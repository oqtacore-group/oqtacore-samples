	Орлов А.И. О проверке однородности двух независимых выборок - Журнал "Заводская лаборатория". 2003. Т.69. No.1. С.55-60.О ПРОВЕРКЕ ОДНОРОДНОСТИ ДВУХ НЕЗАВИСИМЫХ ВЫБОРОК 1 А. И. Орлов 2Показано, что предпосылки двухвыборочного критерия Стьюдента, как правило, не выполняются. Для проверки однородности математических ожиданий вместо критерия Стьюдента предлагается использовать критерий Крамера-Уэлча. Обсуждаются непараметрические критерии для проверки гипотезы однородности функций распределения.Статистические методы применяются в большинстве научных и прикладных работ в области техники и технологии. Среди наиболее популярных - методы проверки однородности двух независимых выборок.  	Началом современного этапа теории статистических методов - математической статистики - можно считать основание К. Пирсоном (К. Pearson) в 1900 г. журнала "Biometrika". В настоящее время в большинстве технических и технико-экономических исследований используются статистические методы, разработанные в основном в первой трети XX века. Объяснение простое - именно они составляют содержание распространенных учебников. Однако математическая статистика бурно развивалась и в последующие 60 с лишним лет [1]. Кроме решения новых задач, изучались свойства традиционных статистических методов, предлагались новые методы для применения в классических постановках. В ряде ситуаций назрела необходимость перехода от классических методов к современным. В качестве примера, разбор которого составляет основное содержание настоящей статьи, рассмотрим задачу проверки однородности двух выборок.  ________________________________________________________ Работа выполнена при поддержке Российского фонда фундаментальных исследований (проект 97-06-80033).2 Московский государственный технический университет  им. Н.Э.Баумана, Москва, Россия.Задача проверки однородностиВ математико-статистических терминах постановка задачи такова: имеются две выборки x1, x2,...,xm и y1, y2,...,yn (т. е. наборы из m и п действительных чисел), требуется проверить их однородность. Термин "однородность" уточняется ниже. Противоположным понятием является "различие". Можно переформулировать задачу: требуется проверить, есть ли различие между выборками. Если различия нет, то для дальнейшего изучения часто выборки объединяют.Традиционный метод проверки однородности (критерий Стьюдента)Для дальнейшего критического разбора опишем традиционный статистический метод проверки однородности. Вычисляют средние арифметические в каждой выборке ,затем выборочные дисперсии ,  и статистику Стьюдента t, на основе которой принимают решение,  .    (1)По заданному уровню значимости a и числу степеней свободы (m+n _ 2) из таблиц распределения Стьюдента находят критическое значение tкр. Если |t|>tкр, то гипотезу однородности (отсутствия различия) отклоняют, если же |t|<tкр, то принимают. (При односторонних альтернативных гипотезах вместо условия |t|>tкр проверяют, что t>tкр; эту постановку рассматривать не будем, так как в ней нет принципиальных отличий от обсуждаемой нами.)Рассмотрим условия применимости традиционного метода проверки однородности, основанного на использовании статистики t Стьюдента, а также укажем более современные методы.Вероятностная модель порождения данныхДля обоснованного применения математико-статистических методов необходимо прежде всего построить и обосновать вероятностную модель порождения данных. При проверке однородности двух выборок общепринята модель, в которой x1, x2,...,xm рассматриваются как результаты m независимых наблюдений некоторой случайной величины Х с функцией распределения F(x), неизвестной статистику, а y1, y2,...,yn - как результаты п независимых наблюдений, вообще говоря, другой случайной величины Y с функцией распределения G(x), также неизвестной статистику. Предполагается также, что наблюдения в одной выборке не зависят от наблюдений в другой, поэтому выборки и называют независимыми.Возможность применения модели в конкретной реальной ситуации требует обоснования. Независимость и одинаковая распределенность результатов наблюдений, входящих в выборку, могут быть установлены или исходя из методики проведения конкретных наблюдений, или путем проверки статистических гипотез независимости и одинаковой распределенности с помощью соответствующих критериев [2, 3].Если проведено (т+п) измерений линейных размеров деталей, то описанную выше модель, как правило, можно применять. Если же, например, xi и yi - результаты наблюдения одного и того же  образца до и после определенного технологического воздействия, то рассматриваемую модель применять нельзя. (В этом случае используют модель т.н. связанных выборок, в которой  обычно строят новую выборку zi = xi - yi и используют статистические методы анализа одной выборки, а не двух.)При дальнейшем изложении принимаем описанную выше вероятностную модель двух выборок.Уточнения понятия однородностиПонятие "однородность", т. е. "отсутствие различия", может быть формализовано в терминах вероятностной модели различными способами.Наивысшая степень однородности достигается, если обе выборки взяты из одной и той же генеральной совокупности, т. е. справедлива нулевая гипотезаH0 : F(x)=G(x) при всех х.Отсутствие однородности означает, что верна альтернативная гипотеза, согласно которойH1 : F(x0)1G(x0) хотя бы при одном значении аргумента x0. Если гипотеза H0  принята, то выборки можно объединить в одну, если нет - то нельзя.В некоторых случаях целесообразно проверять не совпадение функций распределения, а совпадение некоторых характеристик случайных величин Х и Y - математических ожиданий, медиан, дисперсий, коэффициентов вариации и др. Например, однородность математических ожиданий означает, что справедлива гипотезаH'0 : E(X)=E(Y),где Е(Х) и E(Y) - математические ожидания случайных величин Х и Y, результаты наблюдений над которыми составляют первую и вторую выборки соответственно. Различие между выборками в рассматриваемом случае - это справедливость альтернативной гипотезыH'1 : E(X) 1 E(Y) .Если гипотеза H0  верна, то и гипотеза H'0 верна, но из справедливости H'0  не следует справедливость H0 . В частности, если в результате обработки выборочных данных принята гипотеза H'0, то отсюда не следует, что две выборки можно объединить в одну. Однако в ряде ситуаций целесообразна проверка именно гипотезы H'0 .  Например, пусть концентрация SiO2 в мартеновском шлаке определяется  весовым (первая выборка) или фотоколориметрическим (вторая выборка) методами.  Тогда важно проверить гипотезу об отсутствии систематических расхождений результатов весового и фотоколориметрического методов [2], т.е. гипотезу о равенстве математических ожиданий. Другой пример - из медицины труда. Пусть изучается эффективность лечения определенного профессионального заболевания двумя препаратами; результаты наблюдения - число дней нетрудоспособности, а показатель эффективности лечения - среднее число дней нетрудоспособности на одного больного. Тогда для сравнения эффективности препаратов достаточно проверить гипотезу H'0 .Классические условия применимости критерия СтьюдентаПусть выполнены два классических условия применимости критерия Стьюдента, основанного на использовании статистики t, заданной формулой (1):а) результаты наблюдений имеют нормальные распределенияF(x)=N(x; m1, s12) и G(x)=N(x; m2, s22) с математическими ожиданиями m1 и m2 и дисперсиями s12 и s22 в первой и во второй выборках соответственно;б) дисперсии результатов наблюдений в первой и второй выборках совпадают:D(X)=s12=D(Y)=s22.Если условия а) и б) выполнены, то нормальные распределения F(x) и G(x) отличаются только математическими ожиданиями, а поэтому обе гипотезы H0  и H'0  сводятся к гипотезеH"0 : m1=m2, ,а обе альтернативные гипотезы H1 и H'1 сводятся к гипотезеH"1 : m11m2, .Если условия а) и б) выполнены, то статистика t при справедливости H"0 имеет распределение Стьюдента с (т + п - 2) степенями свободы. Только в этом случае описанный выше традиционный метод обоснован безупречно. Если хотя бы одно из условий а) и б) не выполнено, то нет оснований считать, что статистика t имеет распределение Стьюдента, поэтому применение традиционного метода, строго говоря, не обосновано. Обсудим возможность проверки этих условий и последствия их нарушений.О проверке условия нормальностиАприори нет оснований предполагать нормальность распределения результатов технических и технико-экономических наблюдений. Следовательно, нормальность надо проверять. Разработано много статистических критериев для проверки нормальности распределения результатов наблюдений [2]. Однако проверка нормальности - более сложная и трудоемкая статистическая процедура, чем проверка однородности (как с помощью статистики t Стьюдента, так и с использованием непараметрических критериев, рассматриваемых ниже).Для достаточно надежного установления нормальности требуется весьма большое число наблюдений. Так, чтобы гарантировать, что функция распределения результатов наблюдений отличается от некоторой нормальной не более чем на 0,01 (при любом значении аргумента), требуется порядка 2500 наблюдений. В большинстве технических и технико-экономических исследований число наблюдений существенно меньше.Есть и одна общая причина отклонений от нормальности: любой результат наблюдения записывается конечным (обычно 2-5) количеством цифр, а с математической точки зрения вероятность такого события равна 0.Из сказанного выше следует, что распределение результатов технических и технико-экономических наблюдений практически всегда более или менее отличается от нормального. Более подробно это утверждение обосновано в [4]. Последствия нарушения условия нормальностиЕсли условие а) не выполнено, то распределение статистики t не является распределением Стьюдента. Однако при справедливости H'0  и условии б) распределение t при росте объемов выборок приближается к стандартному нормальному распределению Ф(х)=N(x; 0, 1). К этому же распределению приближается распределение Стьюдента при возрастании числа степеней свободы. Другими словами, несмотря на нарушение условия нормальности традиционный метод (критерий Стьюдента) можно использовать для проверки гипотезы H'0 при больших объемах выборок. При этом вместо таблиц распределения Стьюдента достаточно пользоваться таблицами стандартного нормального распределения Ф(х).Сформулированное в предыдущем абзаце утверждение справедливо для любых функций распределения F(x) и G(x) таких, что E(X)=E(Y), D(X)=D(Y) и выполнены некоторые внутриматематические условия, обычно считающиеся справедливыми в реальных задачах [5, 6]. Если же E(X)1E(Y), то при больших объемах выборокP(t<x)"Ф(x-amn),             (2)где.               (3)Формулы (2) - (3) позволяют приближенно вычислять мощность t-критерия (точность возрастает при увеличении т и п).О проверке условия равенства дисперсийИногда условие б) вытекает из методики получения результатов наблюдений, например, когда с помощью одного и того же прибора m раз измеряют характеристику первого объекта и п раз-второго, а параметры распределения погрешностей измерения при этом не меняются. Однако ясно, что в постановках большинства исследовательских и практических задач  нет основании априори  предполагать равенство дисперсий.Целесообразно ли проверять равенство дисперсий статистическими методами, например, как это иногда предлагают, с помощью F-критерия Фишера? Этот критерий основан на нормальности распределений результатов наблюдений, от которой неизбежны отклонения (см. выше), причем в отличие от t-критерия его распределение сильно меняется при малых отклонениях от нормальности [5, 7]. Кроме того, F-критерий отвергает гипотезу D(X)=D(Y) лишь при большом различии выборочных дисперсий. Так, для данных [2] о двух группах результатов химических анализов отношение выборочных дисперсий равно 1,95, т.е. существенно отличается от 1. Тем не менее гипотеза о равенстве теоретических дисперсий принимается на 1% уровне значимости. Следовательно, при проверке однородности применение F-критерия для предварительной проверки равенства дисперсий нецелесообразно.Итак, в большинстве   технических и технико-экономических  задач условие б) нельзя считать выполненным, а проверять его нецелесообразно. Последствия нарушения условия равенства дисперсийЕсли объемы выборок т и п велики, то распределение статистики t описывается с помощью только математических ожиданий Е(Х) и E(Y), дисперсий D(X), D(Y) и отношения объемов выборок:P(t<x)"Ф(bmnx-amn),             (4)где amn определено формулой (3),.                  (5)Если bmn11, то распределение статистики t отличается от распределения, заданного формулой (2), полученной в предположении равенства дисперсий. Когда bmn=1? В двух случаях - при m = n и при D(X) = D(Y). Таким образом, при больших и равных объемах выборок требовать выполнения условия б) нет необходимости. Если объемы выборок мало различаются, то bmn близко к 1. Так, для данных [2] имеем b*mn= 0,987, где b*mn - оценка bmn, полученная заменой в формуле (5) теоретических дисперсий на выборочные.  Область применимости традиционного метода проверки однородности с помощью критерия СтьюдентаПодведем итоги рассмотрения t-критерия. Он позволяет проверять гипотезу H'0 о равенстве математических ожиданий, но не гипотезу H0 о том, что обе выборки взяты из одной и той же генеральной совокупности. Классические условия применимости критерия Стьюдента в подавляющем большинстве технических и технико-экономических задач не выполнены. Тем не менее при больших и примерно равных объемах выборок его можно применять. При конечных объемах выборок традиционный метод носит неустранимо приближенный характер. Критерий Крамера-Уэлча  равенства математических ожиданийВместо критерия Стьюдента предлагаем для проверки H'0  использовать критерий Крамера-Уэлча [8], основанный на статистике.                  (6)Критерий Крамера-Уэлча имеет прозрачный смысл - разность выборочных средних арифметических для двух выборок делится на естественную оценку среднего квадратического отклонения этой разности. Естественность указанной оценки состоит в том, что неизвестные статистику дисперсии заменены их выборочными оценками. Из многомерной центральной предельной теоремы и из теорем о наследовании сходимости [9] вытекает,  что при росте объемов выборок  распределение статистики Т  сходится к стандартному нормальному распределению с математическим ожиданием 0 и дисперсией 1. Итак, при справедливости H'0 и больших объемах выборок распределение статистики Т приближается с помощью стандартного нормального распределения Ф(х), из таблиц которого предлагаем брать критические значения.При т=п, как следует из формул (1) и (6), t=T. При т1п этого равенства нет. В частности, при sx2 в (1) стоит множитель (m-1), а в (6)- множитель п.Если E(X)1E(Y), то при больших объемах выборокP(T<X)"Ф(x-cmn),           (7)где.               (8)При т=п или D(X)=D(Y), согласно формулам (3) и (8), amn=cmn , в остальных случаях равенства нет.Из сказанного выше следует, что применение критерия Крамера-Уэлча не менее обосновано, чем применение критерия Стьюдента. Дополнительное преимущество - не требуется равенства дисперсий D(X)=D(Y). Распределение статистики Т не является распределением Стьюдента, однако и распределение статистики t, как показано выше, не является таковым в реальных ситуациях.Распределение статистики Т при объемах выборок т=п=6, 8, 10, 12 и различных функциях распределений выборок F(x) и G(x) изучено нами совместно с Ю.Э.Камнем и Я.Э.Камнем методом статистических испытаний (Монте-Карло). Рассмотрены различные варианты функций распределения F(x) и G(x). Результаты показывают, что даже при таких небольших объемах выборок точность аппроксимации предельным стандартным нормальным распределением вполне удовлетворительна. Поэтому представляется целесообразным во всех тех случаях, когда в настоящее время используется критерий Стьюдента, заменить его на критерий Крамера-Уэлча. Конечно, такая замена потребует переделки ряда нормативно-технических и методических документов, исправления учебников и учебных пособий для вузов. Непараметрические методы проверки однородностиВ большинстве технических и технико-экономических задач представляет интерес не проверка равенства математических ожиданий, а обнаружение различия генеральных совокупностей, из которых извлечены выборки, т.е. проверка гипотезы H0. Методы проверки гипотезы H0 позволяют обнаружить не только изменение математического ожидания, но и любые иные изменения функции распределения результатов наблюдений при переходе от одной выборки к другой (увеличение разброса, появление асимметрии и т. д.). Как установлено выше, методы, основанные на использовании статистик t Стьюдента  и Т Крамера-Уэлча, не позволяют проверять гипотезу H0 . Априорное предположение о принадлежности функций распределения F(x) и G(x) к какому-либо определенному параметрическому семейству (например, семействам нормальных, логарифмически нормальных, распределений Вейбулла-Гнеденко, гамма-распределений и др.) обычно нельзя достаточно надежно обосновать. Поэтому для проверки H0 следует использовать методы, пригодные при любом виде F(x) и G(x), т.е. непараметрические методы. (Термин "непараметрический метод" означает, что при использовании этого метода нет необходимости предполагать, что функции распределения результатов наблюдений принадлежат какому-либо определенному параметрическому семейству.)Для проверки гипотезы H0  разработано много непараметрических методов - критерии Смирнова, типа омега-квадрат (Лемана-Розенблатта), Вилкоксона (Манна-Уитни), Ван-дер-Вардена, Сэвиджа, хи-квадрат и др. [2, 3, 10]. Распределения статистик всех этих критериев при справедливости H0 не зависят от конкретного вида совпадающих функций распределения F(x)?G(x). Следовательно, таблицами точных и предельных (при больших объемах выборок) распределений статистик этих критериев и их процентных точек [2, 10] можно пользоваться при любых непрерывных функциях распределения результатов наблюдений. Каким из непараметрических критериев пользоваться?Как известно [7], для выбора одного из нескольких критериев необходимо сравнить их мощности, определяемые видом альтернативных гипотез. Сравнению мощностей критериев посвящена обширная литература [11].Хорошо изучены свойства критериев при альтернативной гипотезе сдвигаH1c : G(x)=F(x-d), d10.Критерии Вилкоксона, Ван-дер-Вардена и ряд других ориентированы для применения именно в этой ситуации. Если m раз измеряют характеристику одного объекта и п раз - другого, а функция распределения погрешностей измерения произвольна, но не меняется при переходе от объекта к объекту (это более жесткое требование, чем условие равенства дисперсий), то рассмотрение гипотезы H1c оправдано. Однако в большинстве технических и технико-экономических исследований, в частности при анализе данных об измерениях концентрация SiO2 в мартеновском шлаке весовым или фотоколориметрическим  методами, нет оснований считать, что функции распределения, соответствующие выборкам, различаются только сдвигом.В соответствии с теорией математической статистики естественно потребовать, чтобы рекомендуемый для массового использования в технических и технико-экономических исследованиях критерий однородности был состоятельным [7]. Это значит, что для любых отличных друг от друга функций распределения F(x) и G(x) (другими словами, при справедливости H1) вероятность отклонения гипотезы H0 должна стремиться стремилась к 1 при увеличении объемов выборок т и п. Из перечисленных выше критериев состоятельными являются только критерии Смирнова и омега-квадрат. В частности, критерий Вилкоксона не позволяет отвергнуть гипотезу H0 для таких функций распределения F(x) и G(x), что.                (9)Если F(x) и G(x) не совпадают, но удовлетворяют соотношению (9), то при больших т и п гипотеза H0 принимается столь же часто, как и в случае совпадающих F(x)?G(x). Подробнее это свойство критерия Вилкоксона разобрано в статье [12].Проведенное нами совместно с Ю.Э.Камнем и Я.Э.Камнем исследование мощности (методом статистических испытаний) первых четырех из перечисленных выше критериев (при различных вариантах функций распределения F(x) и G(x)) подтвердило преимущество критериев Смирнова и омега-квадрат и при объемах выборок 6-12. Критерий Смирнова однородности двух выборокОн предложен членом-корр. АН СССР Н.В.Смирновым в 1939 г. [13]. Единственное ограничение - функции распределения F(x) и G(x) должны быть непрерывными. Напомним, что согласно Л.Н.Большеву и Н.В.Смирнову [2]  значение эмпирической функции распределения в точке х равно доле результатов наблюдений в выборке, меньших х. Критерий Смирнова основан на использовании эмпирических функций распределения Fm(x) и Gn(x), построенных по первой и второй выборкам соответственно. Значение статистики Смирновасравнивают с соответствующим критическим значением [2] и по результатам сравнения принимают или отклоняют гипотезу Н0. Практически значение статистики Dm,п рекомендуется [2] вычислять по формулам,,,где x'1<x'2<.x'm  - элементы первой выборки x1,x2,.,xm , переставленные в порядке возрастания, а y'1<y'2<.y'n  - элементы второй выборки y1,y2,.,yn , также переставленные в порядке возрастания.Разработаны алгоритмы и программы для ЭВМ, позволяющие рассчитывать точные распределения, процентные точки и достигаемый уровень значимости [3,14] для статистики Смирнова, разработаны подробные таблицы [15].	Однако у критерия Смирнова есть и недостатки. Его распределение сосредоточено в сравнительно небольшом числе точек, поэтому функция распределения растет большими скачками. В результате не удается выдержать заданный уровень значимости, реальный уровень значимости может в несколько раз отличаться от номинального [16].Критерий типа омега-квадрат (Лемана-Розенблатта)	Статистика критерия типа омега-квадрат для проверки однородности двух независимых выборок имеет вид:A  = Fm(x) - Gn(x))2 dHm+n(x) ,где Hm+n(x) - эмпирическая функция распределения, построенная по объединенной выборке,Hm+n(x) = Fm(x) +   Gn(x) .Статистика A  типа омега-квадрат была предложена Э..Леманом в 1951 г. [17], изучена М.Розенблаттом в 1952 г. [18] и другими исследователями, Она зависит лишь от рангов элементов двух выборок в объединенной выборке:A  =  [ m (ri - i)2 + n (sj  -  j)2 ] - ,где ri  - ранг x'i  и sj  - ранг y'j   в общем вариационном ряду, построенном по объединенной выборке [2].  Рекомендации по выбору критерия однородности 	Для критерия типа омега-квадрат нет выраженного эффекта различия между номинальными и реальными уровнями значимости. Поэтому мы рекомендуем для проверки однородности функций распределения (гипотеза H0) применять статистику А типа омега-квадрат. Если методическое, табличное или программное обеспечение для статистики Лемана-Розенблатта отсутствует, рекомендуем использовать критерий Смирнова. Для проверки однородности математических ожиданий (гипотеза H'0) целесообразно применять критерий Крамера-Уэлча. По нашему мнению, статистики Стьюдента, Вилкоксона и др. допустимо использовать лишь в отдельных частных случаях, рассмотренных выше. О внедрении современных методов прикладной статистики в практику технических и технико-экономических исследованийДаже из проведенного выше разбора лишь одной из типичных статистических задач - задачи проверки однородности двух выборок - можно сделать вывод о целесообразности организации работ по критическому анализу сложившейся в технических и технико-экономических исследованиях практики статистической обработки данных и по внедрению накопленного арсенала современных методов прикладной статистики [1]. По нашему мнению, широкого внедрения заслуживают, в частности, методы многомерного статистического анализа, планирования эксперимента, статистики объектов нечисловой природы. Очевидно, рассматриваемые работы должны быть плановыми, организационно оформленными, проводиться мощными самостоятельными организациями и подразделениями. Целесообразно создание службы статистических консультаций в системе научно-исследовательских учреждений и вузов технического и технико-экономического профиля, идею которой в свое время пропагандировал В.В.Налимов [19] .ЛИТЕРАТУРА1. Орлов А.И. / Заводская лаборатория. 1998. Т.64. № 3. С.52-60.2. Большев Л.Н., Смирнов Н.В. Таблицы математической статистики / 3-е изд. - М.: Наука, 1983. - 474 с.3. Гаек Я., Шидак 3. Теория ранговых критериев / Пер. с англ. - М.: Наука, 1971. - 376 с.4. Орлов А.И. / Заводская лаборатория. 1991. Т.57. № 7. С.64-66.5. Шеффе Г. Дисперсионный анализ / Пер. с англ. / 2-е изд. - М.: Наука, 1980.- 512 с.6. Елисеев В.Г. / Прикладная статистика. - М.: Наука, 1983. - С. 265-267.7. Боровков А.А. Математическая статистика. - М.: Наука, 1984. - 472 с.8. Крамер Г. Математические методы статистики  / Пер. с англ. / 2-е изд. - М.: Мир, 1975. - 648 с.9. Орлов А.И. Устойчивость в социально-экономических моделях. - М.: Наука, 1979, - 296 с.10. Холлендер М., Вулф Д.А. Методы непараметрической статистики / Пер. с англ. - М.: Финансы и статистика, 1983. - 518 с.11. Никитин Я.Ю. Асимптотическая эффективность непараметрических критериев. - М.: Наука, 1995. - 238 с. 12. Орлов А.И. / Заводская лаборатория. 1999. Т.65. № 1. С.51-55.13. Смирнов Н.В. / Бюл. МГУ. Сер.А. 1939. Т.2. №2. С.3-14.14. Орлов А.И. / Заводская лаборатория. 1999. Т.65. № 7. С.46-54.15. Методика. Проверка однородности двух выборок параметров продукции при оценке ее технического уровня и качества. - М.: ВНИИСтандартизации, 1987. - 116 с. 16. Камень Ю.Э., Камень Я.Э., Орлов А.И. / Заводская лаборатория. 1986. Т.52. № 12. С.55-57.17. Lehmann E.L. / Ann. Math. Statist. 1951. V.22. No.1. P.165-179.18. Rosenblatt M. / Ann. Math. Statist. 1952. V.23. No.4. P.617-623.19. Налимов В.В. Теория эксперимента. - М.: Наука, 1971. - 208 с.