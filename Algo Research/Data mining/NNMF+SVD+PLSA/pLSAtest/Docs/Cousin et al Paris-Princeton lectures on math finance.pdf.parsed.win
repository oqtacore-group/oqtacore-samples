
Lecture Notes in Mathematics 2003 Editors: J.-M. Morel, Cachan F. Takens, Groningen B. Teissier, Paris
Areski Cousin : Stephane Crepey Olivier Gueant : David Hobson Monique Jeanblanc : Jean-Michel Lasry Jean-Paul Laurent : Pierre-Louis Lions Peter Tankov Paris-Princeton Lectures on Mathematical Finance 2010 Editors: Rene A. Carmona Erhan Cinlar Ivar Ekeland Elyes Jouini Jose A. Scheinkman Nizar Touzi ABC
Areski Cousin Universite de Lyon Universite Lyon 1 ISFA, 50 Avenue Tony Garnier 69366 Lyon Cedex 07, France areski.cousin@univ-lyon1.fr Prof. Stephane Crepey Universite d'Evry Departement de Mathematiques Cours Monseigneur Romero 91025 Evry Batiment Maupertuis France stephane.crepey@univevry.fr Dr. Olivier Gueant 34, Rue Mazarine 75006 Paris, France olivier.gueant@gmail.com Prof. David Hobson University of Warwick Dept of Statistics Zeeman Building CV4 7AL Coventry United Kingdom D.Hobson@warwick.ac.uk Prof. Monique Jeanblanc Universite d'Evry Val d'Essonne Dept. Mathematiques rue du Pere Jarlan 91025 Evry Cedex, France monique.jeanblanc@univ-evry.fr Jean-Michel Lasry Universite Paris-Dauphine Institut de Finance Place du Marechal de Lattre de Tassigny 75775 Paris Cedex 16 France lasry@dauphine.fr Prof. Jean-Paul Laurent Universite Paris 1 Pantheon-Sorbonne 17 rue de la Sorbonne 7005 Paris France laurent.jeanpaul@free.fr Prof. Pierre-Louis Lions College de France rue d'Ulm 3 75005 Paris CX 05 France pierre-louis.lions@college-de-france.fr Peter Tankov Ecole Polytechnique Centre de Mathematiques Appliquees 91128 Palaiseau Cedex France peter.tankov@polytechnique.org [The addresses of the volume editors appear on page ix] ISBN 978-3-642-14659-6 e-ISBN 978-3-642-14660-2 DOI 10.1007/978-3-642-14660-2 Springer Heidelberg Dordrecht London New York Lecture Notes in Mathematics ISSN print edition: 0075-8434 ISSN electronic edition: 1617-9692 Library of Congress Control Number: 2010936197 Mathematics Subject Classification (2010): 91B28, 91B70, 60G49, 49J55, 60H07, 90C46 c Springer-Verlag Berlin Heidelberg 2011 This work is subject to copyright. All rights are reserved, whether the whole or part of the material is concerned, specifically the rights of translation, reprinting, reuse of illustrations, recitation, broadcasting, reproduction on microfilm or in any other way, and storage in data banks. Duplication of this publication or parts thereof is permitted only under the provisions of the German Copyright Law of September 9, 1965, in its current version, and permission for use must always be obtained from Springer. Violations are liable to prosecution under the German Copyright Law. The use of general descriptive names, registered names, trademarks, etc. in this publication does not imply, even in the absence of a specific statement, that such names are exempt from the relevant protective laws and regulations and therefore free for general use. Cover design: SPi Publisher Services Printed on acid-free paper springer.com
Preface This is the fourth volume of the Paris-Princeton Lectures in Mathematical Finance. The goal of this series is to publish cutting edge research in self-contained articles prepared by established academics or promising young researchers invited by the editors. Contributions are refereed and particular attention is paid to the quality of the exposition, the goal being to publish articles that can serve as introductory references for research. The series is a result of frequent exchanges between researchers in finance and financial mathematics in Paris and Princeton. Many of us felt that the field would benefit from timely exposes of topics in which there is important progress. Rene Carmona, Erhan Cinlar, Ivar Ekeland, Elyes Jouini, Jose Scheinkman and Nizar Touzi serve in the first editorial board of the Paris-Princeton Lectures in Financial Mathematics. Although many of the chapters involve lectures given in Paris or Princeton, we also invite other contributions. Springer Verlag kindly offered to host the initiative under the umbrella of the Lecture Notes in Mathematics series, and we are thankful to Catriona Byrne for her encouragement and her help. This fourth volume contains five chapters. In the first chapter, Areski Cousin, Monique Jeanblanc, and Jean-Paul Laurent discuss risk management and hedging of credit derivatives. The latter are over-the-counter (OTC) financial instruments designed to transfer credit risk associated to a reference entity from one counterparty to another. The agreement involves a seller and a buyer of protection, the seller being committed to cover the losses induced by the default. The popularity of these instruments lead a runaway market of complex derivatives whose risk management did not develop as fast. This first chapter fills the gap by providing rigorous tools for quantifying and hedging counterparty risk in some of these markets. In the second chapter, Stephane Crepey reviews the general theory of forward backward stochastic differential equations and their associated systems of partial integro-differential obstacle problems and applies it to pricing and hedging financial derivatives. Motivated by the optimal stopping and optimal stopping game formulations of American option and convertible bond pricing, he discusses the well-posedness and sensitivities of reflected and doubly reflected Markovian Backward Stochastic Differential Equations. The third part of the paper is devoted to the variational inequality formulation of these problems and to a detailed discussion of viscosity solutions. Finally he also considers discrete path-dependence issues such as dividend payments. v
vi Preface The third chapter written by Olivier Gueant Jean-Michel Lasry and Pierre-Louis Lions presents an original and unified account of the theory and the applications of the mean field games as introduced and developed by Lasry and Lions in a series of lectures and scattered papers. This chapter provides systematic studies illustrating the application of the theory to domains as diverse as population behavior (the so-called Mexican wave), or economics (management of exhaustible resources). Some of the applications concern optimization of individual behavior when interacting with a large population of individuals with similar and possibly competing objectives. The analysis is also shown to apply to growth models and for example, to their application to salary distributions. The fourth chapter is contributed by David Hobson. It is concerned with the applications of the famous Skorohod embedding theorem to the proofs of model independent bounds on the prices of options. Beyond the obvious importance of the financial application, the value of this chapter lies in the insightful and extremely pedagogical presentation of the Skorohod embedding problem and its application to the analysis of martingales with given one-dimensional marginals, providing a oneto-one correspondence between candidate price processes which are consistent with observed call option prices and solutions of the Skorokhod embedding problem, extremal solutions leading to robust model independent prices and hedges for exotic options. The final chapter is concerned with pricing and hedging in exponential Levy models. Peter Tankov discusses three aspects of exponential Levy models: absence of arbitrage, including more recent results on the absence of arbitrage in multidimensional models, properties of implied volatility, and modern approaches to hedging in these models. It is a self contained introduction surveying all the results and techniques that need to be known to be able to handle exponential Levy models in finance. Paris/Princeton The Editors May 4, 2010
Contents Hedging CDO Tranches in a Markovian Environment . . . . . . . . . . . . . . . . . . . . . . . . 1 Areski Cousin, Monique Jeanblanc, and Jean-Paul Laurent About the Pricing Equations in Finance . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 63 Stephane Crepey Mean Field Games and Applications . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .205 Olivier Gueant, Jean-Michel Lasry, and Pierre-Louis Lions The Skorokhod Embedding Problem and Model-Independent Bounds for Option Prices . . . . . . . . . . . . . . . . . . . . . . . . . . . .267 David Hobson Pricing and Hedging in Exponential Levy Models: Review of Recent Results . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .319 Peter Tankov vii
Editors Rene A. Carmona Princeton University Dept. Operations Research & Financial Engineering 08544 Princeton New Jersey ACE-42, E-Quad, USA rcarmona@princeton.edu Erhan Cinlar Princeton University Dept. Operations Research & Financial Engineering 08544 Princeton New Jersey ACE-42, E-Quad, USA ecinlar@princeton.edu Ivar Ekeland University of British Columbia Dept. Mathematics Mathematics Road 1984 V6T 1Z2 Vancouver British Columbia, Canada ekeland@math.ubc.ca Elyes Jouini University of Paris 9, Dauphine CEREMADE Pl. du Marechal DeLattre De Tassigny 75775 Paris CX 16, France jouini@ceremade.dauphine.fr ix
x Editors Jose A. Scheinkman Princeton University Dept. Economics Prospect Ave. 26 08540-5296 Princeton New Jersey, USA joses@princeton.edu Nizar Touzi Ecole Polytechnique CNRS UMR 7641 Centre de Mathematiques Appliquees 91128 Palaiseau CX, France touzi@cmapx.polytechnique.fr
Hedging CDO Tranches in a Markovian Environment Areski Cousin, Monique Jeanblanc, and Jean-Paul Laurent Abstract In this first chapter, we show that a CDO tranche payoff can be perfectly replicated with a self-financed strategy based on the underlying credit default swaps. This extends to any payoff which depends only upon default arrivals, such as basket default swaps. Clearly, the replication result is model dependent and relies on two critical assumptions. First, we preclude the possibility of simultaneous defaults. The other assumption is that credit default swap premiums are adapted to the filtration of default times which therefore can be seen as the relevant information set on economic grounds. Our framework corresponds to a pure contagion model, where the arrivals of defaults lead to jumps in the credit spreads of survived names, the magnitude of which depending upon the names in question, and the whole history of defaults up to the current time. These jumps can be related to the derivatives of the joint survival function of default times. The dynamics of replicating prices of CDO tranches follows the same way. In other words, we only deal with default risks and not with spread risks. Unsurprisingly, the possibility of perfect hedging is associated with a martingale representation theorem under the filtration of default times. Subsequently, we exhibit a new probability measure under which the short term credit spreads (up to some scaling factor due to positive recovery rates) are the intensities associated with the corresponding default times. For ease of presentation, we introduced first some instantaneous default swaps as a convenient basis of hedging instruments. Eventually, we can exhibit a replicating strategy of a CDO tranche payoff with respect A. Cousin () Universite de Lyon, Universite Lyon 1, ISFA, 50 Avenue Tony Garnier, 69366 Lyon Cedex 07, France e-mail: areski.cousin@univ-lyon1.fr M. Jeanblanc Val d'Essonne, Departement de Mathematiques, Universite d'Evry, rue du Pere Jarlan, Evry Cedex 91025, France e-mail: monique.jeanblanc@univ-evry.fr J.-P. Laurent Universite Paris 1 Pantheon-Sorbonne, 17, rue de la Sorbonne, 7005 Paris, France e-mail: laurent.jeanpaul@free.fr A.R. Carmona et al. (eds.), Paris-Princeton Lectures on Mathematical Finance 2010, Lecture Notes in Mathematics 2003, DOI 10.1007/978-3-642-14660-2_1, c Springer-Verlag Berlin Heidelberg 2011 1
2 A. Cousin et al. to actually traded credit default swaps, for instance, with the same maturity as the CDO tranche. Let us note that noMarkovian assumption is required for the existence of such a replicating strategy. However, the practical implementation of actual hedging strategies requires some extra assumptions.We assume that all pre-default intensities are equal and only depend upon the current number of defaults. We also assume that all recovery rates are constant across names and time. In that framework, it can be shown that the aggregate loss process is a homogeneous Markov chain, more precisely a pure death process. Thanks to these restrictions, the model involves as many unknown parameters as the number of underlying names. Such Markovian model is also known as a local intensity model, the simplest form of aggregate loss models. As in local volatility models in the equity derivativesworld, there is a perfect match of unknown parameters from a complete set of CDO tranches quotes. Numerical implementation can be achieved through a binomial tree, well-known to finance people, or by means of Markov chain techniques. We provide some examples and show that the market quotes of CDOs are associated with pronounced contagion effects. We can therefore explain the dynamics of the amount of hedging CDS and relate them to deltas computed by market practitioners. The figures are hopefully roughly the same, the discrepancies being mainly explained by contagion effects leading to an increase of dependence between default times after some defaults. 1 Introduction The risk management and the hedging of credit derivatives and related products are topics of tremendous importance, especially given the recent credit turmoil. The risks at hand are usually split into different categories, which may sometimes overlap, such as credit spread and default risks, correlation and contagion risks. The credit crisis also drove attention to counterparty risk and related issues such as collateral management, downgrading of guarantors and of course liquidity issues. For simplicity, these will not be dealt within this part.1 Credit derivatives are over-the-counter (OTC) financial instruments designed to transfer credit risk of a reference entity between two counterparties by way of a bilateral agreement. The agreement involves a seller of protection and a buyer of protection. The seller of protection is committed to cover the losses induced by the default of a reference entity, typically a corporate. In return, the buyer of protection has to pay at some fixed dates a premium to the seller of protection. By the default, we mean that the entity goes bankrupt or fails to pay a coupon on time, for some of its issued bonds. Even though credit derivatives are traded over-the-counter, credit events are standardized by the International Swap and Derivative Association (ISDA).2 1 See [33] for a discussion of the issues involved. 2 Although ISDA reports a list of six admissible credit events, most of the contracts only include bankruptcy and failure to pay as credit events. This is the case of contracts referencing companies settled in developed countries. The definitions have been last updated in 2003. An overview of these standardized definitions can be found in [54]. However, these are likely to be updated, for instance due to the ISDA big bang protocol.
Hedging CDO Tranches in a Markovian Environment 3 Since credit derivatives involve some counterparty risk, the protection seller may be asked to post some collateral. Also, depending on the market value of the contract, the amount of collateral may be dynamically adjusted. However, after the recent credit crisis and subsequent defaults, settlement procedures had to be updated. Various projects including the ISDA, tend to standardize the cash-flows of credit default swaps (CDS), netting and settlement procedures. It is likely that some market features will change. Nevertheless, the main ideas expressed here will still be valid with some minor adaptation. Financial institutions such as banks, mutual funds, pension funds, insurance and reinsurance companies, monoline insurance companies, corporations or sovereign wealth funds have a natural incentive to use credit derivatives in order to assume, reduce or manage credit exposures. Surprisingly enough, since pricing at the cost of the hedge is the cornerstone of the derivatives modelling field, models that actually connect pricing and hedging issues for CDOs have been studied after the one factor Gaussian copulamodel became a pricing standard. This discrepancy with the equity or interest derivatives fields can actually be seen as a weakness and one can reasonably think that further researches in the credit area will aim at closing the gap between pricing and hedging. Before proceeding further, let us recall the main features in a hedging and risk management problem, which come to light whatever the underlying risks: : A first issue is related to the choice and the liquidity of the hedging instruments: typically, one could think of credit index default swaps, CDS on names with possibly different maturities, standardized synthetic single tranche CDOs and even other products such as equity put options, though this will not be detailed in this part.We reckon that the use of equity products to mitigate risks can be useful in the high yield market, but this is seemingly not the case for CDO tranches related to investment grade portfolios. : A second issue is related to the products to be hedged. In the remainder, we will focus either on single name CDS or basket credit derivatives, such as First to Default Swaps, CDO tranches, bespoke CDOs or tranchelets. We will leave aside interest rate or foreign exchange hybrid products, credit spread options and exotic basket derivatives such as leveraged tranches, forward starting CDOs or tranche options. : A third issue relies on the choice of the hedging method. Themainstream theoretical approach in mathematical finance favors the notion of replication of complex products through dynamic hedging strategies based on plain underlying instruments. However, it is clear that in many cases, risk can be mitigated by offsetting long and short positions, providing either a complete clearing or more usually leaving the dealer exposed to some basis albeit small risk. Moreover, such an approach is obviously quite robust to model risk. Unfortunately, there are some imbalances in customer demand and investment banks can be left with rather large outstanding positions on parts of the capital structure that must be managed up to maturity.
4 A. Cousin et al. 2 Hedging Instruments This section is a primer about hedging of defaultable securities. It aims at presenting a general model of prices and hedging of defaultable claims, in a pure jump setting (there is no Brownian motion involved in our presentation). It also introduces the main hedging instrumentswe will consider throughout this part.We will particularly describe the cash-flows of CDS and derive the dynamics of their price.We also stress the impact of a credit event on the price dynamics of the surviving names. 2.1 Credit Default Swap A CDS is a bilateral over-the-counter agreement which transfers the credit risk of a defined reference entity from a buyer of protection to a seller of protection up to a fixed maturity time T . The reference entity denoted C is typically a corporate or a sovereign obligor. We assume that C may default at a particular time ? which is a non negative random variable constructed on a probability space (?, G, P). The default time ? corresponds to a credit event leading to payment to the protection buyer. Moreover, if C defaults, only a fraction R (the recovery rate) of the initial investment is recovered. Figure 1 illustrates the structure of a CDS. 2.1.1 Cash-Flow Description Let us consider a CDS initiated at time t = 0 with maturity T and nominal value E. The cash-flows of a CDS can be divided in two parts (or legs): the default leg which corresponds to the cash-flows generated by the seller of protection and the premium leg which is the set of cash-flows generated by the protection buyer. For simplicity, we will assume that nor the protection seller, neither the protection buyer can default. Fig. 1 Structure of a credit default swap
Hedging CDO Tranches in a Markovian Environment 5 Default Leg The seller of credit protection (denoted B in Fig. 1) agrees to cover losses induced by the default of the obligor C at time ? if the latter occurs before maturity (? < T). In that case, the payment is exactly equal to the fraction of the loss that is not recovered, i.e., the loss given default E(1 ? R). The settlement procedures in order to determine the recovery rate are not detailed here. The contract is worthless after the default of C. Premium Leg or Fee Leg In return, the buyer of protection (denoted A in Fig. 1) pays a periodic fee to B up to default time ? or until maturity T , whichever comes first. Each premium payment is proportional to a contractual credit spread3 ? and to the nominal value E. More precisely, the protection buyer pays ? - ?i - E to the protection seller B, at every premium payment date 0 < T1 < - - - < Tp = T or until ? < T, where ?i = Ti?Ti?1, i = 1, . . . , p are the time intervals between two premium payment dates.4 Let us remark that premium payments are made in arrears and begin at the end of the fist period (at T1). If default happens between two premium payment dates, say ? ?]Ti?1, Ti[, the protection fee has not been paid yet for the period ]Ti?1, ?]. In that case A will pay B an accrued premium equal to ? - (? ?Ti?1) -E. The accrued premium payment is usually made at time ?. After default of C (t > ?), there are no more cash-flows on the premium leg which is worthless. It is noteworthy that the contractual spread ? is fixed at inception (at t = 0) and remains the same until maturity. It is determined so that the expected discounted cash-flows (under a proper pricing measure to be detailed below) between A and B are the same when the CDS contract is settled. Due to the credit turmoil, some major market participants encourage a change in market convention for single name CDS quotes. In the proposal, the contractual spread will be fixed at ? = 100 bps or ? = 500 bps depending on the quality of the credit. The buyer of protection will have to make an immediate premium payment (upfront payment) to enter the contract (see [5] for more details). 2.2 Theoretical Framework 2.2.1 Default Times In what follows, we consider n default times ?i, i = 1, . . . , n, that is, non-negative and finite random variables constructed on the same probability space (?, G, P). For 3 The contractual spread is quoted in basis points per annum. 4With the convention that T0 = 0.
6 A. Cousin et al. any i = 1, . . . , n, we denote by (Ni t = 1?i?t, t ? 0) the ith default process, and by Hit= ?(Ni s, s ? t) the natural filtration of Ni (after completion and regularization on right).We introduceH, the filtration generated by the processesNi, i = 1, . . . , n, defined as H = H1 ? - - - ? Hn, i.e., Ht = ?n i=1Hit. We denote by ?(1), . . . , ?(n) the ordered default times. Hypothesis 1. We assume that no simultaneous defaults can occur, i.e., P(?i =?j)=0, ?i =j. This assumption is important with respect to the completeness of the market. As shown below, it allows to dynamically hedge credit derivatives referencing a pool of defaultable entities with n credit default swaps.5 Hypothesis 2. We assume that, for any i = 1, . . . , n, there exists a non-negative H-adapted process (?i,P t , t ? 0) such that the process Mi,P t := Ni t ? t 0 ?i,P s ds (1) is a (P,H)-martingale. The process ?i,P is called the (P,H)-intensity of ?i (Note that the value of the intensity depends strongly of the underlying probability). This process vanishes after ?i (otherwise, after ?i, the martingaleMi,P would be continuous and strictly decreasing, which is impossible) and can be written ?i,P t = (1?Ni t )?i,P t for some H1?- - -?Hi?1 ?Hi+1 ?- - -?Hn-adapted process ?i,P (see [6] formore details). In particular, for n = 1, the process ?1,P is deterministic. In terms of the process ?i,P, one has Mi,P t = Ni t ? t??i 0 ?i,P s ds = Ni t ? t 0 (1 ? Ni s)?i,P s ds. Comments. (a) Let us remark that the latter hypothesis is not as strong as it seems to be. Indeed, the process Ni is an increasing H-adapted process, hence an H-submartingale. The Doob-Meyer decomposition implies that there exists a unique increasing H-predictable process ?i such that (Ni t ? ?it, t ? 0) is an H-martingale. We do not enter into details here,6 it's enough to know that a leftcontinuous adapted process is predictable. It is also well known that the process ?i is continuous if and only if ?i is totally inaccessible.7 Here, we restrict our attention to processes ?i which are absolutely continuous with respect to Lebesgue measure. (b) It will be important to keep in mind that the martingaleMi,P has only one jump of size 1 at time ?i. 5 In the general case where multiple defaults could occur, we have to consider possibly 2n states, and we would require non standard credit default swaps with default payments conditionally on all sets of multiple defaults to hedge multiname credit derivatives. 6 The reader is referred to [56] for the definition of a predictable process. A stopping time ? is predictable if there exists a sequence of stopping times ?n such that ?n < ? and ?n converges to ? as n goes to infinity. 7 A stopping time ? is totally inaccessible if P(? = ?) = 0 for any predictable stopping time ?.
Hedging CDO Tranches in a Markovian Environment 7 2.2.2 Market Assumptions For the sake of simplicity, let us assume that instantaneous digital default swaps are traded on the names. An instantaneous digital credit default swap on name i traded at time t is a stylized bilateral agreement between a buyer and a seller of protection. More precisely, the protection buyer receives one monetary unit at time t + dt if name i defaults between t and t + dt. If ?it denotes the contractual spread of this stylized CDS, the seller of protection receives in return a fee equal to ?itdt which is paid at time t + dt by the buyer of protection. The cash-flows associated with a buy protection position on an instantaneous digital default swaps on name i traded at time t are summarized in Fig. 2. Let us also remark that there is no charge at inception (at time t) to enter an instantaneous digital credit default swap trade. Then, its payoff is equal to dNi t ? ?itdt at t + dt where dNi t is the payment on the default leg and ?itdt is the (short term) premium on the default swap. Hypothesis 3. We assume that contractual spreads ?1, . . ., ?n are adapted to the filtration H of default times. The natural filtration of default times can thus be seen as the relevant information on economic grounds. Moreover, since the instantaneous digital credit default swap is worthless after default of name i, credit spreadsmust vanish after ?i, i.e., ?it = 0on the set {t > ?i}. Note that considering such instantaneous digital default swaps rather than actually traded credit default swaps is not a limitation of our purpose. This can rather be seen as a convenient choice of basis from a theoretical point of view. For simplicity, we further assume that (continuously compounded) default-free interest rates are constant and equal to r. Given some initial investment V0 and some H-predictable bounded processes ?1, . . . , ?n associated with some self-financed trading strategy in instantaneous digital credit default swaps, we attain at time T the payoff: V0erT +n i=1 T 0 ?iser(T?s) dNi s ? ?isds. By definition, ?isis the nominal amount of instantaneous digital credit default swap on name i held at time s. This induces a net cash-flow of ?is- dNi s ? ?isdsat time s + ds, which has to be invested in the default-free savings account up to time T . 0 1 ? ?itdt : name i defaults between t and t + dt. ??itdt : survival of name i t t + dt Fig. 2 Cash-flows of an instantaneous digital credit default swap (buy protection position)
8 A. Cousin et al. 2.2.3 Hedging and Martingale Representation Theorem In our framework (we do not have any extra noise in our model, and the intensities do no depend on an exogenous factor), individual default intensities are not driven by a specific spread risk but by the arrival of new defaults: default intensities ?i,P, i = 1, . . . , n are deterministic functions of the past default times between two default dates. More precisely, as we shall prove later on, the intensity of ?i on the set {t; ?(j) ? t < ?(j+1)} is a deterministic function of ?(1), . . . , ?(j). The main mathematical result of the study derives from the predictable representation theorem (see Theorem 9 in [10], Chap. III or [42]). Theorem 1. Let A ? HT be a P-integrable random variable. Then, there exists H-predictable processes ?i, i = 1, . . . , n such that A = EP[A] +n i=1 T 0 ?is dNi s ? ?i,P s ds= EP[A] + n i=1 T 0 ?isdMi,P s , (2) and EP T 0 |?is|?i,P s ds< ?. Proof. We do not enter into details. The idea is to prove that the set of random variables Y = expn i=1 T 0 ?isdMi s ? T 0 (e?is ? 1)?i,P s dswhere ?i are deterministic functions, is total in L2(HT ) and to note that Y satisfies (2): indeed, Y = 1+ n i=1 T 0 ?isY i s?dMi s . Due to the integrability assumption on the r.v. A, and the predictable property of the ?'s, the processes t 0 ?isdMi s, i = 1, . . . , n are (P,H)-martingales. Let us remark that relation (2) implies that the predictable representation theorem (PRT) holds: any (P,H)-martingale can be written in terms of the fundamental martingales Mi,P. Indeed, if MP is a (P,H)-martingale, applying (2) to A = MPT and using the fact that t 0 ?isdMi,P s are martingales, MP t = EP MPT | Ht= EP MPT + n i=1 t 0 ?isdMi,P s . (3) From the PRT, any strictly positive (P,H)-martingale ? with expectation equal to 1 (as any Radon-Nikodym density) can be written as d?t = ?t? n i=1 ?itdMi,P t , ?0 = 1. (4)
Hedging CDO Tranches in a Markovian Environment 9 Indeed, as any martingale, ? admits a representation as d?t =n i=1 ??itdMi,P t , ?0 = 1 Since ? is assumed to be strictly positive, introducing the predictable processes ?i as ?is= 1 ?is? ??isallows to obtain the equality (4). We emphasize that the predictable property of ? is essential to guarantee that the processes ?sdMi s are (local) martingales. Conversely, the Doleans-Dade exponential, (unique) solution of d?t = ?t? n i=1 ?itdMi,P t , ?0 = 1 is a (local) martingale. Note that, in order that ? is indeed a non-negative local martingale, one needs that ?it > ?1. Indeed, the solution of (4) is ?t = exp?t 0 n i=1 ?is?i,P s dsn i=1(1 + ?i?i)Ni t . The process ? is a true martingale under some integrability conditions on ? (e.g., ? bounded) or if EP[?t] = 1 for any t. Note that the jump of ? at time t = ?i is ??t = ?t ? ?t? = ?t??it (so that ?t = ?t?(1 + ?it) at time ?i, hence the condition on ? to preserve non-negativity of ?). Theorem 2. Let ? satisfying (4) with ?it > ?1 and EP[?t] = 1, and define the probability measure Q as dQ|Ht = ?tdP|Ht . Then, the process Mi t := Mi,P t ? t 0 ?is?i,P s ds = Ni t ? t 0 (1 + ?is)?i,P s ds is a Q-martingale. In particular, the (Q,H)-intensity of ?i is ?it = (1+?it)?i,P t . Proof. The process Mi is an (Q,H)-martingale if and only if the processMi? is a (P,H)-martingale. Using integration by parts formula d(Mi t ?t) = Mi t?d?t + ?t?dMi t +?Mi t??t = Mi t?d?t + ?t?dMi,P t ? ?t??it?i,P t dt + ?t??itdNi t = Mi t?d?t + ?t?dMi,P t ? ?t??it?i,P t dt + ?t??it(dMi,P t + ?i,Pdt) = Mi t?d?t + ?t?dMi,P t ? ?t??it?i,P t dt + ?t??itdMi,P t + ?t??it?i,P t dt = Mi t?d?t + ?t? 1 + ?itdMi,P t . 
10 A. Cousin et al. Note that the predictable processes ?i's used to define the Radon-Nikodym density in (4) can be chosen such that the instantaneous credit default swap spreads ?1, . . ., ?n (defined in Sect. 2.2.2) are exactly the (Q,H)-intensities associated with the default times. Let us recall that contractual spreads ?1, . . . , ?n are assumed to be adapted to the natural filtration H of default times. Moreover, from the absence of arbitrage opportunities, the cost of protection is positive if and only if a default risk exists. The latter argument implies that ?1, . . ., ?n are non negative H-adapted processes and ?it > 0P?a.s. = ?i,P t > 0for all time t and all name i = 1, . . . , n. The processes ?i, i = 1, . . . , n defined by ?it = ?it ?i,P t ? 1(1 ? Ni t?), t ? 0, i = 1, . . . , n, (5) are therefore positive H-predictable processes strictly greater than ?1. They are admissible processes to define an equivalent change of probability measure. In the rest of the study, we will work under the probability Q obtained from P through the change of probability measure defined by (4) and (5). It can be proved, using standard arguments that any (Q,H)-martingale can be written as a sum of integrals with respect to Mi. Let M be a (Q,H)-martingale. Then, there exists H-predictable processes ?i such that: Mt = E[MT | Ht] = E[MT] +n i=1 t 0 ?isdMi s, (6) where E is the expectation under Q. Indeed, the process (Mt := Mt?t, t ? 0) being a (P,H)-martingale admits a representation as Mt = M0 + ni=1 t 0 ?isdMi,P s . It suffices to apply integration by parts formula toMt = Mt(?t)?1 to obtain the result. In particular, for A ? HT , one has A = E[A | Ht] + n i=1 T t ?isdMi s. (7) Starting from time t, we can thus replicate the claim A with the initial investment Vt = EAe?r(T?t) | Ht(in the savings account) and the trading strategy based on instantaneous digital credit default swaps defined by ?is= ?ise?r(T?s) for t ? s ? T and i = 1, . . . , n. As there is no initial charge to enter an instantaneous digital credit default swap, Vt = EAe?r(T?t) | Htcorresponds to the time-t replication price of A. Since A depends upon the default indicators of the names up to time T , this encompasses the cases of multiname credit derivatives such as CDO tranches and basket default swaps, provided that recovery rates are deterministic. We can also remark that for a small time interval dt, Vt+dt ? Vt(1 + rdt) + n i=1 ?it dNi t ? ?itdt(8)
Hedging CDO Tranches in a Markovian Environment 11 which is consistent with market practice and regular rebalancing of the replicating portfolio. An investor who wants to be compensated at time t against the price fluctuations of A during a small period dt has to invest Vt in the risk-free asset and take positions ?1, . . . , ?n in the n instantaneous digital credit default swaps. Thanks to the PRT, it is also possible to describe the dynamics of a traditional credit default swap in terms of the dynamics of instantaneous credit default swaps. In the rest of this section we propose to build a general model of default times from the risk-neutral probabilityQ under which any defaultable claim can be replicated using instantaneous credit default swaps. There are variousways to construct such models. One of them, may be the most general in the case of non common defaults, is to start with the joint law of default times, and to make some regularity assumptions on that law (more precisely, that G(t1, . . . , tn) := Q(?1 > t1, . . . , ?i > ti, . . . , ?n > tn) is n-time differentiable with respect to (t1, . . . , tn) and such that G and its derivatives do not vanish). We shall present this approach below, which is closely related to the well-known copula approach. Another way, more tractable but less general, is to specify the form of the intensities (in a Markov setting), and to construct the default times fromthese intensities. This approach will be presented in the following section and may be connected in some cases to the Markov chain used as a first step in a class of top-down models. A third method is to construct the random times as the first passage times at a random level for an increasing process. This last method is interesting for simulation, and allows correlation between the default times, via correlation of the random levels (see [59]). These three approaches both allow to derive the individual CDS spread dynamics as well as the dynamics of the portfolio loss, which will be needed for the pricing and hedging of CDO tranches. In a first part, we shall present computations in the case n = 1. Then, we shall study the case n = 2. 2.3 The Single Default Case We study the case n = 1. Here, ? is a non-negative random variable on the probability space (?, G,Q) with risk-neutral survival function G(t) := Q(? > t) = 1 ? Q(? ? t) = 1 ? F(t) where F is the cumulative distribution function of ?, under Q. We assume that G(t) > 0, ?t, and that G is continuous. Here H = H1. 2.3.1 Some Important Martingales Lemma 1. For any (integrable) random variable X E(X|Ht)1t<? = 1t<? 1 G(t)E(X1t<? ) (9)
12 A. Cousin et al. and for any Borelian (bounded) function h E(h(?)|Ht) = 1??th(?) ? 1t<? 1 G(t) ? t h(u)dG(u). Proof. This well known result is established in a more general setting in [21]. We give here a proof for completeness. For fixed t, the ?-algebra Ht being generated by the random variable ? ? t, any Ht-measurable random variable can be written as h(? ? t) where h is a bounded Borel function. It is then obvious that, on the set {t < ?}, any Ht-measurable random variable is deterministic. Hence, there exists a constant k such that E(X|Ht)1t<? = k1t<? . Taking expectation of both members leads to k = 1 G(t)E(X1t<? ). The second formula follows from E(h(?)|Ht) = h(?)1??t + 1t<? E(h(?)1t<? ) G(t) where we have used (9). The result is obtained with a computation of the last expectation. Note that the minus sign in front of the integral w.r.t. dG is due to the fact that G is decreasing. We now assume that G is differentiable (i.e., that ? admits a density f, so that G(t) = ?f(t)) (see [6] for the general case). Proposition 1. The process (Mt, t ? 0) defined as Mt = Nt ? ??t 0 f(s) G(s) ds = Nt ? t 0 (1 ? Ns) f(s) G(s) ds is an H-martingale. In other terms, the intensity of ? is (1?Nt)?(t) where ?is the deterministic function ?(t) = f(t) G(t) . Proof. Let s < t.Then, from (9), E(Nt ? Ns|Hs) = 1{s<?}E(1{s<??t}|Hs) = 1{s<?}F(t) ? F(s) G(s) . (10) On the other hand, the quantity C := Et s (1 ? Nu) f(u) G(u)duHsis equal toC = t s f(u) G(u) E1{?>u}Hsdu = 1{?>s} t s f(u) G(u) G(u) G(s) du = 1{?>s}F(t) ? F(s) G(s) which, from (10), proves E(Mt ?Ms|Hs) = 0, hence the desired result. 
Hedging CDO Tranches in a Markovian Environment 13 One should not confuse the intensity ? and ?, called the predefault-intensity. The intensity ? is stochastic, and vanishes after ?, the predefault intensity is deterministic. The survival function G can be expressed in terms of the predefault intensity ?. Indeed, we have proved in Proposition 1 that ?(t) = f(t) G(t) = ?G(t) G(t) . Solving this ODE with initial condition G(0) = 1 leads to G(t) = Q(? > t) = exp?t 0 ?(u) du. Note that ?(t)dt = Q(? ? dt|? > t): this is the probability that ? occurs in the interval [t, t + dt] knowing that ? has not yet occurred. 2.3.2 CDS Market Value For the sake of notational simplicity, we assume in this section that the interest rate r is null, so that the price of a savings account is Bt = 1 for every t. We moreover assume that the contractual spread ? is paid in continuous time (i.e., during the time interval [t, t + dt] the amount ?dt is paid by the protection buyer to the protection seller).We also consider that the payment at default time is a deterministic function of the default time, i.e., ?(?), which allows to deal with time dependent recovery rates.8 Let us remark that the results described below can be easily extended to the case of a constant interest rate r or if cash-flows on the premium leg are more realistic. We saw in Sect. 2.1 that the cash-flows of a CDS could be divided in two legs: the default leg and the premium leg. The time-t market value of a buy protection position on a CDS is equal to: Vt(?) = Dt ? ? - Pt, (11) where Dt is the time-t present value of the default leg and Pt is the time-t present value of the premium leg per unit of ?. This corresponds to the amount a buyer of protection is willing to pay (or gain) in order to close his position at time t. Let us recall that the contractual spread ? is such that the CDS market value is equal to zero at inception (V0(?) = 0). 8 ?(?) is equal to the loss given default associated with the reference entity times the notional of the CDS.
14 A. Cousin et al. We first focus on price dynamics of a CDS with spread ? initiated at time 0. The time-t market price of a CDS maturing at T with contractual spread ? is then given by the formula Vt(?) = E?(?)1{t<??T} ? 1{t<?}?(? ? T ) ? tHt. (12) Proposition 2. The price at time t ? [0, T ] of a credit default swap with spread ? is Vt(?) = 1{t<?} Vt(?), ? t ? [0, T ], where Vt(?), a deterministic function, stands for the pre-default value of a CDS and equals Vt(?) = 1 G(t) ?T t ?(u) dG(u) ? ? T t G(u) du. Proof. From Lemma 1, we have, on the set {t < ?}, Vt(?) = ?T t ?(u) dG(u) G(t) ? ??T t udG(u) + TG(T ) G(t) ? t= 1 G(t) ?T t ?(u) dG(u) ? ?TG(T ) ? tG(t) ? T t udG(u). where, in the last equality, we have used an integration by parts to obtain T t G(u) du = TG(T ) ? tG(t) ? T t udG(u) 2.3.3 CDS Market Spreads Like traditional interest-rate swaps, CDS quotations are based on spreads, though this is likely to be modified after the ISDA big bang protocol.Quoted spreadswill be after that only a way to express upfront premiums. Let us consider a CDS initiated at time 0 with maturity T and contractual spread ?. The time-t market spread is defined as the contractual spread of the contract if it would have been initiated at time t. In other words, this is the level of the spread ? = ?(t, T ) that makes a T -maturity CDS worthless at time t. A CDS market spread at time t is thus determined by the equation Vt(?(t, T )) = 0 where Vt is defined in Proposition 2. The T -maturity market spread ?(t, T ) is therefore a solution to the equation T t ?(u) dG(u) + ?(t, T ) T t G(u) du = 0,
Hedging CDO Tranches in a Markovian Environment 15 and thus for every t ? [0, T ], ?(t, T) = ?T t ?(u) dG(u) T t G(u) du . (13) There exists liquidly quoted CDS spreads on most big companies, and standard maturities are T = 3, 5, 7, 10 years. Given (13), it is possible to extract a marketimplied survival distribution G(t) = Q(? > t), t ? 0 from the term structure of CDS market spreads. See Chap. 3 of [59] or Chaps. 2 and 3 of [19] for more details. In what follows, we fix the maturity date T , and we write briefly ?(t) instead of ?(t, T ). There is a simple relationship between credit spreads and market values. The market price of a CDS with payment ? at default, maturity T and contractual spread ? equals, for every t ? [0, T ], Vt(?) = 1{t<?} (?(t) ? ?) T t G(u) du G(t) , or more explicitly, Vt(?) = 1{t<?} T t G(u) du G(t) T 0 ?(u) dG(u) T 0 G(u) du ? T t ?(u) dG(u) T t G(u) du . The latter expression simply means that the value of a CDS contract for a buyer of protection is positive when the current market spread ?(t) is greater than the contractual spread ?. 2.3.4 Dynamics of CDS Prices in a Single Default Setting Proposition 3. The dynamics of the (ex-dividend) price Vt(?) on [0, T ] are dVt(?) = ?Vt?(?)dMt + (1 ? Nt)(? ? ?(t)?(t)) dt, where the (Q,H)-martingaleM is given in Proposition 1. Proof. It suffices to recall thatVt(?) = (1 ? Nt)Vt(?) with V given in Proposition 2, so that, using integration by parts formula, dVt(?) = (1 ? Nt) dVt(?) ? Vt?(?) dNt.
16 A. Cousin et al. Using the explicit expression of Vt(?), we find easily that we have dVt(?) = ?(t)Vt(?) dt + (? ? ?(t)?(t)) dt. The SDE for V (?) follows. It is worthwhile to note that the price dynamics is not a martingale under the riskneutral probability, despite the fact that the interest rate is null. This is because we are dealing with the ex-dividend price. The premium ? is similar to a dividend to be paid, hence the quantity ?(1 ? Nt)dt appears. The quantity ?(t) can be interpreted as a dividend to be received, at time t, with probability ?(t)dt. At default time, the price jumps from V??(?) to 0, as can be seen in the right-hand side of the dynamics. 2.4 Two Default Times Let us now study the case with two random times ?1, ?2. We denote by (Ni t, t ? 0) the default process associated with ?i, i = 1, 2. The filtration generated by the process Ni is denoted Hi and the filtration generated by the two processes N1,N2 is H = H1 ? H2. Note that an H1t ?H2t -measurable random variable is : A constant on the set t < ?1 ? ?2, : A ?(?1 ? ?2)-measurable random variable on the set ?1 ? ?2 ? t < ?1 ? ?2, i.e., a ?(?1)-measurable random variable on the set ?1 ? t < ?2, and a ?(?2)-measurable random variable on the set ?2 ? t < ?1. We recall that a ?(?1)-measurable random variable is a Borel function of ?1. : A ?(?1, ?2)-measurable random variable (i.e., a Borel function h(?1, ?2)) on the set ?1 ? ?2 ? t. To summarize, for fixed t, any H1t ? H2t -measurable random variable Z admits a representation as Z = h1t<?1??2 + h1(?1)1?1?t<?2 + h2(?2)1?2?t<?1 + h(?1, ?2)1?1??2?t . We denote by G(t, s) = Q(?1 > t,?2 > s) the survival probability of the pair (?1, ?2) and we assume that this function is twice differentiable.We denote by ?iG, the partial derivative of G with respect to the ith variable, i = 1, 2. The density of the pair (?1, ?2) is denoted by f. Simultaneous defaults are precluded in this framework, i.e., Q(?1 = ?2) = 0. Even if the case of two default times is more involved, closed form expressions for the intensities are available. It is important to take into account that the choice of the filtration is very important. Indeed, in general, an H1-martingale is not an H1 ? H2-martingale.We shall illustrate this important fact below.
Hedging CDO Tranches in a Markovian Environment 17 2.4.1 Intensities We present the computation of martingales associated with default times ?i, i = 1, 2, in different filtrations. In particular, we shall obtain the computation of the intensities in various filtrations. : Filtration Hi: We study, for any fixed i, the Doob-Meyer decomposition of the submartingale Ni in the filtration Hi. From Proposition 1, the process Ni t ? t??i 0 fi(s) Gi(s)ds (14) is an Hi-martingale. Here, 1 ? Gi(s) = Fi(s) = Q(?i ? s) = s 0 fi(u)du. In other terms, the process (1 ? Ni t ) fi(t) Gi(t) is the Hi-intensity of ?i. : Filtration H: We recall a general result which allows to compute the intensities of a default time (see [27]). Lemma 2. LetG = F?H, where F is a reference filtration andHt = ?(??t) where ? is a random time. Assume that the supermartingale Gt := P(? > t|Ft) admits the Doob-Meyer decomposition Gt = Zt ? At where Z is a martingale and A is a predictable increasing process absolutely continuous with respect to Lebesgue measure. Then Mt = Nt ? t?? 0 dAs Gs is a G-martingale. Proof. The proof relies on the computation of E(Mt ?Ms|Hs) for t > s. See [27] for details. In order to find the intensity of ?1 in a general two defaults setting, we apply the previous lemma to the case F = H2 and H = H1. The first step is to compute the associated supermartingale (under the risk-neutral probability Q). Lemma 3. The H2-supermartingale Q(?1 > t|H2t ) equals G1|2 t := Q(?1 > t|H2t) = N2 t h(t, ?2) + (1 ? N2 t )?(t) (15) where ?(t) = G(t, t)/G(0, t), and h(t, v) = ?2G(t,v) ?2G(0,v) . Proof. From Proposition 1, Q(?1 > t|H2t) = 1t<?2 Q(?1 > t,?2 > t) Q(?2 > t) + 1?2?tQ(?1 > t|?2).
18 A. Cousin et al. It is easy to check that Q(?1 > t|?2 = u) = Q(?1 > t,?2 ? du) Q(?2 ? du) = h(t, u) and the result follows. Proposition 4. Let at = N2 t ?1h(t, ?2) + (1 ? N2 t )?1G(t, t) G(0, t) . The process M1 defined as M1 t := N1 t + t??1 0 as G1|2 s ds = N1 t + t??1??2 0 ?1G(s, s) G(s, s) ds + t??1 t??1??2 ?1,2G(s, ?2) ?2G(s, ?2) ds is an H-martingale. Proof. The proof relies on some Ito's calculus to obtain the Doob-Meyer decomposition of Q(?1 > t|H2t ) and to prove that dAt = atdt. We refer the reader to [8] for details. This means that the H-intensity of ?1 takes into account the knowledge of ?2 and is equal to the deterministic function ??1G(t,t) G(t,t) on the set t < ?2 and to the random quantity ?(t, ?2) where ?(t, s) = ??1,2G(t,s) ?2G(t,s) on the set t ? ?2. In a closed form, the processes Ni t ?t 0 ?isds, i = 1, 2, are martingales in the same filtration H, where ?1t= (1 ? N1 t )(1 ? N2 t )??1G(t, t) G(t, t) ? N2 t ?1,2G(t, ?2) ?2G(t, ?2) = (1 ? N1 t )(1 ? N2 t )?1(t) + (1 ? N1 t )N2 t ?1|2(t, ?2) ?2t= (1 ? N2 t )(1 ? N1 t )??2G(t, t) G(t, t) ? N1 t ?1,2G(?1, t) ?1G(?1, t) = (1 ? N1 t )(1 ? N2 t )?2(t) + N1 t (1 ? N2 t )?2|1(?1, t) where ?i(t) = ? ?iG(t, t) G(t, t) (16) ?1|2(t, s) = ? ?1,2G(t, s) ?2G(t, s) , ?2|1(s, t) = ??1,2G(s, t) ?1G(s, t) . (17)
Hedging CDO Tranches in a Markovian Environment 19 Note that the minus signs in the value of the intensity are due to the fact that G is decreasing with respect to its component, hence the first order derivatives are non-positive and the second order derivative ?1?2G - equal to the density of the pair (?1, ?2) - is non-negative. The quantity ?1(t)dt is equal to Q(?1 ? dt|?1 ? ?2 > t). The quantity ?1|2(t, s) = ? f(t,s) ?2G(t,s) evaluated at s = ?2, represents the value of the predefault intensity process of ?1 with respect to the filtration H on the event {?2 < t}. Let us remark that, in the particular case where ?1 and ?2 are independent (or if ?1 < ?2), the H intensity of ?1 equals its H1 intensity. This model is very general. Let us note that it is not a Markov model, except if h(t, s) does not depend on s (see [6] for a formal proof). Moreover, it can be extended at the price of notational complexity to n names but computations are not so easy, since they involve partial derivatives of the joint survival function and do not usually lead to tractable Markov processes. Since we are working in the same filtration9 the compensated martingale of the counting process Nt = N1 t + N2 t = 2i=1 1?i?t is Mt := Nt ? t 0 ?sds where ?t = ?1t+ ?2t = (1 ? N1 t )(1 ? N2 t )??1G(t, t) + ?2G(t, t) G(t, t) ?(1 ? N1 t )N2 t ?1,2G(t, ?2) ?2G(t, ?2) ? (1 ? N2 t )N1 t ?1,2G(?1, t) ?2G(?1, t) . It is proved in Bielecki et al. [7] that the process N is Markov if and only if the quantities ?1,2G(t,?2) ?2G(t,?2) and ?1,2G(?1,t) ?2G(?1,t) are deterministic. 2.4.2 Dynamics of CDS Prices in a Two Defaults Setting Let us now examine the valuation of a single-name CDS written on the default ?1. Our aim is to show that the dynamics of this CDS will be affected by the information on ?2: when ?2 occurs, the intensity of ?1 changes, and this will change the parameters of the price dynamics. We consider a CDS : With a continuously paid constant premium ?, : Which delivers ?(?1) at time ?1 if ?1 < T, where ? is a deterministic function. In the simplest case ? is constant, corresponding to constant recovery rates. We recall that ? corresponds to the loss given default times the nominal of the CDS. 9 The sum of two martingales in the same filtration is a martingale.
20 A. Cousin et al. The value of the CDS takes the form Vt(?) = Vt(?)1t<?2??1 + Vt(?)1?1??2?t<?1 . First, we restrict our attention to the case t < ?2 ? ?1. Proposition 5. On the set t < ?2 ? ?1, the value of the CDS is Vt(?) = 1 G(t, t) ?T t ?(u)?1G(u, t) du ? ? T t G(u, t) du. Proof. The value V (?) of this CDS, computed in the filtration H including the information related to the second default, is Vt(?) = 1t<?1E(?(?1)1?1?T ? ?((T ? ?1) ? t)|Ht) . Let us denote by ? = ?1 ? ?2 the first default time. Then, 1t<?Vt(?) = 1t<? Vt(?), where Vt(?) = 1 Q(? > t)E(?(?1)1?1?T 1t<? ? ?((T ? ?1) ? t)1t<? ) = 1 G(t, t)E(?(?1)1?1?T 1t<? ? ?((T ? ?1) ? t)1t<? ) = 1 G(t, t) T t ?(u)Q(?1 ? du, ?2 > t) ?? T t (u ? t)Q(?1 ? du, ?2 >t) ? (T ? t)? ? T Q(?1 ? du, ?2 >t). In other terms, using integration by parts formula Vt(?) = 1 G(t, t) ?T t ?(u)?1G(u, t) du ? ? T t G(u, t) du. On the event {?2 ? t < ?1}, the CDS price equals Vt(?) = ? Vt = 1t<?1E(?(?1)1?1?T ? ?((T ? ?1) ? t)|?(?2)) = 1 ?2G(t, ?2) ?T t ?(u)f(u, ?2) du?? T t ?2G(u, ?2) du:= V 1|2 t (?2)
Hedging CDO Tranches in a Markovian Environment 21 whereV 1|2 t (s) = 1 ?2G(t, s) ?T t ?(u)f(u, s) du ? ? T t ?2G(u, s) du. In the financial interpretation, V 1|2 t (s) is the market price at time t of a CDS on the first credit name, under the assumption that the default ?2 occurred at time s and the first name has not yet defaulted (recall that simultaneous defaults are excluded, since we have assumed that G is differentiable). Differentiating the deterministic function which gives the value of the CDS leads to the following result: Proposition 6. The price of a CDS is Vt(?) = Vt(?)1t<?2??1 + ?Vt(?)1?2??1?t<?1 . The dynamics of V (?) are dVt(?) = ?1(t) + ?2(t)Vt(?) + ? ? ?1(t)?(t) ? ?2(t)V 1|2 t (t)dt, where for i = 1, 2 the function ?i(t) is the (deterministic) pre-default intensity of ?i given in (16). The dynamics of V (?) are dVt(?) = ?1|2(t, ?2) Vt(?) ? ?(t)+ ?dt where ?1|2(t, s) is given in (17). Hence, differentiating Vt = Vt(1 ? N1 t )(1 ? N2 t ) + ?Vt(1 ? N1 t )N2 t one obtains dVt = (1 ? N1 t )(1 ? N2 t )dVt + (1 ? N1 t )N2 t dVt ? Vt?dN1 t +(1 ? N1 t )(V 1|2 t (t) ? Vt)dN2 t which leads after light computations10 to dVt = (1?N1 t )(1?N2 t )(? ? ?(t)?1(t))dt+(1 ? N1 t )N2 t (? ? ?(t)?1|2(t, ?2))dt ?Vt?dM1 t + (1 ? N1 t )(V 1|2 t (t) ? Vt)dM2 t = dividend part ? Vt?dM1 t + (1 ? N1 t )(V 1|2 t (t) ? Vt)dM2 t . (18) 10 From the definition, one has dVt = (1 ? N1t )(1 ? N2t ) - - - + (1 ? N1t )(Vt(?2) ? Vt)dN2t . It is important to note that Vt(?2)dN2t = V 1|2 t (t)dN2t : a computation using Vt(?2)dN2t = Vt(?2)(dM2t + . . . dt) would lead to a quantity Vt(?2)dM2t which has a meaning, but which is NOT a martingale, due to the lack of adapteness of the coefficient Vt(?2).
22 A. Cousin et al. Assume now that a CDS written on ?2 is also traded in the market.We denote by V i, i = 1, 2 the prices of the two CDS. Since the CDS are paying premiums, a self financing strategy consisting in ?i units of CDS's has value Xt = ?1tV 1 t + ?2tV 2 t and dynamics dXt = ?1t ?V 1 t?dM1 t + (1 ? N1 t )(V 1|2 t (t) ? V 1 t )dM2 t +?2t ?V 2 t?dM2 t + (1 ? N2 t )(V 2|1 t (t) ? V 2 t )dM1 t = ??1tV 1 t? + ?2t(1 ? N2 t )(V 2|1 t (t) ? V 2 t dM1 t +?1t(1 ? N1 t )(V 1|2 t (t) ? V 1 t ) ? ?2tV 2 t?dM2 t . In order to duplicate a claim with value At = E(A) + t 0 ?1tdM1 t + t 0 ?2tdM2 t it remains to solve the linear system ?? ???1tV 1 t? + ?2t(1 ? N2 t )(V 2|1 t (t) ? V 2 t ) = ?1t , ?1t(1 ? N1 t )(V 1|2 t (t) ? V 1 t ) ? ?2tV 2 t? = ?2t . Thus, under standard invertibility conditions, one can easily use actually traded CDS instead of instantaneous digital CDS when replicating the claim A. 3 Hedging Default Risks of CDOs in Markovian Contagion Models When dealing with CDO tranches, the market approach to the derivation of credit default swap deltas consists in bumping the credit curves of the names and computing the ratios of changes in present value of the CDO tranches and the hedging credit default swaps. This involves a pricing engine for CDO tranches, usually some mixture of copula and base correlation approaches, leading to some "market delta." The only rationale of this modus operandi is local hedging with respect to credit spread risks, provided that the trading books are marked-to-market with the same pricing engine. Even when dealing with small changes in credit spreads, there is no guarantee that this would lead to appropriate hedging strategies, especially to cover large spread widenings and possibly defaults. Also, one could think of changes in base correlation correlated with changes in credit spreads.
Hedging CDO Tranches in a Markovian Environment 23 A number of CDO hedging anomalies in the base correlation approach are reported in [52]. Moreover, the standard approach is not associated with a replicating theory, thus inducing the possibility of unexplained drifts and time decay effects in the present value of hedged portfolios (see [55]). Unfortunately, the trading desks cannot rely on a sound theory to determine replicating prices of CDO tranches. This is partly due to the dimensionality issue, partly to the stacking of credit spread and default risks. Laurent [45] considers the case of multivariate intensities in a conditionally independent framework and shows that for large portfolios where default risks are well diversified, one can concentrate on the hedging of credit spread risks and control the hedging errors. In this approach, the key assumption is the absence of contagion effects which implies that credit spreads of survival names do not jump at default times, or equivalently that defaults are not informative.Whether one should rely on this assumption is to be considered with caution, as discussed in the empirical studies [4] and [16].11 Moreover, anecdotal evidence such as the failures of Delphi, Enron, Parmalat and WorldCom shows mixed results. In this section, we adopt the framework of Laurent et al. [47], concentrating on default risks, credit spreads and dependence dynamics being driven by the arrival of defaults. We will calculate so-called "credit deltas," that are the present value impacts of some default event on a given CDO tranche, divided by the present value impact of the hedging instrument (here the underlying index) under the same scenario. Contagion models were introduced to the credit field by Davis and Lo [17], Jarrow and Yu [38] and further studied by Yu [65]. Schonbucher and Schubert [61] show that copula models exhibit some contagion effects and relate jumps of credit spreads at default times to the partial derivatives of the copula. This is also the framework used by Bielecki et al. [8] to address the hedging issue.We refer to Sect. 2.4 of this contribution for a detailed discussion of this topic. A similar but somehowmore tractable approach has been considered by Frey and Backhaus [31], since the latter paper considers some Markovian models of contagion. In a copula model, the contagion effects are computed from the dependence structure of default times, while in contagion models the intensity dynamics are the inputs from which the dependence structure of default times is derived. In both approaches, credit spreads shifts occur only at default times. Thanks to this quite simplistic assumption, and provided that no simultaneous defaults occurs, it can be shown that the CDO market is complete, i.e., CDO tranche cash-flows can be fully replicated by dynamically trading individual credit default swaps or, in some cases, by trading the credit default swap index (see Sect. 2.2.3 of this contribution for a presentation of the theoretical ideas). In this section we focus on the hedging of synthetic CDO tranches. For the section to be self-contained, we briefly describe in Sect. 3.1 the cash-flows of a 11 The conclusions of this paper have been disputed by [44] in which the conditional independence assumption has not been rejected when tested on the same default database. These discrepancies are explained by an alternative specification of individual default intensities.
24 A. Cousin et al. synthetic CDO tranche. While the use of the representation Theorem 1 guarantees that, in our framework, any basket default swap can be perfectly hedged with respect to default risks, it does not provide a practical way of constructing hedging strategies. In Sect. 3.2, we restrict ourselves to the case of homogeneous portfolios with Markovian intensities which results in a dramatic dimensionality reduction for the (risk-neutral) valuation of CDO tranches and the hedging of such tranches as well. We find out that the aggregate loss is associated with a pure birth process, which is now well documented in the credit literature. Section 3.3 provides an overview of the calibration methods proposed in the literature on contagion credit risk models. We investigate in particular a calibration method based on the marginal distributions of the number of defaults. Section 3.4 details the computation of replicating strategies of CDO tranches with respect to the credit default swap index, through a recombining tree on the aggregate loss. We discuss how hedging strategies are related to dependence assumptions in Gaussian copula and base correlation frameworks. We also compare the replicating strategies obtained in the contagion model with the hedging ratios (spread sensitivity ratios) provided by the Gaussian copula approach or computed in alternative credit risk models. 3.1 Synthetic CDO Tranches Synthetic CDOs are structured products based on an underlying portfolio of reference entities subject to credit risk. It allows investors to sell protection on specific risky portion or tranche of the underlying credit portfolio depending on their desired risk-profile. A synthetic CDO structure is initially arranged by a financial institution (typically an investment bank) which holds a credit portfolio composed of CDS (see Fig. 3). This CDS portfolio is then transferred to a subsidiary company commonly called a special purpose vehicle (SPV). The SPV redistributes the credit risk of the underlying portfolio by raising specific credit-protection products corresponding to different levels of risk. The SPV liability side is defined by the different tranches that have been sold and the asset side corresponds to the portfolio of CDS. The incomes generated by the pool of CDS (premium payments) are re-allocated to the different tranches using a precise prioritization scheme. An investor (seller of protection) on a CDO tranche receives a higher premium if the tranche has a lower level of subordination. For example, the equity tranche which covers the fist losses on the underlying portfolio receives the highest income. 3.1.1 Credit Default Swap Indices A credit default swap Index (CDS Index) is a multi-name credit derivative which allows market participants to buy and sell protection directly on a pool of CDS.
Hedging CDO Tranches in a Markovian Environment 25 Originated bank, protection buyer CDS premium Payment in case of default SPV Equity tranche (exposed to first 3% losses) Mezzanine tranche (exposed to 3% -6% losses) Mezzanine tranche (exposed to 6%-9% losses) Senior tranche (exposed to 9%-12% losses) Super senior tranche (exposed to 12%-22% losses) Asset Liability Pool of CDS Pool of Tranches Tranche premium Payment when the tranche is impacted by a default Fig. 3 Structure of a synthetic CDO CDS indices are actively traded. This means that it can be easier to hedge a credit derivatives referencing a portfolio of CDS with an index than it would be to buy many CDS to achieve a similar effect. This is the reason why a popular use of CDS indices is to hedge multi-name credit positions. There are currently two main families of CDS indices: CDX and iTraxx. CDX indices contain North American and Emerging Market companies and iTraxx contain companies from the rest of the world (mainly Europe and Asia). The iTraxx Europe Main and the CDX North America Main are the most liquid CDS indices. Each Main index includes 125 equally weighted CDS issuers from their respective region.12 These issuers are investment grade at the time an index series is launched, with a new series launched every 6 months. In practice, "on the run" Main indices are mostly composed of A-rated and BBB-rated issuers. 3.1.2 Standardized CDO Tranches Market-makers of these indices have also agreed to quote standard tranches on these portfolios from equity or first loss tranches to the most senior tranches. Each tranche is defined by its attachment pointwhich defines the level of subordination and its detachment point which defines the maximum loss of the underlying portfolio that would result in a full loss of tranche notional. The first-loss 0-3% equity tranche is exposed to the first several defaults in the underlying portfolio. This tranche is the riskiest as there is no benefit of subordination but it also offers 12 The proportion of each issuer in the pool is equal to 1/125 = 0.08%.
26 A. Cousin et al. Fig. 4 Standardized CDO tranches on iTraxx Europe Main iTraxx Europe Main 125 CDS, Investment Grade 0% 3% 6% 9% 12% 20% Equity Senior Mezzanine First Super Senior Second Super Senior 100% Junior Mezzanine Senior Spreads, level of subordination Fig. 5 Standardized CDO tranches on CDX North America Main CDX North America Main 125 CDS, Investment Grade 0% 3% 7% 10% 15% 30% Equity Senior Mezzanine First Super Senior Second Super Senior 100% Junior Mezzanine Senior Spreads, level of subordination high returns if no defaults occur. The junior mezzanine 3-6% and the senior mezzanine 6-9% tranches are less immediately exposed to the portfolio defaults but the premium received by the protection seller is smaller than for the equity tranche. The 9-12% tranche is the senior tranche, while the 12-20% tranche is the low-risk super senior piece. As illustrated in Figs. 4 and 5, the tranching of the indices in Europe and North America is different. In North America, the CDX index is tranched into standard classes representing equity 0-3%, junior mezzanine 3-7%, senior mezzanine 7-10%, senior 10-15% and super senior 15-30% tranche. For a detailed description of the credit derivatives market, the reader is referred to the textbooks [15, 19, 39, 49, 59]. Before addressing the hedging issue of CDO tranches, let us describe the cash-flows associated with these products.
Hedging CDO Tranches in a Markovian Environment 27 3.1.3 Cash-Flows Description We adopt the same notation as in Sect. 2 and we work under the risk-neutral probability Q defined in Sect. 2.2.3.We consider a portfolio of n credit references and we denote by (?1, . . . , ?n) the random vector of default times defined on the probability space (?, G,Q). If name i defaults, it drives a loss of ?i = Ei (1 ? Ri) where Ei denotes the nominal amount and Ri the recovery rate. The loss given default ?i is assumed here to be constant over time. The key quantity for the pricing of synthetic CDO tranches is the cumulative loss Lt =n i=1 ?iNi t , where Ni t = 1{?i?t}, i = 1, . . . , n are the default indicator processes associated with default time ?i, i = 1, . . . , n. Let us recall that the processes Ni, i = 1, . . . , n are adapted to the global filtration H = (Ht, t ? 0) where Ht = ?n i=1Hitand Hit= ?(Ni s, s ? t). Let us remark at this stage that the loss process L is an increasing right-continuous pure jump process. The cash-flows associated with a synthetic CDO tranche only depend upon the realized path of the cumulative loss process L. Default losses on the reference portfolio are split along some thresholds (attachment and detachment points) and allocated to the various tranches. A synthetic CDO tranche can be viewed as a bilateral contract between a protection seller and a protection buyer. In what follows, we consider a synthetic CDO tranche with attachment point a, detachment point b and maturity T and we describe the cash-flows associated with the default payment leg (payments received by the protection buyer) and the cash-flows associated with the premium payment leg (payments received by the protection seller). Default Payments Leg The protection seller agrees to pay the protection buyer default losses each time they impact the tranche (a, b) of the reference portfolio. More precisely, the cumulative default payment L(a,b) t on the tranche [a, b] is equal to zero if Lt ? a, to Lt ? a if a ? Lt ? b and to b?a if Lt ? b. Let us remark that L(a,b) t has a call spread payoff with respect to Lt and can be expressed as L(a,b) t = (Lt ? a)+?(Lt ? b)+. Default payments are simply equal to the increment of L(a,b) t , i.e., there is a payment of L(a,b) t ?L(a,b) t? fromthe protection seller at every time a jump of L(a,b) t occurs before contract maturity T . Figure 6 shows a realized path of the loss process (Lt, t ? 0) and the corresponding path of losses affecting CDO tranche [a, b]. For simplicity we assume that the continuously compounded default free interest rate rt is deterministic and we denote Bt(t) = exp?tt rsdsthe time-t
28 A. Cousin et al. Lt ab t b ? a Lt, Lt(a,b) Lt (a,b) Fig. 6 A realized path of the reference portfolio losses and the corresponding path of losses affecting CDO tranche [a, b]. Jumps occur at default times discount factor up to time t(t ? t). At time t, the discounted payoff corresponding to default payments after time t can written as: T t Bt(s)dL(a,b) s :=n i=1 Bt(?i) L(a,b) ?i ? L(a,b) ?i? 1{t<?i?T}. (19) Thanks to Stieltjes integration by parts formula and Fubini theorem, the time-t price of the default payment leg under the risk-neutral measure can be expressed as: Dt = ET t Bt(s)dL(a,b) s | Ht= Bt(T )E L(a,b) T | Ht! ? L(a,b) t + T t rsBt(s)E L(a,b) s | Ht! ds. Premium Payments Leg The protection buyer has to pay the protection seller a periodic premium payment (quarterly for standardized indexes) based on a fixed contractual spread ? and proportional to the current outstanding nominal of the tranche b ? a ? L(a,b) t . Let us denote by T1 < . . . < Tp, the premium payment dates with Tp = T and by ?i the length of the i-th period [Ti?1, Ti] (in fractions of a year and with convention T0 = 0). The CDO premium payments are equal to ??i b ? a ? L(a,b) Ti at regular payment dates Ti, i = 1, . . . , p. Moreover, when a default occurs between two premium payment dates and when it affects the tranche, an additional payment (the accrued coupon) must be made at default time to compensate the change in value of the tranche outstanding nominal. For example, if name j defaults between Ti?1
Hedging CDO Tranches in a Markovian Environment 29 and Ti, the associated accrued coupon is equal to ? (?j ? Ti?1) L(a,b) ?j ? L(a,b) ?j? . Eventually, at time t, the discounted payoff corresponding to premium payments can be expressed as: p i=pt Bt(Ti)??i b ? a ? L(a,b) Ti + Ti Ti?1 Bt(s)? (s ? Ti?1) dL(a,b) s , (20) where pt = inf {i = 1, . . . , p | Ti > t} is the index of the first premium payment date after time t and Tpt?1 = t by convention. Using the same computational method as for the default leg, the time-t present value of the premium leg under the risk-neutral measure, denoted Pt, can be expressed as: Pt = ? - Pu t , (21) with Pu t = p i=pt Bt(Ti)?i b ? a ? E L(a,b) Ti | Ht!+ ACi,t, (22) and where ACi,t = Bt(Ti)?iE L(a,b) Ti | Ht! ? Ti Ti?1 Bt(s) (1 ? rs (s ? Ti?1)) ?E L(a,b) s | Ht! ds. (23) The quantity Pu t corresponds to the time-t present value of the unitary premium leg (contractual spread ? equal to 1 bp). The CDO tranche (contractual) spread ? is chosen such that the contract is fair at inception, i.e., such that the default payment leg is equal to the premium payment leg: ? = D0 Pu 0 . The spread ? is quoted in basis point per annum.13 Let us remark that the computation of ? only involves the expected losses on the tranche, E L(a,b) t ! at different time horizons. These can readily be derived from the marginal distributions of the aggregate loss on the reference portfolio. 13 Let us remark that market conventions are different for the pricing of equity tranches (CDO tranches (0, b) with 0 < b ? 1). Due to the high level of risk embedded in these "first losses tranches," the premium ? is fixed beforehand at 500 bps per annum and the protection seller receives an additional payment at inception based on an "upfront premium" and proportional to the size of the tranche. This "upfront premium" is quoted in percentage of the nominal value.
30 A. Cousin et al. 3.1.4 CDO Tranche Price and Market Spread The time-t price (buy protection position) of a CDO tranche (a, b) is such that Vt(?) = Dt ? ? - Pu t . This corresponds to the amount a buyer of protection is willing to pay (or gain) in order to close his position at time t. Let us note that this is consistent with the definition of the contractual spread ? for which the market value must be equal to zero at inception (V0(?) = 0). Like CDS, most CDO tranche quotations are based on spreads. The time-t market spread is defined as the contractual spread of a tranche with the same characteristic but initiated at time t: ?t = Dt Pu t . Let us also note that there is a simple relationship between credit spreads and market values: Vt(?) = Pu t (?t ? ?). The latter expression simply means that the value of a CDO tranche contract for a buyer of protection is positive when the current market spread is greater than the contractual spread. As illustrated in Sect. 3.1.2, there exists liquidly quoted CDO tranches on most CDS indices. Figure 7 shows the dynamics of credit spreads on the 5 year iTraxx index between May and November 2007.14 It is interesting to observe a sharp bump corresponding to the summer 2007 credit crisis. 15 25 35 45 55 65 75 85 95 105 115 125 135 145 155 165 30/03/07 20/04/07 11/05/07 01/06/07 22/06/07 13/07/07 03/08/07 24/08/07 14/09/07 05/10/07 26/10/07 16/11/07 07/12/07 28/12/07 18/01/08 08/02/08 29/02/08 21/03/08 11/04/08 02/05/08 Fig. 7 Credit spreads on the 5 years iTraxx index (Series 7, 8 and 9) in bps, source Markit 14 Apart from details regarding the premium leg, cash-flows generated by a CDS index can be considered to be the same as the ones of a [0, 100%] CDO tranche.
Hedging CDO Tranches in a Markovian Environment 31 3.2 Homogeneous Markovian Contagion Models While the use of the representation Theorem 1 guarantees that, in our framework, any basket default swap can be perfectly hedged with respect to default risks, it does not provide a practical way of constructing hedging strategies. As is the case with interest rate or equity derivatives, exhibiting hedging strategies involves some Markovian assumptions. 3.2.1 Intensity Specification In the contagion approach, one starts from a specification of the risk-neutral predefault intensities15 ??1, . . . , ??n. In Sect. 2, risk-neutral predefault intensities depend upon the complete history of defaults. More simplistically, it is often assumed that they depend only upon the current credit status, i.e., the default indicators; thus ??it, i = 1, . . . , n are deterministic functions of N1 t , . . . , Nnt . In this paper, we will further remain in this Markovian framework, i.e., the default intensities will take the form ??it = ??i t,N1 t , . . . , Nnt , i = 1, . . . , n. (24) This Markovian assumption may be questionable, since the contagion effect of a default event may vanish as time goes by. The Hawkes process, that was used in the credit field by Giesecke and Goldberg (see [29] or [34]), provides such an example of a more complex time dependence. Other specifications with the same aim are discussed in [48]. Popular examples are the models of [38,42,65], where the intensities are affine functions of the default indicators. The connection between contagion models and Markov chains is described in the book of Lando [43]. More recently, Herbertsson and Rootzen [37] proved that default times with default intensities defined by (24) could be represented as the times until absorption in a finite state absorbing Markov chain. According to Assaf et al. [3] terminology, default times follow a multivariate phase-type distribution in this framework. Another practical issue is related to name heterogeneity. Modelling all possible interactions amongst names leads to a huge number of contagion parameters and high-dimensional problems, thus to numerical issues. For this practical purpose, we will further restrict to models where all the names share the same risk-neutral intensity.16 This can be viewed as a reasonable assumption for CDO tranches on large indices, although this is an issue with equity tranches for which idiosyncratic risk is an important feature. Since risk-neutral predefault intensities, ??1, . . . , ??n are equal, we will further denote these individual predefault intensities by ??. For further tractability, we will further rely on a strong name homogeneity assumption, that individual predefault intensities only depend upon the number of 15 Let us recall that the default intensity of name i vanishes after ?i, i.e., ?it = 0on the set {t > ?i}. 16 This means that the predefault intensities have the same functional dependence to the default indicators.
32 A. Cousin et al. defaults. Let us denote by Nt = ni=1 Ni t the number of defaults at time t within the pool of assets. Predefault intensities thus take the form17 ??it = ?? (t,Nt). This is related to mean-field approaches (see [31]). As for parametric specifications, we can think of some additive effects, i.e., the predefault name intensities take the form ?? (t,Nt) = a+b?Nt for some constants a, b as mentioned in [31], corresponding to the "linear counterparty risk model," or multiplicative effects in the spirit of Davis and Lo [17], i.e., the predefault intensities take the form ?? (t,Nt) = a ? bNt. Of course, we could think of a non-parametric model. We provide a calibration procedure of such unconstrained intensities onto market inputs in Sect. 3.3. For simplicity, we will further assume a constant recovery rate equal to R and a constant exposure among the underlying names. The aggregate fractional loss at time t is given by: Lt = (1? R) Nt n . As a consequence of the no simultaneous defaults assumption, the intensity of Lt or of Nt is simply the sum of the individual default intensities and is itself only a function of the number of defaults process. Let us denote by ? (t,Nt) the risk-neutral loss intensity. It is related to the individual predefault intensities by:?(t,Nt) = (n ? Nt) ? ?? (t,Nt). We are thus typically in a bottom-up approach, where one starts with the specification of name intensities and thus derives the dynamics of the aggregate loss. 3.2.2 Risk-Neutral Pricing Let us remark that in a Markovian homogeneous contagion model, the process Nt is a continuous time Markov chain (under the risk-neutral probability Q), and more precisely a pure birth process, according to Karlin and Taylor [40] terminology,18 since only single defaults can occur.19 The generator of the chain, ?(t) is quite simple: ?(t) = ??????? ??(t, 0) ?(t, 0) 0 - - - 0 0 ??(t, 1) ?(t, 1) - - - 0 ... .... . . . . . ... 0 ??(t, n ? 1) ?(t, n ? 1) 0 0 0 0 0 ???????. Such a simple model of the number of defaults dynamics was considered in [60] where it is called the "one-step representation of the loss distribution." The approach 17 Let us remark that on {?i > t}, Nt = j=i Nj t , so that the predefault intensity of name i, actually only depends on the credit status of the other names. 18 According to Feller's terminology, we should speak of a pure death process. Since, we later refer to [40], we prefer their terminology. 19 Regarding the assumption of no simultaneous defaults, we also refer to [11, 57, 64]. Allowing for multiple defaults could actually ease the calibration to senior CDO tranche quotes.
Hedging CDO Tranches in a Markovian Environment 33 described in this section can be seen as a bottom-up view of the previous model, where the risk-neutral prices can actually be viewed as replicating prices. As an example of this approach, let us consider the replication price of a European payoff with payment date T , such as a "zero-coupon tranchelet," paying 1{NT=k} at time T for some k ? {0, 1, . . . , n}. Let us denote by V (t,Nt) = e?r(T?t)Q(NT = k |Nt ) the time-t replication price and by V (t, .) the price vector whose components are V (t, 0), V (t, 1), . . . , V (t, n) for 0 ? t ? T . We can thus relate the price vector V (t, .) to the terminal payoff, using the transition matrix Q(t, T ) between dates t and T : V (t, .) = e?r(T?t)Q(t, T )V (T, .), (25) where V (T, j) = 1{j=k}, j = 0, 1, . . . , n. The transition matrix solves for the Kolmogorov backward and forward equations: ?Q(t, T ) ?t = ??(t)Q(t, T ), ?Q(t, T ) ?T = Q(t, T )?(T ). (26) In the time homogeneous case, i.e., when the generator is a constant ?(t) = ?, the transition matrix can be written in exponential form: Q(t, T) = exp((T ? t)?) . (27) These ideas have been put in practice by [1, 18, 28, 36, 37, 48, 63]. These papers focus on the pricing of credit derivatives, while our concern here is the feasibility and implementation of replicating strategies. 3.2.3 Computation of Credit Deltas We recall that the credit delta with respect to name i is the amount of hedging instruments (the index here, but possibly a ith credit default swap) that should be bought to be protected against a sudden default of name i. A nice feature of homogeneous contagion models is that the credit deltas are the same for all (the non-defaulted) names, which results in a dramatic dimensionality reduction. In that case, it is enough to consider the index portfolio as a single hedging instrument, which is consistent with some market practices. Let us consider a European type payoff20 and denote its replication price at time t by V (t, .). In order to compute the credit deltas, let us remark that, by Ito's lemma, dV (t,Nt) = ?V (t,Nt?) ?t dt + (V (t,Nt) ? V (t,Nt?)) dNt = ?V (t,Nt?) ?t dt + (V (t,Nt? + 1) ? V (t,Nt?)) dNt. 20 For notational simplicity, we assume that there are no intermediate payments. This corresponds for instance to the case of zero-coupon CDO tranches with up-front premiums. The more general case is considered in Sect. 3.4.
34 A. Cousin et al. The second term in the right hand side of the latter expression, V (t,Nt? + 1) ? V (t,Nt?) is associated with the jump in the price process when a default occurs in the credit portfolio, i.e., dNt = 1. Thanks to the fact that dNt = n i=1 dNi t and, since e?rtV (t,Nt) is a (Q,H)-martingale, it can be seen using Ito's lemma that V solves for the backward Kolmogorov equations: ?V (t, k) ?t + ? (t, k) ? (V (t, k + 1) ? V (t, k)) = rV (t, k), k = 0, . . . , n ? 1, where the terminal conditions are given by the payoff function at time T and with V (t, n) = 0, for all t ? 0. We end up with: dV (t,Nt) =rV (t,Nt?) dt + n i=1 (V (t,Nt? + 1) ?V (t,Nt?)) dNi t ? ??(t,Nt?)(1 ? Ni t )dt. (28) As a consequence the credit deltas with respect to the individual instantaneous default swaps are equal to: ?it = ?i(t,Nt?) = V (t,Nt? + 1) ? V (t,Nt?) , for 0 ? t ? T and i = 1, . . . , n. Let us denote by V I (t, k) = e?r(T?t)E 1 ? NT n |Nt = k the time-t price of the equally weighted portfolio involving defaultable bonds and set ?It = ?I (t,Nt?) = V (t,Nt? + 1) ? V (t,Nt?) V I (t,Nt? + 1) ? V I (t,Nt?) . (29) As the dynamics of V I also satisfies SDE (28) and using (29), we can deduce that: dV (t,Nt) = r?V (t,Nt?)??I (t,Nt?)V I (t,Nt?)dt+?I (t,Nt?)dV I (t,Nt). As a consequence, we can perfectly hedge a European type payoff, say a zero-coupon CDO tranche, using only the index portfolio and the risk-free asset. The hedge ratio, with respect to the index portfolio is actually equal to (29). The previous hedging strategy is feasible provided that V I (t,Nt? + 1) = V I (t,Nt?). The usual case corresponds to some positive dependence, thus ? (t, 0) ? ? (t, 1) ? - - - ? ? (t, n ? 1). Therefore V I (t,Nt? + 1) < VI (t,Nt?).21 The decrease in 21 In the case where ?(t, 0) = ?(t, 1) = . . . = ?(t, n), there are no contagion effects and default dates are independent. We still have V I (t,Nt? + 1) < VI (t,Nt?) since V I (t,Nt?) is linear in the number of surviving names.
Hedging CDO Tranches in a Markovian Environment 35 the index portfolio value is the consequence of a direct default effect (one name defaults) and an indirect effect related to a positive shift in the credit spreads associated with the non-defaulted names. The idea of building a hedging strategy based on the change in value at default times was introduced in [2]. The rigorous construction of a dynamic hedging strategy in a univariate case can be found in [9]. Our result can be seen as a natural extension to the multivariate case, provided that we deal with Markovian homogeneous models: we simply need to deal with the number of defaults Nt and the index portfolio V I (t,Nt) instead of a single default indicator Ni t and the corresponding defaultable discount bond price. 3.3 Calibration of Loss Intensities Another nice feature of the homogeneous Markovian contagion model is that the loss dynamics or equivalently the default intensities can be determined from market inputs such as CDO tranche premiums. Since the risk neutral dynamics are unambiguously derived from market inputs, so will be for dynamic hedging strategies of CDO tranches. This greatly facilitates empirical studies, since the replicating figures do not depend upon unobserved and difficult to calibrate parameters. The construction of the implied Markov chain for the aggregate loss parallels the one made by Dupire [25] to construct a local volatility model from call option prices. Similar ideas are used in [23, 58] to build up implied trees. Laurent and Leisen [46] have shown howan impliedMarkov chain can be derived from a discrete set of option prices. In these approaches, the calibration of the implied dynamics on market inputs involves forward Kolmogorov equations. Starting from a complete set of CDO tranche premiums or equivalently from a complete set of number of default distributions, [60] provided the construction of the loss intensities. Similarities between the Dupire's approach and the building of the one step Markov chain of [60] have also been reported in [13,20,48]. We propose now to detail and comment the latter calibration approach of loss intensities. 3.3.1 Calibration of Loss Intensities on a Complete Set of Number of Defaults Probabilities While the pricing and thus the hedging involves a backward procedure, calibration is associated with forward Kolmogorov differential equations. We show here a non-parametric fitting procedure of a possibly non time homogeneous pure birth process onto a complete set of marginal distributions of number of defaults. This is quite similar to the one described in [60], though the purpose is somehow different since the aim of [60] was to construct arbitrage-free, consistent with some complete loss surface, Markovianmodels of aggregate losses, possibly in incompletemarkets, without detailing the feasibility and implementation of replicating strategies.
36 A. Cousin et al. We will further denote the marginal default probabilities by p(t, k)=Q(Nt =k) for 0 ? t ? T , k = 0, 1, . . . , n. Clearly, this involves more information that one could directly access through the quotes of liquid CDO tranches, especially with respect to small and large number of defaults. As for the computation of the number of default probabilities from quoted CDO tranche premiums, we refer to [32,41,50, 53,62,64]. Practical issues related to the calibration inputs are also discussed in [63]. In the case of a pure birth process, the forward Kolmogorov equations can be written as: ?? ? dp(t,0) dt = ??(t, 0)p(t, 0), k= 0, dp(t,k) dt = ?(t, k ? 1)p(t, k ? 1) ? ?(t, k)p(t, k), k = 1, . . . , n. (30) Since the space state is finite, there are no regularity issues and these equations admit a unique solution22 (see below for practical implementation). These forward equations can be used to compute the loss intensity dynamics t ? [0, T] > ?(t,Nt), thanks to: ?? ??(t, 0) = ? 1 p(t,0) dp(t,0) dt, k= 0, ?(t, k) = 1 p(t,k)  ?(t, k ? 1)p(t, k ? 1) ? dp(t,k) dt !, k = 1, . . . , n, (31) for 0 ? t ? T . Let us remark that we can also write: ?(t, k) = ? 1 p(t, k) d k m=0 p(t,m) dt = ? 1 Q(Nt = k) dQ(Nt ? k) dt , k = 0, . . . , n. (32) Eventually, the name intensities are provided by: ?? (t,Nt) = ?(t,Nt) n?Nt . This shows that we can fully recover the loss intensities from the marginal distributions of the number of defaults, if the latters do not occur simultaneously. This has to be related to the result of Cont and Minca [13] which states that, under the assumption of no simultaneous defaults, the flow of marginal loss distributions associated with a general point process can be matched with the one of a Markovian jump process. On practical grounds, the computation of the p(t, k) usually involves some arbitrary smoothing procedure and hazardous extrapolations for small time horizons. For these reasons, we think that it is more appropriate and reasonable to calibrate the Markov chain of aggregate losses on a discrete set of meaningful market inputs corresponding to liquid maturities. 22We refer to [40] for more details about the forward equations in the case of a pure birth process.
Hedging CDO Tranches in a Markovian Environment 37 3.3.2 Calibration of Time Homogeneous Loss Intensities In practical applications, we can only rely on a discrete set of loss distributions corresponding to liquid CDO tranche maturities. In the examples below, we will calibrate the loss intensities given a single calibration date T . For simplicity, we will be given the default probabilities p(T, k), k = 0, 1, . . ., n. Now and in the sequel, we assume that the loss intensities are time homogeneous: the intensities do not depend on time but only on the number of realized defaults. We further denote by ?k = ?(t, k) for 0 ? t ? T , the loss intensity for k = 0, 1, . . ., n ? 1. Let us note that [28] have also developed a similar computation of the loss intensities ?k from the values of default probabilities. Solving the forward equations (30) provides (p(T, 0) = e??0T, k= 0, p(T, k) = ?k?1 T 0 e??k(T?s)p(s, k ? 1)ds, k = 1, . . . , n ? 1. (33) The previous equations can be used to determine ?0, . . . , ?n?1 iteratively, even if our calibration inputs are the defaults probabilities at the single date T . Assume for the moment that the intensities ?0, . . . , ?n?1 are known, positive and distinct.23 To solve the forward equations, we assume that the default probabilities can be written as p(t, k) =k i=0 ak,ie??it, 0 ? t ? T, k = 0, . . . , n ? 1, (34) where the parameters ak,i, i = 0, 1, . . . , k, k = 0, . . . , n ? 1 satisfy the following recurrence equations: ???? ??? a0,0 = 1, ak,i = ?k?1 ?k??i ak?1,i, i = 0, 1, . . . , k ? 1, k = 1, . . . , n ? 1, ak,k = ?k?1 i=0 ak,i (35) Then, we check easily that, the functions t > p(t, k), k = 0, . . . , n?1 described by (34) and (35) provide some solutions of the forward PDE. Since it is well-known that these solutions are unique, it means we have obtained explicitly the solutions of the forward PDE, knowing the intensities (?k)k=0,...,n?1. Therefore, using p(0, k) = 0 and ?0 = ?ln(p(T,0)) T , we can compute iteratively ?1, . . . , ?n?1 by solving the univariate non-linear implicit equations p(T, k) = ki=0 ak,ie??iT , or equivalently: k?1 i=0 ak?1,ie??iT 1 ? e?(?k??i)T ?k ? ?i = p(T, k) ?k?1 , k = 1, . . . , n ? 1. (36) 23 Due to the last assumption, the described calibration approach is not highly regarded by numerical analysts (see [51] for a discussion). However, it is well suited in our case studies.
38 A. Cousin et al. It can be seen easily that for any k ? {0, . . . , n ? 1}, p(T, k) is a decreasing function of ?k, taking value ?k?1 T 0 p(s, k ? 1)ds for ?k = 0 and with the limit equal to zero as ?k tends to infinity. In other words, the system of equations (36) has a unique solution provided that: p(T, k) < ?k?1 k?1 i=0 ak?1,i 1 ? e??iT ?i , k = 1, . . . , n ? 1. (37) Note that, in practice, all the intensities ?k will be different. Thus, starting from the T -default probabilities only, we have found the explicit solutions of the forward equations and the intensities (?k)k=0,...,n?1 that would be consistent with these probabilities. 3.3.3 Other Calibrating Approaches Alternative calibrating approaches based on minimization algorithms have been proposed by several authors. In Herbertsson [36], the name intensities ? (t,Nt) are time homogeneous, piecewise constant in the number of defaults (the node points are given by standard detachment points) and they are fitted to spread quotes by a least square numerical procedure. Arnsdorf and Halperin [1] propose a piecewise constant parameterization of name intensities (which are referred to as "contagion factors") in time. When intensities are piecewise linear in the number of defaults too, they use a "multi-dimensional solver" to calibrate onto the observed tranche prices. In the same vein, Frey and Backhaus [30,31] introduce a parametric form for the function ?(t, k), a variant of the "convex counterparty risk model," and fit the parameters to some tranche spreads. Lopatin and Misirpashaev [48] express the loss intensity ?(t, k) as a polynomial function of an auxiliary variable involving the number of defaults. Cont and Minca [13] propose an alternative method based on the principle of minimum relative entropy. The name intensities has to be chosen in such a way that the loss process is close enough to a simple prior process in the sens of an entropy distance. In the same time, the usual calibration constraints have to be satisfied. However, the main drawback of this approach is the fact that the fitted intensities strongly rely on the choice of the prior. In the spirit of Dupire [25], Cont et al. [14] show that loss intensities ? (t, k), 0 ? t ? T , k = 0, . . . , n can be formulated using prices of put options on the aggregate loss, i.e., E[min(Nt, k)], 0 ? t ? T , k = 0, . . . , n. It allows to transform the calibration of the loss intensities into the calibration of the put option values. Given the small number of available quotes, they remark that there can be several sets of put values that are consistent with the market CDO data. Therefore, a calibration algorithm based on quadratic programming is proposed in order to pinpoint a unique set of put values if it exists. They also compare their method
Hedging CDO Tranches in a Markovian Environment 39 with the calibration approaches introduced by Herbertsson [36] and Cont andMinca [13] and show that calibrated intensity surfaces can be significantly different across algorithms. 3.4 Computation of Credit Deltas Through a Recombining Tree We now address the computation of CDO tranche deltas with respect to the credit default swap index of the same maturity. As for the hedging instrument, the premium is set at the inception of the deal and remains fixed which corresponds to market conventions.We do not take into account roll dates every 6 months and trade the same index series up to maturity. Switching from one hedging instrument to another could be dealt with very easily in our framework and closer to market practice but we thought that using the same underlying across the tree would simplify the exposition.24 3.4.1 Building Up a Tree Let us recall that the (fractional) loss at time t is given by Lt = (1?R)Nt n . In what follows, we consider a tranche with attachment point a and detachment point b, 0 ? a ? b ? 1. Up to some minor adjustment for the premium leg (see below), the credit default swap index is assimilated to a [0, 100%] tranche. We denote by O(Nt) the outstanding nominal on a tranche. It is equal to b ? a if L(t) < a, to b ? L(t) if a ? L(t) < b and to 0 if L(t) ? b. Let us recall that, for a European type payoff the price vector fulfils V (t, .) = e?r(t?t)Q(t, t)V (t, ) for 0 ? t ? t? T . The transition matrix can be expressed as Q(t, t) = exp(?(t? t)) where ? is the generator matrix associated with the number of defaults process. Note that, in the time homogeneous framework discussed in the previous section, the generator matrix does not depend on time. For practical implementation, we will be given a set of node dates t0 = 0, . . . , ti, . . ., tns = T . For simplicity, we will further consider a constant time step ? = t1 ? t0 = - - - = ti ? ti?1 = - - - ; this assumption can easily be relaxed. The most simple discrete time approximation one can think of is Q(ti, ti+1) Id + ?(ti) ? (ti+1 ? ti), which leads to QNti+1 = k + 1|Nti = k ?k? and QNti+1 = k |Nti = k 1 ? ?k?. For large ?k, the transition probabilities can become negative. Thus, we will rather use the following approximations: *QNti+1 = k + 1|Nti = k 1 ? e??k?, QNti+1 = k |Nti = k e??k?. (38) Given the latter approximations and as illustrated in Fig. 8, the dynamics of the number of defaults process can be described through a recombining tree. 24 Actually, the credit deltas at inception are the same whatever the choice.
40 A. Cousin et al. N0 = 0 N1 = 0 N1 = 1 N2 = 0 N2 = 1 N2 = 2 N3 = 0 N3 = 1 N3 = 2 N3 = 3 e??0? 1 ? e??0? e??0? 1 ? e??0? e??1? 1 ? e??1? e??0? 1 ? e??0? e??1? 1 ? e??1? e??2? 1 ? e??2? Fig. 8 Number of defaults tree This idea has also been exploited by van der Voort [63]. One could clearly think of using continuous Markov chain techniques to compute present values of derivative products at hand, but the tree implementation is quite intuitive from a financial point of view as it corresponds to the implied binomial tree of Derman and Kani [23]. Convergence of the discrete time Markov chain to its continuous limit is a rather standard issue and will not be detailed here. 3.5 Computation of Hedge Ratios for CDO Tranches 3.5.1 Present Values of a CDO Tranche in the Tree Nodes Let us denote by D(i, k) the value at time ti when Nti = k of the default payment leg of the CDO tranche.25 The default payment at time ti+1 is equal to O(Nti ) ? 25We consider the value of the default leg immediately after ti. Thus, we do not consider a possible default payment at ti in the calculation of D(i, k).
Hedging CDO Tranches in a Markovian Environment 41 ONti+1. Thus, D(i, k) is given by the following recurrence equation26: D(i, k) =e?r? - 1 ? e??k?{D(i + 1, k + 1)+O(k) ? O(k + 1)} + e??k?D(i + 1, k). (39) Let us now deal with a (unitary) premium leg. We denote the regular premium payment dates by T1, . . . , Tp and for simplicity we assume that: {T1, . . . , Tp} ? {t0, . . . , tns}. Let us consider some date ti+1 and set l such that Tl < ti+1 ? Tl+1. Whatever ti+1, there is an accrued premium payment of O(Nti ) ? O Nti+1? (ti+1 ? Tl). If ti+1 = Tl+1, i.e., ti+1 is a regular premium payment date, there is an extra premium cash-flow at time ti+1 of O (N(Tl+1)) ? (Tl+1 ? Tl). Thus, if ti+1 is a regular premium payment date, the total premium payment is equal to O(Nti) ? (Tl+1 ? Tl). Let us denote by P(i, k) the value at time ti when Nti = k of the unitary premium leg.27 If ti+1 ? {T1, . . . , Tp}, P(i, k) is provided by: P(i, k) =e?r? - O(k) (Tl+1 ? Tl) +1 ? e??k?P(i + 1, k + 1)+e??k?P(i + 1, k). (40) If ti+1 /? {T1, . . . , Tp}, then28: P(i, k) = e?r? - 1?e??k?{P(i+1, k+1) + (O(k) ? O(k + 1)) (ti+1?Tl)} + e??k?P(i + 1, k). (41) The CDO tranche premium is equal to ? = D(0,0) P(0,0) . The value of the CDO tranche (buy protection case) at time ti when Nti = k is given by V (i, k) = D(i, k) ? ? - P(i, k). The equity tranche needs to be dealt with slightly differently since its spread is set to ? = 500 bp. However, the value of the CDO equity tranche is still given by D(i, k) ? ? - P(i, k). 3.5.2 Present Values of a CDS Index in the Tree Nodes As for the credit default swap index, we will denote by PI (i, k) and DI (i, k) the values of the premium and default legs. We define the credit default swap index spread at time ti when Nti = k by ?I (i, k) - PI (i, k) = DI (i, k). The value of the credit default swap index, bought at inception, at node (i, k) is given by 26 This relation holds for i = 0, . . . , ns?1, k = 0, . . . , min(i, n?1) and with D(ns, k) = 0 when k = 0, . . . ,n and D(i, n) = 0 when i = n, . . . ,ns ? 1. 27 As for the default leg, we consider the value of the premium leg immediately after ti. Thus, we do not take into account a possible premium payment at ti in the calculation of P(i, k) either. 28 Relations (40) and (41) hold for i=0, . . . ,ns ? 1, k=0, . . . , min(i, n?1) and with P(ns, k)=0 when k = 0, . . . ,n and P(i, n) = 0 when i = n, . . . ,ns ? 1.
42 A. Cousin et al. V I (i, k) = DI (i, k) ? ?I(0, 0) - PI (i, k).29 The default leg of the credit default swap index is computed as a standard default leg of a (0, 100%) CDO tranche. Thus, in the recursion equation (39) giving DI (i, k), we write the outstanding nominal for k defaults as O(k) = 1 ? k(1?R) n , where R is the recovery rate and n the number of names. According to standard market rules, the premium leg of the credit default swap index needs a slight adaptation since the premium payments are based only upon the number of non-defaulted names and do not take into account recovery rates. As a consequence, the outstanding nominal to be used in the recursion equations (40) and (41) providing PI (i, k) is such that O(k) = 1 ? kn. 3.5.3 Computation of Credit Deltas in the Tree Nodes As usual in binomial trees, ?(i, k) is the ratio of the difference of the option value (at time ti+1) in the upper state (k + 1 defaults) and lower state (k defaults) and the corresponding difference for the underlying asset. In our case, both the CDO tranche and the credit default swap index are "dividend-baring." For instance, when the number of defaults switches from k to k+1, the default leg of the CDO tranche is associated with a default payment of O(k)?O(k+1). Similarly, given the above discussion, when the number of defaults switches from k to k +1, the premium leg of the CDO tranche is associated with an accrued premium payment equal to30 ??1ti+1 /?{T1,...,Tp} (O(k) ? O(k + 1)) (ti+1 ? Tl). (42) Thus, when a default occurs the change in value of the CDO tranche is the outcome of a capital gain of V (i + 1, k + 1) ? V (i + 1, k) and of a cash-flow of D(i, k) = (O(k) ? O(k + 1)) 1 ? ?1ti+1 /?{T1,...,Tp} (ti+1 ? Tl). (43) Similarly, when a default occurs the change in value of the credit default swap index is the outcome of a capital gain of V I (i + 1, k + 1) ? V I (i + 1, k) and a cashflow of DI (i, k) = 1 ? R n ? 1n?I(0, 0)1ti+1 /?{T1,...,Tp} (ti+1 ? Tl) (44) The credit delta of the CDO tranche at node (i, k) with respect to the credit default swap index is thus given by: ?(i, k) = V (i + 1, k + 1) ? V (i + 1, k) + D(i, k) V I (i + 1, k + 1) ? V I (i + 1, k) + DI (i, k) . (45) 29 This is an approximation of the index spread since, according to market rules, the first premium payment is reduced. 30 If ti+1 ? {T1, . . . ,Tp}, the premium payment is the same whether the number of defaults is equal to k or k + 1. So, it does not appear in the computation of the credit delta.
Hedging CDO Tranches in a Markovian Environment 43 Let us remark that using the previous credit deltas leads to a perfect replication of a CDO tranche within the tree, which is feasible since the approximating discrete market is complete. In the next section, we compute CDO tranche credit deltas with respect to credit default swap index in two steps. We first calibrate loss intensities from a one factor Gaussian copula loss distribution. It allows us to examine how the correlation between defaults impact credit deltas. We then calibrate loss intensities from a loss distribution associated with a market base correlation structure and we compare our "default risk" deltas with some "credit spread" deltas computed on a basis of a bump of credit default swap index spread. We investigate in particular spread deltas computed from the standard market approach and spread deltas recently obtained in [1] and [26]. 3.5.4 Model Calibrated on a Loss Distribution Associated with a Gaussian Copula In this numerical illustration, the loss intensities ?k are computed from a loss distribution generated from a one factor homogeneous Gaussian copula model.31 The correlation parameter is equal to ?2 = 30%, the credit spreads are assumed to be all equal to ? = 20 basis points per annum,32 the recovery rate is such that R = 40% and the maturity is T = 5 years. The number of names is n = 125. Figure 9 shows the number of defaults distribution. Loss intensities ?k are calibrated up to k = 49 defaults according to the method proposed in Sect. 3.3.2. Under the Gaussian copula assumption, the default probabilities p(5, k) are insignificant33 for k > 49. To avoid numerical difficulties, we computed the remaining ?k (k > 49) by linear extrapolation.34 As can be seen from Fig. 10, loss intensities change almost linearly with respect to the number of defaults. Let us also remark that such rather linear behavior of loss intensities can be found in [48]. Our results can also be related to the analysis of Ding et al. [24] who deal with a dynamic model where the loss intensity is actually linear in the number of defaults. 31 In the homogeneous Gaussian copula model, default times have the same marginal distribution, says F. In that model, default times are defined by ?i = F?1(?(Vi)), i = 1, . . . , n, where ? is the standard Gaussian cumulative distribution and V1, . . . ,Vn are some latent variables such that: Vi = ?V + +1 ? ?2 ? Vi, i = 1, . . . ,n. The factors V, ? Vi, i = 1, . . . ,n are independent standard Gaussian random variables. 32 Marginal default probabilities have been computed using the classical assumption, under which default times are exponentially distributed with parameter ? 1?R, i.e., the cumulative distribution of default times at time T is equal to F(T) = Q(?1 ? T) = 1 ? exp ? ? 1?RT. 33k?50 p(5, k) 3 ? 10?4, p(5, 50) 3.2 ? 10?5 and p(5, 125) 4 ? 10?12. 34We checked that various choices of loss intensities for high number of defaults had no effect on the computation of deltas. Let us stress that this applies for the Gaussian copula case since the loss distribution has thin tails. For the market case example, we proceeded differently.
44 A. Cousin et al. 0% 5% 10% 15% 20% 25% 30% 35% 40% 45% 50% 0 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 Fig. 9 Number of defaults distribution. Number of defaults on the x-axis. ?2 = 30%: p(5, k), k = 0, . . . , 2005 10 15 20 25 0 3 6 9 12 15 18 21 24 27 30 33 36 39 42 45 48 Fig. 10 Loss intensities ?k, k = 0, . . . , 49 Table 1 shows the dynamics of the credit default swap index spreads ?I (i, k) along the nodes of the tree. The continuously compounded default free rate is r = 3% and the time step is ? = 1 365 . It can be seen that default arrivals are associated with rather large jumps of credit spreads. For instance, if a (first) default occurs after a quarter, the credit default swap index spread jumps from 18 to 70 bps. An extra default by this time leads to an index spread of 148 bps. The credit deltas with respect to the credit default swap index ?(i, k) have been computed for the (0-3%) and the (3-6%) CDO tranches (see Tables 2 and 3). As for
Hedging CDO Tranches in a Markovian Environment 45 Table 1 Dynamics of credit default swap index spread ?I (i, k) in basis points per annum Weeks Nbdefaults 0 14 56 84 0 20 18 14 13 1 0 70 54 46 2 0 148 112 93 3 0 243 182 150 4 0 350 261 215 5 0 466 347 285 6 0 589 437 359 7 0 719 531 436 8 0 856 630 516 9 0 997 732 598 10 0 1,142 839 683 Table 2 Delta of the [0-3%] equity tranche with respect to the credit default swap index Outstanding nominal Weeks Nb defaults 0 14 56 84 0 3.00% 0.538 0.591 0.755 0.859 1 2.52% 0 0.238 0.381 0.508 2 2.04% 0 0.074 0.137 0.212 3 1.56% 0 0.026 0.044 0.070 4 1.08% 0 0.011 0.017 0.024 5 0.60% 0 0.005 0.007 0.009 6 0.12% 0 0.001 0.001 0.001 7 0.00% 0 0 0 0 Table 3 Deltas of the [3-6%] with respect to the credit default swap index Outstanding nominal Weeks Nb defaults 0 14 56 84 0 3.00% 0.255 0.254 0.219 0.171 1 3.00% 0 0.280 0.349 0.357 2 3.00% 0 0.167 0.294 0.389 3 3.00% 0 0.068 0.158 0.265 4 3.00% 0 0.026 0.065 0.128 5 3.00% 0 0.014 0.027 0.053 6 3.00% 0 0.010 0.016 0.025 7 2.64% 0 0.008 0.011 0.015 8 2.16% 0 0.006 0.008 0.010 9 1.68% 0 0.004 0.005 0.007 10 1.20% 0 0.003 0.003 0.004 11 0.72% 0 0.002 0.002 0.002 12 0.24% 0 0.001 0.001 0.001 12 0.00% 0 0 0 0
46 A. Cousin et al. the equity tranche, it can be seen that the credit deltas are positive anddecrease up to zero. This is not surprising given that a buy protection equity tranche involves a short put position over the aggregate loss with a 3% strike. This is associated with positive deltas, negative gammas and thus decreasing deltas. When the number of defaults is above 6, the equity tranche is exhausted and the deltas obviously are equal to zero. At inception, the credit delta of the equity tranche is equal to 54% whilst it is only equal to 25% for the [3-6%] tranche which is deeper out of the money (see Table 3). Moreover, the [3-6%] CDO tranche involves a call spread position over the aggregate loss. As a consequence the credit deltas are positive and firstly increase (positive gamma effect) and then decrease (negative gamma) up to zero as soon as the tranche is fully amortized. Given the recovery rate assumption of 40%, the outstanding nominal of the [3-6%] is equal to 3% for six defaults and to 2.64% for seven defaults. One might thus think that at the sixth default the [3-6%] tranche should behave almost like an equity tranche. However, as can be seen from Table 3, the credit delta of the [3-6%] tranche is much lower: around 1% instead of 60%. This is due to dramatic shifts in credit spreads when moving from the no-defaults to the six defaults state (see Table 1). In the latter case, the expected loss on the tranche is much larger, which is consistent with smaller deltas given the call spread payoff. 3.5.5 Dependence of Hedging Strategies upon the Correlation Parameter Let us recall that the recombining tree is calibrated on a loss distribution over a given time horizon. The shape of the loss distribution depends critically upon the correlation parameter which was set up to now to ?2 = 30%. Decreasing the dependence between default events leads to a thinner right-tail of the loss distribution and smaller contagion effects. We detail here the effects of varying the correlation parameter on the hedging strategies. For simplicity, we firstly focus the analysis on the equity tranche and shift the correlation parameter from 30 to 10%. It can be seen from Tables 2 and 4 that the credit deltas are much higher in the latter case. After 14 weeks, prior to the first default, the credit delta is equal to 59% for a 30% correlation and to 96% when the correlation parameter is equal to 10%.35 To further investigate how changes in correlation levels alter credit deltas, we computed the market value of the default leg of the equity tranche at a 14 weeks horizon as a function of the number of defaults under different correlation assumptions (see Fig. 11). The market value of the default leg, on the y-axis, is computed 35 Let us remark that credit deltas can be above one in the no default case. This is due to the amortization scheme of the premium leg. We detail in the next section the impact of the premium leg on credit deltas.
Hedging CDO Tranches in a Markovian Environment 47 Table 4 Deltas of the [0-3%] equity tranche with respect to the credit default swap index, ?2 = 10% Outstanding nominal Weeks Nb defaults 0 14 56 84 0 3.00% 0.931 0.960 1.009 1.058 1 2.52% 0 0.694 0.785 0.910 2 2.04% 0 0.394 0.485 0.645 3 1.56% 0 0.179 0.233 0.352 4 1.08% 0 0.072 0.092 0.145 5 0.60% 0 0.027 0.032 0.046 6 0.12% 0 0.004 0.005 0.007 7 0.00% 0 0 0 0 0.00% 0.50% 1.00% 1.50% 2.00% 2.50% 3.00% 3.50%0 1 2 3 4 5 6 7 8 9 10 11 losses correlation 0% correlation 10% correlation 20% correlation 30% correlation 40% Fig. 11 Market value of equity default leg under different correlation assumptions. Number of defaults on the x-axis as the sum of expected discounted cash-flows posterior to this 14 weeks horizon date and the accumulated defaults cash-flows paid before.36 We also plotted the accumulated losses which represent the intrinsic value of the equity tranche default leg. Unsurprisingly, we recognize some typical concave patterns associated with a short put option payoff. As can be seen from Fig. 11, prior to the first default, the value of the default leg of the equity tranche decreases as the correlation parameter increases from 0 to 40%. However, after the first default the ordering of default leg values is reversed. This can be easily understood since larger correlations are associated with larger 36 For simplicity, we neglected the compounding effects over this short period.
48 A. Cousin et al. jumps in credit spreads at default arrivals and thus larger changes in the expected discounted cash-flows associated with the default leg of the equity tranche.37 Therefore, varying the correlation parameter is associated with two opposite mechanisms: : The first one is related to a typical negative vanna effect.38 Increasing correlation lowers loss "volatility" and leads to smaller expected losses on the equity tranche. In a standard option pricing framework, this should lead to an increase in the credit delta of the short put position on the loss. : This is superseded by the shifts due to contagion effects. Increasing correlation is associated with bigger contagion effects and thus larger jumps in credit spreads at the arrival of defaults. This, in turn leads to a larger jump in the market value of the credit index default swap. Let us recall that the default leg of the equity tranche exhibits a concave payoff and thus a negative gamma. As a consequence the credit delta, i.e., the ratio between the change in value of the option and the change in value of the underlying, decreases. 3.5.6 Model Calibrated on a Loss Distribution Associated with CDO Tranche Quotes Up to now, the probabilities of number of defaults were computed thanks to a Gaussian copula and a single correlation parameter. In this example, we use a steep upward sloping base correlation curve for the iTraxx, typical of June 2007, as an input to derive the distribution of the probabilities of number of defaults (see Table 5). The maturity is still equal to 5 years, the recovery rate to 40% and the credit spreads to 20 bps. The default-free rate is now equal to 4%. Rather than spline interpolation of base correlations, we used a parametric model of the 5 year loss distribution to fit the market quotes and compute the probabilities Table 5 Base correlations with respect to attachment points (iTraxx June 2007) Base tranches [0-3%] [0-6%] [0-9%] [0-12%] [0-22%] Base correlations 18% 28% 36% 42% 58% 37 Let us remark that the larger the correlation the larger the change in market value of the default leg of the equity tranche at the arrival of the first default. Indeed, in a high correlation framework, this default means relatively higher default likelihood for the surviving names. This is not inconsistent with the previous results showing a decrease in credit deltas when the correlation parameter increases. The credit delta is the ratio of the change in value in the equity tranche and of the change in value in the credit default swap index. For a larger correlation parameter, the change in value in the credit default swap index is also larger due to magnified contagion effects. 38We recall that in option pricing, the vanna is the sensitivity of the delta to a unit change in volatility.
Hedging CDO Tranches in a Markovian Environment 49 0% 5% 10% 15% 20% 25% 30% 35% 40% 0 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 Fig. 12 Number of defaults distribution obtained from the base correlation structure described in Table 5. Number of defaults on the x-axis of the number of defaults. This produces arbitrage free and smooth distributions that ease the calculation of the loss intensities.39 Figure 12 shows the number of defaults distribution. This is rather different from the 30% flat correlation Gaussian copula case both for small and large losses. For instance, the probability of no defaults dropped from 48.7 to 19.5% while the probability of a single default rose from 18.2 to 36.5%. Let us stress that these figures are for illustrative purpose. The market does not provide direct information on first losses and thus the shape of the left tail of the loss distribution is a controversial issue. As for the right-tail, we have k?50 p(5, k) 1.4?10?3 and p(5, 50) 3.3?10?6, p(5, 125) 1.38 ? 10?3. The cumulative probabilities of large number of defaults are larger, compared with the Gaussian copula case. The probability of the names defaulting altogether is also quite large, corresponding to some kind of Armageddon risk. Once again these figures need to be considered with caution, corresponding to high senior and supersenior tranche premiums and disputable assumptions about the probability of all names defaulting. Figure 13 shows the loss intensities calibrated onto market inputs compared with the loss intensities based on Gaussian copula inputs up to 39 defaults. As can be seen, the loss intensity increases much quicker with the number of defaults as compared with the Gaussian copula approach. The average relative change in the 39We also computed the number of defaults distribution using entropic calibration. Although we could still compute loss intensities, the pattern with respect to the number of defaults was not monotonic. Depending on market inputs, direct calibration onto CDO tranche quotes can lead to shaky figures.
50 A. Cousin et al. 0 25 50 75 100 125 150 175 200 225 250 0 2 4 6 8 10 12 14 16 18 20 22 24 26 28 30 32 34 36 38 Market case Gaussian copula Fig. 13 Loss intensities for the Gaussian copula and market case examples. Number of defaults on the x-axis loss intensities is equal to 19% when it is equal to 16% when computed under the Gaussian copula assumption. Unsurprisingly, a steep base correlation curve is associated with fatter upper tails of the loss distribution and magnified contagion effects. Table 7 shows the dynamics of the credit default swap index spreads ?I (i, k) along the nodes of the tree. As for tree implementation, the time step is still ? = 1 365 . Let us remark that up to 12 defaults, loss intensities calibrated from market inputs are on the whole smaller than in the Gaussian copula case. Then, the contagion effect is smaller than in the flat 30% correlation Gaussian copula in low default states and greater for high default states. Unsurprisingly, market quotes lead to smaller index spreads up to 2 defaults at 14 weeks (see Tables 1 and 6). This is also coherent with Fig. 14 where the conditional expected losses in the two approaches cross each other at the third default. However, as mentioned above, this detailed pattern has to be considered with caution, since it involves the probabilities of 0, 1 and 2 defaults which are not directly observed in the market. After 2 defaults, credit spreads become definitely larger when calibrated from market inputs. Thanks to Fig. 14 we can investigate the credit spread dynamics when using market inputs. We plotted the conditional (with respect to the number of defaults) expected loss E [LT |Nt ] for T = 5years and t = 14 weeks for the previous market inputs and for the 30% flat correlation Gaussian copula case. The conditional expected loss is expressed as a percentage of the nominal of the portfolio.40 We also 40 Thus, given a recovery rate of 40%, the maximum expected loss is equal to 60%.
Hedging CDO Tranches in a Markovian Environment 51 Table 6 Dynamics of credit default swap index spread ?I (i, k) in basis points per annum Weeks Nb defaults 0 14 56 84 0 20 19 17 16 1 0 31 23 20 2 0 95 57 43 3 0 269 150 98 4 0 592 361 228 5 0 1,022 723 490 6 0 1,466 1,193 905 7 0 1,870 1,680 1,420 8 0 2,243 2,126 2,423 9 0 2,623 2,534 2,423 10 0 3,035 2,939 2,859 Table 7 Delta of the [0-3%] equity tranche with respect to the credit default swap index Outstanding nominal Weeks Nbdefaults 0 14 56 84 0 3.00% 0.645 0.731 0.953 1.038 1 2.52% 0 0.329 0.584 0.777 2 2.04% 0 0.091 0.197 0.351 3 1.56% 0 0.023 0.045 0.090 4 1.08% 0 0.008 0.011 0.018 5 0.60% 0 0.004 0.003 0.004 6 0.12% 0 0.001 0.001 0.001 7 0.00% 0 0 0 0 0% 5% 10% 15% 20% 25% 30% 35% 40% 45% 50% 55% 60% 65% 0 5 10 15 20 25 30 35 40 45 50 55 60 market inputs Gaussian Copula inputs realized losses Fig. 14 Expected losses on the credit portfolio after 14 weeks over a 5 year horizon (y-axis) with respect to the number of defaults (x-axis) using market and Gaussian copula inputs plotted the accumulated losses on the portfolio. The expected losses are greater than the accumulated losses due to positive contagion effects. There are some dramatic differences between the Gaussian copula and the market inputs examples. In the
52 A. Cousin et al. Gaussian copula case, the expected loss is almost linear with respect to the number of defaults in a wide range (say up to 15 defaults). The pattern is quite different when using market inputs with huge non linear effects. This shows large contagion effects after a few defaults as can also be seen from Table 6 and Fig. 13. This rather explosive behavior was also observed by Herbertsson [35], Tables 3 and 4 and by Cont andMinca [13], Figs. 1 and 3. In Lopatin andMisirpashaev [48], the contagion effects are also magnified when using market data, compared with Gaussian copula inputs. Table 7 shows the dynamic deltas associated with the equity tranche. We notice that the credit deltas drop quite quickly to zero with the occurrence of defaults. This is not surprising given the surge in credit spreads and dependencies after the first default (see Fig. 14): after only a few defaults the equity tranche is virtually exhausted. It is noteworthy that the credit deltas ?(i, k) can be decomposed into a default leg delta ?d(i, k) and a premium leg delta ?p(i, k) as follows: ?(i, k) = ?d(i, k) ? ??p(i, k), (46) where: ?d(i, k) = D(i + 1, k + 1) ? D(i + 1, k) + O(k) ? O(k + 1) V I (i + 1, k + 1) ? V I (i + 1, k) + DI (i, k) (47) and ?p(i, k) = P (i + 1, k + 1) ? P (i + 1, k) + (O(k) ? O(k + 1))1ti+1/?{T1,...,Tp} (ti+1 ? Tl) V I (i + 1, k + 1) ? V I (i + 1, k) + DI (i, k) . (48) Tables 8 and 9 detail the credit deltas associated with the default and premium legs of the equity tranche. As can be seen from Table 7, credit deltas for the equity tranche may be slightly above one when no default has occurred. Table 9 shows that this is due to the amortization scheme of the premium leg which is associated with significant negative deltas. Let us recall that premium payments are based on the outstanding nominal. Arrival of defaults thus reduces the commitment to pay. Furthermore, the increase in credit spreads due to contagion effects involves a decrease in the expected outstanding nominal.When considering the default leg only, we are led to credit deltas that actually remain within the standard 0-100% range. The default leg delta of the equity tranche with respect to the credit default swap index is initially equal to 54.1%. Let us also remark that credit deltas of the default leg gradually increase with time which is consistent with a decrease in time value.
Hedging CDO Tranches in a Markovian Environment 53 Table 8 Delta of the default leg of the [0-3%] equity tranche with respect to the credit default swap index (?d(i, k)) Outstanding nominal Weeks Nb defaults 0 14 56 84 0 3.00% 0.541 0.617 0.823 0.910 1 2.52% 0 0.279 0.510 0.690 2 2.04% 0 0.072 0.166 0.304 3 1.56% 0 0.016 0.034 0.072 4 1.08% 0 0.004 0.006 0.012 5 0.60% 0 0.002 0.002 0.002 6 0.12% 0 0.001 0.000 0.000 7 0.00% 0 0 0 0 Table 9 Deltas of the premium leg of the [0-3%] equity tranche with respect to the credit default swap index (??p(i, k)) Outstanding nominal Weeks Nbdefaults 0 14 56 84 0 3.00% ?0.104 ?0.113 ?0.130 ?0.128 1 2.52% 0 ?0.050 ?0.074 ?0.087 2 2.04% 0 ?0.018 ?0.031 ?0.047 3 1.56% 0 ?0.007 ?0.011 ?0.018 4 1.08% 0 ?0.004 ?0.004 ?0.006 5 0.60% 0 ?0.002 ?0.002 ?0.002 6 0.12% 0 ?0.001 0.000 0.000 7 0.00% 0 0 0 0 Table 10 Market delta spreads and model deltas (a default event) at inception Tranches [0-3%] [3-6%] [3-9%] [9-12%] [12-22%] Market deltas 27 4.5 1.25 0.6 0.25 Model deltas 21.5 4.63 1.63 0.9 0.6 3.5.7 Comparison with Standard Market Practice We further examine the credit deltas of the different tranches at inception. These are compared with the deltas as computed by market participants under the previous base correlation structure assumption (see Table 10). These market deltas are calculated by bumping the credit curves by 1 basis point and computing the changes in present value of the tranches and of the credit default swap index. Once the credit curves are bumped, themoneyness varies, but the market practice is to keep constant the base correlations when recalculating the CDO tranches. This corresponds to the so-called "sticky strike" rule. The delta is the ratio of the change in present value of the tranche to the change in present value of the credit default swap index divided by the tranche's nominal. For example, a credit delta of an equity tranche previously equal to one would now lead to a figure of 33.33. First of all we can see that the outlines are roughly the same, which is already noticeable since the two approaches are completely different. Then, we can remark that the model deltas are smaller for the equity tranche as compared with the market deltas, while there are larger for the other tranches. These discrepancies can be understood from the dynamics of the dependence between defaults embedded in the Markovian contagion model. Figure 15 shows the base correlation curves at a 14 weeks horizon, when the number of defaults is
54 A. Cousin et al. Fig. 15 Dynamics of the base correlation curve with respect to the number of defaults. Detachment points on the x-axis. Base correlations on the y-axis 10% 20% 30% 40% 50% 60% 70% 80% 90%3% 6% 9% 12% 22% No default One default Two defaults 70 40% 35% spreads correlation 30% 25% 20% 15% 65 60 55 50 45 40 35 30 25 20 20/03/0703/04/0717/04/0701/05/0715/05/0729/05/0712/06/0726/06/0710/07/0724/07/0707/08/0721/08/0704/09/0718/09/0702/10/0716/10/0730/10/0713/11/07 Fig. 16 Credit spreads on the 5 years iTraxx index (Series 7) in bps on the left axis. Implied correlation on the equity tranche on the right axis equal to zero, one or two.We can see that the arrival of the first defaults is associated with parallel shifts in the base correlation curves. This increase in dependence counterbalances the increase of credit spreads and expected losses on the equity tranche and lowers the credit delta. The model deltas can be thought of as the "sticky implied tree" model deltas of Derman [22]. These are suitable in a regime of fear corresponding to systematic credit shifts. The summer 2007 credit crisis provides some evidence that implied correlations tend to increase with credit spreads and thus with expected losses. Figure 16 shows the dynamics of the 5 year iTraxx credit spread and of the implied correlation of the equity tranche. Over this period the correlation between the two series was equal to 91%. This clearly favors the contagion model and once again suggests a flaw in the "sticky strike" market practice.
Hedging CDO Tranches in a Markovian Environment 55 3.5.8 Comparison with Deltas Computed in Other Dynamic Credit Risk Models We also thought that it was insightful to compare our model deltas and the results provided by Arnsdorf and Halperin [1], Fig. 7 (see Table 11). The market conditions are slightly different since the computations were done in March 2007, thus the maturity is slightly smaller than 5 years. The market deltas are quoted deltas provided by major trading firms. We can see that these are quite close to the previous market deltas since the computation methodology involving Gaussian copula and base correlation is quite standard. The BSLP41 model deltas (corresponding to "model B" in [1]) have a different meaning from ours: there are related to credit spread deltas rather that then default risk deltas and are not related to a dynamic replicating strategy. However, it is noteworthy that the model deltas in [1] are quite similar to ours, and thus rather far away from market deltas. Though this is not a formal proof, it appears from Fig. 11, that (systemic) gammas are rather small prior to the first default. If we could view a shock on the credit spreads as a small shock on the expected loss while a default event induces a larger shock (but not so large given the risk diversification at the index level) on the expected loss, the similarity between the different model deltas are not so surprising. As above, model deltas are lower for the equity tranche and larger for the other tranches, when compared with market deltas. We also compare our model deltas with credit deltas obtained by Eckner [26], Table 5. Eckner model relies on an affine specification of default intensities (AJD model). Conditionally on the path of default intensities, default times are independent (i.e., there are no contagion effects at default times). The model is parametric with respect to the term structure of credit spreads and to CDO tranches. Calibration of the model parameters to credit spreads and liquid tranche quotes on the CDX NA IG5 index in December 2005 is provided and hedge ratios with respect to the credit default swap index are then computed. The sensitivities of CDO tranche and index prices are computed with respect to a uniform and relative shift of individual intensities. The approach can be extended in order to compute different hedge ratios with respect to the single name default swaps. However, the overall procedure, including the calibration and the computation of individual hedge ratios is likely to be rather involved. In Table 12, the deltas obtained in the AJD intensity model can be compared with those computed from the Gaussian copula model and those computed within a contagion model calibrated to the same data set. Table 11 Market and model deltas as in Arnsdorf and Halperin [1] Tranches [0-3%] [3-6%] [3-9%] [9-12%] [12-22%] Market deltas 26.5 4.5 1.25 0.65 0.25 BSLP model deltas 21.9 4.81 1.64 0.79 0.38 41 Bivariate spread-loss portfolio model.
56 A. Cousin et al. Table 12 Market deltas, "intensity" model credit deltas in Eckner [26] and contagion model deltas Tranches [0-3%] [3-7%] [7-10%] [10-15%] [15-30%] Market deltas 18.5 5.5 1.5 0.8 0.4 AJD model deltas 21.7 6.0 1.1 0.4 0.1 Contagion model deltas 17.9 6.3 2.5 1.3 0.8 Even though the approaches are completely different, once again the outlines are quite similar. Moreover, we can remark that the equity tranche deltas computed by Eckner are higher compared with the market deltas. Another empirical comparison of various hedging strategies has recently been proposed by Cont and Kan [12]. This study provides several interesting observations related to the hedging of index CDO tranches, extending the ones presented in this section. 4 Conclusion In this section, we were able to show that a CDO tranche payoff can be perfectly replicated with a self-financed strategy based on the underlying credit default swaps. This extends to any payoff which depends only upon defaults arrivals, such as basket default swaps, but does not address the issue of tranche options for instance. Clearly, the previous replication result is model dependent and relies on two critical assumptions. First, we preclude the possibility of simultaneous defaults. In other words, default times can be ordered from the first to the last default time. Hedging against simultaneous defaults would require trading credit default swaps contingent on several defaults, which are not currently traded in the market. The other important assumption, which is likely to be more questionable, is that credit default swap premiums are adapted to the filtration of default times, denoted H, which therefore can be seen as the relevant information set on economic grounds. As a consequence, default swap premiums are deterministic between two default times. Our framework corresponds to a pure contagion model, where the arrival of defaults leads to jumps in the credit spreads of survived names, the magnitude of which depending upon the considered names and the whole history of defaults up to the current time. These jumps can be related to the derivatives of the joint survival function of default times. The dynamics of replicating prices of CDO tranches follows the same way. In other words, we only deal with default risks and not with spread risks. At a given point in time, there are only p sources of risk, related to the default occurrence of the p non defaulted names and we can trade the corresponding p credit default swaps. This provides the intuition of the completeness of the market following the rule of the thumb, "as many hedging instruments as sources of risk." The hedging strategy deals thus with default risks only and not with credit spread risks. Even though the underlying assumptions may look too restrictive, given the risk management and regulatory issues related to CDOs, we think that it may prove useful to rely
Hedging CDO Tranches in a Markovian Environment 57 on benchmark models where the hedging can be fully described and analyzed in a dynamical way. Unsurprisingly, the possibility of perfect hedging is associated with a martingale representation theorem under the filtration of default times. Subsequently, we exhibit a new probability measure under which the short term credit spreads (up to some scaling factor due to positive recovery rates) are the intensities associated with the corresponding default times. For the ease of presentation, we introduced first some instantaneous default swaps as a convenient basis of hedging instruments. Eventually, we can exhibit a replicating strategy of a CDO tranche payoff with respect to actually traded credit default swaps, for instance, with the same maturity as the CDO tranche. Let us note that no Markovian assumption is required for the existence of such a replicating strategy. Therefore the aggregate loss may not be a Markov process either. Since we dealt first with the dynamics of individual defaults, we are typically in a bottom-up model and no homogeneity assumption, such as equal credit spreads across names is required. However, when going to implementing actual hedging strategies, one needs extra assumptions, both for the implementation to be feasible and to cope with quoted CDO tranches. We therefore consider the simplest way to specialize the above model: we assume that all pre-default intensities are equal and only depend on the current number of defaults. We also assume that all recovery rates are constant across names and time. In that framework, it can be shown that the aggregate loss process is a homogeneous Markov chain, more precisely a pure death process (thanks to the no simultaneous defaults assumption). The intensity associated with the Markov chain is simply the pre-default intensity times the number of nondefaulted names. Thanks to these restrictions, the model involves as many unknown parameters as the number of underlying names. On the other hand, the knowledge of upfront premiums of equity CDO tranches with different maturities and detachment points (and given some recovery rate) is equivalent to the knowledge of marginal distributions of the number of defaults at different time horizons. Thanks to the forward Kolmogorov equations, one can then perfectly compute the intensities of the aggregate loss process or the pre-default intensities of the names. Such fully calibrated and Markov model is also known as the local intensity model, the simplest form of aggregate loss models. As in local volatility models in the equity derivatives world, there is a perfect match of unknown parameters from a complete set of CDO tranches quotes. In other words, the model is fully specified from market inputs, which is clearly a desirable property, since given some market inputs, we deal with a single model and not with a family of parameterized models. The numerical implementation can be achieved through a binomial tree, well-known to finance people or by means of Markov chain techniques.We provide some examples and show that the market quotes of CDOs are associated with pronounced contagion effects. We can therefore explain the dynamics of the amount of hedging CDS and relate them to deltas computed by market practitioners. The figures are hopefully roughly the same, the discrepancies being mainly explained by contagion effects leading to an increase of dependence between default times after some defaults.
58 A. Cousin et al. However, one cannot unfortunately observe a complete set of CDO tranche premiums. The set of local intensities consistent with the actually CDO tranches quotes is not a singleton. For a complete specification, one needs to introduce some extra assumptions: either, one can constrain the shape of intensities, for instance assume that there are piecewise constant with respect to the number of defaults with shifts associated to detachment points of traded tranches. Otherwise, as an intermediary step, we may think of fitting some marginal distributions of aggregate losses to CDO tranche quotes or use interpolation techniques consistent with the increase and concavity of the expected loss on equity tranches. Numerical examples in this section are constructed under the second approach. Unfortunately, for practical purpose, the computed deltas and thus hedging performance seem rather sensitive to the calibration technique. One may compare the proposed framework with the standard structural approach, where default time of a given name is the first hitting time of a barrier by a Brownian motion associated with the asset process of the corresponding name. In that structural approach, dependence between default times stems from the correlation between the Brownian motions. In the latter framework, quite similar to a multivariate Black-Scholes setting, CDS are barrier-options and it is also possible to replicate a CDO tranche payoff by dynamically trading the CDS. While the formerMarkov chain approach focused on default risk, neglecting credit spread risk, the structural approach only deals with credit spread risk. Defaults are predictable and do not constitute an extra source of risk. On the other hand, a structural model can be well approximated in most cases by a one period structural model, where crossing the default barrier is only considered at maturity. This is known to be equivalent to the Gaussian copula model commonly used by practitioners. As mentioned above, an interesting feature is that the deltas with respect to underlying credit default swaps have the same order of magnitude in the two approaches. However, extending the scope of the approach would result in adding extra complexity, both on mathematical grounds and regarding the specification of credit spreads dynamics. For instance, if we were to introduce some Brownian risks on top of jump to default risks, it is not clear how defaults would drive the volatility of credit spreads. The uncertainty with respect to this substantial model risk is likely to offset the benefit of dealing with credit spread and default risk altogether. At the time being, extra-complexity conveys the risk of darkening the risk management picture and providing a false sense of security. A better understanding of the multivariate dynamics of defaults and credit spreads is required before going any further. Another, more down to earth issue, but of practical importance is related to the set of hedging instruments.Given n names, one can think of using two credit default swaps of differentmaturities for each underlying name to cope both with default and credit spread risks. This induces extra complexity in implementing hedging strategies. A more easy to reach extension of the previous framework consists in relaxing the homogeneity of names assumption, while remaining in a pure default setting. For instance, one could think of two homogeneous groups of names, say belonging to two different geographical regions, the intensities depending both upon the number of survived names in each group. This results in a two dimensionalMarkov
Hedging CDO Tranches in a Markovian Environment 59 chain, since the portfolio state is characterized by the number of survived names in each group. We should then be able to discriminate CDS deltas for names within each subgroup. Let us note that given that we rely upon a bottom-up approach, once calibrated onto liquid CDO tranche quotes, one would be able to consistently price CDO tranches on any sub-portfolio, thus solving the difficult issue of bespoke tranche pricing. Another possible and easy to implement extension of our setting consists in using a recovery rate depending upon the number of defaults. The easiest way to proceed is to assume some linear (and most likely negative) dependence with respect to the number of defaults in the portfolio. Such assumption will tend to raise the probability of large losses and ease the calibration to the senior tranches. Eventually, we would like to stress that the approach described in this section should be fruitful in computing so called values on defaults. These assess the magnitude of losses on a portfolio (possibly including CDO tranches) after a default occurs. Usually, market practitioners do not take into account credit contagion effects associated with shifts of credit spreads of survived names, which can lead to gross misestimation of credit risk reserves. This can be easily dealt with in our framework. Acknowledgements This research was supported by CRIS (Credit Risk Service) collaborative project for which we are very grateful. The authors also thank Marek Rutkowski for useful discussions and comments. References 1. Arnsdorf, M., Halperin, I.: BSLP: Markovian bivariate spread-loss model for portfolio credit derivatives. Working paper, JP Morgan (2007) 2. Arvanitis, A., Laurent, J.-P.: On the edge of completeness. RISK 10, 61-65 (1999) 3. Assaf, D., Langberg, N.A., Savits, T.H., Shaked M.: Multivariate phase-type distributions. Oper. Res. 32(3), 688-702 (1984) 4. Azizpour, S., Giesecke, K.: Self-exciting corporate defaults: Contagion vs. frailty. Working paper, Stanford University (2008) 5. Beumee, J., Brigo, D., Schiemert, D., Stoyle, G.: Charting a course through the CDS Big Bang. Quantitative research, FitchSolutions (2009) 6. Bielecki, T.R., Rutkowski,M.: Credit Risk:Modeling, Valuation and Hedging. Springer, Berlin (2004) 7. Bielecki, T.R., Jakubowski, J., Vidozzi, A., Vidozzi, L.: Study of dependence for some stochastic processes. Working paper (2007) 8. Bielecki, T.R., Jeanblanc, M., Rutkowski, M.: Hedging of basket credit derivatives in default swap market. J. Credit Risk 3(1), 91-132 (2007) 9. Blanchet-Scalliet, C., Jeanblanc, M.: Hazard rate for credit risk and hedging defaultable contingent claims. Finance Stochast. 8, 145-159 (2004) 10. Bremaud, P.: Point Processes and Queues: Martingale Dynamics. Springer, Berlin (1981) 11. Brigo, D., Pallavicini, A., Torresetti, R.: Calibration of CDO tranches with the dynamical generalized-Poisson loss model. Working paper, Banca IMI (2007) 12. Cont, R., Kan, Y.H.: Dynamic hedging of portfolio credit derivatives in top-down models. Financial Engineering Report 2008-08, Columbia University (2008)
60 A. Cousin et al. 13. Cont, R., Minca, A.: Recovering portfolio default intensities implied by CDO quotes. Financial Engineering Report 2008-01, Columbia University (2008) 14. Cont, R., Deguest, R., Kan, Y.H.: Default intensities implied by CDO spreads: Inversion formula and model calibration. SIAM Journal on Financial Mathematics 1, 555-585 (2010) 15. Das, S.: Credit Derivatives: CDOs and Structured Credit Products. Wiley, NY (2005) 16. Das, S.R., Duffie, D., Kapadia, N., Saita, L.: Common failings: How corporate defaults are correlated. J. Finance 62(1), 93-117 (2007) 17. Davis, M., Lo, V.: Infectious defaults. Quant. Finance 1, 382-387 (2001) 18. De Koch, J., Kraft, H.: CDOs in chains. Working paper, University of Kaiserslautern (2007) 19. De Servigny, A., Jobst, N.: The Handbook of Structured Finance. McGraw-Hill, NY (2007) 20. Deguest, R., Kan, Y.H.: A closed-form formula for the local intensity and its application to calibration. Working paper (2009) 21. Dellacherie, C.: Capacites et processus stochastiques. Springer, Berlin (1972) 22. Derman, E.: Regimes of volatility. Quantitative Strategies Research Notes, Goldman Sachs (1999) 23. Derman, E., Kani, I.: Riding on a smile. RISK 7(2), 32-39 (1994) 24. Ding, X., Giesecke, K., Tomecek, P. Time-changed birth processes and multi-name credit. Oper. Res. 57(4), 990-1005 (2009) 25. Dupire, B.: Pricing with a smile. RISK 7(1), 18-20 (1994) 26. Eckner, A.: Computational techniques for basic affine models of portfolio credit risk. J. Comput. Finance 13, 63-97 (2009) 27. Elliott, R.J., Jeanblanc, M., Yor, M.: On models of default risk. Math. Finance 10, 179-196 (2000) 28. Epple, F., Morgan, S., Schloegl, L.: Joint distributions of portfolio losses and exotic portfolio products. Int. J. Theor. Appl. Finance 10(4), 733-748 (2007) 29. Errais, E., Giesecke, K., Goldberg, L.R.: Pricing credit from the top down with affine point processes. Working paper, Stanford University (2007) 30. Frey, R., Backhaus, J.: Dynamic hedging of synthetic CDO tranches with spread and contagion risk. J. Econ. Dynam. Contr. 34, 710-724 (2010) 31. Frey, R., Backhaus, J.: Pricing and hedging of portfolio credit derivatives with interacting default intensities. Int. J. Theor. Appl. Finance 11(6), 611-634 (2008) 32. Galiani, S., Kakodkar, A., Shchetkovskiy, M., Jonsson, J.G., Gallo, A.: Base correlation and beyond: Interpolation and extrapolation. Working paper, Credit Derivatives Strategy, Merrill Lynch (2006) 33. Gibson, M.S.: Credit derivatives and risk management. Finance and Economics Discussion Series, Federal Reserve Board, Washington, DC (2007) 34. Giesecke, K., Goldberg, L.R.: A top down approach to multi-name credit. Working paper, Stanford University (2006) 35. Herbertsson, A.: Default contagion in large homogeneous portfolios. In: Gregoriou, G.N., Ali, P.U. (eds.) The Credit Derivatives Handbook. McGraw-Hill, NY (2007) 36. Herbertsson, A.: Pricing synthetic CDO tranches in a model with default contagion using the matrix-analytic approach. J. Credit Risk 4(4), 3-35 (2008) 37. Herbertsson, A., Rootzen, H.: Pricing k-th to default swaps under default contagion, the matrixanalytic approach. J. Comput. Finance 12(1), 49-78 (2006) 38. Jarrow, R.A., Yu, F.: Counterparty risk and the pricing of defaultable securities. J. Finance 56, 1765-1799 (2001) 39. Kakodkar, A., Galiani, S., Jonsson, J.G., Gallo, A.: Credit Derivatives Handbook 2006, vol. 2. Merrill Lynch, NY (2006) 40. Karlin, S., Taylor, H.M.: A First Course in Stochastic Processes, 2nd edn. Academic Press, NY (1975) 41. Krekel, M., Partenheimer, J.: The implied loss surface of CDOs. Working paper, University of Ulm (2006) 42. Kusuoka, S.: A remark on default risk models. Adv. Math. Econ. 1, 69-82 (1999) 43. Lando, D.: Credit Risk Modeling and Applications. Princeton University Press, NJ (2004)
Hedging CDO Tranches in a Markovian Environment 61 44. Lando, D., Nielsen, M.S.: Correlation in corporate defaults: Contagion or conditional independence. J. Financ. Intermed. 19(3), 355-372 (2010) 45. Laurent, J.-P.: A note on the risk management of CDOs. Working paper, ISFA actuarial School, University of Lyon and BNP Paribas (2006) 46. Laurent, J.-P., Leisen, D.: Building a consistent pricing model from observed option prices. In: Quantitative Analysis in Financial Markets: Collected Papers of the New York University Mathematical Finance Seminar, vol. II, pp. 216-238. World Scientific, Singapore (2000) 47. Laurent, J.-P., Cousin, A., Fermanian, J.-D.: Hedging default risk of CDOs in Markovian contagion models. Quant. Finance (2010) 48. Lopatin, A.V.,Misirpashaev, T.: Two-dimensional Markovian model for dynamics of aggregate credit loss. Working paper, NumeriX (2007) 49. Meissner, G.: The Definitive Guide to CDOs. Riskbooks, London (2008) 50. Meyer-Dautrich, S.,Wagner, C.K.J.: Minimum entropy calibration of CDO tranches. Working paper, Unicredit (2007) 51. Moler, C., Van Loan, C.: Nineteen dubious ways to compute the exponential of a matrix, twenty-five years later. SIAM Rev. 45(1), 3-49 (2003) 52. Morgan, S., Mortensen, A.: CDO hedging anomalies in the base correlation approach, pp. 49-61. Lehman Brothers, Quantitative Credit Research Quarterly, October (2007) 53. Parcell, E., Wood, J.: Wiping the smile off your base (correlation curve). Working paper, Derivative Fitch (2007) 54. Parker, E., Brown, M.: The 2003 ISDA credit derivatives definitions. PLC Finance, NY (2003) 55. Petrelli, A., Zhang, J., Jobst, N., Kapoor, V.: A practical guide to CDO trading risk management. In: de Servigny, A., Jobst, N. (eds.) The Handbook of Structured Finance, pp. 339-371. McGraw Hill, NY (2007) 56. Protter, Ph.: Stochastic Integration and Differential Equations, 2nd edn. Springer, Berlin (2005) 57. Putyatin, P., Prieul, D., Maslova, S.: A Markovian approach to modelling correlated defaults. RISK 18(5), 76-81 (2005) 58. Rubinstein, M.: Implied binomial trees. J. Finance 49(3), 771-818 (1994) 59. Schonbucher, P.: Credit Derivatives Pricing Models. Wiley, Chichester (2003) 60. Schonbucher, P.J.: Portfolio losses and the term-structure of loss transition rates: A new methodology for the pricing of portfolio credit derivatives. Working paper, ETH Zurich (2006) 61. Schonbucher, P., Schubert, D.: Copula dependent default risk in intensity models. Working paper, Bonn University (2001) 62. Torresetti, R., Brigo, D., Pallavicini, A.: Implied expected tranched loss surface from CDO data. Working paper, Banca IMI (2007) 63. van der Voort,M.: An implied loss model. Working paper, ABN Amro and Erasmus University (2006) 64. Walker,M.B.: Simultaneous calibration to a range of portfolio credit derivatives with a dynamic discrete-time multi-step Markov loss model. Int. J. Theor. Appl. Finance 12(5), 633-662 (2009) 65. Yu, F.: Correlated defaults in intensity-based models. Math. Finance 17(2), 155-173 (2007)
About the Pricing Equations in Finance Stephane Crepey Abstract In this article we study a decoupled forward backward stochastic differential equation (FBSDE) and the associated system of partial integrodifferential obstacle problems, in a flexible Markovian set-up made of a jumpdiffusion with regimes. These equations are motivated by numerous applications in financial modeling, whence the title of the paper. This financial motivation is developed in the first part of the paper, which provides a synthetic view of the theory of pricing and hedging financial derivatives, using backward stochastic differential equations (BSDEs) as main tool. In the second part of the paper, we establish the well-posedness of reflected BSDEs with jumps coming out of the pricing and hedging problems exposed in the first part. We first provide a construction of a Markovian model made of a jump-diffusion - like component X interacting with a continuous-time Markov chain - like component N. The jump process N defines the so-called regime of the coefficients of X, whence the name of jump-diffusion with regimes for this model. Motivated by optimal stopping and optimal stopping game problems (pricing equations of American or game contingent claims), we introduce the related reflected and doubly reflected Markovian BSDEs, showing that they are well-posed in the sense that they have unique solutions, which depend continuously on their input data. As an aside, we establish the Markov property of the model. In the third part of the paper we derive the related variational inequality approach. We first introduce the systems of partial integro-differential variational inequalities formally associated to the reflected BSDEs, and we state suitable definitions of viscosity solutions for these problems, accounting for jumps and/or systems of equations. We then show that the state-processes (first components Y ) of the solutions to the reflected BSDEs can be characterized in terms of the value functions of related optimal stopping or game problems, given as viscosity solutions with polynomial growth to related integro-differential obstacle problems.We further S. Crepey () Departement de Mathematiques, Universite d'Evry Val d'Essonne, 91025 Evry Cedex, France e-mail: stephane.crepey@univ-evry.fr A.R. Carmona et al. (eds.), Paris-Princeton Lectures on Mathematical Finance 2010, Lecture Notes in Mathematics 2003, DOI 10.1007/978-3-642-14660-2_2, c Springer-Verlag Berlin Heidelberg 2011 63
64 S. Crepey establish a comparison principle for semi-continuous viscosity solutions to these problems, which implies in particular the uniqueness of the viscosity solutions. This comparison principle is subsequently used for proving the convergence of stable, monotone and consistent approximation schemes to the value functions. Finally in the last part of the paper we provide various extensions of the results needed for applications in finance to pricing problems involving discrete dividends on a financial derivative or on the underlying asset, as well as various forms of discrete path-dependence. 1 Introduction In this article, we establish the well-posedness of a decoupled forward backward stochastic differential equation and of the associated system of partial integrodifferential obstacle problems, in a rather flexible Markovian set-up made of a jump-diffusion model with regimes. These equations are motivated by numerous applications in financial modeling, whence the title of the paper. This financial motivation is developed in Part I, where we essentially reduce the problem of pricing and hedging financial derivatives to that of solving (typically reflected) backward stochastic differential equations (BSDEs), or, equivalently in the Markovian case, partial integro-differential equations or variational inequalities (PIDEs or PDEs for short). In Parts II-IV, we tackle the resulting Markovian BSDE and PDE problems. In Crepey and Matoussi [38], a priori estimates and comparison principles were derived for reflected or doubly reflected BSDEs in the general, non-Markovian set-up of a model driven by a continuous local martingale and an integer-valued random measure. In Part II we use these results to establish the well-posedness of Markovian reflected BSDEs, which is used in Part III for studying the associated partial integrodifferential systems of obstacle problems, in a rather flexible Markovian set-upmade of a jump-diffusion model with regimes. As an aside we prove the convergence of any stable, monotone and consistent approximation scheme for these problems. Part IV provides various extensions of the previous results needed for applications in finance to pricing problems involving discrete dividends on a financial derivative or on an underlying asset, as well as various forms of discrete path-dependence. The main results are summed-up in Propositions 30 and 31, which synthesize the major findings of Part II and III, respectively. This paper lays the mathematical foundation of a large body of work in credit risk and financial modeling [15, 16, 20, 39]. Even if rather expected in their statement, many of the mathematical results derived in Parts II-IV are innovative. In particular, doubly reflected BSDEs with a delayed or an even more general intermittent upper barrier (RDBSDEs and RIBSDEs, see Definitions 9(ii) and 16), have not been considered elsewhere in the literature (if not for the preliminary results of Crepey and Matoussi [38]). Also, the Markovian model which is considered in detail in Parts II and III was already considered and some of the results of the present paper were
About the Pricing Equations in Finance 65 already announced and used in [16, 20, 38]. But the possibility to construct a model with all the required properties was taken for granted there. The mathematical construction of the model in Sect. 7 is non-trivial, and was not done elsewhere before. The treatment of the Markovian BSDEs with jumps and of their PDE interpretation in Parts II and III, including the proof of convergence of a numerical deterministic scheme to the viscosity solution of a system of integro-differential variational inequalities, is quite technical too. As for Part I, we believe that, beyond providing the motivation for the mathematical results of Parts II-IV, it also has the merit of giving a unified, cross market perspective (see Sects. 3.3.3 and 6.6) on the theory of pricing and hedging financial derivatives, via the use of BSDEs as a main tool. Part I on one hand, and Parts II-IV on the other hand, can be read essentially independently. The reader who would be mainly interested in the financial applications can thus read Part I first, taking for granted the results of Parts II-IV whenever they are used therein (see Propositions 5, 6, 8, 14 and 16 in particular). Likewise readers mainly interested by the mathematical results of Parts II-IV can skip Part I at first reading. 1.1 Detailed Outline Section 2 develops the theory of risk-neutral pricing and hedging of financial derivatives, using BSDEs as a main tool (see El Karoui et al. [46] for a general reference on BSDEs in finance). The central result, Proposition 3, can be informally stated as follows: Under the assumption, thoroughly investigated in Part II, that a reflected backward stochastic differential equation (BSDE) related to a financial derivative, relatively to a risk-neutral probability measure P over a primary market of hedging instruments, admits a solution ?, then ? is the minimal superhedging price up to a P - local martingale cost process for the derivative at hand, this cost being equal to 0 in the case of complete markets. This notion of hedge with local martingale cost thus establishes a connection between arbitrage prices and hedging, in a rather general, possibly incomplete, market. In Sect. 3, we consider the specification of these results to the Markovian set-up. Using the results of Part III, a complementary variational inequality approach may then be developed, and more explicit and constructive hedging strategies may be given (see Sect. 3.5 in particular). Section 4 presents various extensions of the previous results. Section 4.1 generalizes the previous risk-neutral approach to a martingalemodeling approach relatively to an arbitrary numeraire B (positive primary asset price process) which may be used for discounting other price processes, rather than a savings account (riskless asset) in the risk-neutral approach. This extension is particularly important for dealing
66 S. Crepey with interest-rate derivatives. Section 4.2, which is based on Bielecki et al. [20], refines the risk-neutral martingale modeling approach of Sects. 2 and 3 to the specific case, important for equity-to-credit applications, of defaultable derivatives, with all cash flows killed at the default time ? of a reference entity. Finally in Sect. 4.3 we deal with the issue of callability and call protection (intermittent call protection vs. call protection before a stopping time). In Part I, well-posedness of the pricing BSDEs and PDEs is taken for granted. The following sections of the paper (Parts II-IV) are devoted to the mathematics of these pricing equations. In Sect. 5 we recall the general set-up of [38] and the general form of the BSDEs we are interested in. In Sect. 6, we present a versatile Markovian specification of this general set-up, made of a jump-diffusion X interacting with a pure jump process N (which in the simplest case reduces to a Markov chain in continuous time). The interaction between X and N is materialized by the fact that the coefficients of the dynamics of X depend on N, and also, by a mutual dependence of the jump intensity of either process on the other one. Such coupled dependence is motivated by applications like modeling frailty and contagion in portfolio credit risk (see [16]). But the construction of a model with such mutual dependence is a non-trivial issue, and we treat it in detail in Sect. 7, resorting to a suitable Markovian change of probability measure. This model may also be viewed as a generalization of the interacting Ito process and point process model considered by Becherer and Schweizer in [10]. Yet as opposed to the set-up of [10] where linear reaction-diffusion systems of parabolic equations (pricing equations of European contingent claims, from the point of view of the financial interpretation) are considered from the point of view of classical solutions, here the application one has in mind consists of more general optimal stopping or optimal stopping game problems (pricing equations of American or game contingent claims, see Part I) for which the related reaction-diffusion systems typically do not have classical solutions. This leads us to study in Sect. 8 the related reflected and doubly reflected Markovian BSDEs (see [20, 46, 47]), showing that they are well-posed in the sense that they have unique solutions, which depend continuously on their input data. In Sect. 9 we derive the associated Markov and flow properties. In Sect. 10 we introduce the systems of partial integro-differential variational inequalities formally associated to our reflected BSDEs, and we state suitable definitions of semi-continuous viscosity solutions and solutions for these problems. In Sect. 11 we show that the state-processes (first components Y ) of the solutions to our reflected BSDEs can be characterized in terms of the value functions to related optimal stopping or game problems, given as viscosity solutions with polynomial growth to the related obstacle problems. We establish in Sect. 12 a semi-continuous viscosity solutions comparison principle, which implies in particular uniqueness of viscosity solutions for these problems.
About the Pricing Equations in Finance 67 This comparison principle is subsequently used in Sect. 13 for proving the convergence of stable, monotone and consistent approximation schemes (cf. Barles and Souganidis; see also [8] Briani et al. [28], Cont and Voltchkova [36] or Jakobsen et al. [64]) to the viscosity solutions of the equations. These results thus extend to models with regimes (whence systems of PDEs [9,60]) the results of [8,28], among others. In Sects. 14-16 we provide extensions of the previous results to a factor process model (X,N) possibly involving further deterministic jumps at some fixed times Tls. This is required for applications to pricing problems involving discrete dividends on a financial derivative or on an underlying asset, and also, to be able to deal with the issue of discrete path-dependence.
68 S. Crepey Part I Martingale Modeling in Finance In this part (see Sect. 1 for a detailed outline), we show how the task of pricing and hedging financial derivatives can generically be reduced to that of solving (typically reflected) BSDEs, or, equivalently in the Markovian case, PDEs. These equations are called pricing equations in this paper.Well-posedness of these equations in suitable spaces of solutions will be taken for granted whenever needed in this part, and will then be thoroughly studied in the remaining three parts of the paper. 2 General Set-Up The evolution of a financial market model is given throughout this part in terms of stochastic processes defined on a continuous time stochastic basis (?, F,P ), where P denotes the objective (also called statistical, historical, physical..) probability measure. We may and do assume that the filtration F satisfies the usual completeness and right-continuity conditions, and that all semimartingales are cadlag (i.e., almost surely right continuous with left limits). Finally, since we are always in the context of pricing contingent claims with a fixed maturity T, we further assume that F = (Ft)t?[0,T ] with F0 trivial and FT = F. Moreover, we declare that a process on [0, T ] (resp. a random variable) has to be F-adapted (resp. F-measurable), by definition. We shall typically work under a risk-neutral probability measure P ? P, or more generally, under a martingale probability measure P relative to a suitable numeraire (see Sect. 4.1), such that the prices of primary assets, once properly discounted and adjusted for dividends, are P - local martingales. As we shall now see, under mild technical conditions, existence of such a martingale measure P is equivalent to a suitable notion of no-arbitrage. 2.1 Pricing by Arbitrage 2.1.1 PrimaryMarket Model To model a financial derivative with maturity T, we consider a primary market composed of the savings account B and of d primary risky assets. The discount factor ? is supposed to be absolutely continuous with respect to the Lebesgue measure, and given by ?t = exp(?t 0 ru du) (1) (so ?0 = 1 and ? = B?1), for a bounded from below short-term interest rate process r.
About the Pricing Equations in Finance 69 The primary risky assets, with Rd-valued price process P, may pay dividends, whose cumulative value process, denoted by D, is assumed to be an Rd-valued process of finite variation. Given the price process P, we define the cumulative price P of the asset as Pt = Pt + ??1 t [0,t] ?u dDu. (2) In the financial interpretation, the last term in (2) represents the current value at time t of all dividend payments of the asset over the period [0, t], under the assumption that all dividends are immediately reinvested in the savings account. For technical reasons we assume that P is a locally bounded semimartingale. We assume that the primary market model is free of arbitrage opportunities (though presumably incomplete), in the sense that the so-called no free lunch with vanishing risk (NFLVR) condition is satisfied. This NFLVR condition is a specific no arbitrage condition involving wealth processes of admissible self-financing primary trading strategies (see Delbaen and Schachermayer [42]).We do not reproduce here the full definition of arbitrage price, since it is rather technical and will not be explicitly used in the sequel. It will be enough for us to recall the related notions of trading strategies in the primary market. Definition 1. A primary trading strategy (?0, ?) built on the primary market is an R?R1?d-valued process, with ? predictable and locally bounded, where ?0 and the row-vector ? represent the number of units held in the savings account and in each of the primary risky assets. The related wealth process W is thus given by: Wt = ?0t Bt + ?tPt, (3) for t ? [0, T ]. Accounting for dividends, we say that the strategy is self-financing if dWt = ?0t dBt + ?t (dPt + dDt) or, equivalently1 d(?tWt) = ?t d(?t Pt). (4) If, moreover, the discountedwealth process ?W is bounded from below, the strategy is said to be admissible. Given the initial wealth w of a self-financing primary trading strategy and the strategy ? in the primary risky assets, the related wealth process is thus given by, for t ? [0, T ]: ?tWt = w + t 0 ?u d(?u Pu) (5) 1 This equivalence is very general (cf. Sect. 4.1), and it is an easy exercise in the present context where ?, given by (1), is a finite variation and continuous process.
70 S. Crepey and the process ?0 (number of units held in the savings account) is then uniquely determined as ?0t = ?t(Wt ? ?tPt). In the sequel we restrict ourselves to self-financing trading strategies. We thus redefine a (self-financing) primary trading strategy as a pair (w, ?), made of an initial wealth w ? R and an R1?d-valued predictable locally bounded primary strategy in the risky assets ?, with related wealth processW defined by (5). 2.1.2 Financial Derivatives In the sequel we are going to extend the financial market by introducing a financial derivative relative to the primary market. A derivative is a financial claim between an investor (or holder of a claim) and a financial institution (or issuer), involving in a sense made precise in Definition 2 below, some or all of the following cash flows (or payoffs): : A bounded variation cumulative dividend process D = (Dt)t?[0,T ], : Terminal cash flows, consisting of: - A payment ? at maturity T, where ? denotes a bounded from below real-valued random variable, - And, in the case of American or game products with early exercice features, put and/or call payment processes L = (Lt)t?[0,T ] and U = (Ut)t?[0,T ], given as realvalued, bounded from below, cadlag processes such that L ? U and LT ? ? ? UT . The put payment Lt corresponds to a payment made by the issuer to the holder of the claim at time t, in case the holder of the claim would decide to terminate ("put") the contract at time t. Likewise, the call payment Ut corresponds to a payment made by the issuer to the holder of the claim at time t, in case the issuer of the claim would decide to terminate ("call") the contract at time t. Of course, there is also the initial cash flow (only null in the case of a swapped derivative with initial value equal to zero, by construction), namely the purchasing price of the contract paid at the initiation time by the holder and received by the issuer. The terminology "derivative" comes from the fact that all the above cash flows are typically given as functions of the "primary" asset price processes P. More generally, the price? of a derivative and the prices P of the primary assets may be given as functions of a common set of factors (traded or not)X (cf. Sect. 3). One may then consider the issue of factor hedging the claim with price process ? by the primary assets with price process P, via the common dependence of ? and P on X. Here and henceforth all the financial cash flows are seen from the point of view of the holder of the claim. In this perspective, the assumption above that all the cash flows are bounded from below, which from the mathematical point of view ensures their integrability in R ? {+?}, is indeed satisfied by a vast majority of real-life financial derivatives.
About the Pricing Equations in Finance 71 Remark 1. Usually in the derivative pricing and hedging literature, dividends are implicitly set to zero, or equivalently, implicitly amalgamatedwith the terminal cash flows L,U and ?. The related notion of price thus effectively corresponds to a cumdividend price (present value of future cash flows plus already perceived dividends reinvested in the savings account), as opposed to the market notion of ex-dividend price. Since an important proportion of financial derivatives (starting with all swapped derivatives) only entails dividends (terminal cash flows L = U = ? = 0), it is our opinion that it is better to make the dividends appear explicitly. This is in fact a necessity for the study of defaultable derivatives in Sect. 4.2, where we shall see that the specific structure of the products' cash flows and their distribution between dividends (in the sense of coupons and recovery) and terminal payoffs, is fruitfully exploited in the so-called reduced form approach to these problems. We are now in a position to introduce the formal definition of a financial derivative, distinguishing more specifically European claims, American claims and game claims. It will soon become apparent that European claims can be considered as special cases of American claims, which are themselves included in game claims, so that we shall eventually be able to reduce attention to game claims. In the following definitions, the put time (put or maturity time, to be precise) ?, and the call (or maturity) time ?, represent stopping times at the holder's and at the issuer's convenience, respectively. Definition 2. (i) An European claim is a financial claim with dividend process D, and with payment ? at maturity T. (ii) An American claim is a financial claim with dividend process D, and with payment at the terminal (put or maturity) time ? given by, 1{?<T}L? + 1{?=T}?. (6) (iii) A game claim is a financial claim with dividend process D, and with payment at the terminal (call, put or maturity) time ? = ? ? ? given by,2 1{?=?<T}L? + 1{?<?}U? + 1{?=T}?. (7) Moreover, there may be a call protection modeled in the form of a stopping time ?? such that calls are not allowed to occur before ??. Example 1. In the simplest case of an European vanilla call/put optionwith maturity T and strike K on S = P1, the first primary risky asset, one has D = 0 and ? = (ST ? K). Note 1. (i) The above classification, which is good enough for the purpose of this article, is by no means exhaustive. For instance Bermudan products corresponding 2With priority of a put over a call, here, though this happens to be rather immaterial in terms of pricing and hedging the claim.
72 S. Crepey to constrained put policies might also be introduced. Note however that Bermudan products can be included in the above set-up by considering a suitably adjusted put payoff process L. This is indeed a consequence of Proposition 1(ii) below, in conjunction with our boundedness from below assumption on all the cash flows at hand. On the opposite the explicit introduction of call protections appears to be a useful modeling ingredient. Such protections are actually quite typical in the case of reallife callable products like, for instance, convertible bonds (see Sect. 4.2.1), with the effect of making the product cheaper to the investor (holder of the claim). The introduction of such call protections also allows one to consider an American claim as a game claim with call protection ?? = T. (ii) In Sect. 4.3, building on the mathematical results of Sect. 16, we consider products with more general, hence potentially more realistic forms of intermittent call protection, namely call protection whenever a certain condition is satisfied, rather than more specifically call protection before a stopping time above. By classic arbitrage theory (see, e.g., [18, 32, 42]), the NFLVR condition in a perfect market (without transaction costs, in particular) is equivalent to the existence of a risk-neutral measure P?M, whereMdenotes the set of probability measures P ? P such that ? P is a P - local martingale. In the sequel, the statement (?t)t?[0,T ] is an arbitrage price for a derivative is to be understood as (Pt,?t)t?[0,T ] is an arbitrage price for the extended market consisting of the primary market and the derivative. The notion of arbitrage price process of a financial derivative referred to in the next result is the classical notion of No Free Lunch with Vanishing Risk condition of Delbaen and Schachermayer [42] in the case of European claims, subsequently extended to game (including American) claims by Kallsen and Kuhn [67]. The proof of this result is based on a rather straightforward application of Theorem 2.9 in Kallsen and Kuhn [67] (see Bielecki et al. [18] for the details). Let Tt and ? Tt (or simply T and ? T , in case t = 0) denote the set of [t, T ]-valued and [t ? ??, T]-valued stopping times. Let also ? stand for ? ? ?, for any (?, ? ) ? ? Tt ? Tt. Proposition 1. (i) For any P?M, the process ? = (?t)t?[0,T ] defined by ?t?t = EPT t ?u dDu + ?T ?Ft, t? [0, T ] (8) is an arbitrage price of the related European claim. Moreover, any arbitrage price of the claim is of this form provided sup P?MEP[0,T ] ?u dDu + ?T ?< ?; (9) (ii) For any P?M, the process ? = (?t)t?[0,T ] defined by ?t?t = esssup??TtEP? t ?u dDu+?? 1{?<T}L? + 1{?=T}?Ft, t? [0, T] (10)
About the Pricing Equations in Finance 73 is an arbitrage price of the related American claim as soon as it is a semimartingale. Moreover, any arbitrage price of the claim is of this form provided sup P?MEPsupt?[0,T ][0,t] ?u dDu + ?t1{t<T}Lt + 1{t=T}?< ? ; (11) (iii) For any P?M, the process ? = (?t)t?[0,T ] defined by esssup??Tt essinf?? ? TtEP? t ?u dDu + ??1{?=?<T}L? +1{?<?}U? + 1{?=T}?Ft= ?t?t = essinf?? ? Ttesssup??TtEP? t ?u dDu + ??1{?=?<T}L? + 1{?<?}U? + 1{?=T}?Ft, t? [0, T] (12) is an arbitrage price of the related game claim as soon as it is a well-defined semimartingale (which supposes in particular that equality indeed holds between the left hand side and the right hand side in (12)). Moreover, any arbitrage price of the claim is of this form assuming (11). In view of these results, one may interpret an European claim as an American claim with a fictitious put payment process L defined by ?L = ?c, where ?c is a strict minorant of T t ?u dDu + ?T ?. Indeed, in view of Propositions 1(ii), for this specification of L, exercise of the put before maturity is always sub-optimal to the holder of the claim. It is thus equivalent for a process ? to be an arbitrage price of the European claim with the cash flows D, ?, or to be an arbitrage price of the American claim with the cash flows D,L, ?, with L thus specified. Henceforth by default, by "financial derivative" or "game option," we shall mean game claim, possibly with a call protection ??, including American claim (case ?? = T, in particular European claim with L as specified above) as a special case. Arbitrage prices of the form (8), (10) or (12) will be called P-prices in the sequel. 2.2 Connection with Hedging We adopt a definition of hedging of a game option stemming from successive developments, starting from the hedging of American options examined by Karatzas [68], and subsequently followed by El Karoui and Quenez [45], Kifer [69], Ma and Cvitani?c [76], Hamadene [55], and, in the context of defaultable derivatives examined in Sect. 4.2, Bielecki et al. [20, 23] (see also Schweizer [85]). This
74 S. Crepey definition will be later shown to be consistent with the concept of arbitrage pricing of Proposition 1(iii) for a game option (which encompasses American and European options as special cases). We first introduce a (very large, to be specified later) class of hedges with semimartingale cost process Q. The issuer of a financial derivative immediately sets up a primary hedging strategy such that the corresponding wealth process W reduces to a cost or hedging error Q, after accounting for the "dividend cost" ?D and for the "terminal loss" given by ?L, ?U or ??. The initial wealth w may then be used as a safe issuer price, up to the hedging error Q, for the derivative at hand. Recall that we denote ? = ? ? ?. Definition 3. An hedge with semimartingale cost process Q (issuer hedge starting at time 0) for a game option is represented by a triplet (w, ?, ?) such that: : (w, ?) is a primary trading strategy, : The call time ? belongs to ? T , : The wealth process W of the strategy (w, ?) satisfies for every put time ? in T , almost surely, ??W? + ? 0 ?udQu ? ? 0 ?udDu + ??1{?=?<T}L? + 1{?<?}U? + 1{?=?=T}?. (13) In the special case of European derivatives, in which case ?? = T, and if moreover equality holds in (13) at t = T, then, almost surely, ?TWT + T 0 ?udQu = T 0 ?udDu + ?T ?. (14) In this case one effectively deals with a replicating strategy with cost Q. Note 2. (i) The process Q is to be interpreted as the cumulative financing cost, that is, the amount of cash added to (if dQt ? 0) or withdrawn from (if dQt ? 0) the hedging portfolio in order to get a perfect, but no longer self-financing, hedge. (ii) Hedges at no cost (that is, with Q = 0) are thus in effect super-hedges. (iii) In relation with admissibility issues (see the end of Definition 1), note that the left hand side of (13) (discounted wealth process with financing costs included) is bounded from below, for any hedge (w, ?, ?) with cost Q. This class of hedges with cost Q is obviously too large for any practical purpose, so we will restrict our attention to hedges with a local martingale cost Q under a particular risk-neutral measure P (cf. the related notions of risk-minimizing strategy in Follmer and Sondermann [50] and mean self-financing hedge in Schweizer [85]). Henceforth in this part, we thus work under a fixed but arbitrary risk-neutral measure P, with P-expectation denoted by E. All the measure-dependent notions, like martingale, or compensator, implicitly refer to this probability measure P. In practical applications, it is convenient to think of P as "the pricing measure chosen by the market" to price a contingent claim. For pricing and hedging purposes this measure is typically estimated by calibration of a model to market data.
About the Pricing Equations in Finance 75 2.2.1 BSDE Modeling We shall now postulate suitable integrability and regularity conditions embedded in the standing assumption that a related reflected backward stochastic differential equation (BSDE, see El Karoui et al. [46] for a general reference in connection with finance and El Karoui et al. [47] for a seminal reference on reflected BSDEs) has a solution. We shall thus introduce a reflected BSDE (15) under the probability measure P, with data defined in terms of those of a derivative. Assuming that (15) has a solution (for which various sets of sufficient regularity and integrability conditions are known in the literature, see Part II and [38, 56, 57]), we shall be in a position to deduce explicit hedging strategies with minimal initial wealth for the related derivative. We assume further for the sake of simplicity that dDt = Ctdt for some progressively measurable time-integrable coupon rate process C. Remark 2. It is important to note for applications that it is also possible to deal with discrete dividends: see [20] and Sect. 14 in Part IV. We then consider the following reflected BSDE with data ?,C, ?,L,U, ??: ???? ??? ?t?t = ?T ? + T t ?uCudu + T t ?u(dKu ? dMu), t? [0, T ] Lt ? ?t ? ?Ut, t? [0, T ] T 0 (?u ? Lu)dK+u = T 0 (?Uu ? ?u)dK?u = 0 (15) where, with the convention that 0??= 0 in the last line above, ?Ut = 1{t<??}?+ 1{t???}Ut. (16) Definition 4. (See Part II for more formal definitions, including in particular the specification of spaces for the inputs and outputs to (15)). By a P-solution to (15), we mean a triplet (?,M,K) such that all conditions in (15) are satisfied, where: : The state-process ? is a real valued, cadlag process, : M is a P-martingale vanishing at time 0, : K is a non-decreasing continuous process null at time 0, and K denote the components of the Jordan decomposition of K. By the Jordan decomposition of K in the last bullet point, we mean the unique decompositionK = K+?K? into the difference of non-decreasing processesK null at 0, defining mutually singular random measures on [0, T ]. Remark 3. The first line of (15) can be interpreted as giving the Doob-Meyer decomposition t 0 ?u(dKu ? dMu) of the special semimartingale ?t ?t := ?t?t + t 0 ?uCudu. (17)
76 S. Crepey So an equivalent definition of a solution to (15) would be that of a special semimartingale ? (rather than a triplet of processes (?,M,K)) such that all conditions in (15) are satisfied, whereM and K therein are to be understood as the canonical local martingale and finite variation predictable components of process [0,-] ??1 t d(?t ?t). Note that the first line of (15) is equivalent to ?t = ? + T t (Cu ? ru?u)du + (KT ? Kt) ? (MT ?Mt), t? [0, T ]. (18) As established in [38, 56, 57], existence and uniqueness of a solution to (15) (under suitable L2-integrability conditions on the data and the solution) are essentially equivalent to the so-called Mokobodski condition, namely, the existence of a quasimartingale Y (special semimartingale with additional integrability properties, Sect. 16.2.2) such that L?Y ?U on [0, T ]. Existence and uniqueness of a solution to (15) thus hold when one of the barriers is a quasimartingale and, in particular, when one of the barriers is given as S ? c, where S is a squareintegrable Ito process and c is a constant in R?{??} (see [38] as well as Note 8(v) and Proposition 30 in Part II). This covers, for instance, the put payment process L of an American vanilla option, or of a convertible bond (see Definition 7 and Bielecki et al. [18, 19]). Moreover one typically has K = 0 in the case of an European derivative. We thus work henceforth in this part under the following hypothesis. Assumption 1 Equation (15) admits a solution (?,M,K), with K equal to zero in the special case of an European derivative. Proposition 2. ? is the P-price process of the derivative. Proof. If (?,M,K) is a solution to (15), then ? is a (special) semimartingale (see (18)), and, by a standard verification principle (cf. Proposition 18 in Part II), ? satisfies (12), which in the special cases of American (resp. European) options reduces to (10) (resp. (8)). One thus concludes by an application of Proposition 1. We are now ready to interpret the P-price ?, thus defined via (15), in terms of the notion of hedging introduced in Sect. 2.2. Let us set ?? = inf u ? [t ? ??, T] ; ?u ? Uu? T. (19) Using the minimality condition (third line) in (15) and the continuity of K, one thus has,K? = 0 and K = K+ ? 0 on [0, ??], ??? = U?? on {?? < T}. (20) Note that for any primary strategy ?, the issuer's Profit and Loss (or Tracking Error) process (et)t?[0,T ] relative to the price process ? of Proposition 2 is given for t ? [0, T ] by:
About the Pricing Equations in Finance 77 ?tet = ?0 ? t 0 ?uCudu + t 0 ?ud(?u Pu) ? ?t?t = t 0 ?d(?u ?u) + ?ud(?u Pu)(21) where ?is defined by (17), so that, in view of Proposition 2, ?can be interpreted as the P - cumulative price of the option (cf. (2)). Observe in view of (18) that the tracking error process e is a special semimartingale. Let the P - local martingale ? = ?(?) be such that ?0 = 0 and - 0 ?td?t is the local martingale component of the special semimartingale ?e, so (cf. (21), (18)) d?t = dMt ? ?t ??1 t d(?t Pt) (22) ?tet = t 0 ?udKu ? t 0 ?ud?u. (23) The arguments underlying the following result are classical, and already present for instance in Lepeltier and Maingueneau [75] (in the specific contexts of the Cox- Ross-Rubinstein or Black-Scholes models, analogous results can also be found in Kifer [69]). Proposition 3. (i) For any primary strategy ?, (?0, ?, ??), is an hedge with P - local martingale cost ?(?); (ii) ?0 is the minimal initial wealth of an hedge with P - local martingale cost; (iii) In the special case of an European derivative with K = 0, then (?0, ?) is a replicating strategy with P - local martingale cost ?. ?0 is thus also the minimal initial wealth of a replicating strategy with P - local martingale cost. Proof. (i) One must show that for any ? ? T , almost surely: ?0 + ???? 0 ?ud(?u Pu) + ???? 0 ?ud?u ? ???? 0 ?uCudu+?????1{????=?<T}Lt + 1{??<?}U?? + 1{??=?=T}?(24) or equivalently, using (22): ?0 + ???? 0 ?udMu ? ???? 0 ?uCudu + ?????1{????=?<T}L? + 1{??<?}U?? + 1{??=?=T}?(25) where by the first line in (15): ?0 + ???? 0 ?udMu = ?????????? + ???? 0 ?uCudu + ???? 0 ?udKu.
78 S. Crepey Inequality (25) then follows from (20) and from the following relations, which are valid by the terminal and put conditions in (15): ?T = ? , ?? ? L? . (ii) There exists an hedge with initial wealth ?0 and P - local martingale cost, by (i) applied with, for instance, ? = 0. Moreover, for any hedge (w, ?, ?) with P - local martingale cost Q, one has for every t ? [0, T ]: w + ??t 0 ?ud(?u Pu) + ??t 0 ?udQu ? ??t 0 ?uCudu + ???t1{??t=t<T}Lt + 1{?<t}U? + 1{?=t=T}?(26) The left hand side is thus a bounded from below local martingale, hence it is a supermartingale.Moreover, (26) also holds with a stopping time ? ? T instead of t therein. So, by taking expectations in (26) with ? instead of t therein: w ? E??? 0 ?uCudu + ????1{??=?<T}L? + 1{?<?}U? + 1{?=?=T}?. Hence w ? ?0 follows, by (12). (iii) In the special case of an European derivative, the stated results follow by setting K = 0 in the previous points of the proof. Note 3. (i) Proposition 3 thus characterizes the P-price (arbitrage price relative to the risk-neutral measure P) of a derivative as the smallest initial wealth of a hedge with P - local martingale cost, under the assumption that the related reflected BSDE (15) has a solution. For related results, see also Follmer and Sondermann [50] or Schweizer [85]. (ii) The special case ? = 0 in the previous results corresponds to a suitable form of model completeness (replicability of European options, cf. point (iii) of the proposition), in which the issuer of the option wishes to hedge all the risks embedded in the option. The case ? = 0 corresponds to either model incompleteness, or a situation of model completeness in which the issuer wishes not to hedge all the risks embedded in the product at hand, for instance because she wants to limit transaction costs, or because she wishes to take some bets in specific risk directions. (iii) In case where ? may be taken equal to 0 in Proposition 3, the minimality statements in this proposition can be used to prove uniqueness of the related arbitrage prices. (iv) Analogous definitions and results hold for holder hedges. (v) It is also easy to see that one could state analogous definitions and results regarding hedging a defaultable game option starting at any date t ? [0, T ], rather than at time 0 above.
About the Pricing Equations in Finance 79 3 Markovian Set-Up 3.1 Markovian FBSDE Approach In order to be usable in practice, a dynamic pricing model needs to be constructive, or Markovian in some sense, relatively to a given derivative. Thiswill be achieved by assuming that the related BSDE (15) is Markovian (see Sect. 4 of [46] and Part II). Definition 5. We say that the BSDE (15) is a Markovian backward stochastic differential equation if the input data r,C, ?, L and U of (15) are given by Borelmeasurable functions of some Rq-valued (F, P)-Markov factor process X, so rt = r(t,Xt), Ct = C(t,Xt), ? = ?(XT ), Lt = L(t,Xt), Ut = U(t,Xt) , (27) and is ?? is the first time of entry, capped at T, of the process (t,X), into a given closed subset of [0, T ] ? Rq. Remark 4. By a slight abuse of notation, the related functions are thus denoted in (27) by the same symbols as the corresponding processes or random variables. In particular, the system made of the specification of a forward dynamics for X, together with the BSDE (15), constitutes a decoupledMarkovian forward backward system of equations in (X, ?,M,K). The system is decoupled in the sense that the forward component of the system serves as an input for the backward component (X is an input to (15), cf. (27)), but not the other way round. See Definition 11 in Part II for more complete and formal statements. From the point of view of interpretation, the components of X are observable factors. These are intimately, though non-trivially, related with the primary risky asset price process P, as follows: : Most factors are typically given as primary price processes. The components of X that are not included in P (if any) are to be understood as simple factors that may be required to "Markovianize" the payoffs of the derivative at hand, such as factors accounting for path dependence in the derivative's payoff, and/or non-traded factors such as stochastic volatility in the dynamics of the assets underlying the derivative; : Some of the primary price processes may not be needed as factors, but are used for hedging purposes. Note that observability of the factor process X in the mathematical sense of F-adaptedness is not sufficient in practice. In order for a factor process model to be usable in practice, a constructive mapping from a collection of meaningful and directly observable economic variables to X is needed. Otherwise, the model will be useless.
80 S. Crepey 3.2 Factor Process Dynamics Under a rather generic specification for theMarkov factor process X, we now derive a variational inequality approach for pricing and hedging a financial derivative.We thus assume that the factor processX is an (F = FW,N, P)-solution of the following Markovian (forward) stochastic differential equation in Rq: dXt = b(t,Xt) dt + ?(t,Xt)dWt + ?(t,Xt?)dNt, (28) where: : W is a q-dimensional Brownian motion, and : N is a compensated integer-valued random measure with finite jump intensity measure ?(t,Xt, dx), for some deterministic function ?. In particular ?(t,Xt?)dNt in (28) is a short-hand for Rq ?(t,Xt?, x)N(dt, dx), where the integration is with respect to the x variable. The response jump size function ? and the intensity measure ?, like the other model coefficients b and ? of X, are to be specified depending on the application at hand: see Sect. 3.3 for specific examples and Definition 10 in Part II for more precise statements. Remark 5. The generic and "abstract" jump-diffusion (28) will be made precise and specified in Part II in the form of a process X = (X,N) in which a jump-diffusion - like componentX interacts with a continuous-timeMarkov chain - like component N; so the process X in Part II corresponds to X here. Let us introduce the following additional notation: : Jt, a random variable on Rq with law ?(t,Xt?,dx) ?(t,Xt?,Rq) conditional on Xt?, where x represents the "mark" of the jump of X in ?(t,Xt?, x), : (tl), the ordered sequence of the times of jumps of N (note that we deal with a finite jump measure ?, so (tl) is well defined), : For any vector-valued function u on Rq and for every t ? [0, T ], ?u(t, x, y) = u(t, x + ?(t, x, y)) ? u(t, x) , ?u(t, x) = Rq ?u(t, x, y)?(t, x, dy) ?ut = ?u(t,Xt?, Jt) , ??ut = ??u(t,Xt?) . (29) We apologize to the reader for this admittedly heavy notation, which is motivated by the wish to give intuitive and compact forms below to various expressions of the model's dynamics, generator and Ito formula. Denoting further ??(t, x) := ?IdRq (t, x) = Rq ?(t, x, y)?(t, x, dy), ?t = ?(t,Xt?, Jt) , ??t = ??(t,Xt?),
About the Pricing Equations in Finance 81 one thus has for instance: ?(t,Xt?)dNt = dtl?t ?tl? ??tdt (30) and the dynamics (28) of X may be rewritten as dXt =b(t,Xt)dt + ?(t,Xt)dWt + dtl?t ?tl(31) where we setb(t, x) = b(t, x) ? ??(t, x). 3.2.1 Ito Formula and Model Generator In view of (31), the following variant of the Ito formula holds, for any real-valued function u of class C1,2 on [0, T ] ? Rq: du(t,Xt) = Gu(t,Xt) dt + ?u(t,Xt) ?(t,Xt)dWt + d??tl?t ?utl?? (32) with Gu(t, x) = ?tu(t, x) + ?u(t, x)b(t, x) + 12Tr[a(t, x)Hu(t, x)] (33) where a(t, x) = ?(t, x)?(t, x)T, and where ?u and Hu denote the row-gradient and the Hessian of u with respect to x - so in particular Tr[a(t, x)Hu(t, x)] = 1?i,j,k?q ?i,k(t, x)?j,k(t, x)?2xi,xju(t, x). Using the short-hand ?u(t,Xt?)dNt = x?Rq ?u(t,Xt?, x)N(dt, dx), note that one has (cf. (30)), ?u(t,Xt?)dNt = dtl?t ?utl? ?utdt. (34) The Ito formula (32) may thus be rewritten as du(t,Xt) = Gu(t,Xt) dt + ?u(t,Xt) ?(t,Xt)dWt + ?u(t,Xt?)dNt (35)
82 S. Crepey where we set Gu(t, x) = Gu(t, x) + ??u(t, x) = ?tu(t, x) + ?u(t, x)b(t, x) + 12 Tr[a(t, x)Hu(t, x)] + ?u(t, x)??u(t, x)??(t, x). (36) The process X is thus a Markov process with generator G (see Proposition 29 in Part III for a more formal derivation). Remark 6. By a convenient abuse of terminology we call here and henceforth G the generator of X, whereas strictly speaking G is the generator of the time-extended process (t,X) (the generator of X does not contain the ?t term). 3.2.2 Brackets Let ?c and ?c, resp. ?? and ??, denote the continuous local martingale components, resp. the jump processes, of two given real-valued semimartingales? and ?. Recall that the quadratic covariation or bracket [?,?] is given by d[?,?]t = d(?t?t) ? ?t?d?t ? ?t?d?t (37) = d?c,?ct + d??s?t ??s??s?? (38) with the initial condition [?,?]0 = 0. The sharp bracket ?,?corresponds to the compensator of [?,?], which is well defined provided [?,?] is of locally integrable variation (see, e.g., Protter [84]). Assuming ? and ? to be defined in terms of the process X of (28) by ?t = u(t,Xt) and ?t = v(t,Xt) for deterministic and "smooth enough" functions u and v, then (38) yields, in view of the Ito formula (35):d[?,?]t = ?ua(?v)T (t,Xt) dt + dtl?t ?utl?vtl. The bracket [?,?] thus admits a compensator <?,?> given as a timedifferentiable process with the following Lebesgue-density: d<?,?>t dt = (u, v) (t,Xt) (39)
About the Pricing Equations in Finance 83 where we denote, for any vector-valued functions u and v on Rq such that the matrix-product uvT makes sense: (u, v)(t, x) = ?ua(?v)T(t, x) + y?Rq ?u(?v)T(t, x, y)?(t, x, dy). (40) Remark 7. In the vector-valued case ?u and ?v are defined component by component, and can thus be identified to the Jacobian matrices of u and v. Besides, (37) yields by application of the Ito formula (35) to the functions u, v and uv, "" standing for "equality up to a local martingale term": d[?,?]t = d(?t?t) ? ?t?d?t ? ?t?d?t {G(uv) ? uGv ? vGu} (t,Xt) dt. This yields the following alternative expression for d<?,?>t dt (cf. (39)): d<?,?>t dt = {G(uv) ? uGv ? vGu} (t,Xt). (41) Remark 8. The bilinear operator (u, v) > ?(u, v) = G(uv) ? uGv ? vGu which appears in the right-hand-side of (41) is known as the carre du champ operator associated to G (see, for instance, Sects.XV.20-26 of Dellacherie and Meyer [43]). In particular, formula (41) above corresponds to formula (22.1) on page 244 of [43]. We are now ready to prove the following, Proposition 4. For processes ? and ? given as ?t = u(t,Xt) and ?t = v(t,Xt), where u and v are "smooth enough," one has in probability, for almost every t, d?,?t dt = limh>0 h?1Covt(?t+h ? ?t,?t+h ? ?t) (42) where the subscript t stands for "conditional on Ft." Proof. For any fixedh > 0, one has, Covt(?t+h ? ?t,?t+h ? ?t) + Et(?t+h ? ?t)Et(?t+h ? ?t) = Et (?t+h?t+h ? ?t?t) ? ?tEt (?t+h ? ?t) ? ?tEt (?t+h ? ?t) . (43)
84 S. Crepey Now one has by the Ito formula (35) applied to u, v and uv, respectively: lim h>0 h?1Et(?t+h ? ?t) = Gu(t,Xt) lim h>0 h?1Et(?t+h ? ?t) = Gv(t,Xt) lim h>0 h?1Et (?t+h?t+h ? ?t?t) = G(uv)(t,Xt) Hence, by (43): lim h>0 h?1Covt(?t+h ? ?t,?t+h ? ?t) = {G(uv) ? uGv ? vGu} (t,Xt) = d?,?dt , by (41). 3.3 Examples 3.3.1 Model Specifications In case ? = 0, the jump component of the generic jump-diffusion (28) vanishes, and we are left with a diffusion X. In case b = ?? (sob= 0in (31)) and ? = 0, the general jump-diffusionX reduces to a pure jump process. Under a more specific structure on ? and ? (see Sect. 6 in Part II), the jump process X is supported by a finite set which can be identified with E = {1, . . ., n}, without loss of generality, and X is a continuous-time E-valued Markov chain X such that (cf. (31)) dXt = dtl?t ?tl. (44) The generator G of X us then given by, for any time-differentiable function u over [0, T ]? E (or, equivalently, any system u = (ui)1?i?n of time-differentiable functions ui over [0, T ]): Gui(t) = ?tui(t) + ?ui(t) = ?tui(t) +j=i ?i,j(t)uj(t) ? ui(t). (45) 3.3.2 Unbounded Jump Measures For simplicity we did not consider yet the "infinite activity" case of possibly unbounded jump intensity measures ?(t, x, -). Note however that reinforcing our local boundedness assumption on the response jump size function ? into |?(t, x, y)| < C(1 ? |y|) (46)
About the Pricing Equations in Finance 85 for some constant C locally uniformin (t, x),3 then most statements in this part (and the related developments in Parts II-IV as well) can be extended to more general Levy jump measures ?(t, x, -) on Rq such that, locally uniformly in (t, x), Rq (1 ? |y|2)?(t, x, dy) < C. (47) The stochastic differential equation (28) then defines a Markov processX with generator written as (compare with (36)) Gu(t, x) = ?tu(t, x) + ?u(t, x)b(t, x) + 12 Tr[a(t, x)Hu(t, x)] +Rq ?u(t, x, y)??u(t, x)?(t, x, y)?(t, x, dy) (48) where the integral converges for functions u = u(t, x) of class C2 in x, under (46), (47). Remark 9. In the context of Levy jump measures ? on Rq, the process X is typically defined via its Levy triplet (?b, ?, ?) in the following form (see, e.g., Cont and Tankov [35]): dXt =?b(t,Xt) dt + ?(t,Xt)dWt + d???tl?t ?(t,X?tl?, J?tl )?? +|x|<1 ?(t,Xt?, x)N(dt, dx) (49) where the ?tls stand for the successive jump times of the process t > N(?B1?[0, t]), in which ?B1 denotes the complement of the unit ball in Rq (note that the ordered sequence (?tl) is well defined, in the case of Levy jump measures ?(t, x, -)). By identification with (28), it comes: b(t, x) =?b(t, x) + |y|?1 ?(t, x, y)?(t, x, dy). The following equivalent form of the generator G in terms of?bfollows (cf. (48)): Gu(t, x) = ?tu(t, x) + ?u(t, x)?b(t, x) + 12 Tr[a(t, x)Hu(t, x)] +Rq ?u(t, x, y)??u(t, x)?(t, x, y)1|y|<1?(t, x, dy). (50) 3.3.3 Applications With such versatile specifications ranging from pure diffusions, or (resorting to unbounded jump measures as explained in Sect. 3.3.2) Levy processes, to 3 In the sense that for every compact set in the (t, x) variables there exists a constant C such that (46) holds for every (t, x) in this set and y ? Rq.
86 S. Crepey continuous-time Markov chains, the jump-diffusion model factor process model (28) offers a flexible setting which is rich enough for most applications in financial derivatives modeling. This set-up includes in particular the most common forms of stochastic volatility and/or jump equity derivativesmodels, like the Black-Scholesmodel, local volatility models, the Merton model, the Heston model, the Bates model, or the most common forms of Levy models used in finance for pricing purposes. As will be explained in Sect. 4.1, the risk-neutral modeling approach can be readily extended to a martingalemodeling approach relatively to an arbitrary numeraire, rather than the savings account in the risk-neutral approach. This allows one to extend the previous models to interest-rates and foreign exchange derivatives, yielding for instance the Black model or the SABR model, to quote but a few. Moreover, as we shall see in Sect. 4.2, one can easily accommodate in the riskneutral (or in a more general martingale)modeling approach defaultable derivatives with terminal payoffs of the form 1T<??(XT ) (or 1?<??(X? ) upon exercise at a stopping time ?, in case of American or game claims), where ? represents the default-time of a reference entity. This allows one to deal with equity-to-credit derivatives, like, for instance, convertible bonds (see Sect. 4.2.1). A model X as of (28) is then typically used in the mode of a pre-default factor process model (see Sect. 4.2 and [20]). Finally continuous-timeMarkov chains, or continuous-timeMarkov chains modulated by diffusions, which, as illustrated in Sect. 3.3.1 and made precise in Part II (see Sects. 6 and 7 therein), can all be considered as specific instances of the general jump-diffusion framework (28), cover most of the dynamic models used in the field of portfolio credit derivatives. Let us thus quote: : The so called local intensity model, or pure birth process, which is used for modeling a credit portfolio cumulative loss process in Laurent et al. [74], Cont and Minca [34] or Herbertsson [59], : A more general homogeneous groups model considered for different purposes by various authors in [22, 30, 53], among others, : An even more general basket credit migrations model of Bielecki et al. [15,16] in which the dynamics of the credit ratings of reference entities are modulated by the evolution of macro-economic factors, or another generation of Markovian copula models of Bielecki et al. [17] with model marginals automatically calibrated to the individual CDS curves. 3.4 Markovian Reflected BSDEs and PDEs with Obstacles 3.4.1 No Protection Price With the jump-diffusion factor process X defined by (28) and in the special case of a game option with no call protection (?? = 0), the partial integro-differential equation formally related to the pricing BSDE (15) writes,
About the Pricing Equations in Finance 87 min max Gu(t, x) + C(t, x) ? r(t, x)u(t, x), L(t, x) ? u(t, x), U(t, x) ? u(t, x)= 0, t<T, x?Rq, (51) with terminal condition u(T, x) = ?(x). An application of the results of Part III (see Proposition 31(i) therein) yields, Proposition 5. Under mild conditions, the variational inequality (double obstacle problem) (51) is well-posed in the sense of viscosity solutions, and its solution u(t, x) is related to the solution (?,M,K) of (15) as follows, for t ? [0, T ]: ?t = u(t,Xt). (52) In view of Proposition 3(ii), u(0,X0) = ?0 is therefore the minimal initial wealth of a super-hedge with P - local martingale cost process for the option. Remark 10. When the pricing function u is sufficiently regular for an Ito formula to be applicable, one has further, for t ? [0, T ] (see, e.g., [4, 5, 7, 11, 12]), dMt = ?u?(t,Xt)dWt + ?u(t,Xt?)dNt. (53) 3.4.2 Protection Price We now consider a call protection of the form ?? = inf{t > 0 ; Xt /? O}?T (54) for a constant T ? [0, T ] and an open subsetO ? Rq satisfying suitable regularity properties (see, e.g., Example 3 in Part II). A further application of the results of Part III (Proposition 31 therein) then yields, Proposition 6. (i) (Post-protection price). On [??, T], the P-price process ? can be represented as ?t = u(t,Xt), where u is the unique viscosity solution of (51); (ii) (Protection price). On [0, ??], the P-price process ? can be represented as ?t = ?u(t,Xt), where the function ?u is the unique viscosity solution of the following variational inequality (lower obstacle problem): max G?u(t, x) + C(t, x) ? r(t, x)?u(t, x), L(t, x) ? ?u(t, x)= 0, t < T, x ? O, (55) with boundary condition ?u = u on [0, T ] ? Rq\ [0, T)?O. Remark 11. Because of the jumps in X, one needs to deal with the "thick" parabolic boundary [0, T ] ? Rq\ [0, T)?O.
88 S. Crepey Moreover (cf. Remark 10), in case the pricing functions u and ?u are sufficiently regular for an Ito formula to be applicable, one has further, for t ? [0, T ], dMt = ???(t,Xt)dWt + ??(t,Xt?)dNt, (56) where the random function ? therein is to be understood as u for t > ?? and ?u for t ? ??. Remark 12. Under more specific assumptions on the structure of X (see, e.g., Sect. 6 in Part II), the generic cascade of two PDEs (51), (55) must be suitably amended. For instance, in the case of a continuous-time Markov chain X over E = {1, . . . , n} and for ?? defined by (54) with O therein given as a subset of E, (51) and (55) on Rq in fact reduce to a cascade of two systems of ODEs to be solved in (u, ?u) = (ui(t), ?ui(t))1?i?n, namely, ????????? ???????? ui(T) = ?i(T ), 1 ? i ? n min max Gui(t) + Ci(t) ? ri(t)ui(t), Li(t) ? ui(t), Ui(t) ? ui(t)= 0, t<T, 1 ? i ? n ?u = u on [0, T ] ? E\ [0, T)?Omax G?ui(t) + Ci(t) ? ri(t)?ui(t), Li(t) ? ?ui(t)= 0, t<T, i ? O (57) with the generator G therein given by (45). In this article we refer to a decoupled system of partial integro-differential equations or obstacle problems, as to a cascade of PDEs. In particular (but not only, cf. above), this terminology will be used for systems consisting of equations defined over successive time intervals [Tl?1, Tl], in which the solution of the equation which is posed over the next (in "backward time") time interval is used as a terminal condition for the equation over the previous time interval. 3.5 Discussion of Various Hedging Schemes In view of Proposition 6, the first line of (15) takes the following form (cf. (18)): ? d?(t,Xt) = (C ? r?)(t,Xt)dt + dKt ????(t,Xt)dBt ? ??(t,Xt?)dNt (58) where the function ? therein is to be understood as u for t > ?? and ?u for t ? ??. Let us assume the same structure (without the barriers) on the primary market price process P, so Pt = v(t,Xt) for a deterministic function v(t, x), and ? dv(t,Xt) = (C ?rv)(t,Xt)dt??v?(t,Xt)dBt ? ?v(t,Xt?)dNt, (59)
About the Pricing Equations in Finance 89 where C(t,Xt) represents a primary market coupon rate process. Note that v is an Rd-valued function, so in particular?v lives in Rd?q, and identity (59) holds in Rd. The cost ? relative to the strategy ? (cf. (22)) can in turn be expressed in terms of the pricing functions u and v and the related delta functions. Proposition 7. Under the previous conditions in the Markovian jump-diffusion setup (28), the dynamics (22) for the cost process ? relatively to the strategy ? (and thus the related tracking error e in (23)) may be rewritten as (using the notation introduced in (29)): d?t = ???(t,Xt) ? ?t?v?(t,Xt)dWt + ??(t,Xt?) ? ?t?v(t,Xt?)dNt (60) It is thus possible to hedge completely the market risk W by setting, provided ?v? is left-invertible, ?t = ???(?v?)?1(t,Xt) (61) In the simplest case where q = d and ?v and ? are invertible this formula further reduces to ?t = ??(?v)?1(t,Xt) (62) Plugging this strategy into (60), one is left with the cost process ?t = - 0 ??(t,Xt?) ? ?t?v(t,Xt?)dNt (63) with ? defined by (61) (or (62)). It is thus interesting to note that this strategy, which is perfect on one hand from the point of view of hedging the market risk W, potentially creates some jump risk on the other hand via the dependence on ? of the integrand in (63). At the other extreme, in case the jump measure has finite support (like in the case of a continuous-time Markov chain X with state-space reducible to a finite set E, cf. Remark 12), it is alternatively possible to hedge completely the jump risk N by setting, provided ?v(t,Xt?) is left-invertible, ?t = ??(?v)?1(t,Xt?). (64) Plugging this strategy into (60), one is left with the cost process ?t = - 0 ???(t,Xt) ? ?t?v?(t,Xt)dWt (65) with ? defined by (64). Note however that this strategy potentially creates market risk via the dependence in ? of the integrand in (65).
90 S. Crepey Remark 13. In the context of credit derivatives (see also Sect. 4.2 in this regard), hedging the source risk W typically amounts to hedging the spread risk, whereas hedging the source risk N typically amounts to hedging default risk. We thus see that hedging the spread risk without caring about default risk, which has been the tendency in the practical risk management of credit derivatives in the last years (to spare the high cost of hedging default risk), can lead to leveraged default risk. 3.5.1 Min-Variance Hedging Again a perfect hedge (? = 0) is hopeless unless the jump measure of X has finite support. In the context of incomplete markets the choice of a hedging strategy is up to one's optimality criterion, relatively to the hedging cost (22), (60). For instance, a trader may wish to minimize the (objective, P - ) variance of T 0 ?td?t. Yet the related strategy ?va is hardly accessible in practice (in particular it typically depends on the objective model drift, a quantity notoriously difficult to estimate from financial data). As a proxy to this strategy, traders commonly use the strategy ?va which minimizes the risk-neutral variance of the error. Note that under mild conditions - 0 ?dM and ? P are square integrable martingales, as they can typically be defined in terms of the martingales components of the solutions to related BSDEs. The risk-neutral min-variance hedging strategy ?va is then given by the following Galtchouk-Kunita-Watanabe decomposition of - 0 ?dM with respect to ? P (see, e.g., Protter [84, IV.3, Corollary 1]): ?tdMt = ?va t d(?t Pt) + ?td?va t (66) for some Rd-valued ? P-integrable process ?va and a real-valued square integrable martingale ?td?va t strongly orthogonal to ? P. Denoting in vector-matrix form < A,B >= (< Ai,Bj >)ji , <A>=< A,A > , one thus has by (66) and (39): ?va t = d<?, P >t dt d< P >t dt ?1 = (?, v)((v, v))?1t,Xt?. (67) Note 4. (i) For every fixed t ? [0, T ] and h > 0, it follows from (66) that (?va u )u?[t,t+h] minimizes Vart(t+h t ?udMu ? t+h t ?ud(?ud Pu)), where the subscript t stands for "conditional on Ft," over the set of all primary strategies (?u) on the time interval [t, t + h]. Let likewise ?va,h t minimize
About the Pricing Equations in Finance 91 Vart(t+h t ?udMu ? ?ht t+h t d(?ud Pu)) over the set of all buy-and-hold constant strategies ?ht on the time interval [t, t + h]. The strategy ?va,h t is given as the solution of the linear regression problem of t+h t ?udMu against t+h t d(?ud Pu), so: ?va,h t = Covtt+h t ?udMu, t+h t d(?ud Pu)Vartt+h t d(?ud Pu)?1 . In view of (43) we deduce that ?va t = limh>0 ?va,h t , as it was natural to expect. (ii) In case of a diffusion X (without jumps), sharp brackets coincide with square brackets and are independent of the equivalent probability measure under consideration. It follows that the risk-neutral min-variance hedging strategy ?va defined by (67) satisfies ?va t = limh>0 ?va,h t , where the strategies ?va,h t are the counterpart relatively to the objective probabilitymeasureP of the strategies ?va,h t introduced in part (i). In the no jumps case the risk-neutral min-variance hedging strategy ?va is thus also an objective locally (but possibly not globally) minimal variance strategy. 4 Extensions 4.1 More General Numeraires Up to this point, we implicitly chose the savings account ??1, assumed to be a positive finite variation process, as a numeraire, namely a primary asset with positive price process, used for discounting other price processes. However for certain applications, like dealing with stochastic interest rates in the field of interest rate derivatives, this choice may not be available (inasmuch as there may not be a riskless asset in the primary market), or it may not be the most appropriate (even if there is a riskless asset, the choice of another asset as a numeraire may be more convenient). This motivates the extension of the previous developments to the case where B is a general locally bounded positive semimartingale, not necessarily of finite variation. The interpretation of B as savings account and of ? = B?1 as a riskless discount factor is now replaced by the interpretation of B as a simple numeraire, referring to the fact that other price processes will be typically expressed as relative (rather than discounted) prices ?P. Understanding a discounted price as a relative price, a risk-neutral model as a martingale model relatively to the numeraire B, etc., the risk-neutral modeling approach developed in the previous sections holds mutatis mutandis under this relaxed assumption on B. Note in particular that the self-financing condition still assumes the form of (4) (see, e.g., Protter [83]), though this is not as obvious as in the special case where B was a finite variation and continuous process. Also note that the
92 S. Crepey concept of arbitrage is now to be understood relatively to the numeraire B (the set of admissible strategies being a numeraire dependent notion). In this more general situation, we define a formal correspondence between triplets of processes (?,M,K) and (?,m, k) by setting ?t = ?t?t , dmt= ?t dMt , dkt= ?t dKt with m0 = 0 and k0 = 0 (68) where ? now refers to the discount factor relatively to an arbitrary numeraire. Note that the pricing BSDE (15) (with ? therein as mentioned above) to be solved in (?,M,K), is equivalent to the following BSDE with data (c, ?, , ?h) := (?C, ?T ?, ?L, ??U), to be solved in (?,m, k) (cf. (18)): ?t = ? + cT ? ct + kT ? kt ? (mT ? mt), t? [0, T ] t ? ?t ??ht, t? [0, T ] T 0 (?u ? u) dk+u = T 0 (?hu ? ?u) dk?u = 0, (69) which is but (15) with input data r,C, ?, L, ?Udefined as 0, c, ?, , ?h. The conclusions of Propositions 2 and 3 are still valid in this context, provided "a solution (?,M,K) to (15)" therein is understood as the process (?,M,K) defined via (68) in terms of a solution (?,m, k) to (69). The Markovian case now corresponds to the situation where (cf. (27)): ct = c(t,Xt), ? = ?(XT ), t = (t,Xt), ht = h(t,Xt) (70) for a suitable Rq-valued (F, P)-Markov factor process X. In the generic jumpdiffusion model X defined by (28) under a valuation measure P corresponding to the numeraire under consideration, with generator G given by (36), and for ?? given by (54), the cascade of two PDEs to be solved in the no-protection and protection pricing functions u, ?u formally related to the BSDE (69) writes: ?????? ????? u(T, x) = ?(x), x ? Rq min (max (Gu + c, ? u) , h ? u) = 0 on [0, T ) ? Rq ?u = u on [0, T ] ? Rq\ [0, T)?Omax G?u + c, ? ?uon [0, T)?O (71) We then have the following analog to Propositions 5 and 6. Proposition 8. Under suitable conditions, the BSDE (69) admits a unique solution (?,m, k), and the cascade of PDEs (71) admits a unique viscosity solution (u, ?u). The connection between (?,m, k) and (u, ?u) writes, for t ? [0, T ]: ?t = ?(t,Xt) where ? is to be understood as u for t > ?? and ?u for t ? ??.
About the Pricing Equations in Finance 93 Moreover, in case the pricing functions u, ?u are sufficiently regular for an Ito formula to be applicable, one has further, for t ? [0, T ], dmt = ???(t,Xt)dWt + ??(t,Xt?)dNt. Let us further assume that the primary risky price process P satisfies likewise p = ?P = v(t,Xt) for a function v such that d(?t Pt) = ?v?(t,Xt)dWt + ?v(t,Xt?)dNt. (72) One then has the following analog to Proposition 7. Proposition 9. ?0 = B0?(t,X0) (with B0 = 1, in our set-up) is the minimal initial wealth of a super-hedge with P - local martingale cost process. Moreover the cost process ? = ?(?) and the tracking error process e = e(?) in (21)-(23) may be rewritten as, respectively (with ?0 = 0): d?t = ???(t,Xt) ? ?t?v?(t,Xt)dWt + (??(t,Xt?) ? ?t?v(t,Xt?))dNt (73) ?tet = ?0 ? t 0 cudu + t 0 ?ud(?u Pu) ? ?t = t 0 dku ? t 0 ?ud?u . (74) It is thus possible to hedge completely the market risk represented by W by setting, provided ?v? is left-invertible, ?t = ???(?v?)?1(t,Xt) (75) In the simplest case where q = d and ?v and ? are invertible this formula further reduces to ?t = ??(?v)?1(t,Xt) (76) Alternatively, it is possible to hedge completely the jump risk N by setting, provided ?v(t,Xt?) is left-invertible (assuming a jump measure with finite support, here), ?t = ??(?v)?1(t,Xt?) (77) Still another possibility is to use the strategy ?va which minimizes the risk-neutral variance of the error, and which is given by ?va t = d<?, p>t d<p>t = (?, v) (v, v) (t,Xt?). (78)
94 S. Crepey 4.2 Defaultable Derivatives To illustrate further the flexibility of the above martingale modeling approach to pricing and hedging problems in finance, we now consider an extension of the previous developments to defaultable derivatives. This class of assets, including convertible bonds in particular (see Definition 7), plays an important role in the sphere of equity-to-credit/credit-to-equity capital structure arbitrage strategies. Back to risk-neutral modeling with respect to a numeraire B given as a savings account and for a riskless discount factor ? = B?1 as of (1), we thus now consider defaultable derivatives with terminal payoffs of the form 1T<??(ST ) (or 1?<??(S? ) upon exercise at a stopping time ?, in case of American or game claims), where ? represents the default-time of a reference entity. We shall follow the reduced-form intensity approach originally introduced by Lando [73] or Jarrow and Turnbull [65], subsequently generalized in many ways in the credit risk literature (see for instance Bielecki and Rutkowski [14]), and extended in particular to American and game claims in Bielecki et al. [18-20, 23], on which the material of this section is based. We shall give hardly no proofs in this section, referring the interested reader to [18-20, 23]. Themainmessage here is that defaultable claims can be handled in essentially the same way as default-free claims, provided the default-free discount factor process ? is replaced by a credit-risk adjusted discount factor ?, and a fictitious dividend continuously paid at rate ?, the so-called default intensity, is introduced to account for recovery on the claim upon default. Incidentally note that the "original default-free" discount factor ? can itself be regarded as a default probability, at the killing rate r in (1). 4.2.1 Cash Flows Given a [0, T ] ? {+?}-valued stopping time ? representing the default time of a reference entity (firm), let us set It = 1{??t}, Jt = 1? It. We shall directly consider the case of defaultable game options with call protection ??. For reasons analogous to those developed above, these encompass as a special case defaultable American options (case ?? = T ), themselves including defaultable European options. In few words, a defaultable game option is a game option in the sense of Definition 2(iii), with all cash flows killed at the default time ?. Given a call protection ?? ? T and a pricing time t ? [0, T ], let ? stand for ? ? ? ? ?, for any (?, ? ) ? ? Tt ? Tt.
About the Pricing Equations in Finance 95 Definition 6. A defaultable game option is a game option with the ex-dividend cumulative discounted cash flows ?t?t(?, ? ), where the F?-measurable random variable ?t(?, ? ) is given by the formula, for any pricing time t ? [0, T ], holder call time ? ? ? Tt and issuer put time ? ? Tt, ?t?t(?, ? ) = ? t ?u dDu + ??J?1{?=?<T}L? + 1{?<?}U? + 1{?=T}?, (79) where: : The dividend process D = (Dt)t?[0,T ] equals Dt = [0,t] JuCudu + Ru dIu, for some coupon rate process C = (Ct)t?[0,T ], and some predictable locally bounded recovery process R = (Rt)t?[0,T ]; : The put payment L = (Lt)t?[0,T ] and the call payment U =(Ut)t?[0,T ] are cadlag processes, and the payment at maturity ? is a random variable such that L ? U on [0, T ], LT ? ? ? UT . We further assume that R,L and ? are bounded from below, so that the cumulative discounted payoff is bounded from below. Specifically, there exists a constant c such that [0,t] ?u dDu + ?tJt1{t<T}Lt + 1{t=T}?? ?c , t ? [0, T ]. (80) Remark 14. One can also cope with the case of discrete coupons (see [18-20, 23] and Sect. 14 in Part IV). Convertible Bonds The standing example of a defaultable game option is a (defaultable) convertible bond. Convertible bonds have two important and distinguishing features: : Early put and call clauses at the holder's and issuer's convenience, respectively; : Defaultability, since they are corporate bonds, and one of the main vehicles of the so called equity to credit and credit to equity strategies. To describe the covenants of a convertible bond, we need to introduce some additional notation: ?N: the nominal, S: the price process of the asset underlying the bond,
96 S. Crepey ?R: the recovery rate process on the bond upon default of the issuer, ?: the loss given default on the underlying asset, ? : the bond's conversion factor, ? P, ? C: the put and call nominal payments, with by assumption ? P ? ?N? ? C. Definition 7. A convertible bond is a defaultable game option with coupon rate process C, recovery process Rcb and payoffs Lcb, Ucb, ?cb such that Rcb t = (1 ? ?)?St? ? ?Rt , ?cb = ?N? ?ST (81) Lcb t = ? P ? ?St, Ucb t = ? C ? ?St. (82) See [18] for a more detailed description of covenants of convertible bonds, with further important real-life features like discrete coupons or call protection. 4.2.2 Reduction of Filtration in the Hazard Intensity Set-Up An application of Proposition 1 yields (see Bielecki et al. [23]), Proposition 10. Assume that a semimartingale ? is the value of the Dynkin game related to a defaultable game option under some risk-neutral measure P on the primary market, that is, for t ? [0, T ]: esssup??Ttessinf?? ? TtEP?t(?, ? )Ft= ?t = essinf?? ? Ttesssup??TtEP?t(?, ? )Ft. (83) Then ? is an arbitrage price process for the defaultable game option. Moreover, a converse to this result holds under a suitable integrability assumption. We work henceforth under a given risk-neutral measure P ? M, with Pexpectation denoted by E. In view of applying the so-called reduced-form approach in single-name credit risk (see, e.g., [14]), we assume further that F = H ? F , where the filtration H is generated by the default indicator process It = 1{??t} and F is some reference filtration. Moreover, we assume that the optional projection of J, defined by, for t ? [0, T ], oJt = P(? > t | Ft) =: Qt (the so-called Azema's supermartingale), is a positive, continuous and nonincreasing process. Note 5. (i) If Q is continuous, ? is a totally inaccessible F - stopping time (see, e.g., Dellacherie and Meyer [43]). Moreover, ? avoids F - stopping times, in the sense that P(? = ?) = 0, for any F - stopping time ? (see Coculescu et al. [33]). (ii) Assuming Q continuous, the further assumption that Q has a finite variation in fact implies that Q is non-increasing. This further assumption lies somewhere between assuming further the (stronger) (H), or immersion, Hypothesis, and assuming
About the Pricing Equations in Finance 97 further that ? is an F - pseudo-stopping time. Recall that the (H) Hypothesis means that all F-local martingales are F - local martingales, whereas ? being an F - pseudo-stopping time means that all F - local martingales stopped at ? are F - local martingales (see Nikeghbali and Yor [77]). We assume for simplicity of presentation in this article that Q is timedifferentiable, and we define the default hazard intensity ?, the credit-risk adjusted interest rate ? and the credit-risk adjusted discount factor ? by, respectively; ?t = ?d lnQt dt , ?t = rt + ?t , ?t = ?t exp(?t 0 ?udu) = exp(?t 0 ?udu) Under the previous assumptions, the compensated jump-to-default process Ht = It ? t 0 Ju?udu, t ? [0, T ], is an F-martingale. Also note that the process ? is time-differentiable and bounded, like ?. The quantities ? and ?introduced in the next lemma are called the pre-default values of ? and ?, respectively. Lemma 1 (see, e.g., Bielecki et al. [23]). (i) For any F-adapted, resp. F-predictable process? over [0, T ], there exists an uniqueF -adapted, resp.F-predictable process ?over [0, T ] such that J? = J ?, resp. J-?? = J-? ?over [0, T ]. (ii) For any ? ? T, there exists a [0, T ]-valued F - stopping time ? such that ? ? ? = ? ? ?. In view of the structure of the payoffs ? in (79), we thus may assume without loss of generality that the data C, R, L, U, ?, the call protection ?? and the stopping policies ?, ? are defined relatively to the filtration F , rather than F above. More precisely, we assume in the sequel that C, L,U are F?adapted, ? ? FT, R is F -predictable and ??, ?, ? are F - stopping times. For any t ? [0, T ], Tt (or T , in case t = 0) henceforth denotes the set of [t, T ]-valued F - (rather than F - before) stopping times; ? denotes ? ? ? (rather than ? ? ? ? ? before), for any t ? [0, T ] and ?, ? ? Tt. The next lemma, which is rather standard if not for the presence of the stopping policies ? and ? therein, shows that the computation of conditional expectations of cash flows ?t(?, ? ) with respect to Ft, can then be reduced to the computation of conditional expectations of F-equivalent cash flows ?t(?, ? ) with respect to Ft. Lemma 2 (see Bielecki et al. [23]). For any stopping times (?, ? ) ? ? Tt ? Tt, one has, E?t(?, ? )Ft= Jt E?t(?, ? ) Ft, where ?t(?, ? ) is given by, with ? = ? ? ?, ?t?t(?, ?) = ? t ?ufudu + ??1{?=?<T}L? + 1{?<?}U? + 1{?=T}?(84) in which we set f = C + ?R.
98 S. Crepey As a corollary to the previous results, we have, Proposition 11 (see Bielecki et al. [23]). If an F -semimartingale ?solves the F - Dynkin game with payoff ?, in the sense that, for any t ? [0, T ], esssup??Ttessinf?? ? TtE?t(?, ? ) Ft= ?t = essinf?? ? Ttesssup??TtE?t(?, ? )Ft, then ? := J ?is an F-semimartingale solving the F - Dynkin game with payoff ?. Hence, by Proposition 10, ? is an arbitrage price for the option, with pre-default price process ?. A converse to this result may be established under a suitable integrability assumption. We thus effectively moved our considerations from the original market subject to the default risk, in which cash flows are discounted according to the discount factor ?, to the fictitious default-freemarket, in which cash flows are discounted according to the credit risk adjusted discount factor ?. 4.2.3 Backward Stochastic Differential Equations Pre-DefaultModeling The next step consists in modeling ?as the state-process of a solution ( ?, M, K), assumed to exist, to the following doubly reflected BSDE with data ?, f = C + ?R, ?, L, ?U= 1{-<??}?+1{-???}U (cf. Definition 4 for the definition of a solution to (85)): ?t ?t = ?T ? + T t ?u fudu + dKu ? dMu, t ? [0, T ], Lt ? ?t ? ?Ut, t? [0, T ], T 0 (?u ? Lu) dK+u = T 0 (?Uu ? ?u) dK?u = 0 . (85) Hence, by Proposition 2, the F-semimartingale ?solves the F-Dynkin game with payoff ?. Thus, by Proposition 11, ? := J ?is an arbitrage price for the option, with related pre-default price process ?. Let us set further, for t ? [0, T ] (cf. (17)), ?t = 1{t<?} ?t, ?t ?t = ?t?t + [0,t] ?u dDu (86) where we recall that Dt = [0,t] JuCudu + Ru dIu. We define M by M0 = 0 and, for t ? [0, T ], [0,t] ?udMu = ?t ?t + t 0 ?uJu dKu. (87)
About the Pricing Equations in Finance 99 The following lemma is key in this section. It allows one in particular to interpret (87) as the canonical decomposition of the F - special semimartingale ? ?. In particular M is but the canonical F - local martingale component of [0,-] ??1 t d(?t ?t) (cf. Remark 3). Lemma 3. The processM defined by (87) is an F - local martingale stopped at ?. Proof. One has by (85), for every t ? [0, T ], t 0 ?u dMu = ?t ?t ? ?0 + t 0 ?u dKu + t 0 ?u (Cu + ?uRu)du So by standard computations (cf. Lemma 2), for any 0 ? t ? u ? T, E??1 t u t ?v dMvFt= Jt E??1 t u t ?v dMvFt= 0 . Let ?? = inf u ? [??, T] ; ?u ? Uu? T. (88) For any primary strategy ?, let the F - local martingale ?(?) = ? be given by ?0 = 0 and d?t = dMt ? ?t ??1 t d(?t Pt). (89) Proposition 12 can be seen as an extension of Proposition 3 to the defaultable case, in which two filtrations are involved. Note that our assumptions here are made relatively to the filtrationF , the one with respect to which the BSDE (85) is defined, whereas conclusions are drawn relative to the filtration F. Proposition 12 (see Bielecki et al. [20, 23]). (i) For any hedging strategy ?, (?0, ?, ??), is an hedge with (F, P) - local martingale cost ?; (ii) ?0 is the minimal initial wealth of an hedge with (F, P) - local martingale cost; (iii) In the special case of an European derivative with K= 0, then (?0, ?) is a replicating strategy with (F, P) - local martingale cost ?. ?0 is thus also the minimal initial wealth of a replicating strategy with (F, P) - local martingale cost. Analysis of Hedging Strategies Let Ht = It ?t 0 Ju?udu stand for the compensated jump-to-default F-martingale. Our analysis of hedging strategies will rely on the following lemma, which yields the dynamics of the price process ?of a game option or, more precisely, of the F - local martingale componentM of process [0,-] ??1 t d(?t ?t).
100 S. Crepey Lemma 4. The F - local martingaleM defined in (87) satisfies, for t ? [0, T ? ?]: dMt = dMt + ??t dHt (90) with ??t := Rt ? ?t?. Sketch of Proof. (see Bielecki et al. [23] for the detail). This follows by computations similar to those of the proof of Kusuoka's Theorem 2.3 in [72] (where the (H) hypothesis and a more specific Brownian reference filtrationF = FW are assumed), using in particular the avoidance property recalled at Note 5(i), according to which P(? = ?) = 0 for any F - stopping time ?. In analogy with the structure of the payoffs of a defaultable derivative, we assume henceforth that the dividend vector-process D of the primary market price process P is given as Dt = [0,t] Ju Cudu + Ru dHu for suitable coupon rate and recovery processes C and R. We also assume that P = J P, without loss of generality with respect to the application of hedging a defaultable derivative (in particular any value of the primary market at ? is embedded in the recovery part of the dividend process D for P). We further define, along with the cumulative price P as usual, the pre-default cumulative price, by, for t ? [0, T ]: ? Pt = Pt + ??1 t t 0 ?u gudu where we set g = C + ?R. The following decomposition is the analog, relatively to the primary market, of (90) for the game option. Lemma 5 (see Bielecki et al. [20]). Process ? ? P is anF - local martingale and one has, for t ? [0, T ? ?]: ??1 t d(?t Pt) = ??1 t d(?t ? Pt) + ?Pt dHt (91) with ?Pt := Rt ? Pt?. Plugging (91) and (90) into (89), one gets the following decomposition of the hedging cost ? of the strategy (?0, ?, ??). Proposition 13. Under the previous assumptions, for any primary strategy ?, the related cost ? = ?(?) in Proposition 12 satisfies, for every t ? [0, T ? ?], d?t = dMt ? ?t ??1 t d(?t Pt) = dMt ? ?t ??1 t d(?t ? Pt)+ ??t ? ?t?PtdHt. (92)
About the Pricing Equations in Finance 101 4.2.4 Pre-DefaultMarkovian Set-Up We now assume that the pre-default pricing BSDE (85) is Markovian, in the sense that the pre-default input data ? = r + ?, f = C + ?R, ?, L, U of (85) are given as Borel-measurable functions of an (F , P)-Markov factor process X, so ?t = ?(t,Xt), ft = f(t,Xt), ? = ?(XT ), Lt = L(t,Xt), Ut = U(t,Xt). We assume more specifically that the pre-default factor processX is defined by (28) with respect to F = FW,N, with related generator G, and that ?? is defined by (54). One can then introduce the pre-default pricing PDE cascade formally related to the pre-default pricing BSDE (85), to be solved in the pair (u, ?u) of the pre-default no protection pricing function u and of the pre-default protection pricing function ?u, namely (cf. (51), (55) or (71) above; see also [20]): ?????? ????? u(T, x) = ?(x), x ? Rq min (max (Gu + f ? ?u,L ? u) , U ? u) = 0 on [0, T ) ? Rq ?u = u on [0, T ] ? Rq\ [0, T)?Omax G?u + f ? ?u,L ? ?uon [0, T)?O (93) One then has as before, by application of the results of Parts II and III, Proposition 14. The variational inequality cascade (93) is well-posed in the sense of viscosity solutions under mild conditions, and its solution (u, ?u) is related to the solution ( ?, M, K) of (85) as follows, for t ? [0, T ]: ?t = ?(t,Xt) (94) where ? is to be understood as u for t > ?? and ?u for t ? ??. Moreover, in case the pricing functions u and ?u are sufficiently regular for an Ito formula to be applicable, one has further, for t ? [0, T ], dMt = ???(t,Xt)dWt + ??(t,Xt?)dNt. (95) Accordingly, the first line of (85) takes the following form: ? d?(t,Xt) = (f ? ??)(t,Xt)dt + dKt ????(t,Xt)dBt ? ??(t,Xt?)dNt. (96) Let us assume the same structure (without the barriers) on the primary market price process P, thus Pt = v(t,Xt), where, setting g(t, z) = C(t, z) + ?(t, z)R(t, z), ? dv(t,Xt) = (g ? ?v)(t,Xt)dt??v?(t,Xt)dBt ? ?v(t,Xt?)dNt. (97)
102 S. Crepey Exploiting (96) and (97) in (92), one gets, letting for notational convenience Rt = R(t,Xt?), Rt = R(t,Xt?), Proposition 15. For t ? [0, T ? ?], d?t = (???(t,Xt), ??(t,Xt?),??(t,Xt?)) ??t(?v?(t,Xt), ?v(t,Xt?),?v(t,Xt?))d??Bt Nt Ht??, (98) where we set ??(t, x) = (R ? ?)(t, x),?v(t, x) = (R?v)(t, x). As in Sect. 3.5 (see also Bielecki et al. [19]), this decomposition of the hedging cost ? can then be used for devising practical hedging schemes of a defaultable game option, like super-hedging (? = 0), hedging only the market (spread) risk B, hedging only the default risk H, or min-variance hedging. Note 6. (i) Under more specific assumptions on the structure of the jump component of the model, the cascade of PDEs (93) can assume various forms, like, for instance, being reducible to a cascade of systems of ODEs, cf. Remark 12 and Part III. (ii) Analogous developments regarding defaultable derivatives can also be made relatively to a more general numeraire, cf. Sect. 4.1. 4.3 Intermittent Call Protection We now want to consider callable products with more general, hence potentially more realistic forms of intermittent call protection, namely call protection whenever a certain condition is satisfied, rather than more specifically call protection before a stopping time earlier in this part. This leads us to introduce financial derivatives with an effective call payoff process ?Uof the following form: ?Ut = ?ct?+ ?tUt, (99) for given cadlag event-processes4 ?t,?ct = 1 ? ?t. The interpretation of (99) is that call is possible whenever ?t = 1, otherwise call protection is in force. Note that (16) corresponds to the special case where ?t = 1{t???} in (99). The identification between the arbitrage, or infimal super-hedging, P-price process of a game option with intermittent call protection, and the state-process ? of a solution (?,M,K), assumed to exist, to the BSDE (15) with ?Ugiven by (99) therein, can be established by a straightforward adaptation of the arguments developed in Sect. 2 (See also Remark 29 in Part IV). 4 Boolean-valued processes.
About the Pricing Equations in Finance 103 In the Markovian jump-diffusion model X defined by (28), and assuming ?t = ?(t,Xt,Nt) (100) for a suitably extended finite-dimensionalMarkovian factor process (Xt,Nt) and a related Boolean function ? of (t,X,N), it is expected that one should then have ?t = u(t,Xt,Nt) on [0, T ] for a suitable pricing function u. Under suitable technical conditions (including U being given as a Lipschitz function of (t, x)), this is precisely what comes out from the results of Sect. 16, in case of a call protection discretely monitored at the dates of a finite time grid T = {T0, T1 . . . , Tm}. As standing examples of such discretely monitored call protections, one can mention the following clauses, which are commonly found in convertible bonds contracts on an underlying stock S. Let St be given by X1t , the first component of our factor process Xt. Example 2. Given a constant trigger level ? S and a constant integer ?: (i) Call possible whenever St ? ? S at the last ? monitoring times Tls, Call protection otherwise, Or more generally, given a further integer j ? ?, (ii) Call possible whenever St ? ? S on at least ? of the last j monitoring times Tls, Call protection otherwise. Let S = x1 denote the first component of the mute vector-variable x, and let u(Tl?, x) be a notation for the formal limit, given a function u = u(t, x), lim (t,y)>(Tl,x) with t<Tl u(t, y). (101) One thus has by application of the results of Sect. 16 (cf. in particular (265)-(266)), Proposition 16. In the situation of Example 2(i), the BSDE (15) with ?Ugiven by (99) admits a unique solution (?,M,K), and one has ?t = u(t,Xt,Nt) on [0, T ], for a pricing function u = u(t, x, k) = uk(t, x) with k ? N?, and where Nt represents the number of consecutive monitoring dates Tls with STl ? ? S from time t backwards, capped at ?. The restrictions of the uks to every set [Tl?1 Tl)?[0,+?) are continuous, and uk(Tl?, x) as formally defined by (101) exists for every k ? N?, l ? 1 and x in the hyperplane {S = ? S} of Rq. Moreover u solves the following cascade of variational inequalities: For l decreasing from m to 1, : At t = Tl, for k ? N?, uk(Tl?, x) =  uk+1(Tl, x) , or uk(Tl, x) if k = ?, on{S > ? S} ? Rq?1 u0(Tl, x), or min(u0(Tl, x), U(Tl, x)) if k = ?, on{S < ? S} ?Rq?1, (102) Or, in case l = m, uk(Tl?, x) = ?(x) on Rq,
104 S. Crepey : On the time interval [Tl?1, Tl), max (Guk + C ? ruk , L? uk) = 0, k = 0. . . ? ? 1 min (max (Gu? + C ? ru?, L? u?) , U ? u?) = 0 . In the situation of Example 2(ii), the BSDE (15) with ?Ugiven by (99) admits a unique solution (?,M,K), and one has ?t = u(t,Xt,Nt) on [0, T ], for a suitable pricing function u = u(t, S, k) = uk(t, S) with k ? {0, 1}j, and where Nt represents the vector of the indicator functions of the events STl ? ? S at the last j monitoring dates preceding time t. The restrictions of the uks to every set [Tl?1 Tl) ? [0,+?) are continuous, and the limit uk(Tl?, x) as defined by (101) exists for every k ? {0, 1}j, l ? 1 and x in the hyperplane {S = ? S} of Rq. Moreover u solves the following cascade of variational inequalities, with |k| = 1?j?j kj, k+ = k+(k, x) = (1S?? S, k1, . . . , kj?1) : For l decreasing from m to 1, : At t = Tl, for k ? {0, 1}j, on {S = ? S}, uk(T??, x) =  min(uk+(T?, x), U(T?, x)), if |k| ? ? and |k+| < ? , uk+(T?, x), else (103) Or, in case l = m, uk(Tl?, x) = ?(x) on Rq, : On the time interval [Tl?1, Tl), for k ? {0, 1}j, max (Guk + C ? ruk , L? uk) = 0, |k| < ? min (max (Gu? + C ? ru?, L? u?) , U ? u?) = 0, |k| ? ?. (104) Note 7. (i) Existence of the limits uk(Tl?, x) in (102) or (103) for x in the hyperplane {S = ? S} of Rq follows in view of Remark 34. (ii) Note that the system (103)-(104) is a cascade of 2j equations, which precludes the practical use of deterministic schemes for solving it numerically as soon as j is greater than a few units. Simulation methods on the opposite can be a fruitful alternative (see [31, 39]). Moreover, in case the pricing functions uks are sufficiently regular for an Ito formula to be applicable, one has further, for t ? [0, T ], dMt = ?u(t,Xt,Nt)?(t,Xt)dWt + ?u(t,Xt?,Nt?)dNt.
About the Pricing Equations in Finance 105 Part II Main BSDE Results As opposed to Part I which was mainly focused on the financial interpretation and use of the results, Parts II-IV will be mainly mathematical. In this part (see Sect. 1 for a detailed outline), we construct a rather generic Markovian model (jump-diffusion with regimes) X which gives a precise and rigorous mathematical content to the factor process X underlying a financial derivative in Part I, informally defined by (28) therein. Using the general results of Crepey and Matoussi [38], we then show that related Markovian reflected and doubly reflected BSDEs, covering the ones considered in Part I (see Definition 9, Note 8(v) and Definition 11), are well-posed, in the sense that they have unique solutions, which depend continuously on their input data. This part can thus be seen as a justification of the fact that we were legitimate in assuming well-posedness of the Markovian BSDEs that arose from the derivatives pricing problems considered in Part I. 5 General Set-Up We first recall the general set-up of [38]. Let us thus be given a finite time horizon T > 0, a probability space (?,F, P) and a filtration F = (Ft)t?[0,T ] with FT = F. By default henceforth one considers the right-continuous and completed versions of all filtrations, a random variable has to be F-measurable, and a process is defined on the time interval [0, T ] and F-adapted. All semimartingales are assumed to be cadlag, without restriction. Let B = (Bt)t?[0,T ] be a d-dimensional Brownian motion. Given an auxiliary measured "mark space" (E, BE, ?), where ? is a non-negative ?-finite measure on (E, BE), let ? = (?(dt, de))t?[0,T ],e?E be an integer valued random measure on [0, T ]?E, B([0, T ])?BE(see Jacod and Shiryaev [62, Definition II.1.13, p. 68]). Denoting by P the predictable sigma-field on ? ? [0, T ], we assume that the compensator of ? is defined by dt???(de) := ?t(?, e)?(de)dt, for aP?BE-measurable non-negative bounded random intensity function ?. We refer the reader to the literature [13, 62] regarding the definition of the integral process of P ?BE-measurable integrands with respect to random measures such as ?(dt, de) or its compensated form ?(dt, de) = ?(dt, de)??t(?, e)?(de)dt. By default, all (in)equalities between random quantities are to be understood dP - almost surely, dP ? dt - almost everywhere or dP?dt???(de) - almost everywhere, as suitable in the situation at hand. For simplicity we omit all dependences in ? of any process or random function in the notation. We denote by: : |X|, the (d-dimensional) Euclidean norm of a vector or row vector X in Rd or R1?d;
106 S. Crepey : |M|, the supremum of |MX| over the unit ball of Rd, forM in Rd?d; : M? = M(E, BE, ?;R), the set of measurable functions from (E, BE, ?) to R endowed with the topology of convergence in measure, and for v ? M? and t ? [0, T ]: |v|t = [E v(e)2?t(e)?(de)] 12 ? R+ ? {+?}; (105) : B(O), the Borel sigma-field on O, for any topological space O. Let us now introduce some Banach (or Hilbert, in case of L2, H2dor H2?) spaces of random variables or processes, where p denotes here and henceforth a real number in [2,?): : Lp, the space of real valued (FT -measurable) random variables ? such that ?Lp := E?p1p < +?; : Spd (or Sp, in case d = 1), the space of Rd-valued cadlag processes X such that XSpd := Esup t?[0,T ] |Xt|p1p < +?; : Hpd (or Hp, in case d = 1), the space of R1?d-valued predictable processes Z such that ZHpd := ET 0 |Zt|2 dtp21p < +?; :Hp?, the space ofP?BE-measurable functions V : ??[0, T ]?E > R such that V Hp? := ET 0 E |Vt(e)|p?t(e)?(de)dt1p < +?, so in particular (cf. (105))V H2? = ET 0 |Vt|2tdt12 ; : A2, the space of finite variation continuous processes K with continuous Jordan components K ? S2, where by the Jordan decomposition of K ? A2, we mean the unique decomposition K = K+ ? K? of K as the difference of two nondecreasing processes K null at 0 and defining mutually singular random measures on [0, T ]; : A2i, the space of non-decreasing processes in A2. Remark 15. By a slight abuse of notation we shall also write XHp for ET 0 X2t dtp21p in the case of merely progressively measurable (not necessarily predictable) real-valued processes X.
About the Pricing Equations in Finance 107 For the reader's convenience we recall the following well known facts which will be used implicitly throughout (Regarding (ii) see e.g., Bouchard and Elie [26]). Proposition 17. (i) The processes - 0 ZtdBt and - 0 E Vt(e)?(dt, de) are martingales, for any Z ? Hpd and V ? Hp?; (ii) Assuming that the jump measure ? is finite, then there exist positive constants cp and Cp depending only on p, ?(E), T and a bound on ?, such that: cpV Hp? ? - 0 E Vt(e)?(dt, de)Spd ? CpV Hp? (106) for any V ? Hp?. 5.1 General Reflected and Doubly Reflected BSDEs Let us now be given a terminal condition ?, and a driver coefficient g : ? ?[0, T ]? R ? R1?d?M? > R, such that: (H.0) ? ? L2; (H.1.i) g-(y, z, v) is a progressively measurable process, and g-(y, z, v)H2 < ?, for any y ? R, z ? R1?d, v ?M?; (H.1.ii) g is uniformly ? - Lipschitz continuous with respect to (y, z, v), in the sense that ? is a constant such that for every t ? [0, T ], y, y? R, z,z ? R1?d, v,v ?M?, one has: |gt(y, z, v) ? gt(y, z, v)| ? ?(|y ? y| + |z ? z| + |v ? v|t). Remark 16. Given the Lipschitz continuity property (H.1.ii) of g, the requirement that g-(y, z, v)H2 < ? for any y ? R, z ? R1?d, v ?M? in (H.1.i) reduces of course to g-(0, 0, 0)H2 < ?. We also introduce the barriers (or obstacles) L and U such that: (H.2.i) L and U are cadlag processes in S2; (H.2.ii) Lt ? Ut, t ? [0, T ) and LT ? ? ? UT , P-a.s. Definition 8. (a) An (?, F, P), (B, ?)-solution Y to the doubly reflected backward stochastic differential equation (R2BSDE, for short) with data (g, ?,L,U) is a quadruple Y = (Y,Z, V,K), such that:
108 S. Crepey (i) Y ? S2, Z ? H2d, V ? H2?,K ? A2, (ii) Yt = ? + T t gs(Ys, Zs, Vs)ds + KT ? Kt ? T t ZsdBs ? T t E Vs(e)?(ds, de) for any t ? [0, T ], P-a.s. (iii) Lt ? Yt ? Ut for any t ? [0, T ], P-a.s., and T 0 (Yt ? Lt)dK+t = T 0 (Ut ? Yt)dK?t = 0, P-a.s. (b) An (?, F, P), (B, ?)-solution Y to the reflected BSDE (RBSDE, for short) with data (g, ?,L) is a quadruple Y = (Y,Z, V,K) such that: (i) Y ? S2, Z ? H2d, V ? H2?,K ? A2i (ii) Yt = ? + T t gs(Ys, Zs, Vs)ds + KT ? Kt ? T t ZsdBs ? T t E Vs(e)?(ds, de) for any t ? [0, T ], P-a.s. (iii) Lt ? Yt for any t ? [0, T ], P-a.s., and T 0 (Yt ? Lt)dKt = 0, P-a.s. (c) When there is no barrier, we define likewise solutions to the BSDE with data (g, ?). 5.1.1 Extensions with Stopping Times Motivated by applications (cf. Part I), we now consider two variants of the above problems involving a further [0, T ]-valued stopping time ?. Note that (1-?? g, ?,L-??, , U-?? ) satisfies (H.0), (H.1) and (H.2), like (g, ?,L,U). One can thus state the following Definition 9. Assuming that ? is F? -measurable, (i) A solution to the stopped R2BSDE with data (g, ?,L,U, ?) is a quadruple (Y,Z, V,K) which solves the R2BSDE with data (1-?? g, ?,L-??, U-?? ), and such that Y = Y?, K = K? and Z = V = 0 on [?, T]. A solution to the stopped RBSDE with data (g, ?,L, ?) is a quadruple (Y,Z, V,K) which solves the RBSDE with data (1-?? g, ?,L-?? ), and such that Y = Y?, K = K? and Z = V = 0 on [?, T]. (ii) The RDBSDE with data (g, ?,L,U, ?) (where "D" stands for "delayed") is the generalization of an R2BSDE in which the upper barrier U is inactive before ?. Formally, we replace U by?Ut := 1{t<?}?+ 1{t??}Ut (107) in Definition 8(a)(iii), with the convention that 0??= 0.
About the Pricing Equations in Finance 109 Note 8. (i) All these definitions admit obvious extensions to problems in which the driving term contains a further finite variation process A (not necessarily absolutely continuous). (ii) In [38], reflected BSDEs stopped at a random time were introduced and presented as reflected BSDEs with random terminal time (only defined over the time interval [0, ?]) as of Darling and Pardoux [41]. Such (possibly doubly) reflected BSDEs stopped at a random time and the above stopped R(2)BSDEs are in fact equivalent notions. We refer the reader to [38] for preliminary general results on stopped RBSDEs and on RDBSDEs. (iii) In the special case where ? = 0, resp. ? = T, then the RDBSDE with data (g, ?,L,U, ?) reduces to the R2BSDE with data (g, ?,L,U), resp. to the RBSDE with data (g, ?,L). (iv) If (Y,Z, V,K) is a solution to the RDBSDE with data (g, ?,L,U, ?), then the process (Y-?? , 1-?? Z, 1-??V,K-?? ) is a solution to the stopped RBSDE with data (g, Y-??, L, ?). (v) It will come out from the results of this part (Theorem 2; see also [38]) that the solution of an RDBSDE is essentially given as the solution of a stopped RBSDE before ?, appropriately pasted at ? with the solution of an R2BSDE after ?. So the results of this part effectively reduce the study of RDBSDEs to those of RBSDEs and R2BSDEs. In Part III of this paper we shall not deal explicitly with RDBSDEs. Yet, given the results of this part, the results of Part III are applicable to RDBSDEs, giving a way to compute their solutions in two pieces, before and after ? (cf. the related cascades of two PDEs in Part I). (vi) In Sect. 16 in Part IV we shall consider doubly reflected BSDEs with an intermittent upper barrier, or RIBSDEs, generalizing RDBSDEs to an effective upper barrier ?Uof the form (to be compared with (107)) ?Ut = ?ct?+ ?tUt, (108) for a larger class of cadlag event-processes5 ?t, ?ct = 1? ?t. 5.1.2 Verification Principle Originally, R2BSDEs have been developed in connectionwith Dynkin games, or optimal stopping game problems (see, e.g., Lepeltier and Maingueneau [75], Cvitani?c and Karatzas [40]). Given a [0, T ]-valued stopping time ?, let T? (or simply T , in case ? = 0) denote the set of [?, T]-valued stopping times. We thus have the 5 Boolean-valued processes.
110 S. Crepey following Verification Principle, which was used in the proof of Proposition 2 in Part I. We state it for an RDBSDE as of Definition 9(ii), which in view of Note 8(iii), covers RBSDEs and R2BSDEs as special cases. Note that in the case of RBSDEs (special case where ? = T ) the related Dynkin game reduces to an optimal stopping problem. Proposition 18. If Y = (Y,Z, V,K) solves the RDBSDE with data (g, ?,L,U, ?), then the state process Y is the conditional value process of the Dynkin game with payoff functional given by, for any t ? [0, T ] and (?, ?) ? T? ? Tt: Jt(?, ?) = ??? t gs(Ys, Zs, Vs)ds + L?1{???=?<T} + U?1{?<?} + ?1[???=T]. More precisely, a saddle-point of the game at time t is given by: ?t = infs ? [t ? ?, T] ; Ys = Us? T , ?t= infs ? [t, T ] ; Ys = Ls? T. So, for any t ? [0, T ]: E!Jt(?t, ?)Ft" ? Yt = E!Jt(?t, ?t)Ft" ? E!Jt(?, ?t)Ft" for any (?, ?) ? T? ? Tt. (109) Proof. Except for the presence of ?, the result is standard (see, e.g., Lepeltier and Maingueneau [75]; or see also Bielecki et al. [23] for a proof of an analogous result in a context of mathematical finance). We nevertheless give a self-contained proof for the reader's convenience. The result of course reduces to showing (109). Let us first check that the right-hand side inequality in (109) is valid for any ? ? T?. Let ? denote ?t ? ?. By definition of ?t, we see that K+ equals 0 on [t, ?]. Since K? is non-decreasing, taking conditional expectations in the RDBSDE, and using also the facts that Y?t ? L?t if ?t < T, Y? ? U? if ? < T (recall that ? ? T?, so that ? ? ? and ?U? = U?), and YT = ?, we obtain: Yt ? E? t gs(Ys, Zs, Vs)ds + Y? | Ft? E? t gs(Ys, Zs, Vs)ds + 1{?=?t<T}L?t + 1{?<?t}U? + 1{?=T}?Ft. We conclude that Yt ? EJt(?t, ?)Ftfor any ? ? T? . This completes the proof of the right-hand side inequality in (109). The left-hand side inequality, which is in fact standard since it does not involve ?, can be shown similarly. 
About the Pricing Equations in Finance 111 Remark 17. For general well-posedness (in the sense of existence, uniqueness and a priori estimates) and comparison results on the different variants of reflected BSDEs (RBSDEs, R2BSDEs and RDBSDEs) above, we refer the reader to Crepey and Matoussi [38].We do not reproduce explicitly these results here, since we will state in Sect. 16.2 extensions of these results to more general RIBSDEs (see Note 8(vi)). 5.2 General Forward SDE To conclude this section we consider the (forward) stochastic differential equation d Xs =bs( Xs)ds + ?s(Xs) dBs + E ?s( Xs, e) ?s(e)?(ds, de) , (110) where bs(x), ?s(x) and ?s(x, e) are d-dimensional drift vector, dispersion matrix and jump size vector random coefficients such that: : bs(x), ?s(x) and ?s(x, e) are Lipschitz continuous in x uniformly in s ? 0 and e ? E; : bs(0), ?s(0) and ?s(0, e) are bounded in s ? 0 and e ? E. The following proposition can be shown by standard applications of Burkholder's inequality used in conjunction with (106) and Gronwall's lemma (see for instance Fujiwara-Kunita [54, Lemma 2.1, p. 84] for analogous results with proofs). Proposition 19. Assuming that the jump measure ? is finite, then for any strong solution Xto the stochastic differential equation (110) with initial condition X0 ? F0 ?Lp, the following bound and error estimates are available: XpSpd ? CpE[| X0|p + T 0 |bs(0)|pds + T 0 |?s(0)|pds +T 0 E |?s(0, e)|p?s(e)?(de)ds] (111) X? XpSpd ? CpE[| X0 ? X0|p + T 0 |bs( Xs) ?bs( Xs)|pds +T 0 |?s( Xs) ? ?s(Xs)|pds + T 0 E |?s(Xs, e) ??s(Xs, e)|p?s(e)?(de)ds] (112) where, in (112), Xis the solution of a stochastic differential equation of the form (110) with coefficientsb, ?, ?and initial condition X0 ? F0 ?Lp. 
112 S. Crepey 6 A Markovian Decoupled Forward Backward SDE We now present a versatile Markovian specification of the general set-up of the previous section. This model was already considered and used in applications in [16, 20, 38], but the construction of the model has been deferred to the present work. 6.1 Infinitesimal Generator Given integers d and k, we define the following linear operator G acting on regular functions u = ui(t, x) for (t, x, i) ? E = [0, T ] ? Rd ? I with I = {1, . . . , k}, and where ?u (resp. Hu) denotes the row-gradient (resp. Hessian) of u(t, x, i) = ui(t, x) with respect to x: Gui(t, x) = ?tui(t, x) + 12Tr[ai(t, x)Hui(t, x)] + ?ui(t, x)bi(t, x) +Rd ui(t, x + ?i(t, x, y)) ? ui(t, x)fi(t, x, y)m(dy) +j?I ni,j(t, x) uj(t, x) ? ui(t, x)(113) with bi(t, x) = bi(t, x) ? Rd ?i(t, x, y)fi(t, x, y)m(dy). (114) Assumption 2 In (113) and (114), m(dy) is a finite jump measure without atom at the origin 0d of Rd, and all the coefficients are Borel-measurable functions such that: : The ai(t, x) are d-dimensional covariance matrices, with ai(t, x) = ?i(t, x) ?i(t, x)T, for some d-dimensional dispersion matrices ?i(t, x); : The bi(t, x) are d-dimensional drift vector coefficients; : The jump intensity functions fi(t, x, y) are bounded, and the jump size functions ?i(t, x, y) are bounded with respect to y at fixed (t, x), locally uniformly in (t, x)6; : The ni,j(t, x)i,j?I are regime switching intensities such that the functions ni,j(t, x) are non-negative and bounded for i = j, and ni,i(t, x) = 0. Remark 18. We shall often find convenient to denote v(t, x, i, . . .) rather than vi(t, x, . . .) for a function v of (t, x, i, . . .), and nj(t, x, i) rather than ni,j(t, x). For instance, with Xt = (Xt,Nt) below, the notations f(t,Xt, y) and nj(t,Xt) 6 In the sense that the bound with respect to y may be chosen uniformly as (t, x) varies in a compact set.
About the Pricing Equations in Finance 113 will typically be used rather than fNt(t,Xt, y) and nNt,j(t,Xt). Also note that a function u on [0, T ] ? Rd ? I is equivalently referred to in this paper as a system u = (ui)i?I of functions ui = ui(t, x) on [0, T ] ? Rd. 6.2 Model Dynamics Definition 10. A model with generator G and initial condition (t, x, i) is a triple (?, Ft, Pt), (Bt, ?t, ?t), Xt = (Xt,Nt) , where the superscript t stands in reference to an initial condition (t, x, i) ? E, such that (?, Ft, Pt) is a stochastic basis on [t, T ], relatively to which the following processes and random measures are defined: (i) A d-dimensional standard Brownian motion Bt starting at t, and integer-valued random measures ?t on [t, T ]?Rd and ?t on [t, T ]? I, such that ?t and ?t cannot jump together at stopping times; (ii) An Rd ? I-valued process Xt = (Xt,Nt) on [t, T ] with initial condition (x, i) at t and such that for s ? [t, T ]: #dNt s = j?I (j ? Nt s?) d?ts(j) dXts = b(s,Xt s )ds + ?(s,Xt s ) dBts+ Rd ?(s,Xt s?, , y) ?t(ds, dy) , (115) and the Pt-compensatrices ?t and ?t of ?t and ?t are such that #d?ts(j) = d?ts(j) ? nj(s,Xt s ) ds ?t(ds, dy) = ?t(ds, dy) ? f(s,Xt s, y)m(dy)ds (116) with nj(s,Xt s) = nNts,j(s,Xts), f(s,Xt s, y) = fNts (s,Xts, y). Thus in particular ?ts(j) counts the number of transitions ofNt to state j between times t and s, and ?t((0, s]?A) counts the number of jumps ofXt with mark y ? A between times t and s, for every s ? [t, T ] and A ? B(Rd). By an application of Jacod [61, Theorem 3.89, p. 109], the following variant of the Ito formula then holds (cf. formula (35) in Part I). Proposition 20. Given a model (?, Ft, Pt), (Bt, ?t, ?t), Xt = (Xt,Nt) with generator G, one has for any system u = (ui)i?I of functions ui = ui(t, x) of class C1,2 on [0, T ] ? Rd, for s ? [t, T ], du(s,Xt s) = Gu(s,Xt s )ds + (?u?)(s,Xt s )dBts +y?Rd u(s,Xts? + ?(s,Xt s?, y),Nt s?) ? u(s,Xt s?)?t(ds, dy) +j?I (uj(s,Xts?) ? u(s,Xt s?))d?ts(j). (117)
114 S. Crepey In particular (?, Ft, Pt,Xt) is a solution to the time-dependent local martingale problem with generator G and initial condition (t, x, i) (see Ethier and Kurtz [48, Sects. 7.A and 7.B]). Note 9. (i) Of course, once the related semi-group and Markov properties will be established (see in particular Proposition 26, 28 and 29 as well as Theorems 3 and 4), in applications one can restrict attention to a "single" process X, corresponding in practice to the "true" initial condition (t, x, i) of interest (cf. for instance the last section of [38] in which some of the results of this part were announced without proof). In the context of pricing problems in finance this "true initial condition of interest" corresponds to the current values of the underlyings and to the values of the model parameters calibrated to the current market data, see Part I. Yet at the stage of deriving these results in the present paper, it is necessary to consider families of processes Xt parameterized by their initial condition (t, x, i) ? E. We shall thus in effect be considering Markov families indexed by (t, x, i) ? E. (ii) If we suppose that the coefficients b, ?, ? and f do not depend on i, then X is a "standard" jump-diffusion. Alternatively, if n does not depend on x, then N is an inhomogeneous continuous-time Markov chain with finite state space I. In general the above model defines a rather generic class of Markovian factor processes X =(X,N), in the form of an N-modulated jump-diffusion component X and of an X-modulated I-valued component N. The pure jump process N may be interpreted as defining the so-called regime of the coefficients b, ?, ? and f, whence the name of jump-diffusion with regimes for this model. For simplicity we do not consider the "infinite activity" case of an infinite jump measure m. Note however that our approach could be extended to Levy jump measures without major changes if wished (see in this respect Sect. 3.3.2 in Part I). Yet this would be at the cost of a significantly heavier formalism, regarding in particular the viscosity solutions approach of Part III (see the seminal paper by Barles et al. [9], complemented by Barles and Imbert [6]). (iii) The general construction of such a model with mutual dependence between N and X, is a non-trivial issue. It will be treated in detail in Sect. 7, resorting to a suitable Markovian change of probability measure. It should be noted that more specific sub-cases or related models were frequently considered in the literature. So (see also Sect. 6.6 for more comments about financial applications of this model): : Barles et al. [9] consider jumps in X without regimes N, for a Levy jump measure m (cf. point (i) above); : Pardoux et al. [79] consider a diffusion model with regimes, which corresponds to the special case of our model in which f is equal to 0, and the regimes are driven by a Poisson process (instead of a Markov chain in our case, cf. Sect. 7.1); : Becherer and Schweizer consider in [10] a diffusion model with regimes which corresponds to the special case of our model in which f is equal to 0.
About the Pricing Equations in Finance 115 6.3 Mapping with the General Set-Up The model Xt = (Xt,Nt) is thus a rather generic Markovian specification of the general set-up of Sect. 5, with (note that the initial time is t here instead of 0 therein; superscripts t are therefore added below to the notation of Sect. 5 where need be): : E (the "mark space"), the subset Rd ? {0}? {0d} ? Iof Rd+1; : BE, the sigma-field generated by B(Rd) ? {0} and {0d} ? BI on E, where B(Rd) and BI stand for the Borel sigma-field on Rd and the sigma-field of all parts of I, respectively; : ?(de) and ?ts(e) respectively given by, for any s ? [t, T ] and e = (y, j) ? E: ?(de) =  m(dy) if j = 0 1 if y = 0d , ?ts(e) =  f(t,Xt s, y) if j = 0 nj(t,Xt s ) if y = 0d; : ?t, the integer-valued random measure on [t, T ] ? E, B([t, T ])?BEcounting the jumps of X with mark y ? A and the jumps of N to state j between t and s, for any s ? t, A ? B(Rd) and j ? I. We denote for short: (E, BE, ?) = (Rd ? I, B(Rd)?BI,m(dy) ? 1), and ?t = ?t ? ?t on [t, T ] ? E, B([t, T ]) ? BE. So the compensator of the random measure ?t is given by, for any s ? t,A ? B(Rd), j ? I, with A ? {j} := A ? {0}? {0d} ? {j}: s t A?{j} ?tr(e)?(de)dr = s t A f(r,Xt r, y)m(dy)dr + s t nj(r,Xt r ) dr . Note that H2?t can be identified with the product space H2?t ? H2?t , and that M? = M(E, BE, ?;R) can be identified with the product space M(Rd, B(Rd), m(dy);R)?Rk. These identifications will be used freely in the sequel. Let v denote a generic pair (v,w)?M? ?M(Rd, B(Rd),m(dy);R)?Rk. We denote accordingly, for s ? t (cf. (105)): |v|2s= Rd v(y)2f(s,Xt s, y)m(dy) + j?I w(j)2nj(s,Xt s ) (118) (with the slight abuse of notation that |v|s implicitly depends on t, x, i in (118)). 6.4 Cost Functionals We denote by Pq the class of functions u on E such that ui is Borel-measurable with polynomial growth of exponent q ? 0 in x, for any i ? I. Here by polynomial
116 S. Crepey growth of exponent q in x we mean the existence of a constant C, which may depend on u, such that for any (t, x, i) ? E: ui(t, x)? C(1 + |x|q). Let also P = ?Pq denote the class of functions u on E such that ui is Borelmeasurable with polynomial growth in x for any i ? I. Let us further be given a system C of real-valued continuous cost functions, namely a running cost function gi(t, x, u, z, r) (where (u, z, r) ? Rk ?R1?d ?R), a terminal cost function ?i(x), and lower and upper cost functions i(t, x) and hi(t, x), such that: (M.0) ? lies in Pq ; (M.1.i) The mapping (t, x, i) > gi(t, x, u, z, r) lies in Pq , for any (u, z, r) ? Rk ? R1?d ? R; (M.1.ii) g is uniformly ? - Lipschitz continuous with respect to (u, z, r), in the sense that ? is a constant such that for every (t, x, i) ? E and (u, z, r), (u, z, r) ? Rk ? R1?d ? R: gi(t, x, u, z, r) ? gi(t, x, u, z, r)? ?|u ? u| + |z ? z| + |r ? r| ; (M.1.iii) g is non-decreasing with respect to r; (M.2.i) and h lie in Pq; (M.2.ii) ? h, (T, -) ? ? ? h(T, -). Fixing an initial condition (t, x, i) ? E for X = (X,N), we define for any (s, y, z,v) ? [t, T ] ? R ? R1?d ? M?, with v = (v,w) ? M? ? M(Rd, B(Rd),m(dy);R) ? Rk: g(s,Xt s, y, z, v) = g(s,Xt s , uts, z, rts) ?j?I wjnj(s,Xt s ) (119) (see Remark 18 regarding our notational conventions such as "gi(t, x, . . .) ? g(t, x, i, . . .)"), where rts= rts(v) and uts = uts(y,w) are defined by rts= Rd v(y)f(s,Xt s, y)m(dy) , (uts)j =   y, j = Nt s y + wj, j = Nt s . (120) Note 10. (i) The driver coefficient g = g(s,Xt s, y, z,v) only depends on the functions v, w in v = (v,w) through their integral (or summation, in case of the "discrete function" w) with respect to the jump and regime switching intensities f(s,Xt s, y)m(dy) and nj(s,Xt s ). Indeed it is only under this structural assumption on the driver coefficient that one is able to derive a comparison theorem for a BSDE with jumps (see [38] or Sect. 16.2.3).As will be apparent in the proof of Theorem 11 in Part III, such a comparison theorem is key in establishing the connection between a BSDE and the related PDE problem.
About the Pricing Equations in Finance 117 (ii) The motivation to define g as g minus a regime switching related term in (119), is to get a related PDE of the simplest possible formin Part III (variational inequality problems (V2) and (V1) involving the operator G defined by (188) rather than the "full generator" G of X). (iii) In the financial interpretation, one can think of the mute variables y and w in (119)-(120) as representing the price and the regime switching deltas (cf. (123), (124) or (126), (127) in Definition 11 below). Consequently uts in (120) can be interpreted as the vector of the prices corresponding to the different possible regimes of the Markov chain component Nt s, given the current time s and Xts. As for the mute variable z, it represents as usual the delta with respect to the continuous-space variable x. Given the previous ingredients and an Ft - stopping time ?t, where the parameter t stands in reference to an initial condition (t, x, i) ? E for X, we now define the main decoupled forward backward stochastic differential equation (FBSDE, for short) in this work, encapsulating all the SDEs and BSDEs of interest for us in this article. Recall that g is defined by (119) and that v denotes a generic pair (v,w)?M?. Definition 11. (a) A solution to the Markovian decoupled forward backward stochastic differential equation with data G, C and ? is a parameterized family of triples Zt = (?, Ft, Pt), (Bt, ?t, ?t), (Xt, Yt, ? Yt), where the superscript t stands in reference to the initial condition (t, x, i) ? E, such that: (i) (?, Ft, Pt), (Bt, ?t, ?t), Xt = (Xt,Nt) is a model with generator G and initial condition (t, x, i); (ii) Yt = (Y t, Zt, Vt,Kt), with Vt = (V t,Wt) ? H2?t = H2?t ? H2?t , is an (?, Ft, Pt), (Bt, ?t) - solution to the R2BSDE on [t, T ] with data g(s,Xt s, y, z, v) , ?(XtT) , (s,Xt s ), h(s,Xt s ); (121) (iii) ? Yt = (? Y t, ? Zt, ?Vt, ?Kt), with ?Vt = (? V t, ?Wt) ? H2?t = H2?t ? H2?t , is an (?, Ft, Pt), (Bt, ?t) - solution to the stopped RBSDE on [t, T ] with data g(s,Xt s, y, z,v), Yt ?t, (s,Xt s ), ?t (122) where Y t is the state-process of Yt in (ii). (b) The solution is said to be Markovian, if: (i) Y t t =: ui(t, x) defines as (t, x, i) varies in E, a continuous value function of class P on E, and one has for every t ? [0, T ], Pt-a.s.: Y t s = u(s,Xt s ) , s ? [t, T ] (123) For any j ? I : Wt s (j) = uj(s,Xts?) ? u(s,Xt s?) , s ? [t, T ] (124)
118 S. Crepey s t g(?,Xt ? , Y t ? , Zt? , Vt?)d? = s t g(?,Xt ?, u(?,Xt?), Zt? , rt?) ?j?I nj(?,Xt ? )uj(?,Xt?) ? u(?,Xt ? )?d? , s ? [t, T ] (125) with in (125): u(?,Xt?) := (uj(?,Xt?))j?I , rt?= Rd V?(y)f(?,Xt ? , y)m(dy) (cf. (120)); (ii) ? Y t t =: vi(t, x) defines as (t, x, i) varies in E, a continuous value function of class P on E, and one has for every t ? [0, T ], Pt-a.s.: ? Y t s = v(s,Xt s ) , s ? [t, ?t] (126) For any j ? I : ?Wt s (j) = vj(s,Xts?) ? v(s,Xt s?) , s ? [t, ?t] (127) s t g(?,Xt ? , ?Y t ? , ? Zt? , ?Vt?)d? = s t g(?,Xt ? , v(?,Xt?), ? Zt? , ?rt?) ?j?I nj(?,Xt ? )vj(?,Xt??) ? v(?,Xt ??)?d? , s ? [t, ?t] (128) with in (128): v(?,Xt?) := (vj (?,Xt? ))j?I , ?rt?:= rt?( ? V t ?) = Rd ? V t ? (y)f(?,Xt ? , y)m(dy) (129) (cf. (120)). Remark 19. The terminology Markovian solution in part (b) of these definitions stands in reference to the fact that, as we will see in Part III, the Markovian consistency conditions (123)-(125) or (126)-(128) are the keys in establishing the bridge between the BSDE perspective and a PDE perspective, as well as in making the connection with applications (see, e.g., (131)). 6.5 Markovian Verification Principle The following proposition is a Markovian counterpart to the general verification principle of Proposition 18 in Sect. 5.1.2.
About the Pricing Equations in Finance 119 Proposition 21. If Zt = (?, Ft, Pt), (Bt, ?t, ?t), (Xt, Yt, ? Yt), is a Markovian solution to theMarkovian decoupled forward backward stochastic differential equation with data G, C, ?, with related value functions u and v, then: (i) A saddle-point (?t, ?t) of the Dynkin game related to Yt is given by: ?t = inf{s ? [t, T ] ; (s,Xt s ) ? E?} ? T , ?t= inf{s ? [t, T ] ; (s,Xt s ) ? E+} ? T, with E? = {(t, x, i) ? [0, T ] ? Rd ? I ; ui(t, x) = hi(t, x)} E+ = {(t, x, i) ? [0, T ] ? Rd ? I ; ui(t, x) = i(t, x)}; (ii) An optimal stopping time ?t of the optimal stopping problem related to ? Yt is given by: ?t = inf{s ? [t, ?t] ; (s,Xt s ) ? E+} ? T, (130) with E+ = {(t, x, i) ? [0, T ] ? Rd ? I ; vi(t, x) = i(t, x)}. Proof. (i) This follows immediately from identity (123) and from the definition of the barriers in (121), given the general verification principle of Proposition 18. (ii) By (126) and the fact that ? Yt is stopped at ?t, it comes, ? Y t s = v(s ? ?t,Xt s??t ) , s ? [t, T ]. Using also the definition of the barrier in (122), ?t defined by (130) is hence an optimal stopping time of the related optimal stopping problem, by application of the general verification principle of Proposition 18 (special case ? = T therein). 6.6 Financial Application Jump-diffusions, respectively continuous-time Markov chains, are the major ingredients of most dynamic financial pricing models in the field of equity and interestrates derivatives, respectively credit portfolio derivatives. The above jump-diffusion with regimes X = (X,N) can thus be fit to virtually any situation one may think of in the context of pricing and hedging financial derivatives (see Sect. 3.3.3 in Part I, where this model is represented, denoted by X, in the formalism of the abstract jump-diffusion (28)).
120 S. Crepey Let us give a few comments about more specific applications illustrating the fact that the generality of the set-up of model X is indeed required in order to cover the variety of situations encountered in financial modeling. So: : In Bielecki et al. [20], this model is presented as a flexible risk-neutral pricing model in finance, for equity and equity-to-credit (defaultable, cf. Sect. 4.2 in Part I) derivatives. In this case the main component of the model, that is, the one in which the payoffs of the product under consideration are expressed, is X, while N represents implied pricing regimes which may be viewed as a simple form of stochastic volatility.More standard, diffusive, forms of stochastic volatility, may be accounted for in the diffusive component of X, whereas the jumps in X are motivated by the empirical evidence of the short-term volatility smile on financial derivatives markets. In the context of single-name credit derivatives, N may also represent the credit rating of the reference obligor. So, in the area of structural arbitrage, credit-to- equity models and/or equity-to-credit interactions are studied. For example, if one of the factors is the price process of the equity issued by a credit name, and if credit migration intensities depend on this factor, then one has an equity-to-credit type interaction. On the other hand, if the credit rating of the obligor impacts the equity dynamics, then we deal with a credit-to-equity type interaction. The model X can nest both types of interactions. : In Bielecki et al. [16], this model is used in the context of portfolio credit risk for the valuation and hedging of basket credit derivatives. The main component in the model is then the "Markov chain - like" component N, representing a vector of (implied) credit ratings of the reference obligors, which is modulated by the "jump-diffusion - like" component X, representing the evolution of economic variables which impact the likelihood of credit rating migrations. Frailty and default contagion are accounted for in the model by the coupled interaction between N and X. Now, in the case of risk-neutral pricing problems in finance (see Part I), the driver coefficient function g is typically given as ci(t, x) ? ?i(t, x)y, for dividend and interest-rate related functions c and ? (or dividends and interest-rates adjusted for credit spread in a more general context of defaultable contingent claims, cf. Sect. 4.2). Observe that in order for a Markovian solution Zt to the Markovian FBSDE of Definition 11 to satisfy s t g(?,Xt ?, Y t ? , Zt? , Vt?)d? = s t c(?,Xt ? ) ? ?(?,Xt ? )Y t ? d? , s ? [t, T ] s t g(?,Xt ? , ? Y t ? , ? Zt? , ?Vt?)d? = s t c(?,Xt ? ) ? ?(?,Xt ? ) ? Y t ? d? , s ? [t, ?t] for given functions c and ? on E, it suffices in view of identities (123)-(125) to set gi(t, x, u, z, r) = ci(t, x) ? ?i(t, x)ui +j?I ni,j(t, x)(uj ? ui). (131)
About the Pricing Equations in Finance 121 Note that g in (131) does not depend on z nor r, so gi(t, x, u, z, r) = gi(t, x, u) here. However, modeling the pricing problem under the historical probability (as opposed to the risk-neutral probability in Part I) would lead to a (z, r)-dependent driver coefficient function g. Also, we tacitly assumed in Part I a perfect, frictionless financial market. Accounting for market imperfections would lead to a nonlinear coefficient g. Moreover, in the financial interpretation (see Part I): : ?(XtT) corresponds to a terminal payoff that is paid by the issuer to the holder at time T if the contract was not exercised before T ; : (Xt s ), resp. h(Xt s ), corresponds to a lower, resp. upper payoff that is paid by the issuer to the holder of the claim in the event of early termination of the contract at the initiative of the holder, resp. issuer; : The stopping time ?t (corresponding to ?? in Part 4.2) is interpreted as the time of lifting of a call protection. This call protection prevents the issuer of the claim from calling it back before time ?t. For instance, one has ?t = T in the case of American contingent claims, which may only be exercised at the convenience of the holder of the claim. The contingent claims under consideration are thus general game contingent claims, covering American claims and European claims as special cases; : X (alias X in Part I) corresponds to a vector of observable factors (cf. Sect. 3.1). Recall finally from Sect. 4.2 that in a context of vulnerable claims (or defaultable derivatives), it is enough, to account for credit-risk, to work with suitably recoveryadjusted dividend-yields c and credit-spread adjusted interest-rates ? in (131). Remark 20. In Sect. 16 in Part IV (see also Sect. 4.3 in Part I), we consider products with more general forms of intermittent call protection, namely call protection whenever a certain condition is satisfied, rather than more specifically call protection before a stopping time. 7 Study of the Markovian Forward SDE Sections 7-9, which culminate in Proposition 30 below, are devoted to finding explicit and general enough, even if admittedly technical and involved, conditions on the data G, C and ?, under which existence of a Markovian solution Zt = (?, Ft, Pt), (Bt, ?t, ?t), (Xt, Yt, ? Yt) to the related Markovian FBSDE can be established. Our approach for constructing a Markovian model X = (X,N) with mutual dependence between X and N is to start in Sect. 7.1 from a model with independent components. We shall then apply in Sect. 7.2 a Markovian change of probability measure in order to get a model with mutual dependence under the changed measure.
122 S. Crepey 7.1 Homogeneous Case In this section we consider a first set of data with coefficients n, f, b = n, f,band the related generator G such that Assumption 3 (i) f = 1, ni,j(t, x) = ni,j ? 0 for any i, j ? I, and ni,i = 0 for any i ? I; (ii)bi(t, x), ?i(t, x) and ?i(t, x, y) are Lipschitz continuous in x uniformly in t, y, i; (iii)bi(t, 0), ?i(t, 0) and Rd ?i(t, 0, y)m(dy) are bounded in t, i. Let us be given a stochastic basis (?, F, P), with F = (Ft)t?[0,T ], assumed to support the following processes, independent of each other7: : A d-dimensional standard Brownian motion B; : A compound Poisson process P with jump measure m(dy); : A continuous-time Markov chain Q on the state space I2 with jump intensity from (l, j) to (l, j) given by nl,j, for every (l, j) = (l, j) (and a given law at time 0, the nature of which plays no role in the sequel). Remark 21. Since P and Q are independent of each other and the jumping times of P are totally inaccessible, thus P and Q cannot jump together. We denote by ? the random measure ?(ds, dy) on [0, T ]?Rd counting the jumps of P with mark y between times 0 and s, and by ? the random measure d?s(l, j) on [0, T ] ? I2 counting the jumps of Q to the set (l, j) between times 0 and s. Lemma 6. The P-compensatrices ? of ? and ? of ? are respectively given by ?(ds, dy) = ?(ds, dy) ? m(dy)ds , d?s(l, j) = d?s(l, j) ?nl,j ds. (132) Moreover, for every (l, j) ? I2, ?(l, j) is a Poisson process with intensity nl,j . Proof. Thatm(dy)ds P-compensates ? directly results from the definition of ?. Let us thus prove the results regarding ?. The chain Q is a bi-dimensional F - Markov chain with the generic state denoted as (j, l). Let ?s(q, q) denote the measure that counts the number of jumps of the chain Q from state q= (j, l) to state q = (j, l) (q= q) on the time interval (0, s]. By the characterization of Markov chains in Bielecki et al. [21, Lemma 5.1], the F-compensator of the measure ? is given as ds, (q, q) = 1Qs=qnqds. Thus, the F-compensator of the measure ?s(q) counting the jumps of Q to the state q = (j, l) on the time interval (0, s], is given as qds(q, q) = nqq1Qs=qds = nqds. 7 I thank Tomasz R. Bielecki for interesting discussions regarding the construction of this section, and in particular, for the proof of Lemma 6.
About the Pricing Equations in Finance 123 Consequently, ?s(j, l) is an F-martingale. In view ofWatanabe characterization of a Poisson process (see, e.g., Bremaud [27, Chap. II, Sect. 2, t5, p. 25]), ?(l, j) is thus a Poisson process. We now consider the following stochastic differential equation, for s ? [t, T ]: ?? ?dNt s = j?I (j ? Nt s?) d?s(Nt s?, j) dXts =b(s,Xt s )ds + ?(s,Xt s ) dBs + Rd ?(s,Xt s?, y) ?(ds, dy). (133) Proposition 22. The stochastic differential equation (133) on [t, T ] with initial condition (x, i) on [0, t] has a unique (?, F, P) - solution8 Xt = (Xt,Nt). For any p ? [2,+?), one has: XtpSpd ? Cp (1 + |x|p) (134) 1(s,r)(Xt - ? Xts)pSpd ? Cp (1 + |x|p) (r ? s). (135) Moreover, treferring to a perturbed initial condition (t, x, i), one has: P(Nt ? Nt) ? C|t ? t| (136) Xt ? XtpSpd ? Cp |x ? x|p + (1+ ?xp)|t ? t|12 (137) where we set ?x = |x| ? |x|. Proof. Note that the first line of (133) can be rewritten as dNt s = (l,j)?I2 (j ? l) 1{l=Nts?}d?s(l, j) (138) = (l,j)?I2 (j ? l) 1{l=Nts}nl,jds+ (l,j)?I2 (j ? l) 1{l=Nts?}d?s(l, j). (139) The last formulation corresponds to the special semimartingale canonical decomposition of Nt. One thus has the following equivalent form of (133), #dNts = (l,j)?I2 (j ? l) 1s<t1{l=Nts}nl,jds+ (l,j)?I2 (j ? l) 1s<t1{l=Nts?}d?s(l, j) dXts= 1s>tb(s,Xt s )ds + 1st?(s,Xt s ) dBs + Rd 1st?(s,Xt s?, y) ?(ds, dy) . (140) 8 Defined over [0, T].
124 S. Crepey Any square integrable martingale or martingale measure is an L2-integrator in the sense of Bichteler [13] (see Theorem 2.5.24 and its proof page 78 therein). Therefore by application of [13, Proposition 5.2.25, p. 297], the stochastic differential equation (140) with initial condition (x, i) at time t, or, equivalently, the stochastic differential equation (133) with initial condition (x, i) on [0, t], has a unique (?, F, P) - solution Xt = (Xt,Nt). The general estimates (111) and (112) then yield, under Assumption 3: XtpSpd ? CpCtp(141) 1(s,r)(Xt - ? Xts)pSpd ? CpCtp(r ? s) (142) Xt ? XtpSpd ? Cp Ctp|t ? t| + Ct,tp (143) with Ctp= |x|p + E$sup [t,T] |b(-, 0,Nt - )|p + sup [t,T] |?(-, 0,Nt - )|p + sup [t,T] Rd |?(-, 0,Nt - , y)|pm(dy)% Ct,tp = |x ? x|p + E$T t?t|b(s,Xts,Nt s) ?b(s,Xts,Nts )|pds +T t?t|?(s,Xts,Nt s) ? ?(s,Xts,Nts )|pds +T t?tRd |?(s,Xts,Nt s, y) ? ?(s,Xts,Nts , y)|pm(dy)ds% The bound estimates (134) and (135) result from (141) and (142) by the boundedness Assumption 3(iii) on the coefficients. As for the error estimates (136)-(137), note that by construction of N via Q in (133), one has (assuming t ? t, w.l.o.g.): Nt ? Nt=? j?I\{i} ?t(i, j) > j?I\{i} ?t(i, j) (144) (which in words means, "at least one jump of ? on (t, t]"). Now, in view of Lemma 6, the probability of at least one jump of ?(i, j) on (t, t] is 1?e?ni,j |t?t|, and therefore, P(Nt ? Nt) ? j?I\{i} 1 ? e?ni,j |t?t|? j?I\{i}ni,j|t ? t| ,
About the Pricing Equations in Finance 125 which proves (136). Thus ET t |b(s,Xts,Nt s) ?b(s,Xts,Nts )|pds ? C|t ? t|12 ET t |b(s,Xts,Nt s)|2p + |b(s,Xts,Nts )|2pds12 where by (134) and the properties of b: ET t |b(s,Xts,Nt s)|2pds ? CET t |b(s, 0,Nt s)|2p + |Xts|2pds ? C2p1 + ?x2pand likewise for ET t |b(s,Xts,Nts )|2pds. So ET t |b(s,Xts,Nt s) ?b(s,Xts,Nts )|pds ? Cp(1 + ?xp)|t ? t|12 and by similar estimates regarding the terms in ? and ? of Ct,tp : Ct,tp ? |x ? x|p + Cp(1 + ?xp)|t ? t|12 . Hence (137) follows, in view of (143). Note 11. (i) Given the definition of Nt in the first line of (133), an application of Lemma 5.1 in Bielecki et al. [21] yields that Nt is an F - Markov chain (and therefore, a Markov chain with respect to its own filtration). The Markov property of Nt will be recovered independently in Proposition 29, as a by-product of Theorem 3 (cf. Note 9(i)). Note however that one of the messages of the present paper is that Markov properties are not really needed if one works in a SDE set-up. Indeed, SDE uniqueness results are then enough for most related purposes. In fact one of the keys of Theorem 3 precisely consists in SDE uniqueness results which underlie the SDE and BSDE semi-group properties of Sect. 8. (ii) The reason why we introduce Nt indirectly via Q through (133) is the following. Defining a processNt for every initial condition (t, x, i), and getting a "Markov family" Xt = (Xt,Nt) parameterized by t standing for a generic initial condition (t, x, i) ? E, is not enough for the purpose of establishing the connection between an SDE and a PDE perspective in Part III. For this purpose, one also needs this "Markov family" to be "well-behaved" in the sense of bound and error estimates like (135) and (137) to be available. This is why we resort to the above "bi-dimensional construction" of Nt via Q, which implies (144), and yields as a consequence the error estimate (136) on Nt. (iii) In case where there are no regimes in the model (case k = 1), one can see by inspection of the above proof that |t ? t|12 can be improved into |t ? t| in (137). Let us define further on [t, T ]: Bt = B ? Bt , ?t = ? ? ?t , ?t(j) = ?(Nt-?, j) ? ?t(i, j). (145)
126 S. Crepey Note that ?t is a random measure on [0, T ] ? I, such that for every j ? I, ?ts(j) counts the number of jumps of Nt to regime j on (t, s]. By contrast, ? is a random measure on [0, T ] ? I2, such that for every (j, l) ? I2, ?s(j, l) counts the jumps of the bi-dimensionalMarkov Chain Q to state (j, l) on (0, s]. Remark 22. Of course dBts= dBs and ?t(ds, dy) = ?(ds, dy), so the introduction of Bt and ?t is not really necessary. The reason why we introduce Bt and ?t is for notational consistency with ?t (also note that Bt, ?t and ?t are defined over [t, T ], whereas B, ? and ? live over [t, T ]). Let FBt , F?t , F?t and Ft stand for the filtrations on [t, T ] generated by Bt, ?t, ?t, and the three processes together, respectively. Given a further initial condition at time t (F-measurable random variable) denoted by Mt, with generated sigma-field denoted by ?(Mt), let in turnF Bt , F ?t , F ?t andFt stand for the filtrations on [t, T ] generated by ?(Mt) and, respectively, FBt , F?t , F?t and Ft. Proposition 23. (i) Let Xt be defined as in Proposition 22. The stochastic differential equation (133), or equivalently (140), on [t, T ], with initial condition (x, i) at t, admits a unique strong (?, Ft, P) - solution, which is given by the restriction of Xt to [t, T ]. In particular, (?, Ft, P), (Bt, ?t, ?t),Xt is a solution to the timedependent local martingale problem with generator G and initial condition (t, x, i). (ii) (Ft, P;Bt, ?t, ?t) has the local martingale predictable representation property, in the sense that for any random variable Mt, any (Ft, P) - local martingale M with initial condition Mt at time t admits a representation Ms = Mt + s t Zr dBr + s t Rd Vr(dx)?(dx, dr) +j?I s t Wr(j)d?(Nt s?, j), s ? [t, T ] (146) for processes Z, V,W in the related spaces of predictable integrands. Proof. (i) is straightforward, given Proposition 22 and the fact that the restriction of Xt to [t, T ] is Ft-adapted. The fact that (?, Ft, P), (Bt, ?t, ?t),Xt is a model with generator G immediately follows in view of the Ito formula (117). (ii) One has the following local martingale predictable representation properties for (FBt , P;Bt), (F?t , P; ?t) and (F?t , P; ?t), respectively (see, e.g., Jacod-Shiryaev [62, Theorem 4.34(a) Chap. III, p. 189] for the two former and Boel et al. [24, 25] for the latter): : Every (F Bt , P;Bt) - local martingale M with initial condition Mt at time t admits a representationMs = Mt + s t Zr dBr, s ? [t, T ] ;
About the Pricing Equations in Finance 127 : Every (F ?t , P; ?t) - local martingaleM with initial condition Mt at time t admits a representationMs = Mt + s t Rd Vr(dx)?(dx, dr), s? [t, T ]; : Every (F ?t , P; ?t) - local martingaleM with initial condition Mt at time t admits a representationMs = Mt +j?I s t Wr(j)d?(Nt s?, j), s ? [t, T ] , for processes Z, V,W in the related spaces of predictable integrands. By independence of B, P and Q, added to the fact that the related square brackets are null (see, e.g., Jeanblanc et al. [66]), this implies the local martingale predictable representation property (146) for (Ft, P;Bt, ?t, ?t). 7.2 Inhomogeneous Case Our next goal is to show how to construct a model with generator of a more general form (113) (if not of the completely general form (113): see Remark 23 below), under less restrictive conditions than in the previous section, with state-dependent intensities. Towards this end we shall apply to the model of Sect. 7.1 a Markovian change of probability measure (see Kunita and Watanabe [70], Palmowski and Rolski [78]; cf. also Bielecki et al. [16] or Becherer and Schweizer [10]). Let thus a change of measure function ? be defined as the exponential of a function of class C1,2 with compact support on E. Starting from G, we define the operator G of the form (113) with data n, f and b as follows (and other data as in G), for (t, x, i) ? E: ??? ?? ni,j(t, x) = ?j(t,x) ?i(t,x)ni,j fi(t, x, y) = ?i(t,x+?i(t,x,y)) ?i(t,x) fi(t, x, y), bi(t, x) =bi(t, x) + Rd ?i(t, x, y)(fi(t, x, y) ? fi(t, x, y))m(dy) (147) (where we recall that f ? 1). Lemma 7. (i) The function n is bounded, and the function f is positively bounded and Lipschitz continuous with respect to x uniformly in t, y, i. (ii) The (Ft, P) - local martingale ?t defined by ?t t = 1 and, for s ? [t, T ], d? t s ?t s? = Rdf(s,Xt s?, y) f(s,Xt s?, y) ? 1?(ds, dy) +j?Inj(s,Xt s?) nj(Nt s?) ? 1d?s(Nt s?, j) (148)
128 S. Crepey is a positive (Ft, P)-martingale with E?t s = 1 and such that (with ?t extended by one on [0, t]): ?tpSpd ? Cp. (149) Proof. (i) is straightforward, given Assumptions 3(ii) and the regularity assumptions on ?. (ii) By application of Bichteler [13, Proposition 5.2.25, p. 297], the stochastic differential equation (148) with initial condition 1 on [0, t], has a unique (?, F, P)-solution ?t. Estimate (149) follows by application of the general estimate (111) to ?t. In particular the local martingale ?t is a genuine martingale. We then define for every s ? [t, T ] an equivalent probability measure Pts on (?,Ft s) by setting dPts dP = ?t s , P-a.s. (150) and we let finally Pt = PtT . Note that ?t s is the Ft s-measurable version of the Radon- Nikodym density of Pt with respect to P on Ft s, for every s ? [t, T ]. Let us define, for s ? [t, T ]:   ?t(ds, dy) = ?t(ds, dy) ? f(s,Xt s, y)m(dy)ds d?ts(j) = d?ts(j) ? nj(s,Xt s ) ds. (151) The proof of the following lemma is classical and therefore deferred to Appendix 17.1. Note that this result does not depend on the special form of b in (147). Recall (145) for the definition of Bt. Lemma 8. Bt is an (Ft, Pt) - Brownian motion starting at time t, and ?t and ?t are the Pt-compensatrices of ?t and ?t. Proposition 24. (i) The restriction to [t, T ] of Xt = (Xt,Nt) in Propositions 22 and 23(i) is the unique (?, Ft, Pt) - solution of the following SDE on [t, T ] with initial condition (x, i) at time t: dNts = j?I (j ? Nts?) d?ts(j)= j?I (j?Nts?) nj(s,Xt s ) ds+ j?I (j ? Nts?) d?ts(j) dXts=b(s,Xt s )ds + ?(s,Xt s ) dBts+ Rd ?(s,Xt s?, y) ?t(ds, dy). (152) In particular (?, Ft, Pt), (Bt, ?t, ?t),Xt is a solution to the time-dependent local martingale problem with generator G and initial condition (t, x, i). (ii) (Ft, Pt;Bt, ?t, ?t) has the local martingale predictable representation property, in the sense that for any random variable Mt, any (Ft, Pt) - local martingale M
About the Pricing Equations in Finance 129 with initial condition Mt at time t, whereFt denotes the filtration on [t, T ] generated by Ft and ?(Mt), admits a representation Ms = Mt + s t Ztr dBtr+ s t Rd V t r (dx)?t(dr, dx) +j?I s t Wt r (j)d?tr(j), s ? [t, T ] (153) for processes Zt, V t,Wt in the related spaces of predictable integrands. Proof. (i) In view of (147) and (151), Xt is a strong (?, Ft, Pt) - solution of the stochastic differential equation (152)with initial condition (x, i) at time t if and only if it is a strong (?, Ft, P) - solution of the stochastic differential equation (133) with initial condition (x, i) at time t. The result hence follows from Proposition 23(i). (ii) The local martingale predictable representation property is preserved by equivalent changes of probability measures (see, e.g., Jacod-Shiryaev [62, Theorem 5.24, p. 196]), so the result follows from Proposition 23(ii). Note 12. (i) One might work with the following variant of (148): d ?t s ?t s? = ??? ? (s,Xt s )dBs + Rd f(s,Xt s?, y) f(s,Xt s?, y) ? 1?(ds, dy) +j?I nj(s,Xt s?) nj(Nt s?) ? 1d?s(Nt s?, j). (154) As compared with (148), the change of probabilitymeasure defined by (154), which is used for instance in [16], would have the additional effect to further change the Brownian motion into d Bts= dBts? (???)T ? (s,Xt s )ds (155) in (151), and to modify accordingly the coefficient of the first-order term in the generator of X. (ii) From the point of view of financial interpretation (see Part I): : The changed measure Pt with associated generator G of Xt may be thought of as representing the risk-neutral pricing measure chosen by the market to value financial instruments (or, in the case of defaultable single-name credit instruments as of Sect. 4.2, the pre-default pricing measure). In the risk-neutral pricing context, this imposes a specific arbitrage consistency condition that must be satisfied by the risk-neutral drift coefficient b of G in (147). Namely, in the simplest, default-free case, and for those components xl of X which
130 S. Crepey correspond to price processes of primary risky assets, in an economy with constant riskless interest-rate r and dividend yields ql, arbitrage requirements imply that bil(t, x) = (r ? ql)xl, for (t, x, i) ? E. An analogous pre-default arbitrage drift condition may also be derived in the case of a pre-default factor process X in the case of defaultable derivatives, see Sect. 4.2 and [20]. The corresponding components bl of b are thus pre-determined in (147). The change of measure (147) must then be understood in the reverse-engineering mode, for deducing bl from bl rather than the other way round. The change of measure function ? in (147), possibly parameterized in some relevant way depending on the application at hand, may be determined along with other model parameters at the stage of the calibration of the model to market data; : Another possible interpretation and use of the change of measure (as in Bielecki et al. [16], using (154) instead of (148)), is that of a change of numeraire (cf. Sect. 4.1). 7.3 Synthesis In Sects. 8 and 9, we shall work with the models (?, Ft, Pt), (Bt, ?t, ?t), Xt = (Xt,Nt) with generator G thus constructed, for initial conditions (t, x, i) varying in E. Remark 23. We thus effectively reduce attention from the general case (113) to the case of a generator with data n, f, b deduced from one with "independent ingredients" n, f ? 1,bby the formulas (147). Pt-expectation and P-expectation will be denoted henceforth by Et and E, respectively. The original stochastic basis (?, F, P) and generator G will be used for deriving error estimates in Sects. 8 and 9, where we shall express with respect to this common basis differences between (?, Ft, Pt)-solutions corresponding to different initial conditions (t, x, i). Towards this view, in addition to the notation already introduced in Sect. 6.3 in relation to process Xt considered relatively to the stochastic basis (?, Ft, Pt), we define likewise, in relation with the process Xt considered relatively to (?, F, P): : F, the subset Rd ? {02}? {0d} ? I2of Rd ? R2; : BF , the sigma-field generated by B(Rd) ? {02} and {0d} ? BI2 on F, where B(Rd) and BI2 stand for the Borel sigma-field on Rd and the sigma-field of all parts of I2, respectively; : ?(de) and ?t(e) respectively given by, for any t ? [0, T ] and e = (y, (l, j)) ? F: ?(de) =  m(dy) if (l, j) = 02 1 if y = 0d , ?t(e) =  1 if (l, j) = 02 nl,j if y = 0d
About the Pricing Equations in Finance 131 : ?, the (?, F, P) - integer-valued random measure on [0, T ]?F, B([0, T ])?BF counting the jumps of ? with mark y ? A and the jumps of ? to (l, j) between 0 and t, for any t ? 0, A ? B(Rd), (l, j) ? I2. We denote for short (cf. Sect. 6.3): (F, BF , ?) = (Rd ? I2, B(Rd)?BI2,m(dy) ? 1) and ? = ???. The (?, F, P)-compensator of ? is thus given by, for any t ? 0,A ? B(Rd), (l, j) ? I2, with A ? {(l, j)} := A ? {02}? {0d} ? {(l, j)}: t 0 A?{(l,j)} ?t(e)?(de)ds = t 0 Am(dy)ds + t 0 nl,j ds. Note that H2?can be identified with the product space H2??H2? , and thatM? = M(F, BF , ?;R) can be identified with the product spaceM(Rd, B(Rd),m(dy);R) ?Rk2 . For v = (v,w)?M? ?M(Rd, B(Rd),m(dy);R) ? Rk2 , we denote accordingly (cf. (105)): |v|2 = Rd v(y)2m(dy) + (l,j)?I2 w(l, j)2nl,j . (156) In the sequelvand v denote generic pairs (v,w) inM? andM? , respectively. 8 Study of the Markovian BSDEs We assume that the cost functions C satisfy the Markovian BSDE assumptions (M.0)-(M.2) introduced in Sect. 6.4, as well as (M.3) = ? ? c for a C1,2-function ? on E such that ?, G?, ???, (t, x, i) > Rd |?i(t, x + ?i(t, x, y))|m(dy) ? P (157) and for a constant c ? R ? {??}. Note 13. (i) The standing example for ? in (M.3) (see [38]) is ? = x1, the first component of x ? Rd (assuming d ? 1 in our model), whence G? = b1. In this case (157) reduces to b1, ?1, (t, x, i) > Rd |?i1(t, x, y)|m(dy) ? P.
132 S. Crepey (ii) Alternatively to (M.3), one might work with the symmetric assumptions regarding h, namely h = ? ? c where ? satisfies (157). However it turns out that this kind of call payoff does not correspond to any known applications, at least in finance. In part (i) of the following theorem, building in particular upon the (Ft, Pt;Bt, ?t, ?t) - martingale representation property of Proposition 24(ii), one establishes existence and uniqueness of an (?, Ft, Pt), (Bt, ?t) - solution Yt of the R2BSDE on [t, T ] with data (121). This result is then "translated" in part (ii) in terms of an (?, F, P), (B, ?) - solution Yt to another, auxiliary R2BSDE. The interest of the auxiliary R2BSDE is that the solutions Yt as (t, x, i) varies in E are defined with respect to the common stochastic basis (?, F, P) (cf. Sect. 7.3). One can then proceed by application of the general estimates of [38] for deriving in Proposition 25 Markovian stability results regarding the Yts. These estimates are then used in Part III of this article for establishing the analytic interpretation of Y t, the first component of Yt, which essentially coincides with that of Yt (see part (ii) below). Theorem 1. (i) The R2BSDE on [t, T ] with data (cf. (121)) g(s,Xt s, y, z, v) , ?(XtT) , (s,Xt s ) , h(s,Xt s ) (158) has a unique (?, Ft, Pt), (Bt, ?t) - solution Yt = (Y t, Zt, Vt,Kt). (ii) Denoting Vt = (V t,Wt) with V t ? H2?t,Wt ? H2?t , we extend Y t by Y t t and Kt, Zt and Vt by 0 on [0, t], and we define on [0, T ]: Wt s (l, j) = 1{l=Nts?}Wt s (j) for l, j ? I , Vt = (V t,Wt). Then Yt = (Y t, Zt, Vt,Kt) is an (?, F, P), (B, ?) - solution to the R2BSDE on [0, T ] with data 1{s>t}g(s,Xt s, y, z,v) , ?(XtT) , (s ? t,Xt s?t) , h(s ? t,Xt s?t), (159) where g(s,Xt s, y, z, v) := g(s,Xt s , uts, z, rts) + (rts? r) ? (l,j)?I2 wl,jnl,j (160) with r(v) = Rd v(y)m(dy) , (uts)j(y,w) = # y , j = Nt s y + l?I wl,j , j = Nt s . Proof. (i) Given assumptions (M.0)-(M.2) and the bound estimates (134) on Xt and (149) on ?t, the following conditions are satisfied: (H.0)' ?(XtT) ? L2;
About the Pricing Equations in Finance 133 (H.1.i)'g(-,Xt - , y, z, v) is a progressively measurable process on [t, T ] with Et $T t g(-,Xt - , y, z,v)2 dt% < +? , for any y ? R, z ? R1?d, v ?M? (where Et denotes Pt-expectation); (H.1.ii)' g(-,Xt - , y, z, v) is uniformly ? - Lipschitz continuous with respect to (y, z,v), in the sense that for every s ? [t, T ], y, y? R, z,z ? R1?d, v, v?M?: |g(s,Xt s, y, z, v) ?g(s,Xt s, y, z, v)| ? ?|y ? y| + |z ? z| + |v ? v|s(cf. (118) for the definition of |v ? v|s); (H.2.i)' (s,Xt s ) and h(s,Xt s ) are cadlag quasi-left continuous processes in S2; (H.2.ii)' (-,Xt - ) ? h(-,Xt - ) on [t, T ), and (T,XtT) ? ?(XtT) ? h(T,XtT). Therefore the general assumptions (H.0)-(H.2) are satisfied by the data (158) relatively to (?, Ft, Pt), (Bt, ?t). Given the local martingale predictable representation property of Proposition 24(ii) and the formpostulated in (M.3) for , existence and uniqueness of an (?, Ft, Pt), (Bt, ?t) - solution Yt = (Y t, Zt, Vt,Kt) to the R2BSDE with data (158) on [t, T ] follows by application of the general results of [38]. (ii) By the previous R2BSDE, one thus has for s ? [t, T ]: ?dY t s = g(s,Xt s, Y t s , Zts, Vts)ds + dKts? ZtsdBs ? Rd V t s (y)?t(ds, dy) ?j?I Wt s (j)d?ts(j) = g(s,Xt s , uts, Zts, rts)ds + dKts? ZtsdBs + Rd V t s (y)(? ? ?t)(ds, dy) ?Rd V t s (y)?(ds, dy) ?j?I Wt s (j)d?ts(j). Given (151), (147) (where f = 1) and the facts that for s ? t: j?I Wt s (j)d?ts(j) = (l,j)?I2 Wt s (l, j)d?s(l, j) , uts(Y t s ,Wt s) = uts(Y t s ,Wt s ) , one gets that for s ? t: ?dY t s = g(s,Xt s , uts, Zts, rts)ds + dKts? ZtsdBs +Rd V t s (y)(f(s,Xt s, y) ? 1)m(dy)ds ?Rd V t s (y)?(ds, dy) ? (l,j)?I2 Wt s (l, j)d?s(l, j).
134 S. Crepey It is then immediate to check that Yt is an (?, F, P), (B, ?) - solution of the R2BSDE with data (159) on [0, T ]. By application of the general estimates of [38] to Yt, where the Yts for varying (t, x, i) are defined with respect to the common stochastic basis (?, F, P), one then has the following stability result, whose proof is deferred to Appendix 17.2. Proposition 25. (i) One has the following estimate on Yt in Theorem 1: Y t2S2 + Zt2H2d + Vt2H2? + Kt,+2S2 + Kt,?2S2 ? C(1 + |x|2q). (161) (ii) Moreover, tn referring to a perturbed initial condition (tn, xn, i) ? E with (tn, xn) > (t, x) as n > ?, then Ytn converges in S2 ? H2d? H2?? A2 to Yt as n>?. 8.1 Semi-Group Properties Let t refer to the constant initial condition (t, x, i) as usual. Let Xt = (Xt,Nt) and Yt be defined as in Proposition 22 and Theorem 1, respectively. Given t? t, let Ftstand for ( Ftr )r?twith for r ? tFtr = ?(Xt t)&Ftr . As for Ft= (Ftr )r?t, Pt, Btand ?t, they are still defined as in Sects. 7.1 and 7.2, with tinstead of t therein. Note in particular that Ftis embedded into the restriction Ft| [t,T ] of Ft to [t, T ]. Proposition 26. (i) The stochastic differential equation (133), or equivalently (140), on [t, T ], with initial condition Xt tat t, admits a unique strong (?,Ft, P) - solutionXt= (Xt,Nt), which coincides with the restriction of Xt to [t, T ], so: Xt= (Xtr ,Ntr )t?r?T = (Xt r )t?r?T . (ii) The R2BSDE on [t, T ] with data g(s,Xts , y, z,v), ?(XtT ), (s,Xts ), h(s,Xts ) (162) has a unique (?,Ft, Pt), (Bt, ?t) - solution Yt= (Y t, Zt, Vt,Kt), such that: Yt= (Y tr , Ztr , Vtr ,Ktr )t?r?T = (Y t r , Ztr, Vtr,Ktr ? Ktt)t?r?T . (163)
About the Pricing Equations in Finance 135 Proof. (i) By Bichteler [13, Proposition 5.2.25, p. 297], the stochastic differential equation (133) with initial condition (t,Xt t) admits a unique (?,Ft, P) - solution Xt= (Xt,Nt), and it also admits a unique (?, Ft| [t,T ], P) - solution, which by uniqueness is given by Xtas well, since Ftis embedded into Ft| [t,T ]. Now, (Nt r)t?r?T is an Ft| [t,T ]-adapted process satisfying the first line of (133) on [t, T ]. (Xtr)t?r?T is then in turn an Ft| [t,T ]-adapted process satisfying the second line of (133) on [t, T ]. Therefore Xt= (Xt r )t?r?T , by uniqueness relatively to (?, Ft| [t,T ], P). (ii) Note that the bound estimate (134) on Xt is also valid for solutions of stochastic differential equations with random initial condition like Xtin part (i) above, by application of Proposition 19 (cf. proof of Proposition 22). One thus has for any p ? [2,+?), with Xtextended by Xt= Xt ton [0, t]: XtpSpd ? Cp (1 + E|Xt t|p) ? Cp (1 + |x|p) where the last inequality comes from (134). Consequently, (H.0)'-(H.2)' in the proof of Theorem 1(i) still hold with t(in the sense of the initial condition (t,Xt t) for X) instead of t therein. Given the local martingale predictable representation property of Proposition 24(ii) applied with t and Mt therein equal to tand Xt there, and in view of the form postulated in (M.3) for , existence and uniqueness of an (?,Ft, Pt), (Bt, ?t) - solution Yt= (Y t, Zt, Vt,Kt) to the R2BSDE with data (162) on [t, T ] follows by application of the general results of [38]. These results also imply uniqueness of an (?, Ft| [t,T ], Pt), (Bt, ?t) - solution to the R2BSDE with data (162) on [t, T ], by (H.0)'-(H.2)' as above. Since Ftis embedded into Ft| [t,T ], Yt= (Y t, Zt, Vt,Kt) is thus the unique (?, Ft| [t,T ], Pt), (Bt, ?t) - solution to the R2BSDE with data (162) on [t, T ]. Finally given part (i) it is immediate to check that (Y t r , Ztr, Vtr,Ktr?Ktt)t?r?T is an (?, Ft| [t,T ], Pt), (Bt, ?t) - solution to the R2BSDE with data (162) on [t, T ]. We conclude by uniqueness relatively to (?, Ft| [t,T ], Pt), (Bt, ?t). 8.2 Stopped Problem Let ?t denote a stopping time in Tt, parameterized by the initial condition (t, x, i) of X. Theorem 2. (i) The RDBSDE on [t, T ] with data (cf. (122)) g(s,Xt s, y, z, v), ?(XtT), (s,Xt s ), h(s,Xt s ), ?t (164) has a unique (?, Ft, Pt), (Bt, ?t) - solution Yt = (Y t, Zt, Vt, Kt). Moreover, Y t = Y t on [?t, T ], where Y t is the state-process of the solution Yt defined at Theorem 1.
136 S. Crepey (ii) Let us denote Vt = (V t,'Wt) with V t ? H2?t ,'Wt ? H2?t . We extend Y t by Y t t and Kt, Zt and Vt by 0 on [0, t], and we define on [0, T ]: ? Y t = Y t -??t , ? Zt = 1-??t Zt , ?Vt = 1-??t Vt, ?Kt = Kt-??t Wt(l, j) = 1{l=Nt-?}'Wt(j) for l, j ? I , Vt = 1-??t(V t,Wt) ? Yt = (? Y t, ? Zt, ?Vt, ?Kt) , Yt = (? Y t, ? Zt, Vt, ?Kt). Then (cf. (119) and (160) for the definitions ofgandg): : ? Yt is an (?, Ft, Pt), (Bt, ?t) - solution to the stopped RBSDE on [t, T ] with data g(s,Xt s, y, z,v) , Y t ?t = Y t ?t , (s,Xt s ) , ?t, (165) : Yt is an (?, F, P), (B, ?) - solution to the stopped RBSDE on [0, T ] with data 1{s>t}g(s,Xt s, y, z, v) , Y t ?t , (s ? t,Xt s?t) , ?t. (166) Proof. (i) By the general results of [38], existence of an (?, Ft, Pt), (Bt, ?t) - solution Yt to the R2BSDE on [t, T ] with data (158) in Theorem 1(i) implies existence of an (?, Ft, Pt), (Bt, ?t) - solution (Y t, Zt, Vt, Kt) to the RDBSDE on [t, T ] with data (164), such that Y t = Y t on [?t, T ]. (ii) This implies as in the proof of Theorem 1(ii) that Yt = (Y t, Zt, (V t,Wt), Kt), defined on [0, T ] as described in the statement of the theorem, is an (?, F, P), (B, ?) - solution to the RDBSDE on [0, T ] with data 1{s>t}g(s,Xt s, y, z, v) , ?(XtT) , (t ? s,Xt s?t), h(t ? s,Xt s?t), ?t. The results of part (ii) follow in view of Note 8(iv). We work henceforth in this part under the following standing assumption on ?t. Assumption 4 ?t is an almost surely continuous random function of (t, x, i) on E. Example 3. Let ?t denote the minimum of T and of the first exit time by Xt of an open domain D ? Rd ? I, that is: ?t = inf{s ? t ; Xt s /? D} ? T (167) where for every i ? I: D ? Rd ? {i}= {?i > 0} for some ?i ? C2(Rd) with |??i| > 0 on {?i = 0}. (168) Then Assumption 4 is typically satisfied under a suitable uniform ellipticity condition on the diffusion coefficient ? of X. For related results, see, e.g., Darling and
About the Pricing Equations in Finance 137 Pardoux [41], Dynkin [44, Theorem 13.8], Freidlin [51], or Assumption A2.2 and the related discussion in Kushner-Dupuis [71, p. 281]. See also [31] for a precise statement and proof in case of a diffusion X (case ? ? 0). Under Assumption 4, one has the following stability results on Yt =(? Y t, ? Zt, Vt, ?Kt) in Theorem 2(ii). The proof is deferred to Appendix 17.3. Proposition 27. (i) The following bound estimate holds: ? Y t2S2 + ? Zt2H2d + Vt2H2? + ?Kt2S2 ? C(1 + |x|2q). (169) (ii) Moreover, tn referring to a perturbed initial condition (tn, xn, i) ? E with (tn, xn) > (t, x) as n > ?, then Ytn converges in S2 ? H2d? H2?? A2 to Yt as n>?. 8.2.1 Semi-Group Properties Let Xt = (Xt,Nt) and Yt be defined as in Sect. 8.1, Yt = (? Y t, ? Zt, Vt, ?Kt) and Vt be defined as in Theorem 2(ii), and let ? Xt = (?Xt, ?Nt) stand for Xt -??t . Given t? t, let?Ft= (F?tr )r?tbe defined by, for r ? [t, T ]: F?tr = ?(X?t t)&Ftr , and let ?:= t??t. As for Ft= (Ftr )r?t, Pt, Btand ?t, they are still defined as in Sects. 7.1-7.2, with tinstead of t therein. Note in particular that?Ftis embedded into the restriction Ft| [t,T ] of Ft to [t, T ]. We make the following Assumption 5 ?is an ?Ft-stopping time. Note that since we took D open in (167), Assumption 5 is satisfied in the case of Example 3. Remark 24. Assumption 5 would not satisfied if the domain D had been taken closed instead of open in (167), for instance with {?i ? 0} instead of {?i > 0} in (168). Proposition 28. (i) The following stochastic differential equation on [t, T ]: ??????? ?????? d?Nts = 1s<?t(l,j)?I2 (j ? l) 1{l= ?Nts?}nl,jds + (l,j)?I2 (j ? l) 1{l= ?Nts?}d?s(l, j)d?Xts = 1s<?tb(s,X?ts )ds+?(s,X?ts ) dBs + Rd ?(s,X?ts?, y) ?(ds, dy)(170)
138 S. Crepey with initial condition X?t tat tadmits a unique strong (?,?Ft, P) - solution, which is given by the restriction of X?t to [t, T ], so: X?t= ?Xt, ?Nt= ?Xt-??t , ?Nt-??t= X?t rt?r?T . (171) (ii) The stopped RBSDE on [t, T ] with data gs,X?ts , y, z,v , Y t ?t , s,X?ts , ?(172) has a unique (?,?Ft, Pt), (Bt, ?t) - solution ? Yt= (? Y tr , ? Ztr , ?Vtr , ?Ktr )t?r?T , given by:? Y tr , ? Ztr , ?Vtr , ?Ktr t?r?T = ? Y t r , ? Ztr, ?Vtr, ?Ktr ? ?Kttt?r?T . (173) Proof. (i) By Bichteler [13, Proposition 5.2.25, p. 297], the stochastic differential equation (170) with initial condition (t,X?t t) admits a unique (?,?Ft, P) - solution X?t= (?Xt, ?Nt), and it also admits a unique (?, Ft| [t,T ], P) - solution, which by uniqueness is given by X?tas well, given that ?Ftis embedded into Ft| [t,T ]. Now, (?Nt r)t?r?T is an Ft| [t,T ]-adapted process satisfying the first line of (170) on [t, T ]. (?Xtr)t?r?T is then in turn an Ft| [t,T ]-adapted process satisfying the second line of (170) on [t, T ]. Therefore X?t= (X?t r )t?r?T , by uniqueness relative to (?, Ft| [t,T ], P). (ii) One has as in the proof of Proposition 26(ii): ?XtpSpd ? Cp 1 + E|?Xt t|p? Cp (1 + |x|p) . Consequently the data 1{s<?}gs,X?ts , y, z, v, Y t ?t , s ? ?,X?ts??(174) satisfy the general assumptions (H.0), (H.1), and the assumptions regarding L in (H.2), relatively to (?,?Ft, Pt), (Bt, ?t) or (?, Ft| [t,T ], Pt), (Bt, ?t). Given the local martingale predictable representation property of (Ft, Pt;Bt, ?t, ?t) (cf. Proposition 24(ii)) and the form postulated in (M.3) for , the general results of [38] imply existence and uniqueness of an (?,?Ft, Pt), (Bt, ?t) - solution ? Yt= (? Y t, ? Zt, ?Vt, ?Kt) to the stopped RBSDE with data (172) on [t, T ], which is also the unique (?, Ft| [t,T ], Pt), (Bt, ?t) - solution to the stopped RBSDE with data (172) on [t, T ]. Besides, by Theorem 2(ii), ( ? Y t r , ? Ztr, ?Vtr, ?Ktr)t?r?T is an (?, Ft, Pt), (Bt, ?t) - solution to the stopped RBSDE on [t, T ] with
About the Pricing Equations in Finance 139 data (165), where in particular ?Vt = 1-??t Vt and Vt = (V t,'Wt) for some V t ? H2?t ,'Wt ? H2?t . So by Definition 9(i): ???????????? ??????????? ? Y t s = Y t ?t + ?t s??t g(r,X?t r , ? Y t r , ? Ztr, ?Vtr)dr + ?Kt?t ? ?Kts??t ??t s??t ? ZtrdBr ? ?t s??t Rd V t r ?t(dy, dr) ?j?I ?t s??t 'Wt r d?tr(j) , s ? [t, T ] (s,X?t s ) ? ? Y t s for s ? [t, ?t] , and ?t t ( ? Y t s ? (s,X?t s ))d?Kts= 0 ? Y t, ?Kt constant on [?t, T ]. Therefore, given in particular (171) in part (i): ???????????? ??????????? ? Y t s = Y t ?t + ?s??g(r,X?tr , ? Y t r , ? Ztr, ?Vtr)dr + ?Kt?? ?Kts????s??? ZtrdBr ? ?s??Rd V t r ?t(dy, dr) ?j?I ?s??'Wt rd?tr(j) , s ? [t, T ] (s,X?ts ) ? ?Y t s for s in (t, ?] , and ?t? Y t s ? (s,X?ts )d(?Kts? ?Ktt) = 0 ? Y t, ?Kt ? ?Kttconstant on [?, T ]. where (s,X?ts ) ? ?Y t s for s in (t, ?] in the third line implies that the last inequality also holds at s = t, by right-continuity. So ( ? Y t r , ? Ztr, ?Vtr, ?Ktr ? ?Ktt)t?r?T is an (?, Ft| [t,T ], Pt), (Bt, ?t) - solution to the stopped RBSDE with data (172) on [t, T ] (cf. Definition 9(i)). This implies (173), by uniqueness, established above, of an (?, Ft| [t,T ], Pt), (Bt, ?t) - solution to the stopped RBSDE with data (172) on [t, T ]. 9 Markov Properties Our next goal is to establish the Markov properties which are expected for the solutions X of our Markovian forward SDE and the solutions Y, ? Y of our Markovian reflected backward SDEs. Theorem 3. For any initial condition (t, x, i) ? E, let Yt = (Y t, Zt, Vt,Kt) with Vt = (V t,Wt) ? (H2?t ,H2?t ) be the (?, Ft, Pt), (Bt, ?t) - solution to the R2BSDE on [t, T ] with data (158) of Theorem 1. (i) Y t t defines as (t, x, i) varies in E a continuous function u of class P on E. (ii) One has, Pt-a.s. (cf. (123)-(125)): Y t s = u(s,Xt s ) , s ? [t, T ] (175)
140 S. Crepey For any j ? I : Wt s (j) = uj(s,Xts?) ? u(s,Xt s?) , s ? [t, T ] (176) s t g(?,Xt ?, Y t ? , Zt?, Vt?)d? = s t $g(?,Xt ?, u(?,Xt?), Zt? , rt?) ?j?I nj(?,Xt ? )uj(?,Xt?) ? u(?,Xt ? )% ?d? , s ? [t, T ] (177) with in (177): u(?,Xt?) := (uj(?,Xt?))j?I , rt?= Rd V?(y)f(?,Xt ? , y)m(dy) (cf. (120)). Proof. Letting r = t= s in the semi-group property (163) of Y yields: Y t s = u(s,Xt s ) , Pt?a.s. (178) for a deterministic function u on E. In particular, Y t t = ui(t, x) , for any (t, x, i) ? E. (179) The fact that u is of class P then directly follows from (179) by the bound estimate (161) on Yt. LetE (tn, xn) > (t, x) as n>?. We decompose |ui(t, x) ? ui(tn, xn)| = |Y t t ? Y tn tn | ? |E(Y t t ? Y t tn)| + E|Y t tn ? Y tn tn |, where the second term goes to 0 as n > ?by Proposition 25(ii). As for the first term, one has by the R2BSDE with data (159) solved by Yt: |E(Y t t ? Y t tn)| ? Et?tn t?tn |g(s,Xt s, Y t s , Zts, Vts)|ds + E|Ktt?tn ? Ktt?tn| in which the second term goes to 0 as n>?by Proposition 25(i), and Et?tn t?tn |g(s,Xt s, Y t s , Zts, Vts)|ds ? g(-,Xt - , Y t - , Zt- , Vt - )H2 |t ? tn|12 , which also goes to 0 as n>?, by the properties of g and the bound estimate (25) on Yt. So ui(tn, xn) > ui(t, x) wheneverE (tn, xn) > (t, x) as n>?, which establishes the continuity of u on E. Identity (175) then follows from (178) by the
About the Pricing Equations in Finance 141 fact that Y t and (given the continuity of u) u(-,Xt - ) are cadlag processes. One then has on {?Nt = 0} (set on which ?Xt = 0), using also the continuity of u: ?Y t s = u(s,Xt s ) ? u(s,Xt s?) =j?I uj(s,Xts?) ? u(s,Xt s?)??ts(j) =j?I Ws(j)??ts(j), where the last equality comes fromthe R2BSDE with data (121) satisfied by Yt. The last equality also trivially holds on {?Nt = 0}. Denoting Wts(j) = uj(s,Xts?) ? u(s,Xt s?), one thus has on [t, T ]: 0 =j?I Wts(j) ?Wt s (j)??ts(j) =j?I Wts(j) ?Wt s (j)??ts(j) +j?I Wts(j) ?Ws(j)nj(s,Xt s )ds (recall (151) for the definition of ?t), Pt - almost surely. ThereforeWts(j) = Wt s (j) on [t, T ], Pt - almost surely, by uniqueness of the canonical decomposition of a special semimartingale. This proves (176). Now note that for (y, z,v) = (Y t s , Zts, Vts) in (120): uts(Nt s) = Y t s = u(s,Xt s ), by (175), and then for j = Nt s: (uts)j = Y t s +Wt s (j) = u(s,Xt s) + uj(s,Xts?) ? u(s,Xt s?), by (176). Therefore uts? = u(s,Xts?), so that by definition (119) ofg: s t g(?,Xt ?, Y t ? , Zt? , Vt?)d? = s t g(?,Xt ? , ut?, z, rt?) ?j?I Wt ? (j)nj(?,Xt ? )d? = s t g(?,Xt ? , ut??, z, rt?) ?j?I (uj(s,Xt??) ? u(?,Xt ??))nj(?,Xt ? )d? = s t g(?,Xt ?, u(?,Xt??), z, rt?) ?j?I (uj(?,Xt? ) ? u(?,Xt ? ))nj(?,Xt ? )d? = s t g(?,Xt ?, u(?,Xt?), z, rt?) ?j?I (uj(?,Xt?) ? u(?,Xt ? ))nj(?,Xt ? )d? which gives (177). 
142 S. Crepey As a by-product of Theorem 3, one has the following Proposition 29. Xt is an (Ft, Pt)-Markov process. Proof. In the case of a classical BSDE (without barriers) with gi(t, x, u, z, r) =j?I ni,j(t, x)(uj ? ui), using the Verification Principle of Proposition 18, identities (175) and (177) give: Y t s = Et!?(XtT)Ft s" = u(s,Xt s ), for a continuous bounded function u in P. Therefore Et!?(XtT)Ft s" = Et!?(XtT)?(Xt s )", (180) where ?(Xt s ) denotes the sigma-field generated by Xt s . By the monotone class theorem, identity (180) then holds for any Borel-measurable bounded function ? on E, which proves that Xt is an (Ft, Pt)-Markov process. 9.1 Stopped BSDE For any initial condition (t, x, i) ? E, let ? Y = (? Y t, ? Zt, ?Vt, ?Kt)t?r?T , with in particular ?Vt = 1-??t Vt and Vt = (V t,'Wt) ? H2?t ?H2?t , be the unique (?, Ft, Pt), (Bt, ?t) - solution to the stopped RBSDE on [t, T ] with data (165) of Theorem 2(ii). Theorem 4. (i) ? Y t t defines as (t, x, i) varies in E a continuous function v of class P on E. (ii) One has, Pt-a.s. (cf. (126)-(128)): ?Y t s = v(s,Xt s ) , s ? [t, ?t] (181) v(?t,Xt ?t) = u(?t,Xt ?t) (182) For any j ? I : 'Wt s (j) = vj(s,Xts?) ? v(s,Xt s?) , s ? [t, ?t] (183) s t g(?,Xt ? , ? Y t ? , ? Zt? , ?Vt?)d? = s t g(?,Xt ?, v(?,Xt? ), ? Zt? , ?rt?) ?j?I nj(?,Xt ? )vj(?,Xt?) ? v(?,Xt ? )?d? , s ? [t, ?t] (184)
About the Pricing Equations in Finance 143 with in (184): v(?,Xt?) := (vj (?,Xt?))j?I , ?rt?:= rt?(V t ?) = Rd V t ? (y)f(?,Xt ? , y)m(dy) (cf. (120) for the definition of rt). Proof. Letting r = t= s in the semi-group property (173) of ? Y yields: ? Y t s = v(s,X?t s ) , Pt?a.s. (185) for a deterministic function v on E. In particular, ? Y t t = vi(t, x) , for any (t, x, i) ? E. (186) The fact that v is of class P then directly follows from the bound estimate (169) on Yt. Moreover, givenE (tn, xn) > (t, x) as n>?, we decompose |vi(t, x) ? vi(tn, xn)| = | ? Y t t ? ? Y tn tn | ? |E( ? Y t t ? ? Y t tn )| + E| ? Y t tn ? ? Y tn tn |, where the second term goes to 0 as n > ?by Proposition 27(ii). As for the first term, one has by the stopped RBSDE with data (166) solved by Yt: |E( ? Y t t ? ? Y t tn )| ? Et?tn t?tn |g(s,X?t s , ?Y t s , ? Zts, Vts)|ds + E|?Ktt?tn ? ?Ktt?tn| in which the second term goes to 0 as n>?by Proposition 27(i), and: Et?tn t?tn |g(s,X?t s , ?Y t s , ? Zts, Vts)|ds ? g(-,X?t - , ?Y t - , ? Zt- , Vt- )H2 |t ? tn| 12 which also goes to 0 as n > ?, by the properties of g and the bound estimate (169) on Yt. So vi(tn, xn) > vi(t, x) wheneverE (tn, xn) > (t, x) as n>?, which establishes the continuity of v on E. Identity (181) then follows from (185) by the fact that ? Y t and (given the continuity of v) v(-,Xt - ), are cadlag processes. Since ? Y t ?t = Y t ?t (cf. Theorem 2(ii)), (181) and (175) in turn imply (182). One has further on {(?, s) ; s ? [t, ?t], Nt s = Nt s?} (on which ?Xt = 0), using also the continuity of v: ?? Y t s = v(s,Xt s ) ? v(s,Xt s?) =j?I vj(s,Xts?) ? v(s,Xt s?)??ts(j) =j?I 'Ws(j)??ts(j)
144 S. Crepey where the last equality comes the stopped RBSDE on [t, T ] with data (165) solved by ? Yt. The last equality also trivially holds on {(?, s) ; s ? [t, ?t], Nt s = Nt s?}. DenotingWts(j) := vj(s,Xts?) ? v(s,Xt s?), one thus has, on [t, ?t]: 0 =j?I Wts(j) ? 'Wt s (j)??ts(j) =j?I Wts(j) ? 'Wt s (j)??ts(j) +j?I Wts(j) ? 'Ws(j)nj(s,Xt s )ds (recall (151) for the definition of ?t), Pt - almost surely. ThereforeWts(j) = 'Ws(j) on [t, ?t], by uniqueness of the canonical decomposition of a special semimartingale. Hence (182) follows. Finally (184) derives from (181) and (182) like (177) from (175) and (176) (cf. proof of (177)). In summary, one has established in Sects. 7-9 the following proposition relatively to the Markovian FBSDE of Definition 11. Proposition 30. Under the assumptions of Sects. 7-9, the Markovian FBSDE with generator G, cost functions C and (parameterized) stopping time ? has a Markovian solution Zt = (?, Ft, Pt), (Bt, ?t, ?t), (Xt, Yt, ? Yt). The related assumptions, based on the Markovian change of probability measure defined by (147) and (148) (see Remark 23), are admittedly technical and involved, and by no means minimal. In the sequel we shall give up all these specific assumptions, merely postulating instead that the Markovian FBSDE with data G, C and ? has a Markovian solution (as is for instance the case under the assumptions of Sects. 7-9).
About the Pricing Equations in Finance 145 Part III Main PDE Results In this part (see Sect. 1 for a detailed outline), we derive the companion variational inequality approach to the BSDE approach of Part II, working in a suitable space of viscosity solutions to the associated systems of partial integro-differential obstacle problems. The results of this part are used in Part I for giving a constructive and computational counterpart to the theoretical BSDE results of Sect. 2, in the Markovian factor process set-ups of Sects. 3, 4.1 or 4.2.4.We refer the reader to [31,39] for an alternative, simulation-based, computational approach. As announced at the end of Part II, we give up all the specific assumptions made in Sect. 7-9.We make instead the following standing Assumption 6 The Markovian FBSDE with data G, C, ? has a Markovian solution Zt = (?, Ft, Pt), (Bt, ?t, ?t), (Xt, Yt, ? Yt). As illustrated in the previous sections, Assumption 6 covers various issues such as Lipschitz continuity properties of the forward SDE coefficients b, ?, ? with respect to x, martingale representation properties, some kind of consistency between the drivers Bt, ?t, ?t as t ? (t, x, i) varies in E, and almost sure continuity of the random function ?t of (t, x, i) on E. 10 Viscosity Solutions of Systems of PIDEs with Obstacles Our next goal is to establish the connection between Z and related systems of obstacle problems associated to the data G, C, ?, problems denoted by (V1) and (V2) below. In this article we shall consider this issue from the point of view of viscosity solutions to the related systems of obstacle problems. We refer the reader to the books by Bensoussan and Lions [11, 12] for alternative results in spaces of weak Sobolev solutions (see also [4, 5, 7, 11, 12]). We postulate from now on in this part that Assumption 7 (i) All the (t, x, i)?coefficients of the generator G are continuous functions; (ii) The functions ? and f are locally Lipschitz continuous with respect to (t, x), uniformly in y, i; (iii) ?t is defined as in our standing Example 3 in Part II. Let D = [0, T ] ? ? D, where ?Ddenotes the closure9 of D in Rd ? I. Let also 9 In the sense that for every i ? I, ?D? (Rd ?{i}) is the closure of D ? (Rd ?{i}), identified to a subset of Rd.
146 S. Crepey Int E = [0, T ) ? Rd ? I , ?E := E \ Int E = {T}? Rd ? I IntD = [0, T ) ? D , ?D := E \ IntD (187) stand for the parabolic interior and the parabolic boundary of E andD, respectively. Remark 25. The use of the "thick" boundary ?D is motivated by the presence of the jumps in X. Given locally bounded test-functions ? and ? on E with ? of class C1,2 around a given point (t, x, i) ? E, we define (cf. (113) and (114)): G(?, ?)i(t, x) = ?t?i(t, x) + 12Tr!ai(t, x)H?i(t, x)" +??i(t, x)?i(t, x) + I?i(t, x) (188) with I?i(t, x) := Rd ?i(t, x + ?i(t, x, y)) ? ?i(t, x)fi(t, x, y)m(dy). (189) Let also G? stand for G(?, ?). So in particular (cf. (113)): G?i(t, x) +j?I ni,j(t, x)?j(t, x) ? ?i(t, x)= G?i(t, x). (190) The problems (V2) and (V1) that we now introduce will ultimately constitute a cascade of two PDEs, inasmuch as the boundary (including terminal) condition ? in the Cauchy-Dirichlet problem (V1) will be specified later in the paper as the value function u of Definition 11 (cf. Assumption 6), characterized as the unique viscosity solution of class P of (V2). We thus denote by (V2) the following variational inequality with double obstacle: max min ? Gui(t, x) ? gi(t, x, u(t, x), (?u?)i(t, x), Iui(t, x)), ui(t, x) ? i(t, x), ui(t, x) ? hi(t, x)= 0 on Int E, supplemented by the terminal condition ? (the terminal cost function in the cost data C) at T .We also consider the problem (V1) obtained by formally replacing h by +? in (V2), that is min ? Gui(t, x) ? gi(t, x, u(t, x), (?u?)i(t, x), ? Iui(t, x)) , ui(t, x) ? i(t, x)= 0 on IntD, supplemented by a continuous boundary condition ? extending ? on ?D.
About the Pricing Equations in Finance 147 The following continuity property of the integral term I in G (cf. (189)) is key in the theory of viscosity solutions of nonlinear integro-differential equations (see for instance Alvarez-Tourin [1, p. 297]). Lemma 9. The function (t, x, i) > I?i(t, x) is continuous on E, for any continuous function ? on E. Proof. One decomposes I?i(tn, xn)? I?i(t, x) = ?Rd ?i(tn, xn)fi(tn, xn, y) ? ?i(t, x)fi(t, x, y)m(dy) +Rd ?i(tn, xn + ?i(tn, xn, y))fi(tn, xn, y) ??i(t, x + ?i(t, x, y))fi(t, x, y)m(dy), where Rd ?i(tn, xn + ?i(tn, xn, y))fi(tn, xn, y) ??i(t, x + ?i(t, x, y))fi(t, x, y)m(dy) = Rd ?i(tn, xn + ?i(tn, xn, y)) ? ?i(t, x + ?i(t, x, y))fi(tn, xn, y)m(dy) +Rd ?i(t, x + ?i(t, x, y))fi(tn, xn, y) ? fi(t, x, y)m(dy) (191) goes to 0 as E (tn, xn) > (t, x), by Assumption 7(ii), and likewise for Rd ?i(tn, xn)fi(tn, xn, y) ? ?i(t, x)fi(t, x, y)m(dy) . The following definitions are obtained by specifying to problems (V1) and (V2) the general definitions of viscosity solutions for nonlinear PDEs (see, for instance, Crandall et al. [37] or Fleming and Soner [49]), adapting further the definitions to finite activity jumps and systems of PIDEs as in [1, 9, 28, 60, 79]. Definition 12. (a)(i) A locally bounded upper, resp. lower semi-continuous, function u on E, is called a viscosity subsolution, resp. supersolution, of (V2) at (t, x, i) ? Int E, if and only if for any ? ? C1,2(E) such that ui ? ?i reaches a global maximum, resp. minimum, at (t, x), one has,
148 S. Crepey max min ? G(u, ?)i(t, x) ? gi(t, x, u(t, x), (???)i(t, x), Iui(t, x)), ui(t, x) ? i(t, x), ui(t, x) ? hi(t, x)? 0, resp. ? 0. Equivalently, u is a viscosity subsolution, resp. supersolution, of (V2) at (t, x, i), if and only if ui(t, x) ? hi(t, x), resp. ui(t, x) ? i(t, x), and if ui(t, x) > i(t, x), resp. ui(t, x) < hi(t, x), implies that ?G(u, ?)i(t, x)?gi(t, x, u(t, x), (???)i(t, x), Iui(t, x)) ? 0, resp. ? 0, (192) or inequality (192) with G(u, ?) and Iu replaced by G? and I?, for any ? ? C1,2(E) such that ui ??i reaches a global null maximum, resp. minimum, at (t, x), or, in turn, with global null maximum, resp. minimum, replaced therein by global null strict maximum, resp. minimum. (ii) A continuous function u on E is called a viscosity solution of (V2) at (t, x, i) ? Int E, if and only if it is both a viscosity subsolution and a viscosity supersolution of (V2) at (t, x, i). (b)(i) By a P - viscosity subsolution, resp. supersolution, u of (V2) on E for the boundary condition ?, we mean an upper, resp. lower semi-continuous function of class P on E, which is a viscosity subsolution, resp. supersolution of (V2) on Int E, and such that u ? ?, resp. u ? ? pointwise at T. (ii) By a P - viscosity solution u of (V2) on E, we mean a function that is both a P-subsolution and a P-supersolution of (V2) on E - hence u = ? at T. (c) The notions of viscosity subsolutions, supersolutions and solutions of (V1) at (t, x, i) ? IntD, and, given a continuous boundary condition ? extending ? on ?D, P - viscosity subsolutions, supersolutions and solutions of (V1) on E, are defined by immediate adaptation of parts (a) and (b) above, substituting (V1) to (V2), +? to h, IntD to Int E, C0(E) ? C1,2(D) to C1,2(E), "on ?D" to "at T" and ? to ? therein. Note 14. (i)We thus consider boundary conditions in the classical sense, rather than in the weak viscosity sense (cf. the proof of Lemma 13(ii) for more on this issue, see also Crandall et al. [37]). (ii) A classical solution (if any) of (V1), resp. (V2), is necessarily a viscosity solution of (V1), resp. (V2). (iii) A viscosity solution u of (V2) necessarily satisfies ? u ? h. However a viscosity subsolution (resp. supersolution) u of (V2) does not need to satisfy u ? (resp. u ? h). Likewise a viscosity solution v of (V1) necessarily satisfies ? u, however a viscosity subsolution v of (V1) does not need to satisfy u ? . (iv) The fact that G(u, ?) and Iu may equivalently be replaced by G? and I? in (192), or in the analogous inequalities regarding (V1), can be shown by an immediate adaptation to the present set-up of Barles et al. [9, Lemma 3.3, p. 66] (see also "Definition 2 (Equivalent)" page 300 in Alvarez-Tourin [1]), using the monotonicity assumption (M.1.iii) on g.
About the Pricing Equations in Finance 149 Since we only consider solutions in the viscosity sense in this article, (resp. P - ) subsolution, supersolution and solution are to be understood henceforth as (resp. P - ) viscosity subsolution, supersolution and solution. 11 Existence of a Solution The value functions u and v appearing in the following results are the ones introduced in Definition 11, under Assumption 6. This result establishes that u and v are viscosity solutions of the related obstacle problems, with u as boundary Dirichlet condition for v on ?D. Theorem 5. (i) The value function u is a P-solution of (V2) on E for the terminal condition ? at T. (ii) The value function v is a P-solution of (V1) on E for the boundary condition u on ?D. Proof. (i) By definition, u is a continuous function of class P on E. Moreover by definition of u and Y one has that, the superscript T referring to an initial condition (T, x, i) for X: ui(T, x) = Y T T = ?i(x) i(t, x) ? Y t t = ui(t, x) ? hi(t, x). So u = ? pointwise at T and ? u ? h on E. Let us show that u is a subsolution of (V2) on Int E. We let the reader check likewise that u is a supersolution of (V2) on Int E. Let thus (t, x, i) ? Int E and ? ? C1, 2(E) be such that ui ? ?i reaches its maximum at (t, x). Given that u ? h, it suffices to prove that ? G?i(t, x) ? gi(t, x, u(t, x), (???)i(t, x), I?i(t, x)) ? 0, (193) where it is further assumed that ui(t, x) > i(t, x) and ui(t, x) = ?i(t, x) (cf. Definition 12(a)(i)). Suppose by contradiction that (193) does not hold. Then by a continuity argument using in particular Lemma 9: ?(s, y) := G?i(s, y) + gi(s, y, u(s, y), (???)i(s, y), I?i(s, y)) < 0 (194) for any (s, y) such that s ? [t, t+?] and |y?x| ? ?, for some small enough? > 0 with t +? < T. Let ? = inf s ? t ; |Xts ? x| ? ?, Nt s = i, Y t s = i(s,Xts)? (t + ?) (195) (Y t, Zt, V t, Kt) = 1-<?Y t + 1-??ui(?,Xt?), 1-??Zt, 1-??V t, Kt-??(196) (Y t, Zt, V t) = ?i(-Xt-??), 1-??(???)i(-,Xt - ), (197) 1-??!?i(-,Xt-? + ?i(-,Xt-?, y)) ? ?i(-,Xt-?)"y?Rd.
150 S. Crepey Note that ? > t, Pt - almost surely. Thus, using also the continuity of ui: Y t t = Y t t = ui(t, x) = ?i(t, x) = Y t t , Pt-a.s. (198) Also observe that Kt,+ = 0 on [t, ?] by the related minimality condition in the R2BSDE equation for Yt, given that i(s,Xts) < Yt s on [t, ?). Let us now show that one has, for s ? [t, ?]: Y t s = ui(?,Xt?) + ? s gi(?,Xt?, u(?,Xt?), Zt? , rt?)d? ? (Kt,? ? ? Kt,? s ) ?? s Zt?dBt?? ? s Rd V t ? (y)?t(dy, d?). (199) Indeed this holds true on {s = ?} by definition of Y t in (195). Furthermore, on {s < ?}: : Either ?t, whence Xt, do not jump at ?, and identity (199) with ? replaced by r < ? follows from the R2BSDE equation for Yt (in which Kt,+ = 0 on [t, ?]), so that (199) itself holds by passage to the limit as r ?, : Or (cf. Definition 10(i)) Nt does not jump at ?, in which case the R2BSDE equation for Yt integrated between s and ? directly gives (199). Besides, by application of the Ito formula (117) to the function ? defined by ?j = ?i for all j ? I, one gets for any s ? [t, ?]: d?i(s,Xts) = G ?(s,Xt s )ds + (???)(s,Xt s )dBts + Rd ?i(s,Xts? + ?(s,Xt s?, y)) ? ?i(s,Xt s?)?t(ds, dy) = G ?(s,Xt s )ds + (???)(s,Xt s )dBts + Rd ?i(s,Xts? + ?(s,Xt s?, y)) ? ?i(s,Xt s?)?t(ds, dy) = G?i(s,Xts)ds + (???)i(s,Xts)dBts + Rd ?i(s,Xts? + ?i(s,Xts?, y)) ? ?i(s,Xt s?)?t(ds, dy), where the second equality uses (190) applied to ? and the third one exploits the facts that Nt cannot jump before ? and that ?t cannot jump at ? if Nt does. Hence (cf. (197)): Y t s = ?i(?,Xt?) ? ? s G?i(r,Xtr)dr ? ? s ZtrdBtr? ? s Rd V t r (y)?t(dy, dr) = ?i(?,Xt?)?? s ?(r,Xtr)?lgi(r,Xtr, u(r,Xtr),(???)i(r,Xtr), I?i(r,Xtr))dr ?? s ZtrdBtr? ? s Rd V t r (y)?t(dy, dr),
About the Pricing Equations in Finance 151 by definition (194) of ?. One thus has for s ? [t, ?]: Y t s = ?i(?,Xt?) ? ? s ?(?,Xt? ) ? gi(?,Xt?, u(?,Xt?), Zt? , I?i(?,Xt?))d? ?? s Zt?dBt?? ? s Rd V t ? (y)?t(dy, d?) (200) Note that in (199) and (200), one has by definitions (120) of rt?= rt?(V t ? ), (189) of I and (197) of V : ? s gi?,Xt?, u(?,Xt?), Zt? , rt? d? = ? s gi?,Xt?, u(?,Xt?), Zt? , Rd V? (y)fi(?,Xt?, y)m(dy)d? ? s gi?,Xt?, u(?,Xt?), Zt? , I?i(?,Xt?)d? = ? s gi?,Xt?, u(?,Xt?), Zt? , Rd V? (y)fi(?,Xt?, y)m(dy)d? . In conclusion, (199) and (200) respectively mean that: : (Y t, Zt, V t) is an (?, Ft, Pt), (Bt, ?t) - solution to the stopped BSDE on [t, t+ ?] with driver (cf. Definition 8(d) and Note 8(i)) gis,Xts, u(s,Xts), z, Rd v(y)fi(s,Xts, y)m(dy)ds ? dKt,? s and terminal condition ui(?,Xt?) at ?; : (Y t, Zt, V t) is an (?, Ft, Pt), (Bt, ?t) - solution to the stopped BSDE on [t, t + ?] with driver gis,Xts, u(s,Xts), z, Rd v(y)fi(s,Xts, y)m(dy)ds ? ?(s,Xts)ds and terminal condition ?i(?,Xt?) at ?. Setting ?Y t = Y t ? Y t , we deduce by standard computations (see for instance the proof of the comparison principle in [38]): ?t t ?Y t t = Et?t ??Y t ? + ? t ?t sdAts(201) where: : ?Y t ? = Y t ? ? Y t ? = ui(?,Xt?) ? ?i(?,Xt?) ? 0, by making s = ? in (199) and (200) and since ui ? ?i;
152 S. Crepey : dAts = ?(r,Xts)ds ? dKt,? s , so that At is decreasing on [t, ?], by (194); : ?t is a positive process, the so-called adjoint of ?Y t (see, for instance, [38]). Since furthermore ? > t Pt-a.s., we deduce that ? t ?t sdAts < 0 Pt-a.s., whence ?Y t t < 0, by (201). But this contradicts (198). (ii) v is a continuous function on E, by definition. Moreover by definitions of u, v, Y and ? Y (with ? defined as in Example (3)), we have, for (t, x, i) ? ?D: vi(t, x) = ? Y t t = Y t t = ui(t, x), and for any (t, x, i) ? E: i(t, x) ? ?Y t t = vi(t, x). So v = u on ?D and ? v on E. We now show that v is a subsolution of (V1) on IntD. We let the reader check likewise that v is a supersolution of (V1) on IntD. Let then (t, x, i) ? IntD and ? ? C0(E) ? C1,2(D) be such that vi ? ?i reaches its maximum at (t, x). We need to prove that ? G?i(t, x) ? gi(t, x, v(t, x), (???)i(t, x), I?i(t, x)) ? 0, (202) where it is further assumed that vi(t, x) > i(t, x) and vi(t, x) = ?i(t, x) (cf. Definition 12(a)(i)). Suppose by contradiction that (202) does not hold. One then has by continuity, ?(s, y) := G?i(s, y) + gi(s, y, v(s, y), (???)i(s, y), I?i(s, y)) < 0 (203) for any (s, y) such that (s, y, i) ? IntD, s ? [t, t + ?] and |y ? x| ? ?, for some small enough? > 0. Let ? = inf{s ? t ; |Xts ? x| ? ?, Nt s = i, ? Y t s = i(s,Xts)} ? (t + ?) ? ?t (204) (Y t, Zt, V t, Kt) = 1-<? ? Y t + 1-??vi(?,Xt?) , 1-?? ? Zt , 1-?? ? V t , ?Kt-??(205) (Y t, Zt, V t) = ?i(-Xt-??) , 1-??(???)i(-,Xt - ) , 1-??!?i(-,Xt-? + ?i(-,Xt-?, y)) ? ?i(-,Xt-?)"y?Rd. (206) Using in particular the fact that D is open in (167), one has that ? > t, Pt - almost surely. Thus, using also the continuity of vi: Y t t = ? Y t t = vi(t, x) = ?i(t, x) = Y t t , Pt-a.s. (207)
About the Pricing Equations in Finance 153 Note that by the minimality condition in the stopped RBSDE for ? Yt, one has that ?K= 0 on [t, ?], since i(s,Xts) < ? Y t s on [t, ?) and ? ? ?t. By using the stopped RBSDE equation for ? Yt, one can then show like (199) in part (i) that one has, for any s ? [t, ?]: Y t s = vi(?,Xt?) + ? s gi(?,Xt?, v(?,Xt?), Zt? , ?rt?)d? ?? s Zt?dBt?? ? s Rd V t ? (y)?t(d?, dy) (208) with (cf. (129)): ? s gi?,Xt?, v(?,Xt? ), Zt? , ?rt? d? = ? s gi?,Xt?, v(?,Xt? ), Zt? , Rd V?(y)fi(?,Xt?, y)m(dy)d? . Otherwise said, (Y t, Zt, V t) is an (?, Ft, Pt), (Bt, ?t) - solution to the stopped BSDE on [t, t + ?] with driver (cf. Note 8(i)) gis,Xts, v(s,Xts), z, Rd ?(y)fi(s,Xts, y)m(dy)ds (where, to avoid confusion with the value function v = vi(t, x) in v(?,Xt?), ?(y) here, usually denoted by v(y) elsewhere, refers to a generic function ? ? M(Rd, B(Rd),m(dy);R)), and terminal condition vi(?,Xt?) at ?. Besides, one can show as in part (i) above that (Y t, Zt, V t) is an (?, Ft, Pt), (Bt, ?t) - solution to the stopped BSDE on [t, t + ?] with driver gis,Xts, v(s,Xts), z, Rd ?(y)fi(s,Xts, y)m(dy)ds ? ?(s,Xts)ds and terminal condition ?i(?,Xt?) at ?. We conclude as in part (i). 12 Uniqueness Issues In this section we consider the issue of uniqueness of a solution to (V2) and (V1), respectively.We prove a semi-continuous solutions comparison principle for these problems, which implies in particular uniqueness of P-solutions. For related comparison and uniqueness results we refer the reader to Alvarez and Tourin [1], Barles et al. [6, 9], Pardoux et al. [79], Pham [82], Harraj et al. [58], Amadori [2, 3] and Ma and Cvitanic [76], among others.
154 S. Crepey Assumption 8 (i) The functions b, ? and ? are locally Lipschitz continuous in (t, x, i), uniformly in y regarding ?; (ii) There exists, for every R > 0, a nonnegative function ?R continuous and null at 0 (modulus of continuity) such that |gi(t, x, u, z, r) ? gi(t, x, u, z, r)| ? ?R(|x ? x|(1 + |z|)) for any t ? [0, T ], i ? I, z ? R1?d, r ? R and x, x? Rd, u ? Rk with |x|, |x|, |u| ? R; (iii) The function gi is non-decreasing with respect to uj, for any (i, j) ? I2 with i = j. Note 15. (i) By Assumption 8(i), one has in particular |b| ? |?| ? |?| < C(1 + |x|) (209) on E. (ii) The monotonicity Assumption 8(iii) on g means that we deal with a cooperative system of PIDEs (see, for instance, Busca and Sirakov [29]). We are now in position to establish the following Theorem 6. One has ? ? ? on E, for any P-subsolution ? and P-supersolution ? of (V2) on E with terminal condition ? at T, respectively of (V1) on E with boundary condition u on ?D. As we first show, one can reduce attention, for the sake of establishing Theorem 6, to the special case where gi is non-decreasing with respect to uj for any (i, j) ? I2, rather than gi non-increasing with respect to uj for any (i, j) ? I2 with i = j in Assumption 8(iii). Note that gi being non-decreasing with respect to uj for any (i, j) ? I2 is in fact equivalent to g being non-increasing with respect to u as a whole, rather than gi non-increasing with respect to uj for any (i, j) ? I2 with i = j in Assumption 8(iii). Thus, Lemma 10. If Theorem 6 holds in the special case where gi is non-decreasing with respect to uj for any (i, j) ? I2, then Theorem 6 holds in general. Proof. This can be established by application of the special case to the transformed functions e?Rt?i(t, x) and e?Rt?i(t, x) for large enough R. Indeed, under the general assumptions of Theorem 6, e?Rt? and e?Rt? are respectively P-subsolution and P-supersolution of the following transformed problem, for (V2), max min ? G?i(t, x) ? e?Rtgi(t, x, eRt?(t, x), eRt(???)i(t, x), eRtI?i(t, x)) ? R?i(t, x), ?i(t, x) ? e?Rti(t, x), ?i(t, x) ? e?Rthi(t, x)= 0
About the Pricing Equations in Finance 155 on Int E, supplemented by the terminal condition ? = e?Rt? at T (and likewise with h = +? for (V1) on IntD, supplemented by the boundary condition ? = e?Rt? on ?D). Now, for R large enough, Assumption 8(iii) and the Lipschitz continuity property of g with respect to the last variable imply that e?Rtg(t, x, eRtu, eRtz, eRtr) + Rui is non-decreasing with respect to u. One thus concludes by an application of the assumed restricted version of Theorem 6. Given Lemma 10, one may and do reduce attention, in order to prove Theorem 6, to the case where the function g is non-decreasing with respect to u. The statement regarding (V2) in Theorem 6 is then obtained by letting ? go to 0 in part (iii) of the next lemma. The proof of the statement regarding (V1) in Theorem 6 would be analogous, substituting (V1) to (V2), +?to h, IntD to Int E and C0(E) ? C1,2(D) to C1,2(E) in Lemma 11 below and its proof. Let ?1 = k? where ? is the Lipschitz constant of g (cf. Assumption (M.1.ii) in Sect. 6.4). Lemma 11. Given a P-subsolution ? and a P-supersolution ? of (V2) on E, assuming g non-decreasing with respect to u : (i) ? = ? ? ? is a P-subsolution of min w,?G? ? ?1max j?I (?j)+ + |???| + (I?)+= 0 on E with null boundary condition at T, in the sense that: : ? ? 0 at T, and : ?i(t, x) > 0 implies ? G?i(t, x) ? ?1max j?I (?j(t, x))+ + |??i(t, x)?i(t, x)| + (I?i(t, x))+? 0 (210) for any (t, x, i) ? Int E and ? ? C1,2(E) such that ?i ? ?i reaches a global null maximum at (t, x). (ii) For every q1 > 0, there exists C1 > 0 such that the regular function ?i(t, x) = (1+|x|q1 )eC1(T?t) is a strict P-supersolution of min ?,?G? ? ?1? + |???| + (I?)+= 0 on E, in the sense that? > 0 and ? G? ? ?1? + |???| + (I?)+> 0 (211) on E.
156 S. Crepey (iii) For q1 in part (ii) greater than q2 such that ?, ? ? Pq2 , where q2 is provided by our assumption that ?, ? ? P, one has maxi?I (?i)+ ? ?? on [0, T ]? Rd, for any ? > 0. This lemma is an adaptation to our set-up of the analogous result in Barles et al. [9] (see also Pardoux et al. [79] and Harraj et al. [58]). Here are the main differences (our assumptions are fitted to financial applications, cf. Part I): : We consider a model with jumps in X and regimes represented by N, whereas [9] or [58] only consider jumps in X, and [79] only considers regimes; : We work with finite jump measures m, jump size ? with linear growth in x, and semi-continuous solutions with polynomial growth in x, whereas [9] or [58] consider general Levy measures, bounded jumps, and continuous solutions with sub-exponential (strictly including polynomial) growth in x; : [9] deals with classical BSDEs (without barriers); : We consider time-dependent coefficients b, ?, ? whereas [9] considers homogeneous dynamics. Because of these differences we provide a detailed proof in Appendix 18.1. To conclude this section we can state the following proposition, which sums-up the results of Theorems 5 and 6. Proposition 31. (i) The value function u is the unique P-solution, the maximal P-subsolution and the minimal P-supersolution of (V2) on E with terminal condition ? at T ; (ii) The value function v is the unique P-solution, the maximal P-subsolution, and the minimal P-supersolution of (V1) on E with boundary condition u on ?D. 13 Approximation An important feature of semi-continuous viscosity solutions comparison principles like Theorem 6 above is that they ensure the stability of the related PIDE problem, providing in particular generic conditions ensuring the convergence of a wide family of deterministic approximation schemes. These are the so called stability, monotonicity and consistency conditions originally introduced for PDEs by Barles and Souganidis [8]. See also Briani, La Chioma and Natalini [28], Cont and Voltchkova [36] or Jakobsen et al. [64] for various extensions of these results to PIDEs. The following results thus extend to models with regimes, thus systems of PIDEs, the results of [8, 28], among others. The following lemma is standard and elementary, and thus stated without proof. Lemma 12. Let (Eh)h>0 denote a family of rectangular time-space meshes of step h over E, the time mesh including in particular the maturity time T, for everyh > 0.
About the Pricing Equations in Finance 157 Let (uh)h>0 be a family of uniformly locally bounded real-valued functions with uh defined on the set Eh, for anyh > 0. (i) For any (t, x, i) ? E, the set of limits of the following kind: lim n>+?uihn(tn, xn) with hn > 0 and Ehn (tn, xn, i) > (t, x, i) as n>?, (212) is non empty and compact in R. It admits as such a smallest and a greatest element: ui(t, x) ? ui(t, x) in R. (ii) The function u, respectively u, defined in this way, is locally bounded and lower semi-continuous on E, respectively locally bounded and upper semi-continuous on E. We call it the lower limit, respectively upper limit, of (uh)h>0 at (t, x, i) as h > 0+. We say that uh converges to l at (t, x, i) ? E as h > 0, and we denote : lim h>0+ Eh(th,xh,i)>(t,x,i) uih(th, xh) = l , if and only if ui(t, x) = ui(t, x) = l, or, equivalently: lim n>+?uihn(tn, xn) = l for any hn > 0 et Ehn (tn, xn, i) > (t, x, i). (iii) If uh converges pointwise everywhere to a continuous function u on E, then this convergence is locally uniform:max Eh?C |uh ? u| >0 as h > 0+, for any compact subset C of E. Definition 13. Let us be given families of operators Gh = Ghui(th, xh) , ?h = ?hui(th, xh), Ih = Ihui(th, xh) devoted to approximate Gui(th, xh), ?ui(th, xh) and Iui(th, xh) on Eh for realvalued functions u on E, respectively. For L = ?, I or G, we say that: (i) The discretized operator Lh = ?h, Ih or Gh is monotone, if Lhui1(th, xh) ? Lhui2(th, xh) (213) for any functions u1 ? u2 on Eh with ui1(th, xh) = ui2(th, xh); (ii) The discretisation scheme (Lh)h>0 is consistent with L, if and only if for any continuous function ? on E of class C1,2 around (t, x, i), we have: Lh(? + ?h)i(th, xh) >L?i(t, x) (214) whenever h > 0+, Eh (th, xh, i) > (t, x, i) ? E and R ?h > 0 .
158 S. Crepey Moreover we also assume g to be monotone in the following sense. Assumption 9 The function Rk ? R1?d ? R (u, p, r) > g-(-, -, u, p?, r) ? RE (215) is non-decreasing, in the sense that for any (u, p, r) ? (u, p, r) coordinate by coordinate in Rk ? R1?d ? R, one has gi(t, x, u, p?i(t, x), r) ? gi(t, x, u, p?i(t, x), r) for any (t, x, i) ? E. Note 16. (i) The "abstract" monotonicity and consistency conditions of Definition 13 need to be verified carefully on a case-by-case basis for any concrete approximation scheme under consideration (e.g., finite difference schemes). We refer the reader to Cont and Voltchkova [36] (see also Jakobsen et al. [64]) for the complete analysis of specific schemes under various sets of assumptions. (ii) The monotonicity of g with respect to p, which is the most stringent condition in Assumption 9, is obviously satisfied in every of the following three cases: : The function g = gi(t, x, u, z, r) does not depend on the argument z, which is typically the case with risk-neutral pricing problems in finance (see Sect. 6.6); : ? is equal to zero, which corresponds to the situation of pure jump models; note however that our continuity Assumption 4 on ?t fails to be satisfied in this case for domains as simple as D = {|x| < R} ? I, ? being defined as in Example 3 (cf. Assumption 7(iii)); : The dimension d of the jump-diffusion component X of X is equal to one and ? is discretized by decentered forward finite differences, yielding an upwind discretization scheme for ???, by non-negativity of ? in the scalar case (see, for instance, Kushner and Dupuis [71]). (iii) Under the weaker assumption that gi(t, x, u, p?i(t, x), r) is non-decreasing with respect to (p, r) and non-decreasing with respect to uj for j = i, then, for R large enough, the mapping ui(t, x) > ui(t, x) := e?Rtui(t, x) transforms the problem into one in which Assumption 9 holds (see the proof of Lemma 10). Suitable approximation schemes may then be applied to the transformed problem, and a convergent approximation to the solution of the original problem is recovered by setting uih(t, x) := eRtuih(t, x). By (uh)h>0 uniformly polynomially bounded in part (a) of the following lemma, we mean that uh is bounded by C(1 + |x|q) for some C and q independent of h. Lemma 13. Let us be given monotone and consistent approximation schemes ( Gh)h>0, (?h)h>0 and (Ih)h>0 for G, ? and I respectively, g satisfying the monotonicity Assumption 9.
About the Pricing Equations in Finance 159 (a) Let (uh)h>0 be uniformly polynomially bounded and satisfy max min ? Ghuhi(th, xh) ? gi(th, xh, uh(th, xh), (?huh?)i(th, xh), ?Ihuih(th, xh)), (216) uih(th, xh) ? i(th, xh), uih(th, xh) ? hi(th, xh)= 0 (217) on IntE ?Eh and uh = ? on ?E ?Eh for anyh > 0. Then: (i) The upper and lower limits u and u of uh as h > 0, are respectively viscosity subsolutions and supersolutions of (V2) on Int E; (ii) One has u ? ? ? u pointwise at T. (b) Let (vh)h>0 be uniformly polynomially bounded and satisfy min ? Ghvih(th, xh) ? gi(th, xh, vh(th, xh), (?hvh?)i(th, xh), ?Ihvih(th, xh)), (218) vih(th, xh) ? i(th, xh)= 0 (219) on IntD ?Eh and vh = u on ?D ?Eh for anyh > 0. Then: (i) The upper and lower limits v and v of vh as h > 0, are respectively viscosity subsolutions and supersolutions of (V1) on IntD; (ii) One has v ? u(= ?) ? v pointwise at T. Proof. We only prove (a), since the proof of (b) is similar (cf. the comments preceding Lemma 11). Note that one only has v ? u ? v at T in (b), and not necessarily v ? u ? v on ?D; see comments in part (ii) below. (i) We prove that u is a viscosity subsolution of (V2) on Int E. The fact that u is a viscosity supersolution of (V2) on Int E can be shown likewise. First note that u ? h, by (216) on IntE ? Eh, inequality ? ? h at T (cf. Assumption (M.2.ii) in Sect. 6.4) and continuity of h and ?. Let then (t, x, i) ? Int E be such that ui(t, x) > i(t, x) and (t, x) maximizes strictly ui ? ?i at zero for some function ? ? C1,2(E). We need to show that (cf. (192)): ? G?i(t, x) ? gi t, x, u(t, x), (???)i(t, x), I?i(t, x)? 0. (220) By a classical argument in the theory of viscosity solutions (see, e.g., Barles and Souganidis [8]), there exists, for anyh > 0, a point (t, x) in [0, T ]? ?BR, where ?BR is a ball with large radius R around x, such that (we omit the dependence of t, x in h for notational simplicity):uih ? ?i + (uh ? ?)i(t, x) (221) with equality at (t, x), and ?h := (uh ? ?)i(t, x) goes to 0 = (u ? ?)i(t, x), whence uih(t, x) goes to ui(t, x), as h > 0 (cf. an analogous statement and its justification in the second part of the proof of part (ii) below). Therefore
160 S. Crepey ui(t, x) > i(t, x) implies that uih(t, x) > i(t, x) for h small enough, whence by (216): ? Ghuih(t, x) ? gi(t, x, uh(t, x), (?huh?)i(t, x), Ihuih(t, x)) ? 0. (222) Given (221), one thus has by monotonicity of the scheme and of g (Assumption 9): ? Gh(? + ?h)i(t, x)?gi t, x, uh(t, x), (?h(? + ?h)?)i(t, x), Ih(? + ?h)i(t, x)? gi t, x, u(t, x), (???)i(t, x), I?i(t, x)+ ?(|t ? t|) + ?R(|x ? x|(1 + |(???)i(t, x)|)) + ?1 max j?I (ujh(t, x) ? uj(t, x))+ + ?|(?h(? + ?h)?)i(t, x) ? (???)i(t, x)| + ?(Ih(? + ?h)i(t, x) ? I?i(t, x))+, where in the last inequality (cf. the proof of Lemma 11(i) in Appendix 18.1): : ? is a modulus of continuity of gi on a "large" compact set around (t, x, u(t, x), (???)i(t, x), I?i(t, x)), ?1 stands for k?, and ?R is the modulus of continuity standing in Assumption 8(ii); : The three last terms come from the Lipschitz continuity and monotonicity properties of g. Inequality (220) follows by sending h to zero in the previous inequality, using the consistency (214) of the scheme. (ii) Let us show further that u and u satisfy the boundary condition in the so-called weak viscosity sense at T, namely in the case of u (the related statement and proof are similar in the case of u): Inequality (220) holds for any (t= T, x, i) and ? ? C1,2(E) such that ui(t, x) > i(t, x) ? ?i(t?, x?) (223) and (t, x) maximizes globally and strictly ui ? ?i at zero. As in part (i), there exists, for anyh > 0, a point (t, x) in [0, T ] ? ?BR (we omit the dependence of t, x in h for notational simplicity), where ?BR is a ball with large radius R around x, such that inequality (221) holds with equality at (t, x), and ?h = (uh ? ?)i(t, x), whence uih(t, x) ? ui(t, x), goes to zero as h > 0. Therefore inequality (223) implies that uih(t, x) > i(t, x) ? ?i(t, x) for h small enough, whence (t, x, i) ? Int E and by (216): ? Ghuih(t, x) ? gi(t, x, uh(t, x), (?huh?)i(t, x), Ihuih(t, x)) ? 0 . (224) Inequality (220) follows like in part (i) above.
About the Pricing Equations in Finance 161 Now (note that the following argument only works at T and cannot be adapted to the case of problem (V1) on the whole of ?D, cf. comment at the beginning of the proof), by a classical argument in the theory of viscosity solutions (see Alvarez and Tourin [1, bottom of page 303] or Amadori [2, 3]), any viscosity subsolution or supersolution of (V2) on Int E satisfying the boundary condition in the weak viscosity sense at T, satisfies it pointwise at T. So, in our case, suppose for instance by contradiction that ui(T, x) > ?i(T, x?) (225) for some x? Rd. Let us then introduce the function ?i?(t, x) = ui(t, x) ? |x? ? x|2 ? ? C?(T ? t) (226) in whichC? > sup (t,x)?[t??,T]??B1(x?) (227) G |y ? x?|2 ? i (t, x) + gi t, x, u(t, x),2(y ? x?)? ? i (t, x), I |y ? x?|2 ? i (t, x)goes to?as ? > 0, where ?B1(x?) denotes the closed unit ball centered at x? in Rd. There exists, for any? > 0, a point (t, x) in [0, T ]? ?BR (we omit the dependence of (t, x) in ? for notational simplicity), where ?BR is a ball with large radius R around x, such that: : For any ? > 0 the related point (t, x) maximizes ?i? over [0, T ] ? ?BR, : (t, x) > (T, x) and ui(t, x) > ui(T, x) as ? > 0 . To justify the last point, note that by the maximizing property of (t, x) one has that ?i?(T, x) ? ?i?(t, x) whence in particular (cf. (226)) 0 ? |x? ? x|2 ? + C?(T ? t) ? ui(t, x) ? ui(T, x) (228) so ui(T, x) ? ui(t, x). (229)
162 S. Crepey Since u is locally bounded, (228) implies that (t, x) > (T, x) as ? > 0 , which, joint to the upper semi-continuity of u and to (229), implies that ui(t, x) > ui(T, x) as ? > 0 . Now one has ? ? pointwise at T, therefore (225) joint to the fact that lim?>0 ui(t, x) = ui(T, x) imply that ui(t, x) > i(t, x), for ? small enough. In virtue of the results already established at this point of the proof, the function (s, y) > |x??y|2 ? + C?(T ? s) thus satisfies the related viscosity subsolution inequality at (t, x, i), so C? ? G |y ? x?|2 ? i (t, x) ? gi t, x, u(t, x),2(y ? x?)? ? i (t, x), I |y ? x?|2 ? i (t, x)? 0, which for ? small enough contradicts (227). Proposition 32. Let (uh)h>0, resp. (v)h>0, denote a stable, monotone and consistent approximation scheme, in the sense that all conditions in Lemma 13(a), resp. (b), are satisfied for the value function u, resp. v. Then: (a) uh > u locally uniformly on E as h > 0. (b) vh > v locally uniformly on E as h > 0, provided vh > v(= u) on ?D ?{t < T}. Proof. (a) By Lemma 13(a), the upper and lower limits u and u are P-subsolutions and P-supersolutions of (V2) on E. So u ? u, by Theorem 6. Moreover u ? u by Lemma 12(i). Thus finally u = u, which implies that uh > u locally uniformly on E as h > 0, by Lemma 12(iii). (b) By Lemma 13(b)(i), v and v are respectively viscosity subsolutions and supersolutions of (V1) on IntD. Moreover, they satisfy v ? u ? v at T, by Lemma 13(b)(ii). If, in addition, vh > v(= u) on ?D ?{s < T}, then v ? u ? v on ?D, and v and v are P-subsolutions and P-supersolutions of (V1) on E. We conclude like in part (a). Remark 26. The convergence result regarding v in Proposition 32(b) can only be considered as a partial result, since one only gets the convergence on E conditionally on the convergence on ?D ?{t < T}, for which no explicit criterion is given. Moreover the related approximation scheme vh is written under the working assumption that the true value for u is plugged on ?D in the approximation scheme for v (cf. the boundary condition "vh = u on ?D ?Dh" in Lemma 13(b)).
About the Pricing Equations in Finance 163 Part IV Further Applications In this part we provide various extensions to the BSDE and PDE results of Parts II and III which are needed for dealing with practical issues like discrete dividends or discrete path-dependence in the context of pricing problems in finance. Let us thus be given a set T = {T0, T1 . . . , Tm} of fixed times with 0 = T0 < T1 < - - - < Tm?1 < Tm = T, representing in the financial interpretation discrete dividends dates, or monitoring dates in the case of discretely path-dependent payoffs.We set, for l = 1, . . .,m, El = [Tl?1, Tl] ? Rd ? I , Dl = [Tl?1, Tl] ? D and we define Int El, ?El, IntDl and IntD as the parabolic interiors and boundaries of El and Dl as of (187). Note that the sets Int Els and ?E = {T} ? Rd ? I, partition E. Discrete dividends on a financial derivative or on an underlying asset (component of the factor process X) motivate separate developments presented in Sects. 14 and 15, respectively. Sect. 16 deals with the issue of discretely monitored call protection (discretely monitored and intermittent call protection, as opposed to call protection before a stopping time earlier in this article). 14 Time-Discontinuous Running Cost Function Many derivative payoffs, like for instance convertible bonds (see Sect. 4.2.1), entail discrete coupon tenors, that is, coupons paid at specific coupon dates Tls, rather than theoretical coupon streams that would be paid in continuous-time. Now, discrete coupons imply predictable jumps, by the coupon amounts, of the related financial derivatives arbitrage price processes at the Tls. But all the BSDEs introduced in this paper have time-differentiable driver coefficients (the place for dividends in the case of pricing equations, see Part I), and the state-process Y of the solution to a BSDE, which is intended to represent the price process of a financial derivative, can only jump at totally unpredictable stopping times. One might thus think that pricing problems with discrete coupons are not amenable to the methods of this paper. However, as demonstrated in [18-20,23], this apparent difficulty can be handled by working with a suitable notion of clean (instead of ex-dividend) price process for a financial derivative. Here clean price means (ex-dividend) price less accrued interest at time t, a notion of price commonly used by market practitioners. This simple transformation allows one to restore the continuity in time (but for totally unpredictable jumps) of the price processes. Yet an aside of this transformation is that the resulting running cost function g is not continuous anymore, but presents left-discontinuities in time at the Tls. This motivates an extension of the results of this paper to the case of a running cost
164 S. Crepey function g defined by concatenation on the Int Els of functions gls satisfying our usual assumptions relatively to the Els. Definition 12 for viscosity solutions of (V2) and (V1) then needs to be amended as follows. Definition 14. (i) A locally bounded upper semi-continuous, resp. lower semicontinuous, resp. resp. continuous, function u on E, is called a viscosity subsolution, resp. supersolution, resp. resp. solution, of (V2) at (t, x, i) ? Int E, if and only if the restriction of u to El with (t, x, i) ? Int El is a viscosity subsolution, resp. supersolution, resp. resp. solution, of (V2) at (t, x, i), relatively to El (cf. Definition 12(a)). (ii) A P - viscosity subsolution, resp. supersolution, resp. resp. solution u to (V2) on E for the boundary condition ? at T is formally defined as in Definition 12(b), with the embedded notions of viscosity subsolution, resp. supersolution, resp. resp. solution, of (V2) at any (t, x, i) in Int E defined as in (i) above. (iii) The notions of viscosity subsolutions, supersolutions and solutions of (V1) at (t, x, i) ? IntD, and, given a further continuous boundary condition ? on ?D such that ? = ? at T, those of P - viscosity subsolutions, supersolutions and solutions of (V1) on E, are defined similarly (cf. Definition 12(c)). Proposition 33. Using Definition 14 for the involved notions of viscosity solutions, all the results of this paper still hold true under the currently relaxed assumption on g. Proof. In Part II, the continuity of g was used first, to ensure well-definedness of the process g(s,Xt s, Y t s , Zts, Vts) (cf. (119)) for any (Y t, Zt, Vt) ? S2 ? H2d? H2?t , and second, for the stability results of Propositions 25(ii) and 27(ii). But it can be checked by inspection of the related proofs that these stability results are still true under the currently relaxed assumption on g. Moreover the process g(s,Xt s, Y t s , Zts, Vts) is obviously still well-defined under the current assumption on g, for any (Y t, Zt, Vt) ? S2 ?H2d?H2?t . In Part III, Theorem 5 still holds true, by immediate inspection of its proof. Moreover, under an "l by l" version of Assumption 8(ii) on the gls, Lemma 11 and Theorem 6 (hence Proposition 31 also follows) can be proven together iteratively on l as we now show. Let thus ? and ? denote a P-subsolution and a P-supersolution v of (V2) on E (the proof would be analogous for (V1)). Lemma 11 relative to Em is proven in exactly the same way as before. We thus have (cf. Theorem 6) ? ? ? on Em. One can then establish likewise the version of Lemma 11 relative to Em?1 (note that ? ? ? ? 0 on ?Em?1, by the first step of the proof). So ? ? ? on Em?1, and so on until l = 1. Lemma 12 is of course not affected by the relaxation of the assumption on g. Finally, given Definition 14, Lemma 13(a)(i) can be proven exactly as before, on each Int El, and the proof of Lemma 13(a)(ii) does not change. Lemma 13(a) is thus still true, and so is likewise Lemma 13(b), hence Proposition 32 holds as before. 
About the Pricing Equations in Finance 165 15 Deterministic Jumps in X 15.1 Deterministic Jumps in X After having considered dividends on a financial derivative with factor process X in Sect. 14, we now want to deal with pricing problems involving discrete dividends at times Tls on a primary asset, specifically given as a component of X in our generic factor process X = (X,N), underlying a financial derivative. Note that our basic model X cannot jump at the Tls, since the jump times of the driving random measures ? and ? are totally inaccessible. We thus enrich our model X by the introduction of deterministic jumps in X at the Tls (instead of discontinuities in the running cost function g in Sect. 14), specifically, XTl = ?l(XTl?), where the jump function ? is given as a system of Lipschitz functions y > ?jl (y) from Rd into itself, for every i ? I and l = 1, . . .,m. Definition 15. (i) A Cauchy cascade ?, ? on E is a pair made of a terminal condition ? of class P at T, along with a sequence ? = (ul)1?l?m of functions uls of class P on the Els, satisfying the following jump condition on Rd ? I, for every l = 1, . . .,m: uil(Tl, x) = uil+1(Tl, ?il (x)) (230) where, in case l = m, uil+1 is to be understood as ? in the right-hand-side of (230). A continuous Cauchy cascade is a Cauchy cascade with continuous ingredients ?, uls; (ii) The function defined by a Cauchy cascade ?, ? is the function u on E given as the concatenation on the Int Els of the uls, along with the terminal condition ? at T. The formal analogue of Definition 11 for a Markovian solution to the Markovian decoupled forward backward stochastic differential equation with data G (including here the jumps defined by ? in X), C and ? may then be formulated, where : : A "model X with generator G" in Definition 11(a) is to be understood here in the sense that for every l = 1, . . .,m with t ? Tl, - Xt obeys the dynamics (152) on the time interval [Tl?1 ? t, Tl), - XtTl = ?l(XtTl?) and NtTl = NtTl?, where the superscript t refers as usual to a constant initial condition (t, x, i) for X, so Xt t = (x, i); : In Definition 11(b): - The deterministic value function u in Definition 11(b)(i) is no longer continuous on E, but defined by a continuous Cauchy cascade ?, (ul)1?l?m; - The deterministic value function v in Definition 11(b)(ii) is defined likewise by a continuous Cauchy cascade ?, (vl)1?l?m.
166 S. Crepey One assumes in this section that the lower and upper cost functions and h are not continuous on E, but are defined by continuous Cauchy cascades ?, (l)1?l?m and ?, (hl)1?l?m such that l ? hl for every l = 1, . . . , m, and ? ? ? ? ?, whence in particular im(T, x) = ?i(T, ?im(x)) ? ?i(T, ?im(x)) ? ?i(T, ?im(x)) = him(T, x). (231) Note that (s,Xt s ) and h(s,Xt s ) are then quasi-left continuous processes satisfying our standing assumption (H.2) in Sect. 5.1, as should be in view of application of general reflected BSDE results (see, e.g., [38]). Suitable semi-group properties analogous to Propositions 26 and 28 in Part II, and existence of a Markovian solution in the above sense to the Markovian decoupled forward backward SDE with data G, C and ? (cf. Theorems 3, 4 and Proposition 30 in Part II), can then be established like in Part II (see also Theorem 11 in Part IV below). Remark 27. The fact that the value functions u and v are defined by continuous Cauchy cascades can be established much like Theorem 11 below (see also Chassagneux and Crepey [31]). Since the proof is simpler here, we do not provide it, referring the reader to the proof of Theorem 11 for similar arguments in a more complex situation. The next step consists in deriving analytic characterizations of the value functions u and v in terms of viscosity solutions to related obstacles partial integro-differential problems. Reasoning as in Part III (cf. the proof of Proposition 33 for a review of the main arguments), one can thus show, Proposition 34. Under the currently extended model dynamics for X (with deterministic jumps in X as specified by ?): (i) All the results of Part II still hold true, using the previously amended notions of solutions to the related FBSDEs; (ii) For every l = 1, . . .,m, : ul is the unique P-solution, the maximal P-subsolution and the minimal P-supersolution of (V2) on El with terminal condition uil+1(Tl, ?il (x)) on ?El - with ul+1 in the sense of ?, in case l = m, : vl is the unique P-solution, the maximal P-subsolution and the minimal P-supersolution of (V1) on El with boundary condition ul on ?Dl. Part (ii) of this Proposition is thus the generalization to the present set-up of Proposition 31 in Part III. As for the approximation arguments of Sect. 13, they can only be used in the present set-up for establishing that, for l decreasing frommto 1: : ul,h > ul locally uniformly on El as h > 0, under the working assumption that the true value for uil(Tl, x) = uil+1(Tl, ?il (x)) is plugged at Tl in the approximation scheme for ul;
About the Pricing Equations in Finance 167 : vl,h > vl locally uniformly on El as h > 0, under the working assumption that the true value for ul is plugged on ?Dl in the approximation scheme for vl, and provided vl,h > vl(= ul) on ?Dl ? {t < Tl}. Of course, in practice (cf. also Remark 26): : ul is only approximately known at Tl (except for l = m) when it comes to approximating ul on El, using the already computed function ul+1,h at Tl as input data; : vl is only approximately known on ?Dl when it comes to approximating vl on El, using the already computed function ul,h on ?Dl as input data. There is thus clearly room for improvement in these approximation results. 15.2 Case of a Marker Process N We motivated the introduction of deterministic jumps in the factor process X in Sect. 15.1 by its use in modeling discrete dividends on a primary asset underlying a financial derivative, the primary asset being given as one of the components of X in our generic factor process X = (X,N). Still in the context of pricing problems in finance, there is another important motivation for introducing deterministic jumps in the factor process X, related to the issue of extension of the state space when dealing with discretely path-dependent financial derivatives. To make it as simple as possible, let us thus consider an European option with payoff ?(ST0, ST1, . . . , STm) at maturity time Tm = T, where S represents an underlying stock price process. Such payoffs are for instance found in cliquet options, volatility and variance swaps, or discretely monitored Asian options. As is well known, these can often be efficiently priced by PDE methods after an appropriate extension of the state space.We refer the reader toWindcliff et al. [86, 87] for illustrations in the cases of cliquet options and volatility and variance swaps, respectively. Provided one works with a suitably extended state space, the methods and results of the present paper are applicable to such forms of path-dependence, with all the consequences in terms of pricing and hedging developed in Part I. Let us thus assume S to be given as a standard jump-diffusion, to fix ideas. A first possibility would be to introduce the extended factor process Xt = (St, S0t , . . . , Sm?1 t ), where the auxiliary factor processes Sls are equal to 0 before Tl and to STl on [Tl, T ]. Since this extended factor process X exhibits deterministic jumps at times Tls, we are in the set-up of Sect. 15.1 (case of a degenerate model X = (X,N) = X therein), which provides a second motivation for the developments of Sect. 15.1. But this state space extension is not the only possible one. Exploiting the specific nature of the payoff function ?, more parsimonious alternatives in state spaces like Rd for somed < m rather then Rm above can often be found (see, e.g., Windcliff et al. [86, 87]). An extreme situation in this regard is the one where it is enough to know whether the values of S at the Tls are above or below some trigger levels, so that it is enough
168 S. Crepey to extend the factor process into Xt = (Xt,Nt), where Xt = St and where the marker process Nt represents a vector of indicator processes with deterministic jumps at the Tls. By deterministic jumps here we mean jumps given by deterministic functions of the STl s. One would thus like to be able to address the issue of a discretely monitored call protection ?, like for instance (cf. Examples 2 and 5), Example 4. Given a constant trigger level ? S and an integer ?, (i) Call possible from the first time ? that S has been ? ? S at the last ? monitoring times, Call protection before ?, Or more generally, given a further integer j ? ?, (ii) Call possible from the first time ? that S has been ? ? S on at least ? of the last j monitoring times, Call protection before ?. As we shall see as an aside of the results of Sect. 16 (cf. Sect. 16.3.5), it is actually possible to deal with such forms of path-dependence, resorting to a "degenerate variant" X = (X,N) of the general jump-diffusion with regimes of this paper, in which X is a Markovian jump-diffusion not depending on N, and where the I-valued pure jump marker process N is constant except for deterministic jumps at the Tls, from NtTl? to NtTl = ?l(XtTl?), (232) for a suitable jump function ?. Note 17. In this set-up: (i) In the notation of Sect. 7.1, F?t is embedded into FXt which is itself embedded into FBt ? F?t . Therefore Ft = FBt ? F?t ? F?t = FBt ? F?t , where (FBt ? F?t , Pt;Bt, ?t) has the local martingale predictable representation property (same proof as Proposition 23(ii)). As a consequence, there are no ?t - martingale components in any of the related forward or backward SDEs. (ii) Since X does not depend on N, the error estimate (137) on X and the estimates on Y in Proposition 25 are valid, independently of the error estimate (136) on N. Incidentally note that (136) does not hold anymore, since N now depends on X via (232), even under the original measure P (before the change of measure to Pt). 15.3 General Case The situations of Sects. 15.1 and 15.2 are both special cases, coveringmany practical pricing applications, of deterministic jumps of the factor process X at fixed times Tls. The general case of deterministic jumps of X from XTl? to XTl = ?l(XTl?) at the Tls, for a suitable function ?, seems difficult to deal with. Indeed, as soon as N depends on X via its jumps at the Tls:
About the Pricing Equations in Finance 169 : First, the error estimate (136) on N is not valid anymore. The error estimate (137) on X and the continuity results on Y and Y in Propositions 25(ii) and 27(ii), which all relied on (136), are therefore not available either (at least, not by the same arguments as before), unless we are in the special case of Sect. 15.2 where X does not depend on N; : Second, the martingale representation property of Proposition 23(ii) under the original measure P, which was used to derive the martingale representation property under the equivalent measure Pt at Proposition 24(ii), becomes subject to caution, inasmuch as N and B are not independent anymore (not even under the original measure P), unless we are in the special case of Sect. 15.2 where Ft = FBt ? F?t . 16 Intermittent Upper Barrier 16.1 Financial Motivation A more general form of call protection than those considered earlier in Parts II and III consists in "intermittent" (or "Bermudan") call protection. In the financial set-up of Part I, this involves considering generalized upper payoff processes of the form ?Ut = ?ct?+ ?tUt (233) for given cadlag event-indicator10 processes ?t,?ct = 1 ? ?t, rather than more specifically (cf. (107)) ?Ut = 1{t<?}?+ 1{t??}Ut (234) for a stopping time ?. Let a non-decreasing sequence of [0, T ]-valued stopping times ?ls be given, with ?0 = 0and ?l = T for l large enough, almost surely.We assume that a call protection is active at time 0, and that every subsequent time ?l is a time of switching between call protection and no protection. Thus, for t ? [0, T ], ?t = 1{lt odd}, (235) where lt is the index l of the random time interval [Tl, Tl+1) containing t. Remark 28. Considering sequences ? such that ?0 = ?1 = 0 and ?2 > 0 almost surely, observe that this formalism includes the case where the protection is inactive on the first non-empty time interval. 10 Boolean-valued.
170 S. Crepey In the special case of a doubly reflected BSDE of the form (15) with a generalized effective call payoff process ?Uas of (233), (235) therein, the identification between the arbitrage or infimal super-hedging price process of the related financial derivative and the state-process Y = ? of a solution, assumed to exist, to (15), can be established by a straightforward adaptation of the arguments developed in Part I (see Sect. 16.2.1). Remark 29. We shall see shortly that in the present set-up the possibility of jumps from finite to infinite values in ?Uleads to relax the continuity condition on the process K in the Definition 4 of a solution to a reflected BSDE (see Definition 16 below). This is why one is led to a notion of infimal (rather than minimal) superhedging price in the financial interpretation. See Bielecki et al. [23, Long Preprint Version] or Chassagneux et al. or [31] for more about this. However doubly reflected BSDEs with a generalized upper barrier as of (233), (235) are not handled in the literature. This section aims at filling this gap by showing that such BSDEs are well-posed under suitable assumptions, and by establishing the related analytic approach in the Markovian case. To start with, the results of Sect. 16.2 extend to more general RIBSDEs (see Definition 16 and Remark 17) the abstract RDBSDE results of Crepey and Matoussi [38]: general well-posedness (in the sense of existence, uniqueness and a priori estimates) and comparison results. In order to recover the results of [38], simply consider in Sect. 16.2 the special case of a non-decreasing sequence of stopping time ? = (?l)l?0 such that ?2 = T almost surely, so ?l = ?2 = T for l ? 2. Also note that the component K of the solution is continuous in case of an RDBSDE. We then deal with the Markovian case in Sect. 16.3. 16.2 General Set-Up In this section one works in the general set-up and under the assumptions of Sect. 5. Let us further be given a non-decreasing sequence ? = (?l)l?0 of [0, T ]-valued predictable stopping times ?ls, with ?0 = 0 and ?l = T for l large enough, almost surely. The RIBSDE with data (g, ?,L,U, ?), where the "I" in RIBSDE stands for "intermittent," is the generalization of an R2BSDE in which the upper barrier U is only active on the "odd" random time intervals [?2l+1, ?2l+2). Essentially, we replace U by ?Uin Definition 8(a)(iii), with for t ? [0, T ], ?Ut = 1{lt even}?+ 1{lt odd}Ut (236) where lt is defined by ?lt ? t < ?lt+1. However this generalization leads to relax the continuity assumption on K in the solution. Let thus A2 stand for the space of finite variation but not necessarily continuous processes K vanishing at time 0, with (possibly discontinuous) Jordan components denoted as usual by K.
About the Pricing Equations in Finance 171 Definition 16. An (?, F, P), (B, ?)-solution Y to the RIBSDE with data (g, ?,L, U, ?) is a quadruple Y = (Y,Z, V,K), such that: (i) Y ? S2, Z ? H2d, V ? H2?,K ? A2, (ii) Yt = ? + T t gs(Ys, Zs, Vs)ds + KT ? Kt ? T t ZsdBs ? T t E Vs(e)?(ds, de) , t ? [0, T ] , (iii) L ? Y on [0, T ] , Y ? ?Uon [0, T ] and T 0 (Yt? ? Lt?)dK+t = T 0 (?Ut? ? Yt?)dK?t = 0, where ?Uis defined by (236), and with the convention that 0??= 0 in (iii). Remark 30. In the special case where ?2 = T a.s. (so ?l = ?2 = T for l ? 2), the RIBSDE with data (g, ?,L,U, ?) reduces to the RDBSDE with data (g, ?,L,U, ?1) (see Definition 9(ii)). If moreover ?1 = 0, one then deals with an R2BSDE. 16.2.1 Verification Principle Given t ? [0, T ], let Tt denote the set of [t, T ]-valued stopping times. The following Verification Principle, stated without proof, is an easy generalization of Proposition 18 in Part II. From the point of view of the financial application, this result can be used to establish the abovementioned connection between the arbitrage price process of a game option with call protection ? and the state-process Y of a solution, assumed to exist, to the related RIBSDE (see Remark 29). Proposition 35. If Y = (Y,Z, V,K) solves the RIBSDE with data (g, ?,L,U, ?), then the state process Y is the conditional value process of the Dynkin game with payoff functional given by, for any t ? [0, T ] and ?, ? ? Tt, Jt(?, ?) = ??? t gs(Ys, Zs, Vs)ds + L?1{???=?<T} + ?U?1{?<?} + ?1[???=T] . More precisely, for every? > 0, an ? - saddle-point of the game at time t is given by: ??t= infs ? [t, T ] ; Ys ? ?Uu ? ?? T , ?? t = infs ? [t, T ] ; Ys ? Lu + ?? T . So, for any ?, ? ? ?Tt, E!Jt(?, ?)Ft" ? ? ? Yt ? E!Jt(?, ?)Ft" + ?. (237)
172 S. Crepey Of course, given the definition of ?Uin (236), this Dynkin game effectively reduces to a "constrained Dynkin game" with upper payoff process U (instead of ?Uin Proposition 35),posed over the constrained set of stopping policies (?, ?) ? ? Tt ?Tt, where ? Tt denotes the set of the ?l?0[?2l+1 ? t, ?2l+2 ? t) ? {T } - valued stopping times. In particular, ??t= infs ? ?l?0[?2l+1 ? t, ?2l+2 ? t) ; Ys ? Uu ? ?? T. 16.2.2 A Priori Estimates and Uniqueness Recall that a quasimartingale L is a difference of two non-negative supermartingales. The following classical results about quasimartingales can be found, for instance, in Dellacherie and Meyer [43] (see also Protter [84]). Lemma 14. (i) (See Sect.VI.40 of [43]) Among the decompositions of a quasimartingale X as a difference of two non-negative supermartingales X1 and X2, there exists a unique decomposition X = ?X1 ? ?X2, called the Rao decomposition of X, which is minimal in the sense that X1 ? ?X1, X2 ? ?X2, for any such decomposition X = X1 ? X2. (ii) (See Appendix 2.4 of [43]) Any quasimartingaleX belonging to S2 is a special semimartingale with canonical decomposition Xt = X0 +Mt + At , t ? [0, T] (238) for a uniformly integrable martingale M and a predictable process of integrable variation A. The following estimates are immediate extensions to RIBSDEs of the analogous results which were established for R2BSDEs and RDBSDEs in [38]. Theorem 7. We consider a sequence of RIBSDEs with data and solutions indexed by n, but for a common sequence ? of stopping times, with lower barriers Ln given as quasimartingales in S2, and with predictable finite variation components denoted by An (cf. (238)). The data are assumed to be bounded in the sense that the driver coefficients gn = gnt (y, z, v) are uniformly ? - Lipschitz continuous in (y, z, v), and one has for some constant c1: ?n22+ gn- (0, 0, 0)2H2 + Ln2S2 + Un2S2 + An,?2S2 ? c1. (239) Then one has for some constant c(?): Y n2S2 + Zn2H2d + V n2H2? + Kn,+2S2 + Kn,?2S2 ? c(?)c1. (240)
About the Pricing Equations in Finance 173 Indexing by n,p the differences -n ? -p, one also has: Y n,p2S2 + Zn,p2H2d + V n,p2H2? + Kn,p2S2 ? c(?)c1?n,p22+ gn,p - (Y n - , Zn- , V n - )2H2 + Ln,pS2 + Un,pS2. (241) Assume further dAn,? ? ?ntdt for some progressively measurable processes ?n with ?nH2 finite for every n ? N. Then one may replace Ln2S2 and Ln,pS2 by Ln2H2 and Ln,pH2 in (239) and (241). Suppose additionally that ?nH2 is bounded over N and that when n>?: : gn- (Y-, Z-, V-) converges in H2 to g-(Y-, Z-, V-) locally uniformly w.r.t. (Y,Z, V ) ? S2 ?H2d?H2?, and : (?n, Ln, Un) converges in L2 ?H2 ?S2 to (?,L,U). Then (Y n, Zn, V n,Kn) converges in S2 ? H2d? H2?? S2 to a solution (Y,Z, V,K) of the limiting RIBSDE with data (g, ?,L,U, ?). Moreover, (Y,Z, V,K) also satisfies (240)-(241) "with n = ?" therein. Moreover, in the special case Ln,p = Un,p = 0, one has like for R2BSDEs that estimate (241) holds with Ln,p = Un,p = 0 therein (cf. Appendix A of [38]), irrespectively of the specific assumptions on the Lns in Theorem 7. In particular, Proposition 36. Uniqueness holds for an RIBSDE satisfying the standing assumptions (H.0)-(H.2). 16.2.3 Comparison In this section we specialize the general assumption (H.1) in Sect. 5.1 to the case where (cf. Sect. 4 of [38]) gt(y, z, v) = gty, z, E v(e)?t(e)?t(e) ?(de), (242) for a P-measurable non-negative function ?t(e) with |?t|t uniformly bounded, and a P?B(R)?B(R1?d)?B(R)-measurable function g : ??[0, T ]?R?R1?d?R > R such that: (H.1.i)' g-(y, z, r) is a progressively measurable process, for any y ? R, z ? R1?d, r ? R; (H.1.ii)' g-(0, 0, 0)H2 < +?; (H.1.iii)' |gt(y, z, r) ? gt(y, z, r)| ? ?|y ? y| + |z ? z| + |r ? r|, for any t ? [0, T ], y,y? R, z,z ? R1?d and r, r? R; (H.1.iv)' r > gt(y, z, r) is non-decreasing, for any (t, y, z) ? [0, T ] ? R ? R1?d . Using in particular the fact that E(v(e) ? v(e))?t(e)?t(e) ?(de)? |v ? v|t|?t| with |?t|t uniformly bounded, so g defined by (242) satisfies (H.1).
174 S. Crepey The following RIBSDE comparison result is then an easy generalization of the R2BSDE comparison result of Crepey and Matoussi [38]. Theorem 8. Let (Y,Z, V,K) and (Y , Z, V ,K) be solutions to the RIBSDEs with data (g, ?,L,U, ?) and (g, ?, L, U, ?) satisfying assumptions (H.0)-(H.2). We assume further that g satisfies (H.1)'. Then Y ? Y , dP ? dt - almost everywhere, whenever: (i) ? ? ?, P - almost surely, (ii) g-(Y - , Z-, V - ) ? g-(Y - , Z-, V - ), dP ? dt - almost everywhere, (iii) L ? Land ?U? ?U, dP?dt - almost everywhere, where ?Uis defined by (236) and ?Uis the analogous process relative to ?. Remark 31. The inequality ?U? ?Uwhich is assumed in part (iii) implies in particular that (?2l, ?2l+1) ? (?2l, ?2l+1), l ? 0. 16.2.4 Existence We work here under the following square integrable martingale predictable representation assumption: (H) Every square integrable martingaleM admits a representation Mt = M0 + t 0 Zs dBs + t 0 E Vs(e)?(ds, de), t ? [0, T ] (243) for some Z ? H2dand V ? H2?. We also strengthen Assumption (H.2.i) into: (H.2.i)L and U are cadlag quasi-left continuous processes in S2. Recall that for a cadlag process X, quasi-left continuity is equivalent to the existence of sequence of totally inaccessible stopping times which exhausts the jumps of X, whence pX = X-? (see, e.g., Jacod-Shiryaev [62, Propositions I.2.26, p. 22 and I.2.35, p. 25]).We thus work in this section under assumptions (H) and (H.0)-(H.2)', where (H.2)' denotes (H.2) with (H.2.i) replaced by (H.2.i)' therein. Finally we postulate the so-called Mokobodski condition (see [38]), namely the existence of a quasimartingale X with Rao components in S2 and such that L ? X ? U over [0, T ]. In view of Lemma 14, This is tantamount to the existence of non-negative supermartingales X1,X2 belonging to S2 and such that L ? X1 ? X2 ? U over [0, T ]. The Mokobodski condition is of course satisfied when L is a quasimartingale with Rao components in S2, as for instance under the general assumptions of Theorem 7. The following two lemmas establish existence of a solution in the special cases of RIBSDEs that are effectively reducible to problems with only one call protection switching time involved. The first case is that of an RDBSDE (or RIBSDE with ?2 = T, see Remark 30).
About the Pricing Equations in Finance 175 Lemma 15. Assuming (H), (H.0)-(H.2)' and theMokobodski condition, then, in the special case where ?2 = T almost surely, the RIBSDE with data (g, ?,L,U, ?) has a (unique) solution (Y,Z, V,K). Moreover the reflecting process K is continuous. Proof. Under the present assumptions, existence of a solution to an RDBSDE was established in Crepey and Matoussi [38] (in which continuity of the reflecting process K is part of the definition of a solution), by "pasting" in a suitable way the solution of a related R2BSDE over [?2, T ] with that of a related RBSDE over [0, ?2]. We now consider the case where ?1 = 0and ?3 = T almost surely, so that the upper barrier U is effectively active on [0, ?2), and inactive on [?2, T ) (cf. Remark 28). Let [[?]] denotes the graph of a stopping time ?. Lemma 16. Assuming (H), (H.0)-(H.2)' and the Mokobodski condition, then, in the special case where 0 = ?1 ? ?2 ? ?3 = T almost surely, the RIBSDE with data (g, ?,L,U, ?) has a solution (Y,Z, V,K). Moreover, K+ is a continuous process, and {(?, t) ; ?K?t = 0} ? [[?2]] , ?Y?2 = ?K??2 = (Y?2 ? U?2)+ . Proof. The solution (Y,Z, V,K) can be obtained by an elementary two-stages construction analogous to that used for establishing existence of a solution to an RDBSDE in [38], by "pasting" appropriately the solution (Y , Z, V , K) of a related RBSDE over the random time interval [?2, T ], with the solution ( ?Y , ? Z, ?V , ?K) of a related R2BSDE with terminal condition ?Y?2 = min(Y?2, U?2) over the random time interval [0, ?2]. The detail of this construction appears in the statement of Theorem 9(i) below. In particular, in case Y?2U?2 , the jump ?K??2 of the reflecting process K? at time ?2 is set to the effect that Y?2? = U?2 = U?2? = ?U?2?, so that the upper obstacle related conditions are satisfied in Definition 16(iii). Note in this respect that the process U cannot jump at ?2, by Assumption (H.2.i)' and the fact that the ?ls are predictable stopping times. The random measure ? cannot jump at ?2 either. Iterated and alternate applications of Lemmas 15 and 16 yield the following existence result for an RIBSDE, Theorem 9. Let us be given an RIBSDE with data (g, ?,L,U, ?). We assume (H), (H.0)-(H.2)' and the Mokobodski condition, and ?m+1 = T almost surely for some fixed index m. (i) The following iterative construction is well-defined, for l decreasing from m to 0: Yl = (Y l, Zl, V l,Kl) is the (?, F, P), (B, ?) - solution, with Kl continuous, to the stopped RBSDE (for l even) or R2BSDE (for l odd) on [0, T ] with data
176 S. Crepey #g , Y l+1 ?l+1 , L , ?l+1 (l even) g , min(Y l+1 ?l+1, U?l+1) , L , U , ?l+1 (l odd) (244) where, in case l = m, Y l+1 ?l+1 is to be understood as ? (so min(Y l+1 ?l+1, U?l+1)= min (?,UT) = ?). (ii) Let us define Y = (Y,Z, V,K) on [0, T ] by, for every l = 0, . . .,m : : (Y,Z, V ) = (Y l, Zl, V l) on [?l, ?l+1), and also at ?m+1 = T in case l = m, : dK = dKl on (?l, ?l+1), ?K?l = (Y l ?l ? U?l)+ = ?Y?l (= 0 for l odd) and ?KT = ?YT = 0. Then Y = (Y,Z, V,K) is the (?, F, P), (B, ?) - solution to the RIBSDE with data (g, ?,L,U, ?). Moreover, K+ is a continuous process, and {(?, t) ; ?K? = 0} ? ( {l even}[[?l]] , ?Y = ?K? = (Y ? U)+ on ( {l even}[[?l]] . Remark 32. We conjecture that one does not need the condition that ?m+1 = T for some fixed index m in Theorem 9. In the case of a Brownian filtration (so F = FB and there is no random measure ? involved), this actually follows by application of the results of Peng and Xu [81]. More precisely, this follows from an immediate extension of these results to the case of an R ? {+?} - valued upper barrier ? U, noting that the results of Peng and Xu [81], which are based on Peng [80], even if stated for real-valued barriers, only use the fact that ?U? = U? lies in S2. This is of course verified under the standing assumption (H.2.i) of this paper (see Sect. 5.1). Moreover it is apparent that the penalization approach and the related results of Peng [80] and Peng and Xu [81] can be extended in a rather straightforward way to the more general case of a filtration F = FB ?F?, which would then establish the above conjecture. Since Theorem 9 is enough for our purposes in this article, we shall not push this further however. 16.3 Markovian Set-Up 16.3.1 Jump-Diffusion Set-Up with Marker Process We now specify the previous set-up to a Markovian jump-diffusion model with marker X = (X,N) as of Sect. 15.2, in which X is a Markovian jump-diffusion not depending on N, and the I-valued pure jump marker process N is constant except for deterministic jumps at the times Tls, from NtTl? to NtTl = ?l(XtTl?), (245)
About the Pricing Equations in Finance 177 for a suitable jump function ?. Again (see Remark 17), in this set-up: : (Ft = FBt ? F?t , Pt;Bt, ?t) has the local martingale predictable representation property, : The error estimate (137) on X is valid. Let us set, for a regular function u over [0, T ] ? Rd (cf. (113) and the related comments): Gu(t, x) = ?tu(t, x) + 12 Tr[a(t, x)Hu(t, x)] + ?u(t, x)b(t, x) (246) +Rd u(t, x + ?(t, x, y)) ? u(t, x)f(t, x, y)m(dy) with b(t, x) = b(t, x) ? Rd ?(t, x, y)f(t, x, y)m(dy). (247) In the present set-up, the operator G defined by (246) is thus the generator of the Markov process X. We now consider a Markovian RIBSDE with underlying factor process X = (X,N). More precisely, let us be given a family of RIBSDEs parameterized by the initial condition (t, x, i) of Xt (where the superscript t stands as usual in this article in reference to (t, x, i)), with the following data: : The generator G of X defined by (246), and the specification of the jump size function ? of N in (245), : Cost data C as of Sect. 6.4, assumed here not to depend on i ? I, : The parameterized sequence of stopping times ?t defined by ?t 0 = t and, for every l ? 0 (to be compared with the stopping time ? of Example 3/Hypothesis 7(iii) in Part III): ?t 2l+1 = inf{s > ?t 2l ; Nt s /? ?} ? T , ?t 2l+2 = inf{s > ?t 2l+1 ; Nt s ? ?} ? T , (248) for a given subset ? of I, resulting in an effective upper payoff process ?Uof the Markovian form (233) corresponding to the event-process ?ts= 1Nts/? ?. (249) Observe that since the cost data do not depend on i, the only impact of the marker process Nt is via its influence on ?t. Also note that the ?t l s effectively reduce to T-valued stopping times, and that one almost surely has ?tm+1 = T. This Markovian set-up allows one to account for various forms of intermittent path-dependent call protection. Denoting by Ststhe first component of the Rdvalued processXts and by S the first component of the mute vector-variable x ? Rd, one may thus consider the following clauses of call protection, which correspond to Example 2 in Part I.
178 S. Crepey Example 5. Given a constant trigger level ? S and an integer ? ? m, ?t of the form (248) above, with: (i) I = {0, . . . , ?}, ? = {0, . . . , ? ? 1} and ? defined by ?il (x) =  (i + 1) ? ?, S ? ? S 0, S< ? S (which in this case does not depend on l). With the initial condition Nt t = 0, Nt s then represents the number, capped at ?, of consecutive monitoring dates Tl with StTl ? ? S from time s backwards since the initial time t. Call is possible whenever Nt s = ?, which means that Stshas been ? ? S at the last ? monitoring times since the initial time t; Otherwise call protection is in force; Or more generally, (ii) I = {0, 1}j for some given integer j ? {?, . . .,m}, ? = {i ? I ; |i| < ?} with |i| = 1?j?j ij , and ? defined by ?il (x) = (1S?? S, i1, . . . , id?1) (independently of l). With the initial condition Nt t = 0j, Nt s then represents the vector of the indicator functions of the events StTl ? ? S at the last j monitoring dates preceding time s since the initial time t. Call is possible whenever |Nt s| ? ?, which means that Stshas been ? ? S on at least ? of the last j monitoring times since the initial time t; Otherwise call protection is in force. 16.3.2 Well-Posedness of the Markovian RIBSDE In the present set-up where Ft = FBt?F?t , there are no ?t - martingale components in any of the related forward or backward SDEs, and the definitions of g and g (cf. (119), (160)) reduce to the following expressions, where in particular v denotes a generic element v ?M(Rd, B(Rd),m(dy);R): g(s,Xt s, y, z, v) = g(s,Xts, y, z, rts) with rts= rts(v) = Rd v(y)f(s,Xts, y)m(dy) g(s,Xt s, y, z,v) = g(s,Xts, y, z, rts) + (rts? r) with r = r(v) = Rd v(y)m(dy). (250) Accordingly, the V t-component of a solution to any Markovian BSDE (cf. Theorem 37) lives in H2?t = H2?t . Proposition 37. (i) The following iterative construction is well-defined, for l decreasing from m to 0: Yl,t = (Y l,t, Zl,t, V l,t,Kl,t) is the (?, Ft, Pt), (Bt, ?t) - solution, with Kl,t continuous, to the stopped RBSDE (for l even) or R2BSDE (for l odd) on [t, T ] with data
About the Pricing Equations in Finance 179 ??? ?? 1{s>t}g(s,Xts, y, z, v), Yl+1,t ?t l+1 , (s ? t,Xts?t), ?t l+1 (l even) 1{s>t}g(s,Xts, y, z, v), min(Y l+1,t ?t l+1 , h(?t l+1,Xt?t l+1)), (s ? t,Xts?t), h(s ? t,Xts?t), ?t l+1 (l odd) (251) where, in case l = m, Y l+1,t ?t l+1 is to be understood as ?(XtT). Let Yt = (Y t, Zt, V t,Kt) be defined in terms of the Yl,ts as Y in terms of the Yls in Theorem 9(ii). So in particular Y t = Y l,t on [?t l , ?t l+1), for every l = 0, . . .,m, and Y t t =  Y 0,t t , i ? ? Y 1,t t , i /? ?. (252) Then Yt is the (?, Ft, Pt), (Bt, ?t) - solution to the RIBSDE on [t, T ] with data g(s,Xts, y, z, v), ?(XtT), (s,Xts), h(s,Xts), ?t. (253) (ii) For every l = 0, . . .,m, we extend Y l,t by Y l,t t , and Kl,t t , Zl,t and V l,t by 0 on [0, t]. Then, for every l = m, . . . , 0: Yl,t = (Y l,t, Zl,t, V l,t,Kl,t) is the (?, F, P), (B, ?) - solution, with Kl,t continuous, to the stopped RBSDE (for l even) or R2BSDE (for l odd) on [0, T ] with data as of (251), with ginstead of g therein. Proof. Part (i) follows by application of Proposition 9. Identity (252) simply results from the fact that, since Y t = Y l,t on [?t l , ?t l+1),  Y t t = Y 0,t t , Nt t ? ? Y t t = Y 1,t t , Nt t /? ? (254) with Nt t = i. Part (ii) then follows from part (i) as in the proof of Theorem 2. Our next goal is to derive stability results on Yt, or, more precisely, on the Yl,ts. Toward this end a suitable stability assumption on ?t is needed. Note that in the present set-up assuming the ?t l s continuous, which would be the "naive analog" of Assumption 4, would be too strong in regard to applications. This is for instance typically not satisfied in the situations of Example 5. One is thus led to introduce the following weaker Assumption 10 Viewed as a random function of the initial condition (t, x, i) of X, then, at every (t, x, i) in E, ? is, almost surely: (i) Continuous at (t, x, i) if t /? T, and right-continuous at (t, x, i) if t ? T, (ii) Left-limited at (t, x, i) if t = Tl ? T and ?l is continuous at (x, i). By this, we mean that: : ?tn > ?t if (tn, xn, i) > (t, x, i) with t /? T, or, for t = Tl ? T, if El+1 (tn, xn, i) > (Tl, x, i); : If Int El (tn, xn, i) > (t = Tl, x, i) and that ?l is continuous at (x, i), then ?tn
180 S. Crepey converges to some non-decreasing sequence, denoted by ?t, of predictable stopping times, such that in particular ?t l= T for l? m + 1. Observe that since the ?t l s are in fact T-valued stopping times: : The continuity assumption on ?t effectively means that ?tn l = ?t l for n large enough, almost surely, for every l = 1, . . .,m+ 1 andE (tn, xn, i) > (t, x, i) ? E with t /? T; : The right-continuity, resp. left-limit assumption, effectivelymeans that for n large enough ?tn l = ?t l , resp. ?t l , almost surely, for every l = 1, . . .,m + 1 and El+1 , resp. Int El(tn, xn, i) > (Tl, x, i) ? E. Remark 33. It is intuitively clear, though we shall not try to prove this in this article, that Assumption 10 is satisfied in the situations of Example 5, in case the jump-diffusion X is uniformly elliptic in the direction of its first component S (cf. Example 3). We refer the reader to [31] for a precise statement and proof in a diffusion set-up. Moreoverwe make the following additional hypothesis on the upper payoff function h, whereas the lower payoff function is still supposed to satisfy assumption (M.3). Also recall that in this section the cost data C, including the function h, do not depend on i ? I. Assumption 11 h is Lipschitz in (t, x). One denotes by Yt = (Yl,t)0?l?m, with Yl,t = (Y l,t, Zl,t, V l,t, Kl,t) and Kl,t continuous for every l = 0, . . .,m, the sequence of solutions of stopped RBSDEs (for l even) or R2BSDEs (for l odd) which is obtained by substituting ?t to ?t in the construction of Yt in Theorem 37(i). Theorem 10. For every l = m, . . . , 0: (i) One has the following estimate on Yl,t, Y l,t2S2 + Zl,t2H2d + V l,t2H2? + Kl,t2S2 ? C(1 + |x|2q). (255) Moreover, an analogous bound estimate is satisfied by Yl,t; (ii) tn referring to a perturbed initial condition (tn, xn, i) of X, then: : In case t /? T, Yl,tn converges in S2?H2d?H2??A2 to Yl,t asE (tn, xn, i) > (t, x, i); : In case t = Tl? T, - Yl,tn converges in S2?H2d?H2??A2 to Yl,t as El+1 (tn, xn, i) > (t, x, i); - If ?lis continuous at (x, i), then Yl,tn converges in S2 ?H2d?H2?? A2 to Yl,t as Int El(tn, xn, i) > (t, x, i). Proof. Under Assumption 10, these results can be established, recursively on l decreasing from m to 0, by easy amendments to the proof of Proposition 27 in Appendix 17.3, using Assumption 11 for controlling new terms in
About the Pricing Equations in Finance 181 h(t?-??t l+1,Xt t-??t l+1)?h(tn-??tn l+1,Xtn tn-??tn l+1)S2 and h(t?-??t l+1,Xt t-??t l+1)? h(tn-??tn l+1,Xtn tn-??tn l+1)S2 that arise (for l odd) in the right-hand-side of the analogs of inequality (276). 16.3.3 Semi-Group and Markov Properties Let t refer to the constant initial condition (t, x, i) as usual. Let Xt = (Xt,Nt) and Yt = (Y t, Zt, V t,Kt) be defined as in Sect. 16.3.1 and Theorem 37, respectively. Given t? t, let Ftstand for ( Ftr )r?twith for r ? tFtr = ?(Xt t)&Ftr . Let ?= t? ?t, in the sense that ?l = t? ?t l , for l = 1, . . .,m + 1. As for Ft= (Ftr )r?t, Pt, Btand ?t, they are defined as usual as in Sects. 7.1-7.2, with tinstead of t therein. Note in particular thatFtis embedded into the restriction Ft| [t,T ] of Ft to [t, T ]. We then have the following semi-group properties, which are the analogs in the present set-up of Propositions 26, 28 in Part II. Proposition 38. (i) The Jump-Diffusion model with Marker Process on [t, T ] with initial condition Xt tat tadmits a unique (?,Ft, P) - solution Xt= (Xt,Nt), which coincides with the restriction of Xt to [t, T ], so: Xt= (Xtr ,Ntr )t?r?T = (Xt r )t?r?T . (ii) For t and tin the same monitoring time strip, so Tl?1 ? t < t < Tl for some l ? {1, . . .,m}, then ?= t? ?t is an Ft- stopping time, and the RIBSDE on [t, T ] with datag(s,Xts , y, z,v), ?(XtT ), (s,Xts ), h(s,Xts ), ?(256) has a unique (?,Ft, Pt), (Bt, ?t) - solution Yt= (Y t, Zt, V t,Kt), such that, with Yt = (Y t r , Ztr, V t r ,Ktr)t?r?T defined as in Theorem 37: Yt= (Y tr , Ztr , V tr ,Ktr )t?r?T = (Y t r , Ztr, V t r ,Ktr ? Ktt)t?r?T . (257) Proof. Part (i) can be shown much like Proposition 26(i). It implies in particular that whenever Tl?1 ? t < t< Tl for some l ? {1, . . .,m}, then Nt r = Ntr = i for r ? [t, Tl). In view of (248) one thus has ?0 = tand, for every l ? 0: ?2l+1 = inf{s > ?2l; Nts /? ?} ? T, ?2l+2 = inf{s > ?2l+1; Nts ? ?} ? T. (258)
182 S. Crepey This shows that ?is an Ft- stopping time, namely the analog of ?t relatively to Nt. Knowing this, part (ii) can then be established much like Proposition 26(ii) or 28(ii) in Part II. In the present set-up the suitable notion of a Cauchy cascade (cf. Definition 15) takes the following form. Definition 17. (i) A Cauchy cascade ?, ? on E is pair made of a terminal condition ? of class P at T, along with a sequence ? = (vl)1?l?m of functions vls of class P on the Els, satisfying the following jump condition, at every point of continuity of ?il in x: vil (Tl, x) =  min(vl+1(Tl, x, ?il (x)), h(Tl, x)) if i /? ? and ?il (x) ? ?, vl+1(Tl, x, ?il (x)) else (259) where, in case l = m, vl+1 is to be understood as ?. A continuous Cauchy cascade is a Cauchy cascade with continuous ingredients ? at T and vls on the Els, except maybe for discontinuities of the vls at the points (Tl, x, i) of discontinuity of ?il in x; (ii) The function defined by a Cauchy cascade is the function on E given by the concatenation of the vls on the Int Els, and by the terminal condition ? at T . Remark 34. So, at points (Tl, x, i) of discontinuity of ?il in x, vil (tn, xn) may fail to converge to vil (Tl, x) as El (tn, xn, i) > (Tl, x, i). Note that in the specific situations of Examples 4 or 5 /2, the set of discontinuity points x of ?il is given by the hyperplane {x1 = ? S} of Rd, for every l, i. We are now in a position to state the Markov properties of Y. The notion of ? - saddle-point in part (iii) was introduced in the general RIBSDEs verification principle of Proposition 35. Theorem 11. (i) Given (t, x, i) ? E, let Yt = (Y t, Zt, V t,Kt) be defined as in Theorem 37. As (t, x, i) varies in E, Y t t is a deterministic function v defined by a continuous Cauchy cascade ?, (vl)1?l?m on E. (ii) One has, Pt-a.s., Y t s = v(s,Xt s ), s ? [t, T ]. (260) (iii) For every ? > 0, an ? - saddle-point of the related Dynkin game at time t is given by, ??t= infs ? ?l?0[?t 2l+1, ?t 2l+2); (s,Xt s ) ? E?? T , ??t = infs ? [t, T ]; (s,Xt s ) ? E+? T
About the Pricing Equations in Finance 183 with E?= {(t, x, i) ? E; vi(t, x) ? hi(t, x) ? ?}, E+= {(t, x, i) ? E ; vi(t, x) ? i(t, x) + ?}. Proof. Let us prove parts (i) and (ii), which immediately imply (iii) by an application of Proposition 35. By taking r = tin the semi-group property (257) of Y, one gets, for every l = 1, . . .,m and Tl?1 ? t ? r < Tl, Y t r = vl(r,Xt r ), Pt?a.s. (261) for a deterministic function vl on Int El. In particular, Y t t = vi(t, x), for any (t, x, i) ? E, (262) where v is the function defined on E by the concatenation of the vls and of the terminal condition ?. In view of (252), the fact that v is of class P then directly follows from the bound estimates (255) on Y0,t and Y1,t. Let us show that the vls are continuous on the Int Els. Given E (tn, xn, i) > (t, x, i) with t /? T or tn ? Tl = t, one decomposes by (252): |ui(t, x) ? ui(tn, xn)| = |Y t t ? Y tn tn | ?  |E(Y 0,t t ? Y 0,t tn )| + E|Y 0,t tn ? Y 0,tn tn |, i ? ? |E(Y 1,t t ? Y 1,t tn )| + E|Y 1,t tn ? Y 1,tn tn |, i /? ?. In either case we conclude as in the proof of Theorem 4(i), using Proposition 10 as a main tool, that |vi(t, x) ? vi(tn, xn)| goes to zero as n>?. It remains to show that the vls can be extended by continuity over the Els, and that the jump condition (259) is satisfied (except maybe at the boundary points (Tl, x, i) such that ?il is discontinuous at x). Given Int El (tn, xn, i) > (t = Tl, x, i) with ?l continuous at (x, i), one needs to show that vil (tn, xn) = vi(tn, xn) > vil (Tl, x), where vil (Tl, x) here is defined by (259).We distinguish four cases. : In case i /? ? and ?il (x) ? ?, one has, denoting vj(s, y) = min(v(s, y, ?jl (y)), h(y)), vj(s, y) =min(v(s, y, j), h(y)), |ui(t, x) ? ui(tn, xn)|2 = |ui(t, x) ? Y 1,tn tn |2 ? 2E|vi(t, x) ?v(t,Xtn t )|2 + 2|Ev(t,Xtn t ) ? Y 1,tn tn |2. (263)
184 S. Crepey By continuity of ?l at (x, i), it comes that ?l(Xtn t ) = ?il (x) ? ? for Xtn t close enough to x, say ||X tn t ?x|| ? c. In this case t = ?tn 2 , therefore (cf. (251)) Y 1,tn t = v(t,Xtn t ). So E|1||X tn t ?x||?cv(t,Xtn t ) ? Y 1,tn tn |2 ? E|Y 1,tn t ? Y 1,tn tn |2, which converges to zero as n > ?, by the R2BSDE satisfied by Y 1,tn and the convergence of Y1,tn to Y1,t. Moreover E|1||X tn t ?x||> cv(t,Xtn t )?Y 1,tn tn |2 goes to zero as n > ?by the a priori estimates on X and Y 1,tn and the continuity of v already established over Int El+1. Finally by this continuity and the a priori estimates on X the first term in (263) also goes to zero as n>?. So, as n>?, vi(tn, xn) > vi(t, x) = min(v(t, x, ?il (x)), h(t, x)) = vil (Tl, x). : In case i ?? and ?il (x) /? ?, one can show likewise, using ?vj (s, y) := v(s, y, ?jl (y)) instead of vj (s, y), v(t,Xtn t ) instead of v(t,Xtn t ) and Y 0 instead of Y 1 above, that vi(tn, xn) > ?vi(t, x) = vil (Tl, x) (264) as n>?. : If i, ?il (x) /? ?, it comes, |?ui(t, x) ? ui(tn, xn)|2 = |?ui(t, x) ? Y 1,tn tn |2 ? 2E|?vi(t, x) ? v(t,Xtn t )|2 + 2|Ev(t,Xtn t ) ? Y 1,tn tn |2 ? 2E|?vi(t, x) ? v(t,Xtn t )|2 + 2|EY 1,tn Tl ? Y 1,tn tn |2, which goes to zero as>?by an analysis similar to (actually simpler than) that of the first bullet point. Hence (264) follows. : If i, ?il (x) ? ?, (264) can be shown as in the above bullet point. 16.3.4 Viscosity Solutions Approach The next step consists in deriving an analytic characterization of the value function v, or, more precisely, of ? = (vl)1?l?m, in terms of viscosity solutions to a related partial integro-differential problem. In the present case this problem assumes the form of the following cascade of variational inequalities: For l decreasing from m to 1, : At t = Tl, for every i ? I and x ? Rd with ?il continuous at x, vil (Tl, x) =  min(vl+1(Tl, x, ?il (x)), h(Tl, x)), i /? ? and ?il (x) ? ? vl+1(Tl, x, ?il (x)), else (265) with vl+1 in the sense of ? in case l = m;
About the Pricing Equations in Finance 185 : On the time interval [Tl?1, Tl), for every i ? I, ?? ? min ?Gvil ? gvil , vil ? = 0, i ? ? max min ?Gvil ? gvil , vil ? , vil ? h= 0, i /? ? (266) where G is given by (246) and where we set, for any function ? = ?(t, x), g? = g?(t, x) = g(t, x, ?(t, x), (???)(t, x), I?(t, x)). (267) In the special case of a jump size function ? independent of x, so ?il(x) = ?il , then the vls are in fact continuous functions over the Els. This can be shown by a simplified version of the proof of Theorem 11. Using the notions of viscosity solutions introduced in Definition 14, one then has in virtue of arguments already used in Part III (cf. also Proposition 34(ii)) that for every l = 1, . . .,m and i ? I, the function vil is the unique P-solution, the maximal P-subsolution and the minimal P-supersolution of the related problem (V1) or (V2) on El which is visible in (265)-(266), with terminal condition at Tl+1 dictated by vl+1, h and/or ?. Moreover, under the working assumption that the true value for vl+1 is plugged at Tl+1 in an approximation scheme for vl, then vl,h > vl locally uniformly on El as h > 0. But, thinking for instance of the situations of Example 5, the case of ? not depending on x is of course too specific. Now, as soon as ? depends x, ? presents discontinuities in x, and, under Assumption 10, the functions vls typically present discontinuities at the points (Tl, x, i) of discontinuity of the ?il s. There is then no chance to characterize the vls in terms of continuous viscosity solutions to (265) and (266) anymore. It would be possible however, though we shall not develop this further in this article, to characterize ? in terms of a suitable notion of discontinuous viscosity solution to (265) and (266). 16.3.5 Protection Before a Stopping Time Again We finally consider the special case where the marker process N is stopped at its first exit time of ?, which corresponds to jump functions ?il (x) such that ?il (x) = i for i /? ?. The sequence ?t = (?t l )l?0 is then stopped at rank l = 2, so ?t l = T for l ? 2. In this case (249) reduces to, ?ts= 1Nts/? ? = 1s??t1 . (268) From the point of view of financial interpretationwe recover a case of call protection before a stopping time as of Parts II and III. If Nt t = i /? ?, one has ?t 1 = t, and call protection on [0, ?t 1) actually reduces to no protection. For less trivial examples (provided Nt t = i ? ?) we refer the reader to Example 4, which corresponds to the "stopped" version of Example 5/2. From a mathematical point of view one is back to an RDBSDE as of Definition 9(ii) (cf. (107), (16)). But this is for a stopping time, ?t 1, which falls outside the
186 S. Crepey scope of Example 3/Assumption 6 in Part III, so that the PDE results of Part III cannot be applied directly. However, assuming (268), one can check by inspection in the arguments of Sects. 16.3.2-16.3.4, that: : For i /? ?, the Yl,ts do not depend on i, and Yt in Theorem 37 coincides with Yt in Theorem 1(i) (special case of Xt therein given as Xt here); : The Yl,ts have continuous Kl,ts components (since the discontinuities of the Kl,ts occurred because of the switchings from no call protection to call protection, and that such switchings are not possible for ?t stopped at rank two), : Theorem 10 is true independently of Assumption 11 (since again this assumption was only used for taking care of the case where a call protection period follows a no call protection period), so that Assumption 11 is in fact not required in this section. No-Protection Price Regarding the no-protection period [?t 1, T ] one thus has the following result, either by application of the results of Parts II and III, or by inspection of the proofs in Sects. 16.3.2-16.3.4, Proposition 39. (i) For i /? ?, Y 1,t t =: u(t, x) defines a continuous function u on [0, T ] ? Rd. (ii) This function u corresponds to a no call protection pricing function in the sense that one has, starting from every initial condition (t, x, i) ? E, Y t s = u(s,Xts) on [?t 1, T ], with ?t 1 = inf{s > t ; Nt s /? ?}; (iii) The no protection value function u thus defined is the unique P-solution, the maximal P-subsolution, and the minimal P-supersolution of max min ?Gu ? gu, u ? , u ? h= 0 (269) on E with boundary condition ? at T, where G is given by (246) and where gu is defined by (267). (iv) Stable, monotone and consistent approximation schemes uh for u converge to u locally uniformly on E as h > 0. Note that the no-protection pricing function u is but the function vi of Theorem 11, which for i /? ? does not depend on i (vi is constant in i outside ?, assuming (268)). Protection Price As for the protection period [0, ?t 1), since the vils for i /? ? all reduce to u, the Cauchy cascade (265) and (266) in ? = (vl)1?l?m = (vil )i?I 1?l?m effectively reduces
About the Pricing Equations in Finance 187 to the following Cauchy-Dirichlet cascade in (vil )i?? 1?l?m, with the function u as boundary condition, and where in view of identity (260) in Theorem 11, (vil )i?? 1?l?m can be interpreted as the protection pricing function: For l decreasing from m to 1, : At t = Tl, for every i ? ? and x ? Rd with ?il continuous at x, vil (Tl, x) =  u(Tl, x), l= m or ?il (x) /? ? vl+1(Tl, x, ?il (x)), else, (270) : On the time interval [Tl?1, Tl), for every i ? ?, min ?Gvil ? gvil , vil ? = 0. (271) Given a pertaining notion of discontinuous viscosity solution of (270) and (271), (vil )i?? 1?l?m could then be characterized as the unique solution in this sense to (270) and (271). Remark 35. The Cauchy-Dirichlet cascade (269)-(271) involves less equations than the Cauchy cascade (265) and (266). However "less" here is still often far too much (see for instance Example 4(ii)) from the point of view of a practical resolution by deterministic numerical schemes. For "very large" sets ? simulation schemes are then the only viable alternative. 17 Proofs of Auxiliary BSDE Results 17.1 Proof of Lemma 8 Recall that a cadlag process Zt is a Pt - local martingale if and only if ?tZt is a P - local martingale (see, e.g., Proposition III.3.8 in Jacod-Shiryaev [62]). Now for Zt = Bt , resp. - t Rd V t s (y) ?t(ds, dy) , resp. resp. j?I - t Wt s (j) d?ts(j) with V t,Wt in the related spaces of predictable integrands, we have, "" standing for "equality up to an (Ft, P) - local martingale term": d(?tZt)s ?t s?dZts+ ??t s?Zts where?Zts= 0, resp. Rd V t s (y) ?(ds, dy) , resp. resp. j?I Wt s (j) d?ts(j).
188 S. Crepey : In case Zt = Bt, ?tZt is obviously a P - local martingale. Process Bt is thus a continuous Pt - local martingale null at time t with Bt,Bts = (s ? t)Idd?d. Therefore Bt is a Pt - Brownian motion starting at time t on [t, T ]. : In case Zt = - t Rd V t s (y) ?t(ds, dy) , since ? and ? cannot jump together (see Remark 21), one has by (148): ??t s?Zts= ?Zts?t s? Rd f(s,Xt s?, y) f(s,Xt s?, y) ? 1?(ds, dy). So d(?tZt)s ?t s? Rd V t s (y) ?t(ds, dy) + ?t s? Rd V t s (y)f(s,Xt s?, y) f(s,Xt s?, y) ? 1? (ds, dy) = ??t s? Rd V t s (y) f(s,Xt s, y)m(dy)ds + ?t s? Rd V t s (y) f(s,Xt s?, y) f(s,Xt s?, y) ? (ds, dy) = ?t s? Rd V t s (y)f(s,Xt s?, y) f(s,Xt s?, y) ? (ds, dy) and ?tZt is also a P - local martingale. : In case Zt = j?I - t Wt s (j) d?ts(j) one gets likewise d(?tZt)s ?t s?j?I Wt s (j) nj(s,Xt s?) nj(Nt s?) d?s(j) and ?tZt is again a P - local martingale. 17.2 Proof of Proposition 25 First we have, using the facts that f (cf. Lemma 7(i)) and nare bounded, with f positively bounded for (H.1.ii)": (H.1.i)" 1{->t}g(-,Xt - , y, z,v) is a progressively measurable process with 1{->t}g(-,Xt - , y, z,v)H2 < ? for any y ? R, z ? R1?d, v ?M?;
About the Pricing Equations in Finance 189 (H.1.ii)" 1{->t}g(-,Xt - , y, z,v) is uniformly ? - Lipschitz continuous with respect to (y, z,v), in the sense that for every s ?[0, T ], y, y?R, z,z ?R1?d, v, v?M?: |g(s,Xt s, y, z,v) ?g(s,Xt s, y, z, v)| ? ?|y ? y| + |z ? z| + |v ?v|(cf. (156) for the definition of |v ? v|). So the driver 1{->t}g satisfies the general assumptions (H.1), hence the data (159) satisfy the general assumptions (H.0)-(H.2), relatively to (?, F, P), (B, ?). (i) By the general results of [38], one thus has the following bound estimate on Yt: Y t2S2 + Zt2H2d + Vt2H2? + Kt,+2S2 + Kt,?2S2 ? c(?)c1 withc1 := ?(XtT)22+ 1{->t}g(-,Xt - , 0, 0, 0)2H2 +(- ? t,Xt -?t)2S2 + h(- ? t,Xt -?t)2S2 + - -?t G?(r,Xt r )dr2S2 , where ? is the function introduced at assumption (M.3). Estimate (161) then follows by standard computations, given the Lipschitz continuous and growth assumptions on the data and the bound estimate (134) on Xt. (ii) By the general results of [38], we also have the following error estimate in which c1 is as above: Y t ? Y tn2S2 + Zt ? Ztn2H2d + V t ? V tn2H2? + Kt ? Ktn2S2 ? c(?)c1?(XtT) ? ?(Xtn T )22+ 1{->t}g(-,Xt - , Y t - , Zt- , Vt - ) ? 1{->tn} ?g(-,Xtn - , Y t - , Zt- , Vt - )2H2 + (- ? t,Xt -?t) ? (- ? tn,Xtn -?tn)S2 +h(- ? t,Xt -?t) ? h(- ? tn,Xtn -?tn)S2. (272) First note that c(?)c1 ? C(1 + |x|2q), by part (i). It thus simply remains to show that each term of the sum goes to 0 as n > ?in the right hand side of (272). We provide a detailed proof for the term 1{->t}g(-,Xt - , Y t - , Zt- , Vt - ) ? 1{->tn}g(-,Xtn - , Y t - , Zt- , Vt - )2H2 . The other terms can be treated along the same lines. Introducing a sequence (Rm) of positive numbers going to infinity as m>?, let thus ?m,n s := {s ? t ? tn} ? {Nt s = Ntn s } ? {|Xts| ? |Xtn s | ?|Y t s | ? |Zts| ? rts? Rm},
190 S. Crepey with rts:= |rts| ? |rts| ? |rtn s |, where rts= Rd V t s (y)m(dy), rts= Rd V t s (y)f(s,Xts,Nt s, y)m(dy), rtn s = Rd V t s (y)f(s,Xtn s ,Nt s, y)m(dy), (273) and let ??m,n s denote the complement of the set ?m,n s . One has for any m, n: 1{->t}g(-,Xt - , Y t - , Zt- , Vt - ) ? 1{->tn}g(-,Xtn - , Y t - , Zt- , Vt - )2H2 = ET t?tn 1{s>t}g(s,Xt s, Y t s , Zts, Vts) ? 1{s>tn}g(s,Xtn s , Y t s , Zts, Vts)2 ds = ET t?tn 1{s>t}g(s,Xt s, Y t s , Zts, Vts) ?1{s>tn}g(s,Xtn s , Y t s , Zts, Vts)2 1 ??m,n s ds + ET t?tn 1{s>t}g(s,Xt s, Y t s , Zts, Vts) ? 1{s>tn}g(s,Xtn s , Y t s , Zts, Vts)2 1?m,n s ds ? 2ET t?tn g(s,Xt s, Y t s , Zts, Vts)2 + g(s,Xtn s , Y t s , Zts, Vts)21 ??m,n s ds + ET 0 g(s,Xt s, Y t s , Zts, Vts) ?g(s,Xtn s , Y t s , Zts, Vts)2 ?1?m,n s ds =: Im,n + IIm,n. Now, g(s,Xt s, Y t s , Zts, V t s )2 +g(s,Xtn s , Y t s , Zts, V t s )2 (274) ? C1 + |Xts|2q + |Xtn s |2q + |Y t s |2 + |Zts|2 + |Vts|2. Note that |Xtn s |2q is equi - dP ? dt-integrable, by estimate (134) on X applied for p > 2q. So are therefore the right hand side, and in turn the left hand side, in (274), since Yt ? S2 ?H2d?H2??A2. Besides, one has that ET t?tn 1 ??m,n s ds ? T |t ? tn| + ET t?tn 1 ??m,n s ds, (275) where for s ? t ? tn: ??m,n s ? {Nt s = Ntn s } ? {|Xts| ? |Xtn s | ? |Y t s | ? |Zts| ? |rts| ? Rm}. Note that rtH2 < ?. Using also estimates (136) on N, (134) on X and (161) on Y, we thus get by Markov's inequality: ET t?tn 1 ??m,n s ds ? C|t ? tn| + ET t?tn 1{|Xts|?Rm} + 1{|Xtn s |?Rm} + 1{|Y t s |?Rm} +1{|Zts|?Rm} + 1{|rts|?Rm}ds ? C|t ? tn| + 1 R2m .
About the Pricing Equations in Finance 191 Therefore, given (275), ET t?tn 1 ??m,n s ds goes to 0 as m, n>?. Note that ET t?tn 1 ??m,n s ds = ET t?tn 1?m,n s ds, with ?m,n s = ??m,n s ? {s > t ?tn}. By standard results, the fact that ET 0 1?m,n s ds > 0 as m, n>?implies that ET 0 fn,m s 1?m,n s ds > 0 as m, n > ?, for any equi - dP ? dt-integrable family of non-negative processes f = (fn,m s )m,n. Applying this to fn,m = g(s,Xt s, Y t s , Zts, Vts)2 +g(s,Xtn s , Y t s , Zts, Vts)2, we conclude that Im,n > 0 as m, n>?. On the other hand, since Nt s = Ntn s on ?m,n s , and using the form (160) of g in which g satisfies (M.1), we have: IIm,n = ET 0 g(s,Xts,Nt s, Y t s , Zts, Vts) ? g(s,Xtn s ,Nt s, Y t s , Zts, Vts)2 1?m,n s ds ? ET 0 ?m (|Xts ? Xtn s | + |rts? rtn s |) ds where ?m is a non-negative bounded function continuous and null at 0. Given? > 0, let m, nbe such that Im, n ? ?2 for n ? n. Let further ?be such ?m(?) ? ? for ? ? ?. Cdenoting an upper bound on ?m, it comes, for every n: IIm,n ? ET 0 ?m(|Xts ? Xtn s | + |rts? rtn s |) ds ? ET 0 ? + C1{|Xts?Xtn s |??} +C1{|rts?rtn s |??}ds ? T ?+CP[sup[0,T ] |Xt - ? Xtn - | ? ?]+ CET 0 1{|rts?rtn s |ds??}. Now, given estimate (137), one has that P[sup[0,T ] |Xt - ? Xtn - | ? ?] > 0 as n > ?, by Markov's inequality. Moreover (cf. (273)) |rts? rtn s | ? Rd |V t s (y)||f(s,Xts,Nt s, y) ? f(s,Xtn s ,Nt s, y)|m(dy), so rt ? rtnH2 > 0 as n > ?, by dominated convergence using the Lipschitz continuity property of f in Lemma 7(i). Thus by Markov's inequality: ET 0 1{|rts?rtn s |ds??} ? rt ? rtn2H2 ?2converges to 0 as n>?. In conclusion Im,n + IIm,n ? ? for n ? n? n, for any? > 0, which proves that 1{->t}g(-,Xt - , Y t - , Zt- , Vt - ) ? 1{->tn}g(-,Xtn - , Y t - , Zt- , Vt - )2H2 > 0 as n>?.
192 S. Crepey 17.3 Proof of Proposition 27 By the bound estimate (161) on Yt, Y t ?t ? L2. Moreover, one checks as in the proof of Proposition 25 that the driver 1{t<-<?t}g(-,Xt - , y, z, v) satisfies the general assumptions (H.1). Hence the data 1{t<s<?t}g(s,Xt s, y, z, v), Y t ?t, (t ? s ? ?t,Xt s?t??t) satisfy the general assumptions (H.0), (H.1), and the assumptions regarding L in (H.2) relatively to (?, F, P), (B, ?). (i) By the general results of [38], one thus has the following bound estimate on Yt: ? Y t2S2 + ? Zt2H2d + Vt2H2? + ?Kt2S2 ? c(?)c1 with c1 := Y t ?t22+ g(-,Xt - , 0, 0, 0)2H2 + (t ? -? ?t,Xt t?-??t)2S2 . Estimate (169) then follows by standard computations, given the Lipschitz continuous and growth assumptions on the data and estimate (134) on Xt. (ii) Given the assumptions made on , one has the following error estimate in which c1 is as above, by the general results of [38]: ? Y t ? ?Y tn2S2 + ? Zt ? ? Ztn2H2d + Vt ? Vtn2H2? + ?Kt ? ?Ktn2S2 ? c(?)c1 ? Y t ?t ? Y tn ?tn )22 + 1{t<-<?t}g(-,Xt - , ? Y t - , ? Zt- , Vt- ) ? 1{tn<-<?tn}g(-,Xtn - , ? Y t - , ? Zt- , Vt- )2H2 + (t ? -? ?t,Xt t?-??t) ? (tn ? - ? ?tn,Xtn tn?-??tn )H2(276) (with in particular -H2, better than -S2, in the last term, thanks to the regularity assumption (M.3) on , cf. [38]). Since c(?)c1 ? C(1 + |x|2q) by (i), it simply remains to show that each term of the sum goes to 0 as n > ?in the right hand side of (276).We provide a detailed proof for the term 1{t<-<?t}g(-,Xt - , ? Y t - , ? Zt- , Vt- ) ? 1{tn<-<?tn}g(-,Xtn - , ? Y t - , ? Zt- , Vt- )2H2 . The other terms can be treated along the same lines. Introducing a sequence (Rm) of positive numbers going to infinity asm>?, let thus?m,n s and ??m,n s be defined as in the proof of Proposition 25(ii), with ( ? Y t, ? Zt, Vt) instead of (Y t, Zt, Vt) therein. One has for any m, n:
About the Pricing Equations in Finance 193 1{t<s-<?t}g(-,Xt - , ?Y t - , ? Zt- , Vt- ) ? 1{tn<-<?tn}g(-,Xtn - , ? Y t - , ? Zt- , Vt- )2H2 = ET 0 1{t<s<?t}g(s,Xt s , ? Y t s , ? Zts, Vts) ? 1{tn<s<?tn}g(s,Xtn s , ? Y t s , ? Zts, Vts)2 ds ? 2ET 0 g(s,Xt s , ?Y t s , ? Zts, Vts)2 +g(s,Xtn s , ?Y t s , ? Zts, Vts)21 ??m,n s ds +ET 0 1{t<s<?t}g(s,Xt s , ? Y t s , ? Zts, Vts) ?1{tn<s<?tn}g(s,Xtn s , ? Y t s , ? Zts, Vts)2 1?m,n s ds = : Im,n + IIm,n. As in the proof Proposition 25(ii) (using the fact that Yt ? S2 ?H2d?H2??A2 instead of Yt therein), Im,n > 0 as m, n > ?. Moreover since Nt s = Ntn s on ?m,n s one has that IIm,n = ET 0 1{t<s<?t}g(s,Xts,Nt s, ? Y t s , ? Zts, Vts) ? 1{tn<s<?tn}g(s,Xtn s ,Nt s, ?Y t s , ? Zts, Vts)2 1?m,n s ds ? 2ET 0 g(s,Xts,Nt s, ?Y t s , ? Zts, Vts)?g(s,Xtn s ,Nt s, ? Y t s , ? Zts, Vts)2 1?m,n s ds + 2ET 0 |1{t<s<?t} ?1{tn<s<?tn}|g(s,Xts,Nt s, ?Y t s , ? Zts, Vts)2ds, where in the last inequality: : ET 0 g(s,Xts,Nt s, ?Y t s , ? Zts, Vts) ?g(s,Xtn s ,Nt s, ? Y t s , ? Zts, Vts)2 1?m,n s ds?ET 0 ?m (|Xts ? Xtn s |) ds for a non-negative bounded function ?m continuous and null at 0 (cf. the proof of Proposition 25(ii)); : ET 0 |1{t<s<?t} ? 1{tn<s<?tn}|(g(s,Xts,Nt s, ?Y t s , ? Zts, Vts)2ds goes to 0 as n,m > ?, by dP ? dt-integrability of g(s,Xts,Nt s, ?Y t s , ? Zts, Vts)2 joint to the fact that ET 0 |1{t<s<?t} ? 1{tn<s<?tn}|ds = E|?t ? ?tn| + |t ? tn| > 0 as n,m>?, by dominated convergence (under Assumption 4). We conclude the proof as for Proposition 25(ii).
194 S. Crepey 18 Proofs of Auxiliary PDE Results 18.1 Proof of Lemma 11 (i) Let (t, x, i) ? (0, T ) ? Rd ? I be such that ?i(t, x) > 0 and (t, x) maximizes ?i ? ?i for some function ? ? C1,2(E). We need to show that (210) holds at (t, x, i).We first assume t> 0. By a classical argument, we may and do reduce attention to the case where (t, x) maximizes strictly ?i ? ?i. Let us then introduce the function ?i?,?(t, x, s, y) = ?i(t, x) ? ?i(s, y) ? |x ? y|2 ?2 ? |t ? s|2 ?2 ? ?i(t, x) (277) on [0, T ]?Rd, in which ?, ? are positive parameters devoted to tend to zero in some way later in the proof. By a classical argument in the theory of viscosity solutions known as the Jensen-Ishii Lemma (see, e.g., Crandall et al. [37] or Fleming and Soner [49]), there exists, for any positive ?, ?, points (t, x), (s, y) in [0, T ] ? ?BR (we omit the dependence of t, x, s, y in ?, ?, for notational simplicity), where ?BR is a ball around xwith a large radius R which will be fixed throughout in a way made precise later, such that: : For any positive ?, ?, the related quadruple (t, x, s, y) maximizes ?i?,? over ([0, T ] ? ?BR)2. In particular, ?i(t, x) ? ?i(t, x) ? ?i(t, x) = ?i,?(t, x, t, x) ? ?i?,?(t, x, s, y) = ?i(t, x) ? ?i(s, y) ? |x ? y|2 ?2 ?|t ? s|2 ?2 ? ?i(t, x); (278) : (t, x), (s, y)> (t, x) as ?, ? > 0; :, |x?y|2 ?2 , |t?s|2 ?2 are bounded and tend to zero as ?, ? > 0. It follows from [37, Theorem 8.3] that there exists symmetric matrices X, Y ? Rd?d such that (a + ?t?(t, x), p + ??i(t, x),X) ? ? P2,+?i(t, x) (a, p, Y ) ? ? P2,??i(s, y) X 0 0 ?Y ? 4 ?2 Idd ?Idd ?Idd Idd + H?(t, x) 0 0 0(279)
About the Pricing Equations in Finance 195 where ? P2,+?i(t, x), resp. ? P2,??i(s, y), denotes the closure of the parabolic superjet of ?i at (t, x), resp. subjet of ?i at (s, y) (see [37, 49]), and a = 2(t ? s) ?2 , p = 2(x ? y)T ?2 . (280) Modifying if necessary ?i?,? = ?i?,?(t, x, s, y) by adding terms of the form ?(x) and ?(y) with supports in the complement ?BcR/2 of ?BR/2, we may assume that (t, x, s, y) is a global maximum point of ?i?,? over ([0, T ] ? Rd)2. Since ?i(t, x) > 0, then by (278) there exists ? > 0 such that ?i(t, x) ? ?i(s, y) ? ? > 0 for (?, ?) small enough. Combining this inequality with the fact that ? ? and ? ? h, we deduce by continuity of the obstacles and h that for (?, ?) small enough: i(t, x) < ?i(t, x), ?i(s, y) < i(s, y) so that the related sub-and super-solution inequalities are satisfied by ? at (t, x, i) and ? at (s, y, i). Thus ? a ? ?t?i(t, x) ? 12 Tr(ai(t, x)X) ? pbi(t, x)???i(t, x)bi(t, x) ? Rd ?i(t, x, z)fi(t, x, z)m(dz)? Rd ?i(t, x + ?i(t, x, z)) ? ?i(t, x) ? p?i(t, x, z)fi(t, x, z)m(dz) ? gi(t, x, ?(t, x), (p + ??i(t, x))?i(t, x), I?i(t, x)) ? 0 ? a ? 12Tr(ai(s, y)) ? pbi(s, y) ? Rd ?i(s, y + ?i(s, y, z)) ? ?i(s, y) ? p?i(s, y, z)fi(s, y, z)m(dz) ? gi(s, y, ?(s, y), p?i(s, y), I?i(s, y)) ? 0 Note 18. (i) The ? terms that one has added to ??,? to have a global maximum point do not appear in these inequalities because ? has linear growth in x and is thus locally bounded,whereas these terms have a supportwhich is included in ?BcR/2 with R large. (ii) Since we restrict ourselves to finite jump measures m(dz), the Jensen-Ishii Lemma is indeed applicable in its "differential" form (such as it is stated in [37]) as done here. In the case of unbounded Levy measures however, Barles and Imbert [6] (see also Jakobsen and Karlsen [63]) recently established that this Lemma (and thus the related uniqueness proofs in Barles et al. [9], and then in turn in Harraj et al. [58]) has to be amended in a rather involved way.
196 S. Crepey By subtracting the previous inequalities, there comes: ? ?t?i(t, x) ? 12Tr(ai(t, x)X) ? Tr(ai(s, y))? pbi(t, x) ? bi(s, y))???i(t, x)bi(t, x) ? Rd ?i(t, x, z)fi(t, x, z)m(dz)? Rd (?i(t, x+?i(t, x, z))??i(t, x)) ? (?i(s, y + ?i(s, y, z)) ? ?i(s, y)) ? p(?i(t, x, z) ? ?i(s, y, z))fi(t, x, z)m(dz) + Rd ?i(s, y + ?i(s, y, z)) ? ?i(s, y) ? p?i(s, y, z))? fi(t, x, z) ? fi(s, y, z)m(dz) ? gi(t, x, ?(t, x), (p + ??i(t, x))?i(t, x), I?i(t, x)) ? gi(s, y, ?(s, y), p?i(s, y), I?i(s, y))? 0 Now, by straightforward computations analogous to those in [9, p. 76 and 77] (see also [79]) using the maximization property of (t, x, s, y), the definition of p (cf. (280)), the matrix inequality (279) and the Lipschitz continuity properties of the data (and accounting for the fact that we deal with inhomogeneous coefficients bi(t, x), ?i(t, x), and ?i(t, x, z) here, instead of b(x), ?(x), and c(x, z) in [9, 79]), we have: |p|(|t ? s| + |x ? y|) ? C |t ? s|2 + |x ? y|2 ?2 Tr(ai(t, x)X) ? Tr(ai(s, y)Y ) ? C |t ? s|2 + |x ? y|2 ?2 + Tr(ai(t, x)H?i(t, x)) |pbi(t, x) ? bi(s, y))| ? C |t ? s|2 + |x ? y|2 ?2 (?i(t, x + ?i(t, x, z)) ? ?i(t, x)) ? (?i(s, y + ?i(s, y, z)) ? ?i(s, y)) ? (?i(t, x + ?i(t, x, z)) ? ?i(t, x)) +|x + ?i(t, x, z) ? y ? ?i(s, y, z)|2 ?2 ? |x ? y|2 ?2 
About the Pricing Equations in Finance 197 where in the last inequality |x + ?i(t, x, z) ? y ? ?i(s, y, z)|2 ?2 ? |x ? y|2 ?2 = 1 ?2 !2(x ? y)T(?i(t, x, z) ? ?i(s, y, z)) + |?i(t, x, z) ? ?i(s, y, z)|2" = p(?i(t, x, z) ? ?i(s, y, z)) + 1 ?2 |?i(t, x, z) ? ?i(s, y, z)|2 ? C |t ? s|2 + |x ? y|2 ?2 Therefore ??t?i(t, x) ? 12Tr(ai(t, x)H?i(t, x))???i(t, x)bi(t, x) ? Rd ?i(t, x, z)fi(t, x, z)m(dz)? Rd ?i(t, x + ?i(t, x, z)) ? ?i(t, x)fi(t, x, z)m(dz) ?gi(t, x, ?(t, x), (p + ??i(t, x))?i(t, x), I?i(t, x)) ?gi(s, y, ?(s, y), p?i(s, y), I?i(s, y))? C|t ? s| + |x ? y| + |t ? s|2 + |x ? y|2 ?2 I?i(t, x) ? I?i(s, y)) = Rd ?i(s, y + ?i(s, y, z)) ? ?i(s, y)fi(t, x, z) ? fi(s, y, z)m(dz) +Rd (?i(t, x + ?i(t, x, z)) ? ?i(t, x)) ? (?i(s, y + ?i(s, y, z)) ??i(s, y))fi(t, x, z)m(dz) ? Rd (?i(t, x + ?i(t, x, z)) ? ?i(t, x))fi(t, x, z)m(dz) + C|t ? s| + |x ? y| + |t ? s|2 + |x ? y|2 ?2 = I?i(t, x) + C|t ? s| + |x ? y| + |t ? s|2 + |x ? y|2 ?2 gi(t, x, ?(t, x), (p + ??i(t, x))?i(t, x), I?i(t, x)) ?gi(s, y, ?(s, y), p?i(s, y), I?i(s, y)) ? ?(|t ? s|) + ?R(|x ? y|(1 + |p?i(s, y)|)) + ?1 max j?I (?j (t, x) ? ?j(s, y))+ +?|p(?i(t, x) ? ?i(s, y)) + (???)i(t, x)| + ?(I?i(t, x) ? I?i(s, y))+
198 S. Crepey where in the last inequality: : ?is a is a modulus of continuity of gi on a compact set parameterized by ?, obtained by using the fact that p in (280) is bounded independently of ?, for given ?; : ?R is the modulus of continuity standing in Assumption 8(ii); : The three last terms come from the Lipschitz continuity and/or monotonicity properties of g with respect to its three last variables. Therefore ?G?i(t, x) = ??t?i(t, x) ? 12 Tr(ai(t, x)H?i(t, x))???i(t, x)bi(t, x) ? Rd ?i(t, x, z)fi(t, x, z)m(dz)? Rd ?i(t, x + ?i(t, x, z)) ? ?i(t, x)fi(t, x, z)m(dz) ? ?1max j?I (?j(t, x) ? ?j (s, y))+ + |(???)i(t, x)| + I?i(t, x)++ ?(|t ? s|) + ?R(|x ? y|(1 + |p?i(s, y)|)) + C|t ? s| + |x ? y| + |t ? s|2 + |x ? y|2 ?2 Given ? > 0 one thus has for ? ? ?? and ? ? ?, using the properties of (t, x, s, y) in the Jensen-Ishii Lemma and the regularity of ?i: ? G?i(t?, x?) ? ?1max j?I (?j(t, x) ? ?j (s, y))+ + |(???)i(t?, x?)| + I?i(t?, x?)+? ? + ?(|t ? s|). Note that t?s > 0 for fixed ? as ? > 0, by boundness of |t?s|2 ?2 in the Jensen-Ishii Lemma.Whence for ? ? ??(? ?): ? G?i(t?, x?) ? ?1max j?I (?j (t, x) ? ?j(s, y))+ + |(???)i(t?, x?)| + I?i(t?, x?)+? 2? Sending ?, ?, ? to zero with ? ? ?? and ? ? ??, inequality (210) at (t, x, i) follows by upper semi continuity of the function (t, x, s, y) > maxj?I (?j(t, x)? ?j(s, y))+. This finishes to prove that (210) holds at (t, x, i) in case t> 0. Now in case t= 0 let us introduce the function ?i(t, x) = ?i(t, x) ? (?i(t, x) + ?t ) (281) on [0, T ]? ?BR, in which ? is a positive parameter devoted to tend to zero. Assuming again w.l.o.g. that (t= 0, x) maximizes strictly ?i??i, there exists, for any?>0, a point (t, x) in [0, T ] ? ?BR (we omit the dependence of (t, x) in ?, for notational simplicity), where ?BR is a ball with large radius R around x, such that:
About the Pricing Equations in Finance 199 : For any ? > 0 the related point (t, x) maximizes ?i? over [0, T ] ? ?BR, and one has t > 0, for ? small enough; : (t, x) > (t, x) as ? > 0 . In virtue of the part of the result already established in t? > 0, we may thus apply (210) to the function (s, y) > ?i(s, y) + ?s at (t, x, i), whence: ? G?i(t, x) ? ?1max j?I (?j(t, x))+ + |(???)i(t, x)| + (I?i(t, x))+? ? ? t2 ? 0. Sending ? to 0 in the left hand side we conclude by upper semi-continuity of maxj?I (?j)+ that (210) holds at (t= 0, x, i). (ii) Straightforward computations give: ??t?(t, x) = C1?(t, x) (1 + |x|)|??(t, x)| ? (1 + |x|2)|H?(t, x)| ? ?(t, x + ?i(t, x, z))| ? C|?(t, x)| on E, for a constant C independent of C1. Therefore for C1 > 0 large enough ?G? ? ?1? + |???| + (I?)+> 0 on E. (iii) First note that |?| ? goes to 0 uniformly in t, i as |x| > ?, since q1 > q2. Given ? > 0, let us prove that sup (t,x,i)?E (?i(t, x))+ ? ??(t, x)e??1(T?t) ? 0. (282) Assume by contradiction that one has > instead of ? in (282). Then by upper semicontinuity of ?+ the supremum is reached at some point (t?, x?, i) ? Int E in the left hand side of (282), and (?i(t?, x?))+ ? ?i(t?, x?))+ ? ??(t?, x?) > 0. (283) Therefore one has on [0, T ] ? Rd: ?i(t, x) ? ??(t, x)e??1(T?t) ? (?i(t, x))+ ? ??(t, x)e??1(T?t) ? (?i(t?, x?))+ ? ??(t?, x?)e??1(T?t?) = ?i(t?, x?) ? ??(t?, x?)e??1(T?t?) thus ?i(t, x) ? ??(t, x) ? ?i(t?, x?) ? ??(t?, x?)e??1(t?t?).
200 S. Crepey In other words, (t?, x?) maximizes globally at zero ?i ? ?i over [0, T ] ? Rd, with ?i(t, x) = ??(t, x) + ?i(t?, x?) ? ??(t?, x?)e??1(t?t?). Whence by part (i) (given that ?i(t?, x?) > 0, by (283)): ? G?i(t?, x?) ? ?1max j?I (?j(t?, x?))+ + |??i(t?, x?)?i(t?, x?)| +(I?i(t?, x?))+? 0. (284) But the left hand side in this inequality is nothing but ?? G?(t?, x?) + ?1?i(t?, x?) ? ??(t?, x?)??1?i(t?, x?) + ?|??(t?, x?)?i(t?, x?)| + ?(I?i(t?, x?))+= ?? G?(t?, x?) ? ?1??(t?, x?) + ?|??(t?, x?)?i(t?, x?)| +?(I?i(t?, x?))+which should be positive by (211) in (ii), in contradiction with (284). Acknowledgements This research benefited from the support of the "Chaire Risque de credit" (Federation Bancaire Francaise), of the Europlace Institute of Finance and of Ito33. References 1. Alvarez O., Tourin, A.: 13(3), 293-317 (1996) 2. Amadori, A.L.: Nonlinear integro-differential evolution problems arising in option pricing: A viscosity solutions approach. J. Diff. Integr. Equat. 16(7), 787-811 (2003) 3. Amadori, A.L.: The obstacle problem for nonlinear integro-differential operators arising in option pricing. Ricerche Matemat. 56(1), 1-17 (2007) 4. Bally, V.,Matoussi, A.:Weak solutions for SPDEs and Backward doubly stochastic differential equations. J. Theor. Probab. 14(1), 125-164 (2001) 5. Bally, V., Caballero, E., Fernandez, B., El-Karoui, N.: Reflected BSDE's PDE's and variational inequalities. INRIA Technical Report (2002) 6. Barles, G., Imbert, C.: Second-order elliptic integro-differential equations: Viscosity solutions' theory revisited. Annales de l'IHP 25(3), 567-585 (2008) 7. Barles, G., Lesigne, L.: SDE, BSDE and PDE. Backward stochastic differential equations. In: El Karoui, N., Mazliak, L. (eds.) Pitman Research Notes in Mathematics Series, vol. 364, pp. 47-80. Longman, Harlow (1997) 8. Barles, G., Souganidis, P.E.: Convergence of approximation schemes for fully nonlinear second order equations. Asymptotic Analysis 4, 271-283 (1991) 9. Barles, G., Buckdahn, R., Pardoux, E.: Backward stochastic differential equations and integralpartial differential equations. Stoch. Stoch. Rep. 60, 57-83 (1997)
About the Pricing Equations in Finance 201 10. Becherer, D., Schweizer, M.: Classical solutions to reaction-diffusion systems for hedging with interacting Ito and point processes. Ann. Appl. Probab. 15, 1111-1144 (2005) 11. Bensoussan, A., Lions, J.L.: Applications of Variational Inequalities in Stochastic Control. North-Holland, Amsterdam (1982) 12. Bensoussan, A., Lions, J.L.: Impulse Control and Quasi-variational Inequalities. Gauthier-Villars, Paris (1984) 13. Bichteler, K.: Stochastic Integration with Jumps. Cambridge University Press, Cambridge (2002) 14. Bielecki, T.R., Rutkowski, M.: Credit Risk:Modeling, Valuation and Hedging. Springer, Berlin (2002) 15. Bielecki, T.R., Vidozzi, A., Vidozzi, L.: An efficient approach to valuation of credit basket products and ratings triggered step-up bonds. Working Paper (2006) 16. Bielecki, T.R., Crepey, S., Jeanblanc, M., Rutkowski, M.: Valuation of basket credit derivatives in the credit migrations environment. In: Birge, J., Linetsky, V. (eds.) Handbook of Financial Engineering. Elsevier, Amsterdam (2007) 17. Bielecki, T.R., Vidozzi, A., Vidozzi, L.: A Markov copulae approach to pricing and hedging of credit index derivatives and ratings triggered step-up bonds. J. Credit Risk 4(1) (2008) 18. Bielecki, T.R., Crepey, S., Jeanblanc,M., Rutkowski,M.: Arbitrage pricing of defaultable game options with applications to convertible bonds. Quant. Finance 8(8), 795-810 (2008) (Preprint version available online at www.defaultrisk.com) 19. Bielecki, T.R., Crepey, S., Jeanblanc, M., Rutkowski, M.: Convertible bonds in a defaultable diffusion model. Forthcoming In: Kohatsu-Higa, A., Privault, N., Sheu, S.J. (eds.) Stochastic Analysis with Financial Applications (36 pages). Birkhauser Verlag (2010) 20. Bielecki, T.R., Crepey, S., Jeanblanc, M., Rutkowski, M.: Defaultable options in a Markovian intensity model of credit risk. Math. Finance 18, 493-518 (2008) (Updated version available on www.defaultrisk.com) 21. Bielecki, T.R., Jakubowski, J., Vidozzi, A., Vidozzi, L.: Study of dependence for some stochastic processes. Stoch. Anal. Appl. 26(4), 903-924 (2008) 22. Bielecki, T.R., Crepey, S., Jeanblanc, M.: Up and Down Credit Risk. Quantitative Finance, 1469-7696, April 2010 23. Bielecki, T.R., Crepey, S., Jeanblanc, M., Rutkowski, M.: Valuation and hedging of defaultable game options in a hazard process model. J. Appl. Math. Stoch. Anal. 2009, 33 (2009); Article ID 695798 (Long Preprint version available on www.defaultrisk.com) 24. Boel, R., Varaiya, P.,Wong, E.:Martingales on jump processes: I Representation results. SIAM JC 13(5), 999-1021 (1975) 25. Boel, R., Varaiya, P., Wong, E.: Martingales on jump processes: II Applications. SIAM JC 13(5), 1023-1061 (1975) 26. Bouchard, B., Elie R.: Discrete time approximation of decoupled Forward-Backward SDE with jumps. Stoch. Process. Appl. 118, 53-75 (2008) 27. Bremaud, P.: Point Processes and Queues, Martingale Dynamics. Springer, New York (1981) 28. Briani, M., La Chioma, C., Natalini, R.: Convergence of numerical schemes for viscosity solutions to integro-differential degenerate parabolic problems arising in financial theory. Numer. Math. 98(4), 607-646 (2004) 29. Busca, J., Sirakov, B.: Harnack type estimates for nonlinear elliptic systems and applications. Annales de l'institut Henri Poincare (C) Analyse non lineaire 21(5), 543-590 (2004) 30. Carmona, R., Crepey, S.: Importance sampling and interacting particle systems for the estimation of markovian credit portfolios loss distribution. Int. J. Theor. Appl. Finance 13(4), 577-602 (2010) 31. Chassagneux, J.-F., Crepey, S.: Doubly reflected BSDEs with call protection and their approximation. Working Paper (2009) 32. Cherny, A., Shiryaev, A.: Vector stochastic integrals and the fundamental theorems of asset pricing. Proceedings of the Steklov Institute of mathematics, vol. 237, pp. 6-49 (2002) 33. Coculescu, D., Nikeghbali, A.: Hazard processes and martingale hazard processes. Working Paper (2008)
202 S. Crepey 34. Cont, R., Minca, A.: Recovering portfolio default intensities implied by CDO quotes. Working Paper (2008) 35. Cont, R., Tankov, P.: Financial Modelling with Jump Processes. Chapman & Hall, London (2003) 36. Cont, R., Voltchkova, K.: Finite difference methods for option pricing methods in exponential Levy models. SIAM J. Numer. Anal. 43, 1596-1626 (2005) 37. Crandall, M., Ishii, H., Lions, P.-L.: User's guide to viscosity solutions of second order partial differential equations. Bull. Amer. Math. Soc. 27, 1-67 (1992) 38. Crepey, S.,Matoussi, A.: Reflected and doubly reflected BSDEs with jumps: A priori estimates and comparison principle. Ann. Appl. Probab. 18(5), 2041-2069 (2008) 39. Crepey, S., Rahal, A.: Pricing convertible bonds with call protection. Forthcoming in J. Comput. Finance 40. Cvitanic, J., Karatzas, I.: Backward stochastic differential equations with reflection and Dynkin games. Ann. Probab. 24(4), 2024-2056 (1996) 41. Darling, R., Pardoux, E.: Backward SDE with random terminal time and applications to semilinear elliptic PDE. Ann. Probab. 25, 1135-1159 (1997) 42. Delbaen, F., Schachermayer, W.: The fundamental theorem of asset pricing for unbounded stochastic processes. Mathematische Annalen 312, 215-250 (1997) 43. Dellacherie, C., Meyer, P.-A.: Probabilities and Potential. North-Holland, Amsterdam (1982) 44. Dynkin, E.B.: Markov Processes. Springer, Berlin (1965) 45. El Karoui, N., Quenez, M.-C.: Nonlinear pricing theory and backward stochastic differential equations. In: Runggaldier, W. (ed.) Financial Mathematics, Bressanone, 1996. Lecture Notes in Math., vol. 1656, pp. 191-246. Springer, Berlin (1997) 46. El Karoui, N., Peng, S., Quenez, M.-C.: Backward stochastic differential equations in finance. Math. Finance 7, 1-71 (1997) 47. El Karoui, N., Kapoudjian, E., Pardoux, C., Peng, S., Quenez, M.-C.: Reflected solutions of backward SDEs, and related obstacle problems for PDEs. Ann. Probab. 25, 702-737 (1997) 48. Ethier, H.J., Kurtz, T.G.: Markov Processes. Characterization and Convergence. Wiley, NY (1986) 49. Fleming, W., Soner, H.: Controlled Markov Processes and Viscosity Solutions, 2nd edn. Springer, Berlin (2006) 50. Follmer, H., Sondermann, D.: Hedging of non-redundant contingent claims. In: Mas-Colell, A., Hildenbrand, W. (eds.) Contributions to Mathematical Economics, pp. 205-223. North-Holland, Amsterdam (1986) 51. Freidlin, M.:Markov Processes and Differential Equations: Asymptotic Problems. Birkhauser, Basel (1996) 52. Frey, R., Backhaus, J.: Dynamic hedging of synthetic CDO-tranches with spread-and contagion risk. J. Econ. Dyn. Contr. 34(4), 710-724 (2010) 53. Frey, R., Backhaus, J.: Pricing and hedging of portfolio credit derivatives with interacting default intensities. Int. J. Theor. Appl. Finance 11(6), 611-634 (2008) 54. Fujiwara, T., Kunita, H.: Stochastic differential equations of jump type and Levy processes in diffeomorphisms group. J. Math. Kyoto Univ. 25, 71-106 (1985) 55. Hamadene, S.:Mixed zero-sum differential game and American game options. SIAM J. Contr. Optim. 45, 496-518 (2006) 56. Hamadene, S., Hassani, M.: BSDEs with two reflecting barriers driven by a Brownian motion and an independent Poisson noise and related Dynkin game. Electr. J. Probab. 11(5), 121-145 (2006) 57. Hamadene, S., Ouknine, Y.: Reflected backward stochastic differential equation with jumps and random obstacle. Electr. J. Probab. 8, 1-20 (2003) 58. Harraj., N., Ouknine, Y., Turpin, I.: Double-barriers-reflected BSDEs with jumps and viscosity solutions of parabolic integrodifferential PDEs. J. Appl. Math. Stoch. Anal. 1, 37-53 (2005) 59. Herbertsson, A.: Pricing portfolio credit derivatives. PhD Thesis, Goteborg University (2007) 60. Ishii, H., Koike, S.: Viscosity solutions for monotone systems of second-order elliptic PDEs. Comm. Part. Diff. Equat. 16(6-7), 1095-1128 (1991)
About the Pricing Equations in Finance 203 61. Jacod, J.: Calcul Stochastique et Problemes de Martingales, 2nd edn. Springer, Berlin (2003) 62. Jacod, J., Shiryaev, A.N.: Limit Theorems for Stochastic Processes. Springer, Berlin (2003) 63. Jakobsen, E.R., Karlsen, K.H.: A maximum principle for semi-continuous functions applicable to integro-partial differential equations. Nonlinear Differ. Equat. Appl. 13, 137-165 (2006) 64. Jakobsen, E.R., Karlsen, K.H., La Chioma, C.: Error estimates for approximate solutions to Bellman equations associated with controlled jump-diffusions. Numer. Math. 110(2), 221-255 (2008) 65. Jarrow, R.A., Turnbull, S.: Pricing derivatives on financial securities subject to credit risk. J. Finance 50, 53-85 (1995) 66. Jeanblanc, M., Yor, M., Chesney, M.: Mathematical Methods for Financial Markets. Springer, Berlin (2009) 67. Kallsen, J., Kuhn, C.: Convertible bonds: financial derivatives of game type. In: Kyprianou, A., Schoutens, W., Wilmott, P. (eds.) Exotic Option Pricing and Advanced Levy Models, pp. 277-288. Wiley, NY (2005) 68. Karatzas, I.: On the pricing of American options. Appl. Math. Optim. 17, 37-60 (1988) 69. Kifer, Y.: Game options. Finance Stoch. 4, 443-463 (2000) 70. Kunita, H., Watanabe, T.: Notes on transformations of Markov processes connected with multiplicative functionals. Mem. Fac. Sci. Kyushu Univ. A17, 181-191 (1963) 71. Kushner, H., Dupuis, B.: Numerical Methods for Stochastic Control Problems in Continuous Time. Springer, Berlin (1992) 72. Kusuoka, S.: A remark on default risk models. Adv. Math. Econ. 1, 69-82 (1999) 73. Lando, D.: Three Essays on Contingent Claims Pricing. Ph.D. Thesis, Cornell University (1994) 74. Laurent, J.-P., Cousin, A., Fermanian, J.-D.: Hedging default risks of CDOs in Markovian contagion models. Quantitative Finance, 1469-7696, April 2010 75. Lepeltier, J.-P., Maingueneau, M.: Le jeu de Dynkin en theorie generale sans l'hypothese de Mokobodski. Stochastics 13, 25-44 (1984) 76. Ma, J., Cvitani?c, J.: Reflected Forward-Backward SDEs and obstacle problems with boundary conditions. J. Appl. Math. Stoch. Anal. 14(2), 113-138 (2001) 77. Nikeghbali, A., Yor, M.: A definition and some characteristic properties of pseudo-stopping times. Ann. Probab. 33, 1804-1824 (2005) 78. Palmowski, Z., Rolski, T.: A technique for exponential change of measure for Markov processes. Bernoulli 8(6), 767-785 (2002) 79. Pardoux, E., Pradeilles, F., Rao, Z.: Probabilistic interpretation of systems of semilinear PDEs. Annales de l'Institut Henri Poincare, serie Probabilites-Statistiques 33, 467-490 (1997) 80. Peng, S.: Monotonic limit theorem of BSDE and nonlinear decomposition theorem of Doob-Meyer's type. Probab. Theor. Relat. Field. 113(4), 473-499 (1999) 81. Peng, S., Xu, M.: The smallest g-supermartingale and reflected BSDE with single and double L2 obstacles, Annales de l'Institut Henri Poincare (B) Probability and Statistics 41(3), 605-630 (2005) 82. Pham, H.: Optimal stopping of controlled jump-diffusion processes: A viscosity solution approach. J. Math. Syst. Estim. Contr. 8, 1-27 (1998) 83. Protter, P.E.: A partial introduction to financial asset pricing theory. Stoch. Process. Appl. 91(2), 169-203 (2001) 84. Protter, P.E.: Stochastic Integration and Differential Equations, 2nd edn. Springer, Berlin (2004) 85. Schweizer, M.: Option hedging for semimartingales. Stoch. Process. Appl. 37, 339-363 (1991) 86. Windcliff, H.A., Forsyth, P.A., Vetzal, K.R.: Numerical methods for valuing Cliquet options. Appl. Math. Finance 13, 353-386 (2006) 87. Windcliff, H.A., Forsyth, P.A., Vetzal, K.R.: Pricing methods and hedging strategies for volatility derivatives. J. Bank. Finance 30, 409-431 (2006)
Mean Field Games and Applications Olivier Gueant, Jean-Michel Lasry, and Pierre-Louis Lions About this text: This text is inspired from a "Cours Bachelier" held in January 2009 and taught by Jean-Michel Lasry. This course was based upon the articles of the three authors and upon unpublished materials they developed. Proofs were not presented during the conferences and are now available. So are some issues that were only rapidly tackled during class. [RENE: this isn't a complete sentence] The content of this text is therefore far more important than the actual "Cours Bachelier" conferences, though the guiding principle is the same and consists in a progressive introduction of the concepts, methodologies and mathematical tools of mean field game theory. Mean field game theory was created in 2006 by Jean-Michel Lasry and Pierre-Louis Lions and the first results and developments are given in the publications [34-36]: structures, concepts, definitions of equilibria, forward-backward Hamilton-Jacobi-Bellman/Kolmogorov equation systems, existence theorems in static and dynamic cases, links with Nash equilibria and dynamics in n-player games theory when n tends to infinity, variational principle for decentralization, etc. A number of developments were then implemented by Jean-Michel Lasry and Pierre-Louis Lions, several of them in collaboration with Olivier Gueant: notions O. Gueant () UFR de Mathematiques, Universite Paris-Diderot, 175, rue du Chevaleret, 75013 Paris, France e-mail: olivier.gueant@gmail.com J.-M. Lasry Institut de Finance, Universite Paris-Dauphine, Place du Marechal de Lattre de Tassigny, Paris Cedex 16, 75775, France e-mail: lasry@dauphine.fr P.-L. Lions College de France, rue d'Ulm 3, Paris CX 05, 75005, France e-mail: pierre-louis.lions@college-de-france.fr A.R. Carmona et al. (eds.), Paris-Princeton Lectures on Mathematical Finance 2010, Lecture Notes in Mathematics 2003, DOI 10.1007/978-3-642-14660-2_3, c Springer-Verlag Berlin Heidelberg 2011 205
206 O. Gueant et al. of stability of solutions, specific numerical methods, numerical eductive algorithms, and developments in 1/n for a better approximation to n-player games. These developments were presented in three successive courses at the College de France [38], in a Bachelier course, in various publications [23,24] and in Olivier Gueant's PhD thesis [23]. Various applications, notably on the economics of scarce resources, were implemented or are ongoing (in collaboration: Pierre Noel Giraud, Olivier Gueant, Jean-Michel Lasry, Pierre-Louis Lions). Advances in population dynamics were made by Olivier Gueant [23]. Since 2008, several other authors have made further contributions, or are working on new applications and/or properties of MFG models [21, 33]. 1 Introduction to Mean Field Games Mean field game theory is a branch of game theory. It is therefore a set of concepts, mathematical tools, theorems, simulation methods and algorithms, which like all game theory, is intended to help specialists model situations where agents make decisions strategically. These specialists, as in other areas of game theory, will probably be economists (micro or macro), sociologists, engineers and even architects or urban planners. In any case, these applications emerge from the panorama created by the first "toy models" presented in this text. We choose the term "toy models" to indicate the particular status of game theory and of its many "examples". Consider the famous "prisoner's dilemma". Nobody thinks of taking the story literally, nor that this example was created to be applied to the real-life situation it is supposed to evoke. In fact it is a fable intended to introduce an archetype of strategic interaction: an archetype that can thus be recognized in many negotiation situations in business life and elsewhere. Many of our examples have a similar status. "What time does the meeting start?" or the "Mexican wave equation" should not be taken literally, as a desire to scientifically model these situations in social life. Even if there is clearly an element of truth in our models for these two examples, we believe that the interest for the reader is primarily in the structure that is indicated through these "toy models". The Mexican wave equation, for example, shows how a sophisticated propagation phenomenon in a social setting can be constructed from non-cooperative individual behaviors in a rationalexpectations context, once a certain taste for imitation is present in agents' utility function. Introducingmean field games through these "toy models" is also a way of leading the reader to progressively discover the concepts and the mathematics of mean field game theory. In this text we present a large number of results and mathematical proofs. Nevertheless, we cover only some parts of the large mathematical corpus built up since 2006. Thus for mathematicians this course can be seen as an introduction, or
Mean Field Games and Applications 207 a reading in parallel with the mean field games mathematical literature and with the three different courses held by Pierre-Louis Lions at the College de France (06-07, 07-08, 08-09), which present the whole mathematical corpus and which can be downloaded from the College de France website [38]. 1.1 Three Different Avenues There are three routes leading naturally to mean field game theory. Each route casts light on a particular aspect of mean field game theory, and the three complement each other. 1.1.1 First Route: From Physics to Mean Field Games The first route takes its departure from particle physics.1 In particle physics, mean field theory designates a highly effective methodology for handling a wide variety of situations in which there are too many particles to permit the dynamics or equilibrium to be described by modeling all the inter-particle interactions. The enormous number of all these interactions makes a detailed model ineffective - unreadable and unsuitable for both calculation and simulation, the model becomes unusable. Nevertheless, in many situations of this kind, it is possible to construct an excellent approximation to the situation by introducing one or more "mean fields" that serve as mediators for describing inter-particle interactions. In this kind of model, one describes the contribution of each particle to the creation of a mean field and the effect of the mean field on each particle by conceiving each particle as infinitesimal, i.e. by carrying out a kind of limit process on the number n of particles (n>?). A large proportion of types of inter-particle interactions, though not all, lend themselves to this methodology: the inter-particle interactions must be sufficiently "weak" or "regular" in order for the statistical phenomena to emerge. Mean field game theory provides an adaptation of this methodology to cases in which the particles are replaced by agents who mutually interact in socioeconomic and/or strategic situations. The main difference - indeed the challenge - is to take account not only of the ability of agents to make decisions, but also the capacity for strategic interaction, i.e. the capacity of each agent to construct strategies that involve thinking about his peers, who in turn and at the same time follow their own individual strategies. 1 Several articles were written using the mean field notion of physicists and applying it to economic dynamics. One may see [15,16] or [27] as instances of such an approach. Our approach is different from the approach of the "econophysicists" since we are more influenced by control theory and hence more keen on mixing optimization and mean fields. As a consequence, the forward/backward structure of our approach is not present in most of the preceding works.
208 O. Gueant et al. This new sophistication changes the nature of the mean field: it is no longer a statistic on the domain of particle states, but rather a statistic on the domain of agent states and hence in the domain of strategies and information. This first route is certainly the one that sheds the most light on the operating characteristics of mean field game theory: since the methodology of mean fields works very well in particle physics and provides computable and readable [RENE: this doesn't make any sense] models in a priori complex situations, it offers a good prospect for transposition to the world of agents. But this route is also the most demanding, and would probably be the most discouraging on any initial attempt. Mean field game theory has been able to emerge only because N-player game theory has long existed, thanks to the remarkable pioneering work carried out by Von Neumann and Morgenstern [47] sixty years ago and to the important developments made since then, notably by Nash [43-46] and then Aumann [9], and through the many applications that have been developed, particularly in most branches of economics. What we want to provide is indeed a new branch of game theory for large games that relies on Nash equilibria and on the various concepts introduced in this field during the last 50 years. We are not applying, mutatis mutandis, the tools of statistical physics to economic problems. This is an important difference between mean field games and econophysics and we need to insist on it. Econophysicists only apply theories and methods originally rooted in physics to describe an economy and, although they often manage to have good models for the topics under scrutiny, these models are only descriptive. For instance, econophysicists manage to have good descriptive models for wealth distributions using only kinetic models and microscopic interactions (see [14]) but they never explain why people may want to exchange money as in their models (our last model can be seen as an attempt to model wealth distributions in a different way). Mean field game theory proposes to use the tools of physics but to use them within the classical economic paradigm, to explain (and not only to describe) phenomenon. Hence we will assign rationality to agents and not regard them as just gas particles, and not even as robots applying some predetermined behavioral strategy: strategic choices are endogenous in our models as they are in game theory. 1.1.2 Second Route: From Game Theory to Mean Field Games This route is the most well-charted from a mathematical standpoint: it involves studying the limit of a large class of N-player games when N tends to infinity. Usually, differential games with N-players can be summed up by an HJB-Isaacs system of PDEs that turns out to be untractable. Fortunately things are simplified, at least for a wide range of games that are symmetrical in the players as their number increases, and for deep reasons. Indeed, interpersonal [RENE: this is not the right word] complex strategies can no longer be implemented by the players, for each player is progressively lost in the crowd in the eyes of other players when the number of players increases.
Mean Field Games and Applications 209 More precisely, the class that proves to be best suited to this passage to the limit is that of games in which players of the same kind can be interchanged without altering the game: a form of anonymity of context where nothing is dependent on the individual. This hypothesis is particularly appropriate in the modeling of applications when there are a large number of players. From a mathematical standpoint this hypothesis of invariance through permutation is crucial in moving to the limit. Moving to the limit causes a situation to emerge in which each player has become infinitesimal amidst the mass of other players, and constructs his strategies from his own state and from the state of the infinite mass of his co-players, who in turn simultaneously construct their strategies in the same way. It is this equilibrium of each player in the mass of co-players that we term the mean field approach. Continuums of players are not new in the literature and they have been widely used since Robert Aumann and his seminal paper on general equilibrium with infinitely many players (see [9]). However, our approach is different in many ways from what has been studied up to now (see the literature on large games for instance - [29-32]). An example is the set of specific partial differential equations systems developed and studied in the seminal articles [34-36] and in [38]. Another instance is the approximation of a N-player game by a mean field game and the study on the error term in 1N (see our first toy model). This strategy of approximation allows us to constrain the strategies of the players (since no complex strategies involving specific players can be played) and hence to reduce the finite dimension of the game to a granularity effect that leads to a common noise for the group of players. 1.1.3 Third Route: From Economics to Mean Field Games In the theory of general economic equilibrium, agents have little concern for each other: everyone looks only to his own interest and to market prices. The only level at which the existence of others applies is found in the hypothesis of rational expectation. A theory is viewed as credible from the standpoint of rational expectations only if each agent can check whether, by putting himself in the place of others, he would find the behavior predicted by the theory. This is the only requirement that removes the agent of general equilibrium from his solipsism. In other words, in the theory of general equilibrium, pricesmediate all social interactions. Yet we know that in many cases there are other economic effects which give rise to other interactions between agents: externality, public goods, etc. The incorporation of these effects when they are of a statistical nature, which is most often the case, leads to a "mean field"-type definition (in the sense given above) of equilibrium between agents. Similarly, the issues of industrial economics in which agents are involved in complex systems of signaling, entry barriers, positioning in relation to the competition, etc. can become mean field games equilibria as the size of the groups of agents concerned grows. These interactions between agents are the main interests of economists. They want to understand how prices form through rational behaviors and the consequence of externality effects. Also, economists are interested in the evolution of an economy
210 O. Gueant et al. and hence they have been spending a lot of time on anticipation and the way prices or, more generally, behaviors form in an intertemporal context. This field of economics is clearly untractable for econophysicists since econophysics only considers forward problems without anticipations except perhaps from a heuristical point of view that makes the backward dimension vanish. That's another difference between mean field game theory and the mean fields of econophysicists: mean field games have a forward/backward structure. In most mean field games models, we try not only to describe but also, and most importantly, to explain a phenomenon using the economic toolbox of utility maximization and rational expectations. Hence mean field game theory appears as a toolbox to be used by economists and not as a new competing paradigm in social sciences that avoids considering the major methodological advances made by economists in the last decades. 1.2 Fields of Application 1.2.1 Mean Field Games Versus N-PlayerModeling These three routes place the representation of agents in mean field game theory. They are more sophisticated than the agents of general equilibrium in economics, who as we have seen are largely indifferent to their co-agents and are concerned only with prices. Conversely, the agents of mean field game theory are less sophisticated than the players of N-player game theory since they base their strategies only on the statistical state of the mass of co-agents. Nevertheless, this lesser sophistication of the mean field games agent compared to theN-player game theory player produces by way of compensation a wide variety of positive effects in two very different respects: in terms of efficiency on the one hand and of widening the field of application on the other. As far as efficiency is concerned A large part of this efficiency and readability comes from the possibility of deploying the power of differential calculus. This advantage is, moreover, one of the differences between mean field games and other prior developments already mentioned in games with an infinite number of players. These works, which follow from Robert Aumann's outstanding contribution, basically use measure theories, as we do, to represent the continuum of players, but they only use measure theory. From a mathematical standpoint, mean field game theory takes a completely new direction by opening the door to extensive use of differential calculus. Differential calculus has been one of the most powerful and productive tools for some 300 years and there have been major advances in the last decades in many applied fields outside physics: applications of partial differential equations (PDE) to control problems, Ito or Malliavin stochastic calculus, SPDE, advanced methods of functional analysis,
Mean Field Games and Applications 211 etc. Mean field game theory has moreover enabled a new and autonomous corpus to be developed in this mathematical field, including at the junction of differential calculus and measure theory, in the form of sophisticated developments in the geometry of Wasserstein spaces. An enlargement of the field of application: two examples 1. A substantial gain in relation to N-player game theory derives from the ease with which questions of player entries and exits can be dealt with. Indeed, through the representation of players by a continuum, the modeling of the renewal of player generations is no longer a problem. Like time and player distribution in space, states are continuous variables, and entries and exits are simple flows whose technical treatment presents no special problems. One can thus implement overlapping generation models without pain. 2. The emergence of a social dimension to mean field games models, since, in these models, statistical data on other players emerge as fundamental constituents of individual strategies. From this point of view, the approximation of N-player games by the mean field games limit with (if necessary) the use of the corrective 1/Nterm, allows this approach to introduce a "social" dimension in regard to players, even in limited groups of, say, a few hundred agents. In view of the benefits compared with N-player games, it seems quite natural to us to consider mean field games as "solutions" to problems of N-player games. Consider, for example, an N-player game where N is fairly small (on the order of a few dozen) and with player entries and exits. It is very likely that in a large number of cases themean field games limit (N >?) provides a good first approximation to the N-player solution and that the first term of the development in 1/N is sufficient to described with enough precision the effects due to granularity (produced by the fact that N is finite and rather small). Thus there is a wide field of application for mean field games models. It ranges from general equilibrium with externality to the Mexican wave, and its center of gravity seems to us, from today's standpoint, to be socioeconomic modeling in a rational expectations context. 1.2.2 A Large Family of Examples To illustrate the different aspects of mean field game theory, and to indicate something of its domains of application, we shall in the follow-up to this course present a series of "toy models". In other words, as we mentioned above, we generally present extremely stylized models, which are not to be taken literally and require being reworked by specialists, but which show the possible architecture of applications to various questions: : Effects of coordination and interactions in the face of externality (meeting time) : Production of a limited resource (peak oil, Hotelling's rule)
212 O. Gueant et al. : Mimicry and propagation of behaviors in the social area (Mexican wave, forenames, fashion, etc.) : Agoraphobia/agoraphilia, search for identity, etc. (quadratic-Gaussian population models) : Distortion of financial management in the presence of a signaling problem (managers and classification) : Effects of competition on the dynamics of human capital (Pareto-type distribution of salaries: an example of the positive effect of negative externality) In the course of presenting these "toy models", the mathematical concepts and methods, indeed the whole mean field games toolbox, will become progressively apparent. The considerations mentioned above will thus acquire substance. 1.3 The Mathematical Tools of the Mean Field Approach The implementation of the mean field game theory as a modeling methodology led to writing new types of systems of equation, then developing the mathematical apparatus required for handling these equations: theorems for the existence of solutions, numerical calculation algorithms, specific definition of stability, variational principles, etc. We shall return in the conclusion of this course to the mathematical corpus which the reader will be able to discover through these examples. 2 A First Toy Model:When Does the Meeting Start? We begin with a "toy model" constructed as a series of episodes, or rather as the old TV show "Double your Money", in which the dramatic tension progressively grows. We shall here adopt the serious true/false-type question: "What time does the meeting start?". We recall what was previously said in the introduction on the role of "toy models", of which the prisoner's dilemma is archetypical. Nevertheless, we shall proceed as if it involved a scientific investigation of the subject, by tackling it in an increasingly sophisticated step-by-step manner.We therefore begin with a relatively simple framework, then we progressively add various difficulties to give the model greater depth and at the same time reveal the technological answers provided by the mean field games approach. As this "toy model" is presented, we hope the readers will come to feeling that it applies to real examples they are particularly familiar with. In the next section, we shall offer a stylized model of oil production over a long period of time that will show how our "toy model" can shed light on more serious contexts.
Mean Field Games and Applications 213 2.1 An First Simple Model 2.1.1 Introduction A meeting scheduled for a certain time t very often only starts several minutes after the scheduled time. The actual time T when the meeting starts depends on the dynamics of the arrival of its participants. If a rule sets the start of the meeting at the point when a certain quorum is reached, this rule sets up a form of strategic interaction between agents. We shall construct a first mean field games approach to this situation. We consider a meeting with a very large number of participants and we consider them as a continuum of agents (the justification will be provided further on). Our agents are rational and understand the situation. More precisely, all the data that we shall provide pertaining to the problem is common knowledge to the meeting participants. Three moments will be important in this model: : t the scheduled time of the meeting. : ?i the time at which agent i would like to arrive in view of the problem. In reality, we suppose that he will arrive at time ??i = ?i + ?i?i where ?i is a normal noise with variance 1, specific to agent i (hypothesis of idiosyncratic noise2). More precisely, ?i is a variable controlled by the agent i and ?i?i is an uncertainty the agent is subject to. These uncertainties and their intensity differ in the population of agents since some agents come a long way to participate in the meeting and others are very close. We will note m0 the distribution of ?i in the population. : T the time which the meetingwill start at (the rule which sets the meeting starting time T according to the arrival of participants is given further on). To decide on his arrival time, or at least his intended arrival time ?i, each agent will optimize a total cost that, to simplify things (since it is "toy model"), we assume is made up of three components: : A cost (reputation effect) of lateness in relation to the scheduled time t: c1(t, T, ??) = ?[?? ? t]+ : A cost (personal inconvenience) of lateness in relation to the actual starting time of the meeting T : c2(t, T, ??) = ?[?? ? T ]+ : A waiting time cost that corresponds to the time lost waiting to reach time T : c3(t, T, ??) = ?[T ? ?? ]+ 2 This hypothesis of independence will simplify the equations to determine the equilibrium.
214 O. Gueant et al. Let us note c(t, T, ??) the sum of these three costs which is a convex function of ?? . We can already make the model more complex by assuming different values for c1, c2, c3 according to the agent, but our goal is precisely the opposite: to make it simple in order to explain the methodology. 2.1.2 Resolution The optimization problem that each agent faces is therefore to minimize his expected total cost. Nash-MFG equilibrium, with rational expectations, presupposes that each agent optimizes by assuming T to be known. T is a priori a random variable but because we consider an infinite number of players, the "law of large numbers" will imply that T is deterministic and we consider a deterministic T from now.3 For agent i the problem is therefore: ?i = argminEc(t, T, ??i), ??i = ?i + ?i?i Here T is the mean field, the exhaustive summary for each agent of the behavior of the others. The exercise is to show the existence of a fixed point T , i.e. to show that individual optimization behaviors, supposing T is known, fully generate the realization of this time T . To show that this equilibrium exists, one must first examine more closely agents' individual choices, which is done simply by obtaining a first-order condition. Proposition 1 (FOC). The optimal ?i of an agent having a ? equal to ?i is implicitly defined by: ?N ?i ? t ?i + (? + ?)N ?i ? T ?i = ? where N is the cumulative distribution function associated to a normal distribution. Proof. The expression to minimize is: E?[??i ? t]+ + ?[??i ? T ]+ + ?[T ? ??i]+= E?[??i ? t]+ + (? + ?)[??i ? T ]+ ? ?(??i ? T )= ?E[?i ? t + ?i?i]++ (? + ?)E[?i ? T + ?i?i]+? ?(?i ? T ) 3 Hence rational expectations are simply perfect expectations.
Mean Field Games and Applications 215 The first order condition of the problem is therefore given by: ?P ?i ? t + ?i?i > 0+ (? + ?)P ?i ? T + ?i?i > 0= ? ?N ?i ? t ?i + (? + ?)N ?i ? T ?i = ? Since N is a strictly monotonic cumulative distribution function and since the three parameters ?, ? and ? are positive, the existence and uniqueness of ?i can be deduced easily. From this characterization of ?i as a function of (t, T, ?i) we can deduce the dynamics of agents' arrival. For this let us consider first of all the distribution m0 of the ?i within the continuum. Because of the continuum and the law of large numbers, this distribution is transported by the application ?i > ??i. If we therefore note F the (deterministic!) cumulative distribution function of the agents' real arrival times, it is natural to establish a rule on the real starting time T from the meeting, which depends on the function F(-). An example is that of a quorum: the meeting starts after the scheduled time and only when a proportion ? of the participants have arrived. We then have to prove the existence and uniqueness of a fixed point. Starting from a value T , we obtain agents' optimal strategies (?i(-; T ))i. These optimal strategies are the targeted times but each person's arrival time is affected by a noise: we obtain the real arrival times (??i(-; T ))i. Then from the law of large numbers and the hypothesis of the independence of agents' uncertainties, these arrival times are distributed according to F, which is deterministic, and T is deduced from F by the meeting starting time rule (T ?(F)), in this case the quorum. This is straightforwardly summarized by the following scheme: T ?? : T > (?i(-; T ))i > (??i(-; T ))i > F = F(-; T ) > T ?(F) The result we obtain is as follows: Proposition 2 (Equilibrium T). If? > 0, ? > 0, ? > 0 and if 0 /?supp(m0) then T ?? is a contraction mapping of [t;+?[, and there is a unique solution T to our problem. Proof. First, let's differentiate with respect to T the first order condition that defines ?i. d?i dT ?N?i ? t ?i + (? + ?)N?i ? T ?i = (? + ?)N?i ? T ?i Since 0 is supposed not to be in the support of m0, this leads to d dT ?(t, ?; T ) ? k < 1.
216 O. Gueant et al. Hence, ?T, s, h > 0, F(s; T + h) = P(?i(?i; T + h) + ?ii ? s) ? P(?i(?i; T) + kh + ?ii ? s) = F(s ? kh; T ) Consequently, T ?(F(-; T + h)) ? T ?(F(- ? kh; T )) ? T ?(F(-; T )) + kh ? T ??(T + h) ? T ??(T ) ? kh and this proves the result through the contraction mapping theorem. It is interesting to notice that the quorum case is not special in the sense that the preceding proof only requires the T setting rule (T ? : F(-) > T ) to verify the following properties for the above result to be true. : ?F(-), T ?(F(-)) ? t: the meeting never starts before t : (Monotony) Let's consider two cumulative distribution functions F(-) and G(-). If F(-) ? G(-) then T ?(F(-)) ? T ?(G(-)) : (Sub-additivity) ?s > 0, T ?(F(- ? s)) ? T ?(F(-)) ? s In the more general case where the cost depends on F, strategic interaction no longer simply reduces to time T . It is very natural that the social cost for each agent depends on the proportion of participants who are already there when he arrives. In this more general case, F is the mean field: each person makes his decision according to F. In return, the decisions construct F. From a mathematical standpoint, the fixed point concerns F. 2.2 Variations There aremany possible ways of enriching this initial "toymodel". For example, one variant involves considering a shared disturbance in addition to the idiosyncratic disturbances. This is an important variant as it is an example where the dynamics of the population is stochastic. Nonetheless, as it would lead us to too long developments we will not consider this variant here. The variant we shall present is a "geographical"model, i.e. the agents are initially distributed in different places and must come to where the meeting is being held. The interest of this variant is that it will show how coupled forward/backward PDEs, which are the core of mean field game theory (in continuous time, with a continuous state space), emerge.
Mean Field Games and Applications 217 2.2.1 The Framework Thus let us suppose that the agents are distributed on the negative half-line according to distribution function m0(-) (with compact support and such that m0(0) = 0) and that they must go to the meeting held at 0. Suppose that in order to get to 0, an agent i moves according to the process dXi t = aitdt + ?dWi t where drift a is controlled in return for a quadratic cost 12a2 (here ? is the same for everyone). This distribution hypothesis may seem to be a rather artificial representation in this example of transport uncertainties. In practice, we shall see that it is relatively pertinent in other applications. Each agent is thus faced with an optimization problem, written as: Mina(-)Ec(t, T, ??i) + 12 ??i 0 a2(t)dtwith Xi0= x0, dXi t = aitdt + ?dWi t and the time to reach 0 is given by ??i = min{s/Xis= 0}. If one looks for a Nash-MFG equilibrium, one will reason at a given T and each agent's problem is one of stochastic control.We thus have the following Hamilton- Jacobi-Bellman equation4: 0 = ?tu+min a a?xu + 12a2+ ?2 2 ?2xxu This equation can be written: (HJB) ?tu ? 12 (?xu)2 + ?2 2 ?2xxu = 0 The condition at the limit is simply ??, u(?, 0) = c(t, T, ?), where T is deterministic for the same reason as before. This condition corresponds to the total cost on arrival at the meeting (we will assume that c has the same shape as in the preceding setup but we impose c not to be piecewise-linear but twice continuously differentiable). The Hamilton-Jacobi-Bellman equation gives a Bellman function u and hence indicates the optimal behavior of agents for a fixed T . This equation is the same for all agents since they have the same cost criterion and differ only in their point 4 As it is often the case in this text, we will consider that the solution of the Hamilton-Jacobi- Bellman equation is a solution of the optimization problem. In general, if we do not provide any verification result for the solutions of the mean field games partial differential equations, it should be noticed that verifying (u,m) indeed provides a solution of the optimization problem is like verifying u, solution of the Hamilton-Jacobi-Bellman equation with m fixed, provides a solution of the optimization problem with m fixed. Hence, there should not be specific tools of verification for mean field games.
218 O. Gueant et al. of departure at the initial moment. Moreover, the solution here is Markovian as in most stochastic optimization problems and the strategy, i.e. the optimal drift a(s, x) = ??xu(s, x) therefore depends only on the place x and the time s. Thus, in particular, it does not depend on the agent concerned: the agents, whom unknown factors lead to the same point x at time s, adopt the same strategy, which is natural, since they have the same information, same transport costs and same final criterion. This property simplifies the expression of the problem. The "law of large numbers" then gives us the distributionmof agents through the Kolmogorov equation.5 This distribution corresponds to the distribution of players who have not yet arrived at 0 and therefore m loses mass (through 0), as agents gradually arrive at the meeting. The dynamics of m is: (Kolmogorov) ?tm + ?x((??xu)m) = ?2 2 ?2xxm m(0, -) = m0(-) is obviously fixed, and we will try to find a solution with the following "smooth fit" condition: m(-, 0) = 0. Moreover, as we have chosen to model the problem by the dynamics of Brownian diffusion, the model must be complemented and restricted to a compact domain. In the proof that follows, we suppose that the domain is [0, Tmax]?[?Xmax, 0] and the boundary conditions are u(Tmax, -) = c(t, T, Tmax), u(-,?Xmax) = c(t, T, Tmax), m(-,?Xmax) = 0 In this context, the flow reaching 0 (when the agents reach the meeting place) is s > ??xm(s, 0). Thus the cumulative distribution function F of arrival times is defined by F(s) = ?s 0 ?xm(v, 0)dv Now, T is fixed by the quorum rule (with let's say ? = 90%) but we impose that it must be in the interval [t, Tmax]. In otherwords: T = ???? ??? t, if F?1(?) ? t Tmax, if F(Tmax) ? ? F?1(?), otherwise 5 Note that this is based not only on the independence hypothesis of noises but also on the simple structure of noises. For example, if volatility depends on state, the associated elliptic operator would replace the Laplace operator. Also, If noises were not independent, the deterministic partial differential equation would have to be replaced by a stochastic one. For all these developments, we refer to [38].
Mean Field Games and Applications 219 2.2.2 Existence of an Equilibrium for the Meeting Starting Time As in the first simple case, we need to prove that there is a time T coherent with the (rational) expectations of the agents. We are going to use a fixed point theorem as before. Indeed, one goes from a given T and deduces u. The Kolmogorov equation then gives us m and therefore the arrival flow at 0. Since the time T in our example is given by the arrival of a proportion ? of all the agents, it clearly is a matter of fixed point. Before going deeply in the mathematics, let's introduce some hypotheses: : We suppose that T > c(t, T, ?) is a continuous function : We suppose that ? > c(t, T, ?) is a C2 function : We suppose thatm0(0) = m0(?Xmax) = 0. Also, we suppose that |m0(0)| > 0 and |m0(?Xmax)| > 0 Now, we consider the following scheme (the functional spaces involved in the scheme will be proved to be the right ones in what follows): T > c(t, T, -) ? C2 > u ? C2 > ?xu ? C1 > m ? C1 >??xm(-, 0) ? C0(> F) > T Since the scheme is from [t, Tmax] to [t, Tmax], to obtain a fixed point result, we just need to prove that the scheme is continuous. The first part of the scheme (T > c(t, T, -) ? C2) is continuous and well defined by hypothesis. For the second part of the scheme (c(t, T, -) ? C2 > u ? C2), we just state a lemma: Lemma 1. Let's consider the following PDE: (HJB) ?tu ? 12 (?xu)2 + ?2 2 ?2xxu = 0 with the boundary conditions u(-, 0) = c(t, T, -) u(Tmax, -) = c(t, Tmax, Tmax), u(-,?Xmax) = c(t, Tmax, Tmax) The solution u is in C2(]0, Tmax[?] ?Xmax, 0[) and ?K, ?T ? [t, Tmax], ?xu is a K-Lipschitz function. Moreover the mapping c(t, T, -) ? C2 > u ? C2 is continuous. Now that we get u and then the control ??xu we can turn to the Kolmogorov equation.We state a lemma that is an application of Hopf's principle. Lemma 2. Let's consider the following PDE: (Kolmogorov) ?tm+ ?x(am) = ?2 2 ?2xxm
220 O. Gueant et al. with a a C1 (and hence Lipschitz) function and the boundary conditions m(0, -) = m0(-), m(-, 0) = 0, m(-,?Xmax) = 0 where m0 is supposed to verify the above hypotheses. Then the solution m is in C1((0, Tmax) ? (?Xmax, 0)) and ?> 0, inf |?xm(-, 0)| ? Moreover only depends on the Lipschitz constant of the function a. Also the mapping a > m ? C1 is continuous. From these two lemmas, we can deduce a third one adapted to our problem. Indeed, since u is a C2 function, a = ??xu is a Lipschitz function and hence we have a lower bound to the flow arriving at the meeting: Lemma 3. ?> 0, ?T ? [t, Tmax], inf |?xm(-, 0)| ? Now, let's consider the mapping ? : ??xm(-, 0) ? C0 > T , defined above using (here) the quorum rule. We are going to prove that ? is continuous as soon as ??xm(-, 0) has a strictly positive lower bound. Lemma 4. ? is a Lipschitz function on C0([0, Tmax],R?+). Proof. Let's consider two functions ?1 and ?2 that stand for two possible flows of arrival and let's define a common lower bound to these two functions. Then, let's define T1 = ?(?1) and T2 = ?(?2). If T1 and T2 are both in ]t, Tmax[, then, assuming T1 ? T2, we can write: 0 = T1 0 ?1 ? T2 0 ?2 = T1 0 (?1 ? ?2) ? T2 T1 ?2 ? (T2 ? T1) ? T2 T1 ?2 = T1 0 (?1 ? ?2) ? Tmax|?1 ? ?2|? Hence, in this case, the function is Lipschitz. In all other cases, still assuming T1 ? T2, we have instead of an equality the following inequality: T1 0 ?1 ? T2 0 ?2 ? 0 and the result follows from the same reasoning. Thus, the function is Lipschitz and hence continuous. By now, we have proved that the scheme is continuous and therefore, using the Brouwer fixed point theorem we have existence of an equilibrium T . Proposition 3 (Existence). The scheme that defines the actual T as a function of the anticipated T is continuous and has at least one fixed point. Hence, there is at least one equilibrium T .
Mean Field Games and Applications 221 2.2.3 Comments This variant is a good example of a mean field game in continuous time and the mechanism will often be the same. First agents anticipate what will be the dynamics of the community and hence anticipate m. Here, the relevant information was captured by T that is a function of m so that they had to anticipate m to anticipate T . From this anticipation agents use a backward reasoning described by the Hamilton-Jacobi-Bellman equation. Then, from this equation, individual actions can be plugged into the forward equation (the Kolmogorov equation) to know the actual dynamics of the community implied by individual behaviors. Finally, the rational expectation hypothesis implies that there must be coherence between the anticipated m and the actual m. This forward/backward mechanism is the core of mean field game theory in continuous time and we will see it in action later on. 2.3 Mean Field Games Equilibrium as the N-Player Nash Limit Equilibrium 2.3.1 Introduction Let us return for the sake of simplicity to our first model. It is now time to come back to the continuum hypothesis by considering the game with N players. To simplify the account, and because it involves a "toy model", we look at the same particular case as above (which is rather technical since the criterion is not regular but is very graphic) in which the meeting begins once a proportion ? (we shall assume ? = 90% for the sake of simplicity) of the participants have arrived (but still we force T to be between times t and Tmax). In addition, let us suppose that all the agents have the same ?. Various questions then naturally arise: : Does the N-player game have Nash equilibria? : Is there uniqueness of such equilibria? : Do N-player equilibria tend towards the mean field games equilibrium when N >?? : If need be, is the rate of convergence known? This case is simple, but it allows - since we shall answer the above questions in the affirmative (in the symmetrical case) - to pave the way for an approximation of an N-player game by MFG. This example of approximation of a N-player game through a first order expansion "G0 + 1NG1 + . . .", where (formally) G0 is the mean field game and G1 the first order correction coefficient, leads to a new type of solution of a N-player game equilibrium. The solution of "G0 + 1N G1" reflects a strategic world in which agents
222 O. Gueant et al. do not care about other agents, individually at least, but only about the population dynamics and a world in which N, the number of players, is only entered to take into account the "granularity" of the game and the imperfectness of the continuum hypothesis. 2.3.2 Solution of the N-Player Games To simplify, let us say that the number of players is N = 10k (k = 1, 2, 3, . . .) and thus that the meeting begins with the arrival of the 9kth player. A given player (let us say player 1) will aim for an arrival time ?? which should verify (symmetrical Nash equation): ?? = argmin?1E[C(?1 + ??1, ?? + ??2, . . . , ?? + ??N)] This function C does not really depend on all the components of (?? + ??2, . . . , ??+??N) but only on two statistics of order ??+??(9k?1) and ??+??(9k) where one has noted ?(r) the rth element, in the order, in {?2, . . . , ?N}. Indeed it is obvious that the 90-percentile of (?1 + ??1, ?? + ??2, . . . , ?? + ??N) is hidden among ?1 + ??1, ?? + ??(9k?1) and ?? + ??(9k). Thus the Nash equilibrium is characterized by: ?? = argmin?1E[G(?1 + ??1, ?? + ??y, ?? + ??z)] where (?y, ?z) are statistics of order corresponding to the (9k?1)th and 9kth ordered elements of {?2, . . . , ?N}. Hence, the variables (?y, ?z) are independent of ?1. Taking up the initial model, the function G is defined by: ?a, ?b, ?c ? b, G(a, b, c) = G(a, t ? b ? Tmax, t ? c ? Tmax) ?b ? c ? [t, Tmax],G(a, b, c) = ?????? ????? ??(a ? b) a ? t ??(a ? b) + ?(a ? t) a ? (t, b] ?(a ? t) a ? (b, c] ?(a ? t) + ?(a ? c) a > c We have the following property: Lemma 5. ?b, ?c ? b, a > G(a, b, c) is continuous, piecewise linear and convex. G is not practical for optimization purposes. Let's introduce H the function (?1, b, c) > ??? G(?1 + ?x, b, c)N(x)dx where N still is the cumulative distribution function of a normal variable with variance 1.
Mean Field Games and Applications 223 Lemma 6. ?b ? c, H is a strictly convex function of ?1 that decreases and then increases. Moreover, we can compute some derivatives (t ? b ? c ? Tmax): ?1H(?1, b, c) = ??N b ? ?1 ? + ?1?N t ? ?1 ? +? 1?N c ? ?1 ? ?211H(?1, b, c) = 1? ?Nb ? ?1 ? + ?Nt ? ?1 ? + ?Nc ? ?1 ? ?212H(?1, b, c) = ?1? ?Nb ? ?1 ? ?313H(?1, b, c) = ?1??Nc ? ?1 ? Proof. ? ?? G(?1 + ?x, b, c)N(x)dx = 1? ? ?? G(t, b, c)Nt ? ?1 ? dt Hence, we can differentiate with respect to ?1 and we get: ?1H(?1, b, c) = ? 1 ?2 ? ?? G(t, b, c)Nt ? ?1 ? dt = ?1? ? ?? G(?1 + ?x, b, c)N(x)dx Then, using derivatives in the distribution sense, we get: ?1H(?1, b, c) = ? ?? ?1G(?1 + ?x, b, c)N(x)dx ?1H(?1, b, c) = ? ??[??1?1+?x?b + ?1?1+?x?t + ?1?1+?x?c]N(x)dx ?1H(?1, b, c) =??N b ? ?1 ? + ?1?N t ? ?1 ? +? 1?N c ? ?1 ? 
224 O. Gueant et al. We can differentiate once again and we get: ?211H(?1, b, c) = 1? ?Nb ? ?1 ? + ?Nt ? ?1 ? + ?Nc ? ?1 ? This is strictly positive so that H is strictly convex as a function of the first variable. SinceH(?1, b, c) = E[G(?1+??1, b, c)] ? G(E[?1+??1], b, c) = G(?1, b, c), H must be decreasing and then increasing. Other derivatives are straightforwardly given by: ?212H(?1, b, c) = ?1? ?Nb ? ?1 ? ?313H(?1, b, c) = ?1??Nc ? ?1 ? Let's now recall that we want to find a symmetrical Nash equilibrium and the condition is given by: ?? = argmin?1E[G(?1 + ??1, ?? + ??y, ?? + ??z)] Clearly this can be rewritten using the function H and we get: ?? = argmin?1E[H(?1, ?? + ??y, ?? + ??z)] Using the first order condition associated to the preceding minimization we see that we need to better understand the function ?1H. The following lemma will be helpful in what follows because it introduces compactness in the problem: Lemma 7. B = {?1|?b ? c, ?1H(?1, b, c) = 0} is a bounded set. Proof. The set we introduced corresponds to the set of points at which H reaches its minimum for all possible couples (b, c) with b ? c. Because ?a, ?b, ?c ? b, G(a, b, c) = G(a, t?b?Tmax, t?c?Tmax), the same type of properties applies for H and hence our set B is the same as {?1|?(b, c), t ? b ? c ? Tmax, ?1H(?1, b, c) = 0} Now, ?1H(?1, b, c) = 0 implicitly defines a function ?1(b, c) that is continuous and hence the set B is compact (and then bounded) as the image of a bounded set ({(b, c), t ? b ? c ? Tmax}) by a continuous mapping. 
Mean Field Games and Applications 225 Let's introduce now the best response function of agent 1. This function ? is defined as: ?(??) = argmin?1E[H(?1, ?? + ??y, ?? + ??z)] Another (though implicit) definition of this function is based on the first order condition: E[?1H(?(??), ?? + ??y, ?? + ??z)] = 0 (?) Lemma 8. ???, infB ? ?(??) ? supB Proof. Since H is decreasing and then increasing as a function of the first variable, we clearly now that ?? < infB: E[?1H(?, ?? + ??y, ?? + ??z)] < 0 Hence infB ? ?(??). The other inequality is obtained using the same reasoning.Since a Nash equilibrium simply is a fixed point of ?, we can restrict ? to the set K = [inf B, supB]. If we define ?|K : ?? ? K > ?(??), we see that any symmetrical Nash equilibrium must be a fixed point of ?|K. Now we have our last lemma before the existence and uniqueness theorem that says: Lemma 9. ?|K is a contraction mapping from K to K. Proof. Let's go back to the implicit definition of the function ? given by (?). Using the implicit function theorem we have: ?(??)=?E[?212H(?(??), ?? + ??y, ?? + ??z) + ?213H(?(??), ?? + ??y, ?? + ??z)] E[?211H(?(??), ?? + ??y, ?? + ??z)] Since 0 < ??212H ? ?213H <?211H, we have 0 ? ?(??) < 1. Now because K is compact, there exists a constant ? > 0 so that ??? ? K, ?|K(??) ? 1 ? . Now using a classical fixed point result we have: Proposition 4 (Existence and Uniqueness). There exists a unique symmetrical Nash equilibrium for the game with N players. Remark: We restrict ourselves to cases where N = 10k and ? = 90% for the sake of simplicity but the preceding result is still true for all N and ?.
226 O. Gueant et al. 2.3.3 Approximation in 1/N Before beginning the analysis, recall that the equilibrium is a Dirac measure in the mean field game case since all individuals have the same ?.We note this equilibrium ??MFG, and the starting time for the meeting will be (except when a limit is reached) ??MFG +?F?1(?) where F is here the cumulative distribution function of a normal distribution. Thus, rather than being defined by: E[?1H(??N, ??N + ??y, ??N + ??z)] = 0 the mean field games equilibrium is defined by: ?1H(??MFG, ??MFG + ?F?1(?), ??MFG + ?F?1(?)) = 0 We see that there is an advantage in introducing J defined by J(t, y, z) = ?1H(t, t+?y, t+?z) and that we can then carry out the following Taylor expansion: 0 =EJ(??N, ?y, ?z) = J(??MFG, F?1(?), F?1(?)) =0 +(??N ? ??MFG)?1J(??MFG, F?1(?), F?1(?)) +E(?y ? F?1(?))?2J(??MFG, F?1(?), F?1(?)) +E(?z ? F?1(?))?3J(??MFG, F?1(?), F?1(?)) +12E(?y ? F?1(?))2?22J(??MFG, F?1(?), F?1(?)) +12E(?z ? F?1(?))2?33J(??MFG, F?1(?), F?1(?)) +E(?z ? F?1(?))(?y ? F?1(?))?23J(??MFG, F?1(?), F?1(?)) +o(??N ? ??MFG) + o(1/N) Detailed study of the properties of order statistics (see [17]), i.e. the variables ?y and ?z, show that the convergence of ??N toward ??MFG occurs in 1/N. Indeed, if we write6 ? = lim N>?NE(?y ? F?1(?)) ? R ? = lim N>?NE(?z ? F?1(?)) ? R v = lim N>?NE(?y ? F?1(?))2 = lim N>?NE(?z ? F?1(?))2 = lim N>?NE(?z ? F?1(?))2 ? R 6 The fact that these constants exist is not obvious and relies on the properties of order statistics.
Mean Field Games and Applications 227 then we see that ??N = ??MFG ? 1 N 1 ?1J ??2J + ??3J + v2 2 (?22J + ?33J + 2?23J)+ o1 N The mean field games framework is therefore an approximation of an N-player game when N is large and we know the order of magnitude of the error occurring when we consider a mean field games model for solving an N-player game. 3 Application of Mean Field Game to Economics: Production of an Exhaustible Resource A fairly typical example of mean field game is that of the production of an exhaustible resource by a continuum of producers. We know from Hotelling's work (see [28]) that there is a rent involved in the production of an exhaustible resource, but it is interesting to examine this in greater depth in a competitive situation and to understand the dynamics of exhaustion of a scarce resource. We therefore present a basic model onto which other models can be grafted. For instance, the model can be improved to take account of a Stackelberg-type competition, to consider the existence of big players (OPEC in the instance we have in mind), etc. It is also a basis for studying important problems such as the entry of new competitors, particularly those who are developing alternative energy sources (see [20] for a complete analysis of this question in a mean field game framework identical to the one developed here. This framework allows for instance to consider with powerful analytical tools the negative effect in terms of carbon emissions of a subsidy to alternative energy producers (see [25]) as in [18]). This example will enable us to show the general character of mean field games PDEs when addressing Forward/Backward problems. It also offers a transparent way of dealing with externality. 3.1 Basis of the Model We consider a large number of oil producers, which can be viewed either as wells or from a more macro standpoint as oil companies. The only assumption we make is that there is a sufficiently large number of them and that one can apply simple hypotheses such as that of the continuum (mean field games modeling) and perfect competition (price-taker behavior of agents). Each of these oil producers initially has a reserve that is termed R0. We assume that these reserves are distributed among producers according to an (initial) distribution m(0, -). These reserves will of course contribute to production q such that,
228 O. Gueant et al. for any specific agent, we have dR(t) = ?q(t)dt + ?R(t)dWt where the brownian motion is specific to the agent considered. Production choices will be made in order to optimize a profit criterion (the same for all agents) of the following form: Max(q(t))t,TE? 0 (p(t)q(t) ? C(q(t)))e?rtds s.t. q(t) ? 0,R(t) ? 0 where: : C is the cost function which we will then write as quadratic: C(q) = ?q + ? q2 2 . : the prices p are determined according to the supply/demand equilibrium on the market at each moment, demand being given by a function D(t, p) at instant t (that could be written D(t, p) = We?tp?? where W exp(?t) denotes the total wealth affected by a constant growth rate to model economic growth and where ? is the elasticity of demand that can be interpreted in a more general model as the elasticity of substitution between oil and any other good) and supply is naturally given by the total oil production of the agents. Our model can be dealt with in the deterministic case or in the stochastic case depending on the value of ?. We are going to start with the deterministic case where ? = 0. In that case, a solution can be found without mean field methods. The mean field methods will be necessary in the stochastic case and the economic equilibrium will appear as a very special case of the PDE system, leaving an empty room to add externality effects and for more complex specifications. 3.2 The Deterministic Case 3.2.1 Characterization of the Equilibrium Proposition 5 (Equilibrium in the deterministic case). The equilibrium is characterized by the following equations where p, q and ? are unknown functions and R0 the level of initial oil reserve. D(s, p(s)) = q(s,R0)m0(R0)dR0 q(s,R0) = 1? [p(s) ? ? ? ?(R0)ers]+ ? 0 q(s,R0)ds = R0
Mean Field Games and Applications 229 Proof. Let's consider the problem of an oil producer with an oil reserve equal to R0. The optimal production levels can be found using a Lagrangian: L = T 0 (p(s)q(s) ? C(q(s)))e?rsds + ?R0 ? T 0 q(s)dsThe first order condition is:p(s) = C(q(s)) + ?ers where ?ers is the Hotelling rent. Noteworthy, if one considered a monopole, the price would not be "marginal cost + rent" but "marginal cost + rent" multiplied by the usual markup. In other words, the actual rent is increasing with the market power. Now, using our specification for the costs, we get, as long as q(s) is positive: p(s) ? ? ? ?q(s) = ?ers Hence, q(s) is given by:q(s) = 1? [p(s) ? ? ? ?ers]+ In this equation ? depends on the initial oil stock (or reserve) and it will be denoted ?(R0). This lagrangian multiplier is given by the intertemporal constraint that equalizes the whole stream of production and the initial oil reserve: T 0 q(s,R0)ds = 1? ? 0 (p(s) ? ? ? ?(R0)ers)+ ds = R0 Now, we need to find the prices that were left unknown. This simply is given by the demand/supply equality. D(s, p(s)) = q(s,R0)m0(R0)dR0 If we compile all these results we get the three equations that characterize the equilibrium. 3.2.2 Computation of an Equilibrium Since q only depends on ?(-) and p(-) we can totally separate the variables t and R0. More precisely, if we consider an eductive algorithm (eductive algorithms will be used later to solve coupled PDEs) we can consider two "guesses" ?(-) and p(-) to compute q(-, -) and then update ?(-) and p(-) using respectively the constraints ?0 q(s,R0)ds = R0 and D(s, p(s)) = q(s,R0)m0(R0)dR0.
230 O. Gueant et al. More precisely, we consider a dynamical system indexed by the variable ? like the following7 ??p(t, ?) = D(t, p(t, ?)) ? q(t,R0)m0(R0)dR0 ???(R0, ?) = ? 0 q(t,R0)dt ? R0 where q(t,R0) = 1? p(t, ?) ? ? ? ?(R0, ?)ert+ Once a dynamical system is chosen, the solution for R0 > ?(R0) and t > p(t) and hence the productions of all oil producers is obtained by: lim ?>+?p(t, ?) = p(t) lim ?>+??(R0, ?) = ?(R0) As an example we can illustrate the evolution of total oil production in this model where we consider a CES demand function, namely D(t, p) = We?tp??. We took the following values for the parameters: the interest rate considered by oil producers is r = 5%, the average growth rate of the world economy is ? = 2%, the initial marginal cost of producing an oil barrel is ? = 10, ? = 100 to model the importance of capacity constraints, ? = 1.2 because oil is not a highly elastic good and W = 40 to obtain meaningful values in the model. The problem is considered over 150 years and the initial distribution of reserves has the following form(Fig. 1): Fig. 1 m0 7 The system can be multiplied by the inverse of its Jacobian matrix. Different multiplying factors can also be added to the two equations.
Mean Field Games and Applications 231 If we consider the global production of oil producers, its evolution is given by the first graph below (Fig. 2) where the horizontal axis represents the years and the vertical one the global production at each date. The associated evolution of oil prices is also represented where we only plot the first 50 years to avoid ending up with very large values after too many decades and hence a graph that is unreadable (Fig. 3). Fig. 2 Evolution of the total oil production Fig. 3 Evolution of prices over 50 years
232 O. Gueant et al. 3.2.3 Comments on the Deterministic Model This deterministic model will appear as classical to most readers. Though, some comments deserve to be made. First of all, we saw that prices were not equal to marginal cost since the optimal production (when positive) is given by: p(t) = C(q(t,R0)) + ?(R0)ert Hence, the Hotelling rent (?(R0)ert) increases with time and differs among producers. Since ? measures the strength of the constraint associated to the exhaustible nature of oil, it is a decreasing function of R0. As a consequence, the rent is higher when it comes to consider a smaller producer. Another remarkable phenomenon is the shape of the curve. Oil production first increases and then decreases. It's a form of the so-called Hubbert peak even though we do not have the symmetry result associated to the usual Hubbert peak.8 Economic growth pushes oil producers to produce more (and especially producers with a large oil reserve) but the intrinsic exhaustibility of oil induces a decrease in the production after a certain period of time. 3.3 The Stochastic Case The above model was a mean field game as any general equilibrium economic model. In the simple deterministic case developed above, the mean field games tools didn't need to be used and classical tools were sufficient, except perhaps when it came to find a numerical solution. However, when it comes to noise or externality in the model, the mean field games partial differential equations will be necessary. In contrast with the PDEs developed for the first toy model, the PDEs will now be completely coupled and not only coupled through boundary conditions. 3.3.1 The Mean Field Games PDEs To start writing the equations, let's introduce u(t,R) the Bellman function of the problem, namely: u(t,R) = Max(q(s))s?t,q?0E? t (p(s)q(s) ? C(q(s)))e?r(s?t)ds s.t. dR(s) = ?q(s)ds + ?R(s)dWs,R(t) = R 8 Our model not being suited for it since we do not focus on the discovery and exploitation of new wells.
Mean Field Games and Applications 233 The Hamilton-Jacobi-Bellman equation associated to this optimal control problem is: (HJB) ?tu(t,R) + ?2 2 R2?2RRu(t,R) ? ru(t,R) + max q?0 (p(t)q ? C(q) ? q?Ru(t,R)) = 0 Now, let's denotem(t,R) the distribution of oil reserves at time t. This distribution is transported by the optimal production decisions of the agents q?(t,R) where, now, R is the reserve at time t and not the initial reserve as in the deterministic case. The transport equation is: (Kolmogorov) ?tm(t,R) + ?R(?q?(t,R)m(t,R)) = ?2 2 ?2RR R2m(t,R)with m(0, -) given. Now, let's discuss the interdependence between u and m. m is linked to u quite naturally since m is transported by the optimal decisions of the agents determined by the optimal control in the HJB equation. This optimal control is given by9: q?(t,R) = p(t) ? ? ? ?Ru(t,R) ? + Now, u depends on m through the price p(t) and this price can be seen as a function of m. Indeed, because p(t) is fixed so that supply and demand are equal, p(t) is given by: p(t) = D(t, -)?1 ? d dt Rm(t,R)dRIf we want to conclude on this part and rewrite the equations to focus on the interdependence, we may write the following expressions: ?tu(t,R) + ?2 2 R2?2RRu(t,R) ? ru(t,R) + 1 2? D(t, -)?1 ? d dt Rm(t,R)dR? ? ? ?Ru(t,R)+2 = 0 9 Once again we suppose that the solution of the (HJB) equation we consider is a solution of the underlying optimization problem. Verification results still need to be proved.
234 O. Gueant et al. ?tm(t,R)+?R ?D(t, -)?1 ? d dt Rm(t,R)dR? ? ??Ru(t,R) ? +m(t,R)= ?2 2 ?2RR R2m(t,R)These equations are the coupled equations associated to our optimization problem but it is still an interesting problem to establish a verification theorem that would prove a solution of the Hamilton-Jacobi-Bellman equation to be a solution of the optimization problem. 3.3.2 Numerical Solutions and Comments In the deterministic case, we found a numerical approximation of the solution that should be reinterpreted as a Nash equilibrium of our problem. In fact, because we are dealing with exhaustible resources, producers are disappearing with time and the number of active producers shrinks to nothing. This remark is important since it induces a price increasing a lot as global oil reserves decrease. In particular, depending on the specification, our model may have a "solution" where no oil is produced after a certain time and hence the price equal a maximum bound or infinity. If this can be a solution of the optimization problem, this may not be a Nash equilibrium because in such a case a producer may deviate and keep oil to produce when no other oil is left. Hence the decrease in the number of participants is important to find a solution that really is a Nash-equilibrium. Finding a solution of the above PDEs can be complicated because it imposes to find a (symmetrical)mean field solution in which two identical producers behave the same. But, in this model, there can be cases in which solutions are, in some sense, dynamical mixed solutions as a game theorist would say : two identical players may act differently, the first one producing during a short period of time and the second one producing less but during a longer period of time. Because of this phenomenon, and in spite of the noise coefficient, approximating the solution after several decades deserves more than a paragraph. Although we know how to numerically find "symmetrical" solutions in many cases, it's still research in progress in general. Readers interested in the numerical tools to find solutions of the PDEs may see [20]. 3.3.3 Generalization and Externality The equations, as stated above to focus on the interdependence, are less practical and intuitive than the preceding forms of the equation. Though, they express something really important we want to insist upon: general equilibrium in its classical form can appear as a very special case of a mean field game. A natural consequence is that we can add other effects in a very simple manner while adding meaningful terms to the PDEs.
Mean Field Games and Applications 235 For example, it's widely thought amongst oil specialists that oil producers not only want to maximize profit but also want to avoid being in the last producers to produce because they do not know what is going to happen to oil companies at the end of the oil era. This kind of effect would have been very hard to introduce with the first (usual) approach we presented. With the mean field games approach, the addition of such an effect is just another dependence on m in the HJB equation that defines u. One possibility is for example to introduce a ranking effect in the Hamilton-Jacobi- Bellman equation. The Hamilton-Jacobi-Belmman equation may become: ?tu(t,R) + ?2 2 R2?2RRu(t,R) ? ru(t,R) + H R 0 m(t, ?)d?+ 1 2? D(t, -)?1 ? d dt Rm(t,R)dR? ? ? ?Ru(t,R)+2 = 0 where H is a decreasing function. In addition to the intertemporal profit optimization, the producer wants to have less oil reserve than its competitors. This generalization is one amongst many. We just aim at convincing the reader about the variety of effects and particularly externality effects the mean field games approach allows to handle quite easily. To see how this mean field game can be adapted to the study of competition between oil producers and potential entrants that produce alternative energy, see [25] and [20]. 4 TheMexicanWave 4.1 Introduction Before moving on to more complex models, let us look at a "toy model" which is prompted by mean field games and models the mimicry responsible for the Mexican wave phenomenon in stadiums. Mexican wave is called this way because it seems that it appeared for the first time in a stadium in Mexico. The goal of our model here is to understand how a Mexican wave can be one of the solution of a mean field game involving a (infinite) set of supporters and a taste for mimicry. Let's start with the description of the stadium. To simplify the study, we regard our stadium as a circle of length L (hence the stadium is a one-dimension object, though it wouldn't be difficult to generalize). Mathematically, the stadium will then be the interval [0, L) regarded as a torus. In the stadium, there is a continuum of individuals; each one being referenced by a coordinate x ? [0, L). Each agent is free to behave and can be either seated (z = 0) or standing (z = 1) or in an intermediate position z ? (0, 1). Some positions are less comfortable than others and we model this phenomenon using a utility function u.
236 O. Gueant et al. Typically u will be of the following form to express that being standing or being seated is more comfortable than being in an intermediate position: u(z) = ?Kz?(1 ? z)? Now, let's describe the optimization function for any agent: : An agent pays a price h(a)dt to change his position from z to z + adt. h(a) will simply be a quadratic cost function: a2 2 . : An agent wants to behave as his neighbors. Mathematically an agent in x maximizes ? 1 2 (z(t, x) ? z(t, x ? y))2 1g ydy where g is a gaussian kernel. : An agent maximizes his comfort described by u. The optimization criterion for an agent localized at x is then sup z(-,x) lim inf T>+? 1T T 0 ? 1 2 (z(t, x) ? z(t, x ? y))2 1g ydy+u(z(t, x)) ? z?(t, x)2 2 dt This ergodic control problem can be formally transformed in a differential way and we get: ? 2 2 (z(t, x) ? z(t, x ? y))1g ydy + u(z(t, x)) = ??2ttz(t, x) If we let tends to 0, we get in the distribution sense that our problem is to solve the equation10: ?2ttz(t, x) + ?2xxz(t, x) = ?u(z(t, x)) 10 This equation doesn't seem to be of the mean field type but we can write the associated mean field equations. Let's consider that agents are indexed by x. For each x, the Bellman function associated to the problem of an agent in x can be written as J(x; -) solving the Hamilton-Jacobi equation: 0 = ?tJ(x; t, z) + 12 (?zJ(x; t, z))2 + u(z) ? 1 2 (z ? ?z)2m(?x; t, ?z) 1g x ? ?x d?zd?x where m(x; t, -) is the probability distribution function of the position z of an agent situated in x. m(x; -, -) solves a Kolmogorov equation that is: ?tm(x; t, z) + div(?zJ(x; t, z)m(x; t, z)) = 0 with m(x; 0, z) = ?z(0,x)(z) Hence, the problem can be written as a set of Hamilton-Jacobi equations indexed by x with the associated Kolmogorov equations. Because the problem is purely
Mean Field Games and Applications 237 Before going on and solve the problem, we must notice that z = 0 and z = 1 should be solutions of the problem. Consequently, we must have u(0) = u(1) = 0 and hence ? and ? have to be strictly greater than 1. 4.2 Mexican Wave as a Solution A Mexican wave is, by definition, a wave. Hence we are going to look for a solution of the form z(t, x) = ?(x ? vt) where v is the speed of the wave. But what we call Mexican wave is usually a specific form of wave and we want to call Mexican wave a function ? with a compact support on (0, L) that is first increasing from 0 to 1 and then decreasing form 1 to 0. If we look for such a function ?, we can easily see that it must solve: (1 + v2)?= ?u(?) Proposition 6 (Existence of Mexican waves for ?, ? ? (1; 2)). Suppose that ?, ? ? (1; 2). Then, for any v verifying ?(1 ? ?2 )?(1 ? ?2 ) ?(2 ? ?+? 2 ) < K 2(1 + v2)L there exists a Mexican wave ? solution of (1 + v2)?= ?u(?). Proof. We use an "energy method" to solve the equation (1 + v2)?= ?u(?). First, let's multiply the equation by ?and integrate.We get: 1 + v2 2 ?2 = u(?) + Cst Since ? = 0 must be a solution, the constant has to be zero. Consequently, we are left with an ODE: ?= 2K 1 + v2 ??/2(1 ? ?)?/2 If ? were greater than 2 the Cauchy-Lipschitz theorem would apply using the boundary condition ?(0) = 0 or ?(L) = 0 and the unique solution would be z = ? = 0. Now because we supposed ? ? (1; 2), we can have a local nonuniqueness result. Let's build a solution different from 0. First we can consider that ? is equal to zero in a neighborhood of 0 e.g. ?s ? [0, ?]. Now for s > ?,we can integrate the deterministic, we can directly follow the position of each individual and consider an equation in z(t, x) instead of this complex system.
238 O. Gueant et al. ODE and define ?(s) implicitly by: ?(s) 0 w??/2(1 ? w)??/2dw = 2K 1 + v2 (s ? ?) This definition holds as long as ?(s) ? 1, i.e. as long as s ? M whereM is defined as B(1??/2, 1??/2) = 2K 1+v2 (M??) (B stands for the beta function).Now, for s > M, we build the solution in the same way and we can do so because ? ? (1; 2). We define implicitly ?(s) by: 1 ?(s) w??/2(1 ? w)??/2dw = 2K 1 + v2 (s ?M) as long as ?(s) remains positive. This happens in s = Mwhere B(1 ? ?/2, 1 ? ?/2) = 2K 1+v2 (M?M). Now, ? is supposed to be 0 for s ? M. We have built a differentiable function ? but we need to check that Mcan be smaller than L for a sufficiently small ?. We have 2B(1 ? ?/2, 1 ? ?/2) = 2K 1+v2 (M? ?). Hence Mcan be smaller than L if and only if there exists ? such that ? < L?2(1 + v2) K B(1 ? ?/2, 1 ? ?/2) Such a positive ? exists if and only ifK 2(1+v2)L > B(1 ? ?/2, 1 ? ?/2) and this is equivalent to our condition thanks to the link between the functions ? and B. We can represent a solution ? as described above (supporters do not keep standing before going down to the seated position) (Fig. 4): Fig. 4 ? = ? = 1.5
Mean Field Games and Applications 239 Remark: This solution is not unique in general for two reasons. The first one is obvious: ? in the preceding proof can be chosen in an interval. However, this nonuniqueness is only due to a translation invariance of the problem on the torus and is therefore meaningless. A second reason is that supporters may stand for a while before going back to the seated position. 4.3 Mean Field Games Versus Descriptive Models All the models developed to represent theMexican wave assume that the supporters behave like automata: they carry out actions according to the context with possibly some memory of the preceding moments. This logic of automatic functioning is perfectly adequate for producing a Mexican wave-type crowd movement, and even for producing an equation of the dynamics that is the same as what we have written: if it has not already been done, we would be able to do so. The difference between our model and a model based on automata agents (see for instance [19]), lies in the meaning given to the agents' actions. While automata produce actions dictated by the context, our agents produce the same actions as a consequence of a process of thinking about the behavior of other agents, the coherence of these behaviors, and the personal preferences in view of these behaviors. That this gives the same result as if agents were automata should not be cause for disappointment: the parsimony principle does not apply here; simply because agents behave as if they were automata is no reason for not giving another meaning to their actions. And not only for ethical reasons. Indeed, if one wishes to study the stability of the Mexican wave, and behaviors apart from equilibrium, it becomes necessary to return to the mechanism that has enabled the equation to be constructed. And hence, if the Mexican wave has been disturbed, if some rows of spectators have not moved for an exogenous reason, models based on automata generally predict erratic behavior in situations in which our mean field games agents, after a moment's thought, behave in such a way that the collective motion of the Mexican wave is re-established. Thus the meaning given to behaviors sheds light on what one would expect in the event of disturbance to various processes. 5 A Model of Population Distribution 5.1 Introduction Let's now consider a model of population distribution. This model is the archetype of a mean field gamesmodel in continuous time with a continuous state space. Many models can be derived from this one and most importantly the notion of stability
240 O. Gueant et al. introduced in what follows is arguably one of the most relevant one to deal with stability in forward/backward models such as intertemporal mean field games models. This stability notion called eductive stability turns out to be useful to circumvent the issues of the forward/backward structure, especially when it comes to find numerical solutions to mean field games PDEs. In what follows we only present some aspects of the model. The readers may refer to [23] to go deeper into the different notions of stability or they may read [22] for an even more complete presentation with generalization to multi-population issues. 5.2 The Framework We consider a large number of agents modeled as usual by a continuum. These agents have geographic, economic and social characteristics that we assume are represented by a finite number n of values. A simple example is the position of an agent represented by his coordinates in space. Another example is that of a technology used by an agent. In short, we assume that the agents have characteristics denoted by X ? Rn. Each individual will have control over his characteristics, and we choose the case in which agents wish to resemble their peers. To resemble others, an agent has to move in the state Rn. When an agent wants to make move of size ? in the characteristics space (hereafter social space or state space) he will pay a cost of the quadratic form |?|2 2 . Moreover, this control is not perfect, since we add Brownian noise. In mathematical terms, our problem is thus written (for an agent i): sup (?s)s?0,Xi0=xE? 0 g(t,Xi t,m) ? |?(s,Xis)|2 2 e??sdsdXi t = ?(t,Xi t )dt + ?dWi t where m is the distribution of agents in the social space and where the function g will model the will to resemblance depending on the type of problem. Various specifications for g will produce our results: g(t, x,m) = ??(x ? ym(t, y)dy)2 g(t, x,m) = ?? (x ? y)2m(t, y)dy g(t, x,m) = ln(m(t, x)) To simplify the exposition and to stick to the papers cited in the introduction, we consider the logarithmic case where g is a local function of m.
Mean Field Games and Applications 241 The control problem is re-written in differential way. We obtain the PDEs which are at the heart of mean field game theory: (HJB) ?tu + ?2 2 ?u + 12|?u|2 ? ?u = ?ln(m) (Kolmogorov) ?tm+ ? - (m?u) = ?2 2 ?m and in this case the optimal control is written ?(t,Xt) = ?u(t,Xt). What is fundamental in this PDE system is the forward/backward dimension. The Hamilton-Jacobi-Bellman equation is backward like all Bellman equations (in finite time, there would be a final condition of type u(T, x) = uT (x)) -this can also be seen in the diffusion part of the equation,which is a backward heat equation. Conversely, the transport equation is forward and transport an initial distributionm(0, x) according to agents' optimal choices. We clearly see the emergence of agents' reasoning in this forward/backward aspect. They assume a dynamic formand optimize as a result to get the optimal control?u. The behavior obtained transports the distribution of agents. The coherence is finally found if we assume that the expectations are rational (and hence perfect) on the distribution m. This is the usual reasoning in mean field games. 5.3 Stationary Solutions We are interested firstly in stationary solutions. The framework of quadratic costs and logarithmic utility allows us to have explicit quadratic solutions for u and Gaussian solutions for m, as in the following result: Proposition 7 (Gaussian solutions). Suppose that ? < 2 ?2 . There exist three constants, s2 > 0, ? > 0 and ? such that ?? ? Rn, if m is the probability distribution function associated to a gaussian variable N(?, s2In) and u(x) = ??|x ? ?|2 + ?, then (u,m) is a solution of our problem. These three constants are given by: : s2 = ?4 4?2??2 : ? = 1 ?2 ? ?2 = ?2 4s2 : ? = ?1? ?n?2 ? n2 ln 2? ??2 Proof. First, let's note that the stationary equation form(the Kolmogorov equation) can be rewritten as: ? - (m?u ? ?2 2 ?m) = 0 Hence, we can restrict ourselves to solutions of: m?u = ?2 2 ?m
242 O. Gueant et al. Consequently, we just need to solve the Hamilton-Jacobi-Bellman equation if we replace m by K exp( 2 ?2 u) where K is chosen to ensure that m is indeed a probability distribution function. We are looking for a solution for u of the form: u(x) = ??|x ? ?|2 + ? If we put this form in the Hamilton-Jacobi-Bellman equation we get: 2?2|x ? ?|2 + ??|x ? ?|2 ? ?? ? ?n?2 = ?ln(K) + 2?|x ? ?|2 ?2 ? 2? ?2 A first condition for this to be true is: 2?2 + ?? = 2? ?2 ?? ? = 1 ?2 ? ?2 A second condition, to find ?, is related to the fact that m is a probability distribution function. This clearly requires ? to be positive but this is guaranteed by the hypothesis ??2 < 2. This also implies: K exp2? ?2 Rn exp?2? ?2 |x ? ?|2= K exp2? ?2 ??2 2? n2 = 1 ? ?? + ?n?2 = n2 ln2? ??2and this last equation gives ?. From this solution for u we can find a solution for m. We indeed know that m is a probability distribution function and that m is given by m(x) = K exp(2u(x) ?2 ) As a consequence, m is the probability distribution function of an n-dimensional gaussian random variable with variance equal to s2In where s2 = ?2 4? i.e. s2 = ?4 4?2??2 . A priori, nothing guaranteed that a solution exists insofar as the cases usually well treated (see [36]) correspond most often to a decrease in the function g and not, as here, to an increase. On the other hand nothing shows there is a uniqueness result. First, there is invariance by translation and we must therefore localize the problem in order to address this question. This localization is done simply by replacing ln(m(t, x)) by ln(m(t, x)) ? ?x2 (? > O) and we obtain the same type of results. Even when localized, we do not guarantee uniqueness (though, localization
Mean Field Games and Applications 243 will be helpful for other purposes). Although we do not prove uniqueness, we are nevertheless interested in the problem of the stability of solutions. Since we have a stationary result, a first step towards studying the dynamics is to study stability. 5.4 Stability Results 5.4.1 Two Notions of Stability Two types of stability are relevant to our problem.We will call the first one "physical stability" and the second one "eductive stability". The physical stability concept might look more standard to the reader. The second, the eductive stability, refers to many papers by Roger Guesnerie and other authors (e.g. [26]) on stability in a rational expectation economic context. These papers inspired the mean field games eductive stability concept. If we consider a problem on [0, T ] with conditions stationary solutions on each side (u(T, -) = u? and m(0, -) = m? given), we can look at what happens (as T >?) when we disturb the boundary conditions (u?,m?). The stability associated with this perturbation in 0 for m and in T for u is the physical stability and we refer to [23] for a complete study. A second possibility is to add a variable ? (virtual time) and to consider a different, purely forward, dynamic system, whose stationary equilibrium is the same as the one we are looking for. If there is convergence (when ? > ?) in this new dynamic system where we reverse the time in the backward equation by imposing arbitrary conditions in ? = 0, then we shall call this eductive stability. In what follows, we focus on eductive stability, and more precisely on local eductive stability, because it helps a lot to develop and justify numerical methods. 5.4.2 Eductive Stability The physical stability, briefly described above, is intrinsically linked to the forward/backward structure of the equations. Here, we want to circumvent this forward/backward structure and we introduce a virtual time ? that will be purely forward in the sense that we consider the following new system of PDEs11: ??u = ?2 2 u+ 12u2 ? ?u + ln(m) ??m = ?2 2 m? (mu)11We consider the problem in dimension 1 for the sake of simplicity but the problem in general is the same.
244 O. Gueant et al. Let's consider two "initial guesses" (u(? = 0, x) and m(? = 0, x)) that are not too far from the stationary equilibrium (u?,m?) associated to ? = 0, as defined in Proposition 5.1: m(0, x) = m?(x)(1 + ??(0, x)) u(0, x) = u?(x) + ??(0, x) We are going to linearize these equations. After easy computations we obtain the following linear PDEs: ??? = ?2 2 ?? 2?x?? ?? + ? ??? = ?2 2 ?+ 2?x?? ?+ x s2 ?A more convenient way to write these linearized PDEs is to introduce the operator L: f > Lf = ??2 2 f+ 2?xfand we get the following equations for the couple (?, ?): Proposition 8. ??? = ?L? ? ?? + ? ??? = ?L? + 2 ?2 L? Proof. It simply is a consequence of the link between the variables, namely s2 = ?2 4? . Now,we are going to use the properties of the operatorL we have just introduced. To do that we need to use some properties of the Hermite polynomials associated to the space L2(m?(x)dx) (see [1] for more details). Proposition 9 (Hermite polynomials). We define the nth Hermite polynomial of L2(m?(x)dx) by: Hn(x) = sn 1 vn! (?1)n expx2 2s2dn dxn exp? x2 2s2The polynomials (Hn)n form an orthonormal basis of the Hilbert space L2(m?(x)dx). The Hermite polynomials Hn are eigenvectors of L and: LHn = 2?nHn To study the linearized equations, we are going to consider the space L2(m?(x)dx) and consider a decomposition on the Hermite polynomials basis. Because the problem is purely forward in ? we need to have, for each coordinate, two negative eigenvalues.
Mean Field Games and Applications 245 To this purpose, let's introduce the matrices (Bn)n: Bn = ?(? + 2?n) 1 n s2 ?2?nLemma 10 (Eigenvalues of Bn). Let's consider n ? 2. The eigenvalues ?1n< ?2nof Bn are both negative with: ?1,2 n = 12 ?? ? 4?n ?2 + 4n s2 Proposition 10. Let's suppose that the initial conditions ?(0, -) and ?(0, -) are in the Hilbert space H = L2(m?(x)dx). Let's consider for n ? 2 the functions ?n ?n that verify: ???n ???n = Bn ?n ?n with ?n(0) equal to ?(0, -)n =< Hn, ?n(0) > and ?n(0) equal to ?(0, -)n =< Hn, ?n(0) >. We have for a fixed ? and as n tends to?: ?n(?) = O(|?n(0)|e?2n?) ?n(?) = O(vn|?n(0)|e?2n?) In particular, ?? > 0, ?k ? N, (nk?n(?))n ? l1(? l2), (nk?n(?))n ? l1(? l2) Proof. After straightforward algebraic manipulations, we get: ?n(?) ?n(?)= Ane?1n? 1 an + Bne?2n? 1 bn where: an = ? + 2?n + ?1n, bn = ? + 2?n + ?2n Now, to find the two constants we need to use the conditions on ?n(0) and ?n(0): ?n(0) = An + Bn ?n(0) = anAn + bnBn
246 O. Gueant et al. Hence: An = bn?n(0)??n(0) bn?an Bn = an?n(0)??n(0) an?bn Using the fact that an ? ?v? ? vn and bn ? v? ? vn we can deduce the asymptotic behavior of the constants as n goes to infinity. An ?n>? ?n(0) 2 , Bn ?n>? ?n(0) 2 Hence, since ?1n< ?2n, ?n(?) = O(|?n(0)|e?2n?) ?n(?) = O(vn|?n(0)|e?2n?) These two estimations prove the results. These estimations show that the solutions will be far more regular than the initial conditions. Proposition 11 (Resolution of the linearized PDEs). Suppose that: : The initial conditions ?(0, -) and ?(0, -) are in the Hilbert space H = L2(m? (x)dx) : ?(0, x)m?(x)dx = 0 (this is guaranteed if the initial guess for m is a probability distribution function) : x?(0, x)m?(x)dx = 0 (this is guaranteed if the initial guess is even) : x?(0, x)m?(x)dx = 0 (this is guaranteed if the initial guess is even) Let's define (?n)n and (?n)n by: : ?0(?) = ?0(0)e??? and ?0(?) = 0. : ?1(?) = ?1(?) = 0. : ?n ? 2, ?n and ?n defined as in the preceding proposition. Then ?(?, x) =  ?n=0 ?n(?)Hn(x) and ?(?, x) =  ?n=0 ?n(?)Hn(x) are well defined in H, are in C?, are solutions of the PDEs and verify the initial conditions. Proof. First of all, the above proposition ensures that the two functions ? and ? are well defined, in C?, and that we can differentiate formally the expressions. Then, the first three conditions can be translated as ?0(0, -) = 0, ?1(0, -) = 0 and ?1(0, -) = 0 and so the conditions at time 0 is verified. The fact that the PDEs are verified is due to the definition of ?n and ?n and also to the fact that we can differentiate under the summation because of the estimates of the preceding proposition. 
Mean Field Games and Applications 247 Proposition 12 (Local eductive stability). Suppose that: : The initial guesses ?(0, -) and ?(0, -) are in the Hilbert space H = L2(m? (x)dx). : ?(0, x)m?(x)dx = 0 (this is guaranteed if the initial guess for m is a probability distribution function) : x?(0, x)m?(x)dx = 0 (this is guaranteed if the initial guess is even) : x?(0, x)m?(x)dx = 0 (this is guaranteed if the initial guess is even) Then the solution (?, ?) of the PDEs converges in the sense that: lim ?>?||?(?, -)||L2(m?(x)dx) = 0 lim ?>?||?(?, -)||L2(m?(x)dx) = 0 Proof. We basically want to show that: !+? n=0 |?n(?)|2 >?>+? 0, !+? n=0 |?n(?)|2 >?>+? 0 This is actually a pure consequence of the estimates proved earlier and of the Lebesgue's dominated convergence theorem. These stability results are interesting but the symmetry conditions to obtain them may seem cumbersome. Indeed, when it comes to apply this kind of methodology to find stationary solutions, we clearly need a result that is less sensitive to initial conditions. A good way to proceed is to consider the case introduced at the beginning where there is no translation invariance, that is the localized case in which ? > 0. 5.4.3 Eductive Stability in the Localized Case In the proof of the eductive stability, there was a need to impose symmetry conditions on the initial guesses. These conditions were necessary to ensure stability because B1 was singular. If one wants to have stability results for more general initial guesses, the intuitive idea is to break the translation invariance of the problem. Interestingly, we introduced localization earlier. This localization idea can be used once again, to have more general stability results. If we center the problem around 0 as before, we can see that the only relevant difference between the original problem and the problem with an additional term ??x2, that localizes the problem around 0, is the positive constant ? that depends on ? according to the equation: 2?2 ? ? 2 ?2 ? ?= ?
248 O. Gueant et al. Now, in this context we can prove that the eigenvalues of Bn are both negative for n ? 1 (remember that we needed n to be larger than 2 to have these properties in the case where ? = 0). This result can be used to prove general stability results when ? > 0. It is indeed straightforward that all our stability results can be rewritten exactly the same if one replaces the conditionsx?(0, x)m? (x)dx = 0 x?(0, x)m?(x)dx = 0 by ? > 0 Thus, in this localized context, (and up to a linear approximation) if we start from a couple (u,m) close to a stationary equilibrium, there will be convergence toward stationary equilibrium as ? > ?when using the purely forward PDEs system. Numerically, this is very interesting and the eductive methods give very good results, both for finding stationary equilibriumand for generalizing the approach for seeking dynamic equilibrium (see [23]). 5.5 Numerical Methods The forward/backward structure of mean field games is quite an issue when it comes to find numerical solutions. One can try to find a fixed point (u,m) solving alternatively the backward equation and the forward equation but there is a priori no guarantee that a solution can be found in this way. The eductive stability property proved earlier, however, can be adapted to design a numerical method.Other authors have developed several methods and the interested author may for instance see [3]. We are going to present our methods to find stationary solutions. Interestingly, if one replaces the Laplace operator by heat operators (forward or backward, depending on the context), the numerical recipes presented below still work to find dynamical solutions (see [22, 23]). 5.5.1 Stationary Equilibrium First, let's recall the two equations that characterize a stationary equilibrium: (HJB) ?2 2 ?u + 12|?u|2 ? ?u = ?g(x,m) (Kolmogorov) ? - (m?u) = ?2 2 ?m where, now, g is not anymore supposed to be the logarithm function.
Mean Field Games and Applications 249 The Hamilton-Jacobi-Bellman equation can be simplified using the change of variable12 ? = expu ?2 and we obtain: (HJB)?2 2 ?? = ? ? ln(?) ? 1 ?2 g(x,m)(Kolmogorov)? - ?2 m?? ? = ?2 2 ?m The two equations (HJB)and (Kolmogorov)can be written in a more practical way for numerical resolutions by "inverting" the ? operators. This can be done in the Kolmogorov equation by restricting the Laplace operator to probability distribution functions (since in practice we restrict ourselves to Fourier series with only a finite number of harmonics) and we obtain: (Kolmogorov)? m + ?2 2 ??1 ?2? - m?? ? = 0 This cannot be done in the case of the Hamilton-Jacobi-Bellman equation but we can invert an operator like ?2 2 ? ? Id for any > 0. This gives: (HJB)? ? + ?2 2 ? ? Id?1 ? ? ln(?) ? 1 ?2 g(x,m) ? = 0 Using these equations we can consider the ideas of eductive stability and try to obtain solutions by solving the following equations where we introduce the virtual time ?: ??? ?? ??m = ?m+ " ?2 2 ?#?1 ?2? - m?? ? ??? = ?? + " ?2 2 ? ? Id#?1 ? ? ln(?) ? 1 ?2 g(x,m) ? Numerically these equations are quite easy to solve. An example is shown below where g(x,m) = vm??x2 with ?2 = 0.4, ? = 0.4, ? = 0.5 on the domain [?1, 1] (we took = ?3) (Fig. 5). 12 This change of variable, combined with the change of variable ? = mexp ? u ?2 , simplifies the PDEs. Easy calculations give in fact that the equations in (u,m) become: ?t? + ?2 2 ?? = ?h(?, ?) ?t? ? ?2 2 ?? = ??h(?, ?) where h simply is h(?, ?) = ? ln(?) ? 1 ?2 g(??).
250 O. Gueant et al. 1.4?1 1 10 Fig. 5 Initial guess N(0, 0.3). Solution after 8,000 iterations with d? 0.01 (an iteration is drawn every 40 iterations). Only 15 harmonics are used. We see that after a certain number of steps in ?, the distribution m(?, -) converges towards a limit distribution m that is a good candidate for being a stationary equilibrium. 5.5.2 Generalizations This method works really well in practice for stationary solutions. In addition to be fast and effective, the eductive algorithm (as we term it) can be generalized to find not only stationary solutions but dynamical solutions of the mean field game PDEs. In short, the idea is simply to invert the heat operators instead of Laplace operators before introducing the virtual time ?. This is done in [22, 23]. 6 Asset Managers and Ranking Effect 6.1 Introduction When someone entrusts his saving to an asset manager, he does so according to his risk profile, i.e. he will try and find an asset manager whose management is as close as possible, in terms of return/risk for example, to what would be his own
Mean Field Games and Applications 251 management strategy were it not delegated.However, the asset manager to whom he entrusts his savings does not have the sole aim of satisfying his current customers. He may wish to increase the number of his customers and therefore the assets under management or, as an individual, perform better in order to increase his bonus. We offer a model which, starting off from the classicMarkowitz model (see [41]) or the CARA-Gaussian model, adds a classification dimension among the asset managers: each asset manager will want to optimize, over and above his usual criterion, a function that depends on his classification (in terms of return) among all the asset managers. 6.2 The Model Ourmodel therefore considers a continuum of assetmanagerswho at time 0 have the same unitary amount to manage. These managers will invest in risk-free and risky assets in creating their portfolio. A proportion ? of their portfolio will be invested in risky assets and a proportion 1 ? ? in risk-free assets with return r. The risky assets have a return which we denote r + ?, where ?is a random variable that we will assume is distributed normally, with the mean and variance still be to specified. To build their portfolio,managers will optimize a criterion of the following form: E[u(X) + ? ? C] where: : u(x) = ?exp(??x) is a CARA utility function. : X = 1+r + ??is the fund value at date 1. : ? measures the relative importance of the additional criterion of competition among managers. : ? C is the random variable representing the classification. This variable ? C has values in [0, 1], with 0 corresponding to the worst performance and 1 to the best performance obtained by a manager. It now remains to specify how managers differ. If they all have the same amount to invest, they nevertheless have different beliefs as regards the return on the risky asset, i.e. in relation to the variable ?. These beliefs will concern the mean of ?(we assume that there is agreement on volatility), such that an agent will be of type if he thinks that ?? N(, ?2). We will assume in what follows that the beliefs are distributed according to a probability distribution function f (even, for example). 6.3 Resolution To solve this problem, let us consider an agent of type . The proportion ? of his portfolio placed in the risky asset is given by the following optimality condition:
252 O. Gueant et al. Proposition 13 (FOC). (FOC) ? ?2?2 ? ? ??2 exp??(1 + r) ? ??+ 12?2?2?2+?m(?)C() = 0 where m is the distribution of the ?'s in the population at equilibrium and where C(-) = 2N - ? ? 12 , N being the cumulative distribution function of a normal variable N(0, 1). Proof. The asset manager maximizes: E"u(1 + r + ??) + ? ? C# It's easy to see that ? C = 1?>0M(?) + 1??0(1 ?M(?)) where M stands for the cumulative distribution function of the weights ?. Also, E[u(1 + r + ??)] = ?E[exp (?? (1 + r + ??))] = ?exp?? (1 + r + ?) + 12?2?2?2Hence, the optimal ? is given by the argmax of: ?exp?? (1 + r + ?) + 12?2?2?2+ ?E[1?>0M(?) + 1??0(1 ?M(?))] Let's differentiate the above equation. We get the first order condition for an -type asset manager: ??2?2 ? ? ??2 exp??(1 + r) ? ??+ 12?2?2?2+?E[1?>0 ? 1??0]m(?) = 0 But, P(?> 0)?P(?? 0) = 2 P(?> 0) ? 12=2P N(0, 1) > ? ??12=C() Hence we get the result. If we now use the fact that the solution > ?() transport distribution f toward distribution m, we see that the problem, once resolved, can be written in a differential way:
Mean Field Games and Applications 253 Proposition 14 (Differential equation for > ?()). Let's consider the function > ?() that gives the optimal ? for each type. If ? is C1 then it verifies the following differential equation: ??2?2 ? ? ??2 exp??(1 + r) ? ??+ 12?2?2?2d? d+?f()C()=0 (?) Moreover, ? must verify ?(0) = 0. Proof. To go from the distribution f of the types to the distributionm of the ?'s, we need a coherence equation that is simply: m(?)?() = f() Now, if we take the different first order conditions FOCand multiply by ?() we get the ODE we wanted to obtain. Now, because C(0) = 0, the equation (FOC0) is simply ??2?2? exp??(1 + r) + 12?2?2?2= 0 and the unique solution of this equation is ? = 0. If we return to theMarkowitz problem (? = 0), we see that the solution is simply given by > ?0() = ??2 . Our problem with? > 0 is therefore written: ?()= ?C()f() ?2?2 exp (??(1 + r + ?()) + 12?2?2?()2) 1 ?() ? ?0() , lim >0 ?()=0 This is not a usual Cauchy problem since the condition in 0 is meaningful only at the limit. However, we should point out that the solution will be odd and that we can therefore restrict ourselves to >0. Also, ?() must be increasing, which implies ?() > ?0() and hence greater risk-taking in our model than in the Markowitz model. Now we can completely solve the problem and we get: Proposition 15 (Existence and Uniqueness). There exists a unique function ? that verifies the equation (?) with the two additional constraints: : ?() > ?0() = ??2 : lim>0 ?() = 0 Proof. Let's start with the proof of the uniqueness. Let's consider a solution ? of the problem and let's introduce the function z defined by: z() = 12?()2 ? ?0()?()
254 O. Gueant et al. If we want to invert this equation and get ? as a function of z then we get: ?() = ?0() $?0()2 + 2z() but since ?() > ?0() we clearly can invert the equation and get: ?() = ?0() +$?0()2 + 2z() := ?(, z()) Now, if we differentiate the equation that defines z we have: z() = ?()?() ? ?0()?() ? 1 ??2 ?() = ?() (?() ? ?0()) ? 1 ??2 ?() ? z() = ?C()f() ?2?2 exp (??(1 + r + ?()) + 12?2?2?()2) ? 1 ??2 ?() ? z() = ?C()f() ?2?2 exp (??(1 + r + ?(, z())) + 12?2?2?(, z())2) ? 1 ??2?(, z()) From Cauchy-Lipschitz we know that there is a unique solution z of this equation that verifies z(0) = 0. This solution is defined in a neighborhood V of 0. From this we know that locally, in the neighborhood V , ? is uniquely defined by ?() = ?0() +$?0()2 + 2z(). Since there is no problem outside of 0 (i.e. the Cauchy-Lipschitz theorem can be applied directly) the uniqueness is proved. Now, we want to prove that there exists a solution on the whole domain. For that let's consider the following ODE: z()= ?C()f() ?2?2 exp (??(1 + r + ?(, z())) + 12?2?2?(, z())2)? 1 ??2?(, z()) We know that there is a local solution z (defined on a neighborhood V of 0) satisfying this equation with z(0) = 0. If we define ?loc on V (or more exactly on an open subset of V that contains 0, because it is not a priori defined on V ) as: ?loc() = ?0() +$?0()2 + 2z() then, we have a local solution of the equation (?) that satisfies the two additional conditions. Let's consider now ?in V . We can apply the Cauchy Lipschitz theorem to the equation (?) with the Cauchy condition ?(?) = ?loc(?) on the domain {(, ?)/> 0, ? > ?0()} and consider ? the maximal solution of the problem. This maximal solution clearly satisfies lim>0 ?() = 0. We want to show that there is in fact no upper bound for the maximal domain.
Mean Field Games and Applications 255 Suppose there is such an upper bound . Since ? is increasing, we have either: lim >?() = +? or lim >?() = ?0() We are going to show that these two cases are impossible. Suppose first that lim>?() = +?. Then, we can suppose there exists an interval (, ) such that ?? (, ), ?() > ?0() + 1. Hence, on (, ) we have: ?() ? ?C()f() ?2?2 exp ??(1 + r + ?()) + 12?2?2?()2? ?() ? ?C()f() ?2?2 exp?(1 + r) + ??()? 12?2?2?()2But ??()? 12?2?2?()2 ? 2 2?2 so that: ?? (, ), ?() ? ?C()f() ?2?2 exp?(1 + r) + 2 2?2Hence, ?? (, ), ?() ? ?() + ?C(?)f(?) ?2?2 exp?(1 + r) + ?2 2?2d? This implies that we cannot have lim>?() = +?. Now, let's consider the remaining possibility that is lim>?() = ?0(). The intuitive reason why this case is also impossible is that the slope when ? crosses the line associated to the solution ?0 should be infinite and this cannot happen. To see that more precisely let's consider the following ODE: (?) = ?2?2 exp (??(1 + r + ?(?)) + 12?2?2?2) ?C((?))f((?)) (? ? ?0((?))) Let's apply the Cauchy-Lipschitz theorem to the above equation on the domain (R+?)2 with the Cauchy condition (?0()) = .We have a local solution defined on a small interval [?0() ? ?, ?0() + ?] and this solution exhibits a local minimum at ?0(). However, we can build another solution of the above Cauchy problem since the inverse of the maximal solution ? satisfies the equation and can be prolonged to satisfy the Cauchy condition. Therefore, because of the local minimum, the two solutions are different and this is absurd. The conclusion is that the maximal interval has no upper bound. Now, by symmetry the solution is defined on R. 
256 O. Gueant et al. One thing remains to be done. In fact, if we have found a function ?() that verifies the differential equation and hence a distribution m coherent with the first order condition, we still need to check that the second order condition is verified to be sure that we characterized a maximum of the optimization criterion. This is the purpose of the following proposition: Proposition 16 (Second order condition). Let's introduce ?(, ?) = ??2?2 ? ? ??2 exp??(1 + r) ? ??+ 12?2?2?2+?m(?)C() Let's consider the unique function ?(), given by the preceding proposition, that satisfies ?, ?(, ?()) = 0 and the conditions of the above proposition. We have: ???(, ?()) < 0 Proof. First, let's differentiate the first order condition ?(, ?()) = 0 with respect to . We get: ??(, ?()) + ?()???(, ?()) = 0 Thus, the sign of ???(, ?()) is the sign of ???(, ?()) and we need to prove that ??(, ?()) > 0. But: ??(, ?) = ? exp??(1 + r) ? ??+ 12?2?2?21 + ?2?2? ? ? ??2 +?m(?)C() This expression is positive for ? = ?() since ?() ? ??2 6.4 Example Now that existence and uniqueness have been proved, we can try to compute numerically a solution. To know the shape of the curve, it's indeed important to compute the function ?() for an example and to compare it to the linear function ?0() we usually obtain in the non-competitive case. This is what we are doing now. Let us consider the following case.We put r = 2%, ? = 20% and ? = 1.We put s = 1%the standard deviation associated to f and we make ? small: ? = 5?10?5. Numerically, we obtain the following result: The conclusion is that the introduction of the mean field m overturns the Markowitz model. The Markowitz model indeed supposes that each agent reasons
Mean Field Games and Applications 257 1,51 0,50 theta epsilon ?2,00% ?1,00% 0,00% 1,00% 2,00% Beta = 0,00005 Beta = 0 ?0,5 ?1 ?1,5 as if he were alone and that's not true in practice. Surprisingly perhaps, even a small influence of competition (?) completely changes the shape of the solution and induces asset managers to take risker positions, both bullish and bearish. 7 Mean Field Games Model of Growth and Pareto Distribution of Salaries 7.1 Introduction to the Model Mechanisms We shall construct an economic growth model based on human capital using the mean field games approach. The idea is to consider a large number of people who will endeavor to increase their human capital in order to increase their salary. Increasing one's human capital usually has two effects: it leads to increased competence and therefore salary, and also, ceteris paribus, a reduction in the number of people one is in competition with and, as a result, an increased salary. To take advantage of these two effects, there is obviously a cost. However, this cost is not the same for each individual since it is a priori easier for someone with poor qualifications to resort to training than for an agent whose human capital is close to what economists call the technology frontier (see [2]). We consider a large number of agents, each having human capital that we term q. This human capital is distributed in the population according to a distribution function we termm(the associated cumulative distribution function is F and F = 1?F is the tail function).
258 O. Gueant et al. Let us now define the salary function. If we take a Cobb-Douglas production function (see [22]), it is clear13 that the salary can be written in the form: w(q,m(t, q)) = C q? m(t,q)? , if q is in the support of m(t, -) 0 otherwise If we suppose that m is a distribution function that decreases with q, we find the two effects mentioned above. The costs of increasing human capitalmust also be made explicit, and we express them as follows: H dq dt , F(t, q)= E? dq dt ? F(t, q)? , ?q in the support of m(t, -) Here, E is a constant that indicates the inefficiency of the human capital production mechanism and ? and ? are two constants. This functional form means that the cost depends on the growth intensity a of human capital (dqt = a(t, qt)dt) but also on the proximity to the technological frontier, because of the tail function F. The parameters ?, ?, ? and ? are positive and, to successfully do our calculations, we shall suppose that ? + ? = ?, ? = ? and ? > 1, thus leaving two degrees of freedom. 7.2 The Optimization Problem and the Associated PDEs Let us now move on to the problem of optimization of agents. We assume that they will maximize their wealth over time, which is coherent if one is situated in a stylized world without liquidity constraint. The agents' problem is the following maximization: Max(qs),q0=q ? 0 w(qs,m(s, qs)) ? H(a(s, qs), F(s, qs))e?rsds To solve this problem, we must first specify the initial distribution of human capital. If we take a Pareto distribution for human capital, i.e. a distribution of the form: m(0, q) = k 1 qk+1 1q?1 13 In general, if we consider two production factors x1 and x2, taking a Cobb-Douglas production function means that the production y is of the form y = Ax?1 1 x?2 2 . Hence if x1 is labor, the wage simply is dy dx1 .
Mean Field Games and Applications 259 we see that the initial distribution of salaries is also a Pareto distribution, which conforms to reality, at least for distribution tails. We therefore opt for this specification. The optimization problem can be solved, since it is deterministic, by using the classic Euler-Lagrange tools. However, as we shall later introduce uncertainty, we prefer to solve it with mean field games tools. To do this, we introduce the Bellman function J: J(t, q) = Max(qs),qt=q ? t w(qs,m(s, qs)) ? H(a(s, qs), ? F(s, qs))e?r(s?t)ds The mean field games PDEs that concern J and m are then written in the following form: (HJB) w(q,m(t, q)) + ?tJ + Maxa a?qJ ? H(a, ? F(t, q))? rJ = 0 (Kolmogorov) ?tm(t, q) + ?q(a(t, q)m(t, q)) = 0 where a(t, q) = ArgMaxa a?qJ ? H(a, ? F(t, q))is the optimal control. By using the specific forms chosen, we obtain: C q? m(t, q)? + ? ? 1 ? 1 E 1 ??1 F(t, q) ? ??1 (?qJ) ? ??1 + ?tJ ? rJ = 0 ?tm(t, q) + ?q F(t, q)? E ?qJ(t, q)1 ??1 m(t, q)= 0 and the optimal control is: a(t, q) = F(t, q)? E ?qJ(t, q)1 ??1 7.3 Solution We can give explicit solutions14,15: Proposition 17 (Resolution of the PDEs). If ?(? ? 1) < ?k,there is a unique triple (J,m, ?) that satisfies both the PDEs and the additional equation on the optimal control function: a(t, q) = ?q. 14 There are some additional restrictions about the parameters for the integral in the criterion to be defined at equilibrium (see [22]). 15 As always, this solution of the PDEs does not automatically induce a solution of the control problem and a verification theorem still need to be written.
260 O. Gueant et al. Solutions are of the following form: m(t, q) = k exp(?kt) qk+1 1q?exp(?t) J(t, q) = B exp(??k?t)q?k+?1q?exp(?t) where ? and B are related by ? = BE (?k + ?)1 ??1 Proof. First of all, the additional condition is equivalent to a constant growth rate for qt and therefore, we obtain the Pareto distribution m(t, -) stated above. Therefore, we have the following equation for ?qJ(t, q) if q ? exp(?t): ?qJ(t, q) = E(?q)??1F(t, q)?? = E(?q)??1e??k?tq?k Hence (the constant being zero), J(t, q) = E ?k + ????1e??k?tq?k+? If we plug this expression into the Hamilton-Jacobi-Bellman equation we get: Ck? q?k+?e??k?t + ? ? 1 ? E??q?k+?e??k?t ??k? E ?k + ????1e??k?tq?k+? ? r E ?k + ????1e??k?tq?k+? = rD From this we get: Ck? + ? ? 1 ? E?? ? ?k E ?k + ??? ? r E ?k + ????1 = 0 Ck? + (? ? 1)? ? k? ?(k? + ?) E?? ? r E ?k + ????1 = 0 Since ?(? ? 1) < ?k, ? is unique. Even though we cannot prove that there is uniqueness, this solution is very interesting since ? corresponds in fact to the rate of growth of human capital, which is the same for everyone. Furthermore, we see that the solution m is always Pareto-type, which is remarkable since in practice salary distribution tails are indeed Pareto-type (see [7, 8, 48, 49] for more details on the analysis of wealth distribution). 7.4 Underlying Mechanisms The fact that there is a regular growth path merits spending a few moments on the underlying economic mechanism. To begin with, the basic reason why people
Mean Field Games and Applications 261 change their human capital is due to two effects. First, there is a pure wage effect since, ceteris paribus, wage increases with human capital. However, this effect cannot explain by itself the continuous improvement of human capital at a constant growth rate. The effect needed to ensure a convincing explanation is an escape competition effect.16 A given individual taken at random in the population is threaten by people who have less human capital than he has (say ?q). Indeed, if part of those people where to improve there human capital so that they end up with a human capital ?q they will compete with our individual on the labor market, reducing her wage. This effect is the origin of continuous growth in our model. We have here a continuum of agents and therefore, for any given individual, there is always a threat.17 We think therefore that the Schumpeterian effect which basically assumes that people will not improve their human capital if the gains are too small is reduced to nothing because there is always a potential competitor and that's why a Darwinian effect (competition effect) dominates. Let's indeed highlight how tough is the threat effect. Each agent knows that every one is threaten by every one, and that fear will induce behaviors that will make the frightening event happen and be more important. This model shows that the growth process is not only due to those who innovate, that is to say "researchers" near the technological frontier, but is in fact a process that involves the whole population and is fostered by those who are far from the technological frontier and threaten the leaders by improving their human capital. The process revealed is therefore very mean field games, if we can put it like that, since it brings into play an overall social dimension. 7.5 A Stochastic Generalization Let us now move on to a more stochastic model. We suppose that dqt = a(t, qt)dt + ?qtdWt where W s a Brownian common to all the agents. If therefore we put qm as the minimum human capital (this is in fact a new state variable that evolves according to dqmt = a(t, qmt )dt + ?qmt dWt where a is here the optimal control), we see that the Bellman function can be written J = J(t, q, qm) and the PDEs are: Maxa C q? m(t, q)? ? E? a? F(t, q)? ? rJ +?tJ + a?qJ + ?2 2 q2?2qqJ + a?qmJ + ?2 2 qm2?2qmqmJ + ?2qqm?2qqmJ = 0 where ais none other than a(t, qmt ), exogenous in the optimization. 16 See [4-6] for the link between growth and competition. 17 In practice everybody thinks there are people less gifted than he is...
262 O. Gueant et al. The optimal control is given by: a(t, q) = F(t, q)? E ?qJ(t, q)1 ??1 Lemma 11. If a(t, q) = ?q, then the probability distribution function of the q's is m(t, q) = k (qmt )k qk+1 1q?qmt . Proof. Assuming a(t, q) = ?q we get: qt = q0 exp ? ? ?2 2 t + ?Wt= q0qmt ? m(t, q) = k exp (k(? ? ?2 2 )t + ?kWt) qk+1 1q?exp((???2 2 )t+?Wt) = k (qmt )k qk+1 1q?qmt Proposition 18 (Resolution of the PDEs18). If ?(? ? 1) < ?k and r > ?2 2 ? (? ? 1), then, there is a unique growth rate ? compatible with the problem and J is of the form: J(q, qm) = Bq?k+?(qm)??k1q?qm where ? and B are related by ? = BE (?k + ?)1 ??1 Moreover, ? is given by (?): ?(? ? 1) ? ?k ? ?? = r ? ?(? ? 1)?2 2 ???1 ? C(? + ?k) Ek? (?) Proof. First, if a(t, q) = ?q then, ?qJ(t, q, qm) = E(?q)??1F(t, q)?? = E???1q?k+??1(qmt )??k From this we deduce that the solution is of the stated form with B = E ?k+????1. If we want to find B or ? we need to plug the expression for J in the Hamilton- Jacobi-Bellman equation. This gives: q?k+??1(qm)??k Ck? ? E? ?? ? rB + ?(?k + ?)B ? ?k?B 18 For the "transversality" condition, see [22].
Mean Field Games and Applications 263 +?2 2 B ((?k + ?)(?k + ? ? 1) + (??k)(??k ? 1) + 2(?k + ?)(??k))= 0 Ck? ? E? ?? + ??B ? r ? ?(? ? 1)?2 2 B = 0 C(?k + ?) Ek? ? ?k + ? ? ?? + ??? ? r ? ?(? ? 1)?2 2 ???1 = 0 ?(? ? 1) ? ?k ? ?? = r ? ?(? ? 1)?2 2 ???1 ? C(? + ?k) Ek? As for (?), it's clear that, given our hypotheses, this equation has a unique solution. One consequence of these solutions is that growth is greater in the presence of a risk factor, even though this risk is common to everyone. 8 Mathematical Perspectives The examples above clearly show that many kinds of nonlinear problems arise in the context of mean field gamesmodels. For most of them, these nonlinear problems are new systems of coupled nonlinear equations which, in the case the state of the agents is described by continuous variables and the time variable is continuous, are partial differential equations. In all situations, the main novelty of these systems is the mixed "forward-backward" nature of the equations composing these systems. In general, no classical mathematical theory could be involved to tackle them. Furthermore, in the "partial differential" case for instance, the scope of the necessary new mathematical theory is quite large since many classical Partial Differential Equations (such as Hamilton-Jacobi-Bellman equations, Nonlinear heat or porous media equations, kinetic equations such as Vlasov or Boltzmann equations, compressible Euler equations of Fluid Mechanics, general semilinear elliptic equations, Hartree equations in QuantumMechanics, optimal transportation problems, . . . ) are in fact particular case of mean field games systems! This is to be expected since all these models arise in Mechanics and Physics model in a "mean field" fashion where the mean field sum up the collective or average behaviour of a large number of interacting particles (which can be seen as agents without any possibility of choosing their actions!) Both the novelty of the mean field games models and the "range" of problems explain why numerous (and delicate) mathematical issues are being raised by mean field game theory. To conclude, we set a brief (and thus far from exhaustive) list of issues for which some mathematical understanding is available (although a lot of open questions remain): - Justification of the derivation of mean field games models from N-player Nash equilibria:
264 O. Gueant et al. A general analytical framework has been developed by J.-M. Lasry and P.-L. Lions ([34-37] and [38]) that allows to derive rigorously the mean field games equations from N-player Nash equilibria. This framework is of independent mathematical interest and has many other applications (limits of equations when the dimension goes to infinity, interacting particle systems, large deviations for stochastic partial differential equations, . . . ) - Expansion in N as the number of players N goes to infinity: Such an expansion has been rigorously established for a large class of examples of mean field games models (at least in situations where the uniqueness of solutions holds for the limit mean field games system). - Existence and regularity results: For large classes of models, the existence and regularity of solutions is now understood. - Uniqueness results: Two uniqueness regimes have been identified: the case of a small horizon and the case of a "monotone" coupling. In addition, non-uniqueness examples are available that show that there does not seem to be any other general uniqueness regime. - Stability questions: Of course, closely related to uniqueness is the issue of the stability of solutions which is indeed, true in the uniqueness regimes. It is worth pointing out that there are many notions of stability (small perturbations of data, horizon going to infinity, . . . ) which are all of interest. - Interpretation of mean field games models as control problems: For a substantial class of mean field games models, it is possible to show that the mean field games system corresponds to a global optimal control problem of a certain partial differential equation. Roughly speaking, the system is then described as the coupling of the equations governing the state of a system and its dual state. - Numerical Approaches: Various numerical methods or approaches have been proposed such as direct discretizations (finite elements) of the systems, discretization of the associated control problem (when there is one, see above), various iteration strategies, or the addition of an extra time variable ("relaxation time"). - Limiting situations: One relevant class of limiting situations corresponds to what could be called a planning problem. Instead of prescribing the initial state ("density") of the agents population and the terminal "cost-reward" profile for each agent as it is the case for "classical" mean field games models, one prescribes the state of the population (agents) both initially and at the end of the time interval (in other words, at both ends). In that case, the unknown terminal "cost-reward" function can be thought as the incentive scheme for each player which will lead to the desired final state of the population. Most of the preceding mathematical results can now be extended to that "limiting" class of models.
Mean Field Games and Applications 265 Acknowledgements The research results presented here could not have been made without the financial support of the Chair "Finance and Sustainable Development". Hence, the authors express their gratitude to the Chair and all the associated partners. Also, the "Centre Francais de l'Energie" deserves a special acknowledgment for its specific financial support on the mean field games application to exhaustible resources. References 1. Abramowitz,M., Stegun, I.: Handbook ofMathematical Functions with Formulas, Graphs, and Mathematical Tables. Dover, New York (1964) 2. Acemoglu, D., Aghion, P., Zilibotti, F.: Distance to frontier, selection, and economic growth. J. Eur. Econ. Assoc. 4(1) (2006) 3. Achdou, Y., Capuzzo-Dolcetta, I.: Mean field games: Numerical methods (To appear) 4. Aghion, P., Bloom, N., Blundell, R., Griffith, R., Howitt, P.: Competition and innovation: An inverted-u relationship. Q. J. Econ. 120(2) (2005) 5. Aghion, P., Harris, C., Howitt, P., Vickers, J.: Competition, imitation and growth with step-bystep innovation. Rev. Econ. Stud. 68(3), 467-492 (2001) 6. Aghion, P., Howitt, P. (To appear) 7. Atkinson, A.: Top incomes in the united kingdom over the 20th century. J. R. Stat. Soc. 168, 325-343 (2005) 8. Atkinson, A., Piketty, T.: Top Incomes over the Twentieth Century: A Contrast between European and English-Speaking Countries. Oxford University Press, Oxford (2007) 9. Aumann, R.: Markets with a continuum of traders. Econometrica 32(1/2), 1-17 (1964) 10. Bardi,M., Capuzzo-Dolcetta, I.: Optimal Control and Viscosity Solutions of Hamilton-Jacobi- Bellman equations. Birkhauser, Boston (1997) 11. Bensoussan, A., Frehse, J.: Nonlinear elliptic systems in stochastic game theory. J. Reine Angew. Math. 350, 23-67 (1984) 12. Bensoussan, A., Frehse, J.: Ergodic bellman systems for stochastic games in arbitrary dimension. Proc. Roy. Soc. A. 449, 65-77 (1995) 13. Carmona, G.: Nash equilibria of games with a continuum of players. FEUNL Working paper series no. 466 (2004) 14. Chakrabarti, B.K., Chatterjee, A., Yarlagadda, S.: Econophysics of Wealth Distributions. Springer (2005) 15. Cordier, S., Pareschi, L., Toscani, G.: On a kinetic model for a simple market economy. J. Stat. Phys. 120(1/2), 253-277 (2005) 16. Cross, R., Grinfeld, M., Lamba, H.: A mean-field model of investor behaviour. Journal of Physics: Conference Series 55 (2006) 17. David, H.A., Nagaraja, H.N.: Order Statistics (Third edition). Wiley, New Jersey (2003) 18. Ekeland, I.: Le petrole sera-t-il brade? Pour la Science (2007) 19. Farkas, I., Helbing, D., Vicsek, T.: Mexican wave in an excitablemedium. Nature 419, 131-132 (2002) 20. Giraud, P.N., Gueant, O., Lasry, J.M., Lions, P.L.: A mean field game model of oil production in presence of alternative energy producers (To appear) 21. Gomes, D., Mohr, J., Sousa, R.: Discrete time, finite state space mean field games. Journal de Mathematiques Pures et Appliques 93, 308-328 (2010) 22. Gueant, O.: Mean field games and applications to economics. Ph.D. thesis, Universite Paris-Dauphine (2009) 23. Gueant, O.: A reference case for mean field games. Journal de Mathematiques Pures et Appliquees 92, 276-294 (2009) 24. Gueant, O.: A reference case for mean field games. Cahier de la Chaire Finance et Developpement Durable 10 (2009)
266 O. Gueant et al. 25. Gueant, O., Lasry, J.M., Lions, P.L.: Mean field games and oil production. In: Lasry, J.M., Lautier, D., Fessler, D. (eds.) The Economics of Sustainable Development. Economica (2010) 26. Guesnerie, R.: An exploration of the eductive justifications of the rational-expectations hypothesis. Am. Econ. Rev. 82(5), 1254-1278 (1992) 27. Horst, U.: Ergodic fluctuations in a stock market model with interacting agents: the mean field case. Discussion paper No. 106, Sonderforschungbereich 373, Humboldt Universitat, Berlin (1999) 28. Hotelling, H.: The economics of exhaustible resources. J. Polit. Econ. 39(2), 137-175 (1931) 29. Kalai, E.: Private information in large games. Discussion paper 1312. Center for Mathematical Studies in Economics and Management Science. Northwestern University (2000) 30. Kalai, E.: Ex-post stability in large games. Discussion paper 1351. Center for Mathematical Studies in Economics and Management Science. Northwestern University (2001) 31. Kalai, E.: Large robust games. Econometrica 72(6) (2004) 32. Khan, A., Sun, Y.: Non-cooperative games with many players (2002) 33. Lachapelle, A., Salomon, J., Turinici, G.: Computation of mean field equilibria in economics. Mathematical Models and Methods in Applied Sciences no. 1, 1-22 (2010) 34. Lasry, J.M., Lions, P.L.: Jeux a champ moyen i. le cas stationnaire. C. R. Acad. Sci. Paris 343(9), 619-625 (2006) 35. Lasry, J.M., Lions, P.L.: Jeux a champ moyen ii. horizon fini et controle optimal. C. R. Acad. Sci. Paris 343(10), 679-684 (2006) 36. Lasry, J.M., Lions, P.L.: Mean field games. Jpn. J. Math. 2(1), 229-260 (2007) 37. Lasry, J.M., Lions, P.L.: Mean field games. Cahiers de la Chaire Finance et Developpement Durable (2) (2007) 38. Lions, P.L.: Theorie des jeux a champs moyen et applications. Cours au College de France, http://www.College-de-france.fr/default/EN/all/equ_der/cours_et_seminaire s.htm (2007-2008) 39. Lions, P.L.:Mathematical Topics in Fluid Mechanics. Oxford Science Publications, Clarendon Press, Oxford (Vol. 1 (1996); Vol. 2 (1998)) 40. Lucas, R., Sargent, T.: Rational expectations and econometric practice. University of Minnesota Press, Minnesota (1981) 41. Markowitz, H.: Portfolio selection. J. Finance 7(1), 77-91 (1952) 42. Muth, J.F.: Rational expectations and the theory of price movements. Econometrica 29(3), 315-335 (1961) 43. Nash, J.: The bargaining problem. Econometrica 18, 155-162 (1950) 44. Nash, J.: Equilibrium points in n-person games. Proc. Natl. Acad. Sci. USA 36, 48-49 (1950) 45. Nash, J.: Non-cooperative games. Ann. Math. 54, 286-295 (1951) 46. Nash, J.: Two-person cooperative games. Econometrica 21, 128-140 (1953) 47. Neumann, J.V., Morgenstern, O.: Theory of Games and Economic Behavior. Princeton University Press, Princeton (1944) 48. Piketty, T.: Income inequality in france, 1901-1998. J. Polit. Econ. 111(5), 1004-1042 (2003) 49. Piketty, T., Saez, E.: Income inequality in the united states, 1913-1998. Q. J. Econ. 118(1), 1-39 (2003) 50. Touzi, N.: Stochastic control and application to finance. Scuola Normale Superiore, Pisa. Special Research Semester on Financial Mathematics (2002)
The Skorokhod Embedding Problem and Model-Independent Bounds for Option Prices David Hobson Abstract This set of lecture notes is concerned with the following pair of ideas and concepts: 1. The Skorokhod Embedding problem (SEP) is, given a stochastic process X = (Xt)t?0 and a measure ? on the state space of X, to find a stopping time ? such that the stopped process X? has law ?. Most often we take the process X to be Brownian motion, and ? to be a centred probability measure. 2. The standard approach for the pricing of financial options is to postulate a model and then to calculate the price of a contingent claim as the suitably discounted, risk-neutral expectation of the payoff under that model. In practice we can observe traded option prices, but know little or nothing about the model. Hence the question arises, if we know vanilla option prices, what can we infer about the underlying model? If we know a single call price, then we can calibrate the volatility of the Black- Scholes model (but if we know the prices of more than one call then together they will typically be inconsistent with the Black-Scholes model). At the other extreme, if we know the prices of call options for all strikes and maturities, then we can find a unique martingale diffusion consistent with those prices. If we know call prices of all strikes for a single maturity, then we know the marginal distribution of the asset price, but there may be many martingales with the same marginal at a single fixed time. Any martingale with the given marginal is a candidate price process. On the other hand, after a time change it becomes a Brownian motion with a given distribution at a random time. Hence there is a 1-1 correspondence between candidate price processes which are consistent with observed prices, and solutions of the Skorokhod embedding problem. These notes are about this correspondence, and the idea that extremal solutions of the Skorokhod embedding problem lead to robust, model independent prices and hedges for exotic options. D. Hobson () Department of Statistics, Zeeman Building, University of Warwick, Coventry CV4 7AL, UK e-mail: D.Hobson@warwick.ac.uk A.R. Carmona et al. (eds.), Paris-Princeton Lectures on Mathematical Finance 2010, Lecture Notes in Mathematics 2003, DOI 10.1007/978-3-642-14660-2_4, c Springer-Verlag Berlin Heidelberg 2011 267
268 D. Hobson 1 Motivation Consider the problem of pricing and hedging a one-touch digital option on an underlying. The standard approach to such a problem is to postulate a stochastic model for the underlying, perhaps the Osborne-Samuelson-Black-Scholes (exponential Brownian motion) model, and to price the option as the discounted expectation under the risk-neutral measure. In perfect frictionless markets this approach is justified by the theory of replication, and allows either counter-party in a transaction to eliminate the market risk. However, the success of a replicating strategy is predicated on the fundamental truth of the model on which it is based. Although market risk (the known unknown) is eliminated, model risk (the unknown unknown) remains. The classical hedging strategies remove hedging risk, but leave agents exposed to Knightian uncertainty. If the problem at issue is to price and hedge the exotic digital option then it seems reasonable to assume that simpler, vanilla options (such as call options) would also be traded. Then, at the very least, the volatility in the exponential Brownian motion can be calibrated with reference to the price of a traded call. However, this leads to a potential inconsistency, since many calls may be traded, each with their distinct volatilities. Ideally we should use a model which calibrates perfectly to the full spectrum of traded calls. However, in principle there are many such models, and associated with each model which is consistent with the market prices of (liquidly) traded options, there may be a different price for the exotic. Instead, one might attempt to characterise the class of models which are consistent with the market prices of options. This is a very challenging problem, and a less ambitious target is to characterise the extremal elements of this set, and especially those models for which the price of the exotic is maximised or minimised. Suppose the one-touch digital option is written on a forward price (St)0?t?T , and that the payoff is given by ? F =IA where I is the indicator function and A = {St ? B, for some t ? [0, T ]}. Here the payoff is made at time T, we take 0 to be the current time and we assume that the barrier B is above the initial price B > S0, and that S is right continuous. If we write HB for the first time the underlying reaches the barrier then we have HB = inf{u > 0 : Su ? B}, and ? F = I{HB?T}. The key observation is contained in the following inequality which is valid for anyK <B: I{HB?T} ? (ST ? K)+ B ? K + (SHB ? ST ) B ? K I{HB?T}. (1) Note that (1) is a path-wise inequality. The left-hand-side is the payoff of the option. The two terms on the right-hand-side have simple financial interpretations as the payoff from 1/(B ? K) call options with strike K (with maturity taken to match that of the exotic), and the gains from trade from a forward transaction in S, struck the first time, if ever, that the underlying crosses the barrier. Provided the call with strike K is traded, and provided it is possible to invest forward in S, then
The Skorokhod Embedding Problem and Model-Independent Bounds for Option Prices 269 the right-hand-side of (1) describes a super-replicating strategy for the one-touchdigital; furthermore by no-arbitrage it determines an upper bound on the price of the one-touch-digital given by C(K)/(B ? K), where C(k) is the traded price of a call option on the forward strike with k (By definition, the forward transaction is costless). Since the strike K in (1) is arbitrary we can optimise over K. If we write the arbitrage-free price of the one-touch digital as P( ? F) then P( ? F) ? inf C(K) B ? K (2) where the infimum is taken over traded strikesK <B. In deriving this bound the only assumption that has been used is that it is possible to generate constant multiples of the payoff (SHB ? ST )I{HB?T} at zero cost, which we interpret as an investment in the forward market. Note that we have imposed no probabilistic structure, we have not written down a stochastic model (?,F, F = (Ft)t?0, P) nor have we postulated the existence of a martingale measure Q. Instead, the bound is based on the ability to hedge using simple strategies in the forward market, and to take a static initial positions in vanilla securities at their prevailing time-0 market price. In this sense the resulting bound is modelindependent. The explicit modelling of the dynamics of S has been replaced by the requirement that the model is consistent with observed call prices, (which places implicit conditions on the stochastic properties of the underlying price process) and ?-hedging is replaced by super-hedging with a portfolio of call options. The quantity D = infK<B C(K) B?K gives a model-independent bound on the price of a digital option, in the sense that if we introduce any model for the underlying for which call prices are given by the pricing function C(k), then the discounted expected payoff of the option under (any) martingale measure is less than D. The question immediately arises: is this bound best possible? We will show in Sect. 2.7 below, by demonstrating a model which matches call prices and for which the price of the one-touch digital is equal to the bound, that this is indeed the case, and the bound is tight. (The model we give may not be realistic, but unless it can be ruled out, the bound D cannot be refined.) Return to the characterisation problem of describing the models which are consistent with observed option prices. It turns out that knowledge of the prices of puts and calls is equivalent to knowledge of the marginal distribution of the underlying asset under the measure used by the market for pricing. Further, if we assume temporarily that the market uses a pricing measure under which the forward price is a martingale, then the problem is to find a martingale with a given law at time T . However, any martingale is a time-change of Brownian motion. Hence the characterisation problem is reduced to the following: find stopping times such that the stopped Brownian motion has the given law. This is the classical Skorokhod embedding problem (SEP), first introduced (and solved) by Skorokhod [54]. The idea of relating the range of no-arbitrage prices of exotics to the prices of vanilla puts and calls via solutions of the Skorokhod embedding problem was first developed by Hobson [31] in the context of lookback options. The example above of
270 D. Hobson a one-touch barrier option, which allows perhaps for the simplest exposition of the theory, is from Brown et al. [9]. Recent applications include Cox and Obloj [18,19] to two-sided barrier options, Hobson and Neuberger [34] to forward-starting straddles and Dupire [24] and Carr and Lee [12] to volatility options, but, in principle, the method applies to a wide range of path-dependent derivatives. The connection between model independent option price bounds and the Skorokhod embedding problem can be exploited in both directions. Existing solutions to the SEP (see Obloj [43] for a comprehensive survey) can be used to give bounds on the prices of financial options; conversely questions about the range of no-arbitrage prices for path-dependent options motivates the search for further solutions of the SEP. 2 Model Independent Option Pricing 2.1 The Classical Approach The standard approach in derivative pricing is to begin by postulating a model (or a parametric family of models) for the price process (Pt)t?0, supported on a filtered probability space (?,F, F = (Ft)t?0, P)). The price of a contingent claim with payoff FT = F(Pt; 0 ? t ? T ), payable at T , is calculated as a discounted expectation: EQ[e?rTFT] = EQ[e?rTF(Pt; 0 ? t ? T )]. Here Q is an equivalent (local) martingale measure. In a complete market, the rationale for this pricing rule is supported by the replication (martingale representation) e?rTFT = EQ[e?rTFT] + T 0 ?t(dPt ? rPtdt), Q a.s. (Note that since Q is equivalent to P, any statement which holds Q almost surely, also holds P almost surely). The quantity ?t determines the investment or hedge in the risky asset. For example, in the exponential Brownian motion parametric family of models we have that the asset price P follows dP P = ?dW + ?dt and then for a call option with strike K, maturity T and payoff FT = (PT ? K)+ we have the price C(K, T ; P0; r, ?, ?), as given by the Black-Scholes formula. Here the quantities K and T are characteristics of the derivative, P0 is the observed initial value of the asset, r is assumed known (or observed from bond prices), the drift ? is irrelevant, since we price under the risk-neutral measure, and the volatility ? is estimated from historical data.
The Skorokhod Embedding Problem and Model-Independent Bounds for Option Prices 271 When the derivative has a payoff which is convex in the price process Pt (for example, a call option) then the model price C = C(?) is increasing in ?. Hence in practice, the volatility is selected via a calibration process in which the price of a liquidly traded option Ctraded is used to determine the implied volatility ?I as the solution to Ctraded = C(?I ). In this sense the real purpose of the pricing function C(K, T ) is as an extrapolation device. See Figlewski [26] for a discussion of other choices of extrapolation functions. 2.2 Model Misspecification and Incomplete Markets In a complete market the price EQ[e?rTFT ] and the hedge (or replication strategy) ?t are uniquely determined, and replication is perfect provided that the model provides an exact description of reality. Clearly, this last provision never holds. However, we have the following reassuring result, see Bergman et al. [6], El Karoui et al. [25], Hobson [33] and Janson and Tysk [37]. Theorem 1. Suppose that the goal is to price and hedge a claim on PT with convex payoff function FT = F(PT ). Suppose that the claim is priced and hedged under a diffusion model dPt = Pt??(Pt)dBt + rPtdt and that the model is sufficiently regular that the solution, denoted ? P, is such that (e?rt ? Pt)t?0, is a true martingale. The model is Markovian, so that we may write the replicating hedge of the claim F as ??t = ??(Pt, t). Now suppose that the real-world dynamics are such that dPt = Pt?tdBt+rPtdt and that ?t ? ??(Pt). Then ?EQ[e?rTFT] + T 0 ??(Pt, t)(dPt ? rPtdt) ? e?rTF(PT ), Q a.s., where ?EQ denotes the fact that expectation has been calculated under a martingale measure for the model with volatility ??. The content of the theorem is that if an agent uses a model which overestimates volatility, then provided she uses both themodel price and themodel hedge, then she will still succeed in super-replicating the option on a path-wise basis.We will extend this idea of path-wise super-replication so that it does not rely on an assumption that the true volatility is bounded by a model volatility, but rather so that superreplication holds whatever the behaviour of the underlying. In general, in incomplete markets there are several alternative criteria which can be used for option pricing. One alternative is to select arbitrarily (or otherwise) a martingale measure, perhaps by fixing the market prices of risk of those Brownian motions orthogonal to those driving the traded assets to be zero. Alternatively, utility indifference pricing incorporates the agents' attitudes to risk to find a price at which an option seller will be prepared to enter into a contract for sale of a derivative. The extreme version of utility indifference pricing is super-replication, whereby the agent is not willing to accept any risk.
272 D. Hobson These approaches are all conditional on an assumption that the dynamics of P follow a given model, or family of models. Often, (e.g. in the case of utility indifference pricing) the investor needs knowledge of the drift parameter ? (which is notoriously difficult to estimate) as well as the volatility ?. 2.3 A Reverse Approach: Recovering a Model from Prices The starting point of our philosophy is to take option prices (at least those of liquidly traded options) as exogenously given by the market, and to use those prices to learn about the stochastic properties of the underlying. Since market prices are determined under the measure used by the market for pricing, the conclusions we draw are already phrased in a fashion whereby they can be used for pricing other derivatives. Lemma 1 (Breeden and Litzenberger [8]). Fix T ? (0,?). Suppose that call prices with maturity T are known for every K ? (0,?). Then assuming call prices are calculated as the discounted expected payoff under a model Q, so that C(K, T) = EQ[e?rT (PT ? K)+], we have Q(PT >K) = erT ? ?KC(K, T ), (3) and, provided C is twice-differentiable in K Q(PT ? dK) = erT ?2 ?K2 C(K, T ) (4) If the law of PT underQ has atoms, then Q(PT > K) is given by the right derivative in (3), and Q(PT ? K) by the left derivative. In this case (4) must be understood in a distributional sense. However, for the present we assume that there are no atoms and C is smooth (Fig. 1). P0 P0erT k C(k) Fig. 1 No arbitrage considerations force that the call price curve C is a decreasing convex function of k (for maturity T fixed) with C(0) = P0 and C(k) ? (P0 ? Ke?rT )+
The Skorokhod Embedding Problem and Model-Independent Bounds for Option Prices 273 It follows from the Lemma that call prices, as represented by the set of decreasing convex functions are in one-to-one correspondence with the marginal laws of PT under the pricing measure. The above result applies for individual maturities. If we also have information about the dependence of option prices on maturity we can recover a price process. Theorem 2 (Krylov [39], Gyongy [28], Dupire [23]). Suppose call prices are known for every K ? (0,?) and every T ? (0, T). Assuming that C(T,K) is sufficiently differentiable, there exists a unique diffusion of the form dPt = Pt?(Pt, t)dBt + rPtdt such that E[e?rT (PT ? K)+] = C(K, T ) In particular, ?(p, t) solves 12K2?(K, T )2CKK ? rKCK ? CT = 0. The idea in Krylov [39] is to take any process (Yt)t?0 and to show that there exists a diffusion process Xt with the same marginal distributions. Gyongy refined the analysis and derived the relationship ?(k, t)2 = E[(dY )2t|Yt = k]. Dupire has a slightly different starting point in that rather than assuming the existence of a process Y he begins with the call price surface C(K, T ). The Dupire construction gives a unique Markovian martingale which agrees with the doubly infinite family of call option prices. In principle, it is then possible to give the prices of any other derivatives. However, the diffusion assumption is a strong assumption (and is inconsistent with stochastic volatility, for example), and although the Dupire diffusion calibrates perfectly to the initial structure of call prices, there is no guarantee that it will match derivative prices at any later time. (We consider in Sect. 6.3, the existence of other martingales which also match the marginals implicit in the call price function.) Both the Breeden and Litzenberger [8] and Dupire [23] results give us information about how the marginal distributions of the asset (under the pricing measure) can be determined from call prices. More generally, given any set of option prices we can ask: : Is there a model consistent with those prices? (i.e. can we find (?,F, F,Q) such that EQ[e?rTFT] = f for each claim F with associated traded price f) : If such a model exists is it unique? : If there is no such model, is there an arbitrage?
274 D. Hobson 2.4 Notation It is very convenient to remove the impact of interest rates by switching to a notation in which prices are expressed in discounted terms. Define St = e?rtPt, then (St)t?0 is the forward price, and is a martingale under a pricing measure. Furthermore, we write C(k) for the time-zero price of an option on the forward S with strike k (and maturity T ): C(k) = EQ[(ST ? k)+] = EQ[e?rT (PT ? kerT )+] = C(kerT ) where C denotes the price of a call option on PT. Then Q(ST > k) = |C(k+)|. When written without a superscript C denotes the traded set of options prices. However, under a martingale model for which ST ? ?, we also have that call prices are given by C?(k) = E[(X ? k)]+, X? ?; and we use C with a subscript to denote call prices which correspond to ST having a given law. Later we use P? to denote put prices under law ?: P?(k) = E[(k ? X)]+, X? ?. In the financial context, ? will be the law of a positive random variable, often with mean 1. However, the quantities C? and P? are well defined for any ? with first moment, and we will frequently consider the case where ? is the law of a centred random variable. 2.5 The Pricing Problem The goal of the next two sections is to develop a formal framework within which we can attempt to determine model-independent bounds and hedging strategies. Our set-up is an extension of the framework developed by Follmer and Schied [27] and especially Cox and Obloj [18, 19]. Let ?S describe the space of possible paths for the asset price process. A natural candidate is to let ?S be the space of continuous non-negative trajectories with a given initial value S0. The advantage of using this choice is that we can then define the natural filtration associated with the coordinate process, and then first hitting times will be stopping times with respect to this filtration. Note that we do not want to specify the probability triple (and especially the probability measure) exogenously, but rather to construct models (and measures) which are consistent with observed prices. See Cox and Obloj [19] for further discussion on this issue. Suppose we are given a family ? of admissible trading strategies (?t)0?t?T with associated terminal gains from trade processes G? = T 0 ?tdSt. The space
The Skorokhod Embedding Problem and Model-Independent Bounds for Option Prices 275 G? = {G?; ? ? ?} represents a space of costless, forward transactions. Implicitly, we are assuming zero transactions costs for trades on the forward market, or at least that such costs are negligible on strategies that we class as admissible. Suppose we are given a family {F?, ? ? A} of traded payoffs (random variables), and suppose that V is a vector space with basis F?, ? ? A. Suppose we are also given a map (pricing functional), P : V ? G? > R such that P is both linear, and monotone: P(v + G?) = P(v); P(?1F1 + ?2F2) = ?1P(F1) + ?2P(F2); F1 ? F2 ? P(F1) ? P(F2). Note that the monotonicity plays the role of a no-arbitrage condition. The idea is that P represents the prices at which the traded payoffs can be bought in the market. In the analysis we will assume that these payoffs can be bought and sold at the same price, but once we attempt to value a hedging portfolio of traded payoffs we can use the market bid or ask prices as appropriate. Now suppose we add a family of payoffs {F??; ?? ? A?}, and let V? be the vector space with basis {F?; ? ? A} ? {F??; ?? ? A?}. The problem is to decide when P can be extended to a linear function from ?V ? G? to R. Definition 1. The family {F?; ? ? A} is the set of vanilla securities. The family {F??; ?? ? A?} is the set of exotic securities. Equivalently the set {F?; ? ? A} is the set of payoffs whose prices are precisely determined by the market, and the set {F??; ?? ? A?} is the set of payoffs for which we wish to determine a price, relative to the prices of the vanilla securities. We have not yet been specific about the set of admissible trading strategies ?, and the definition of ? may be chosen according to the context. We certainly want to exclude strategies which allow for arbitrage. The main example is when ? is the linear space generated by ?? = (??t )0?t?T for stopping times ?, where ??t = I{t?(?,T]}. These are the gains from trade obtained from simple combinations of forward contracts. However, in Sect. 5.1 we will want to allow for more general strategies. 2.6 The Hedging Problem Definition 2. We say ?V is a static vanilla portfolio if ?V = n i=1 ??iF?i n < ?, ?1, . . . ?n ? A We say ? is a semi-static portfolio if ? is the sum of a static vanilla portfolio and an admissible trading portfolio.
276 D. Hobson Definition 3. ? is a semi-static superhedging portfolio for ? F if ? is a semi-static portfolio and ? ? ? F almost surely. Lemma 2. If P(F?) = f? for ? ? A and if ? = ni=1 ??iF?i + G? is a semistatic superhedging portfolio for ? F, then for any extension P from V to ? V we must have P( ? F) ?n i=1 ??if?i Proof. If P can be extended to the linear space spanned by {F? : ? ? A} ? ? F then P( ? F) ? P(?) = n i=1 ??if?i by monotonicity and linearity. Remark 1. In the set-up of Sect. 2.3 an implicit assumption is that option prices are both bid and ask prices and that there are zero transaction costs. This is a necessary assumption in order to identify a precise correspondence between prices and probabilities under the risk-neutral measure for use in the pricing problem. However, once we have identified a candidate model-independent super-replicating strategy involving vanilla options, in the hedging problem we can use market bid or ask prices (depending on whether the hedge involves a short or long position) as appropriate. In this way the theory extends to situations in which there are bid-ask spreads, even on liquidly traded securities. Note, moreover, that the position in vanilla securities is static over time, so these transaction costs are incurred once only, and unlike classical model-dependent ?-hedging, the semi-static hedging strategy remains feasible in a model with transaction costs. By restricting the class of admissible trading strategies in the forward, we can also allow for transaction costs on the forward. For example, in the next section we could restrict the class of admissible trading portfolios to those which involve at most a single forward transaction, and therefore incur transaction costs at most once. 2.7 An Example: A Digital Option We return to the example first discussed in the opening section; namely given the prices of call options what are the possible prices of a one-touch digital option, a security which makes a unit payment at T if ever St ? B for some t ? T . We assume that forward contracts with maturity T are traded at zero cost, and that ? = ? : ?t = p i=1 ?iI{?i<t?T}p ? N, ?i ? R
The Skorokhod Embedding Problem and Model-Independent Bounds for Option Prices 277 where (?i)i?p are stopping times. In fact the only property we need for ? is that ? ? {cI{HB<t?T}; c ? R}. We assume that the vanilla options are precisely the set of call options with maturity T , parameterised by the strike K, and that a continuum of such calls are traded (one for each possible strike), together with the bond which pays a unit value at time T . In the notation of this section, {F?; ? ? A} = {FK;K ? R+} = {(ST ? K)+;K ? R+}, and for K ? (0,?) the payoff FK = (ST ? K)+ has price fK = C(K). Note that to preclude arbitrage in the vanilla options we must have that C is a decreasing convex function, and that by our assumption that S is a forward price C(0) = S0, C(S0) ? ?1 and C(K) ? (S0 ? K)+. We also make the very natural assumption that limK^? C(K) = 0. (As observed by Davis and Hobson [20] this does not follow from no arbitrage alone, but rather from a martingale assumption, and can be violated if the asset price allows a bubble, see e.g. Cox and Hobson [16]. Davis and Hobson [20] introduce the notion of a weak arbitrage and Cox and Obloj [19] introduce the parallel notion of a weak free lunch with vanishing risk, which they use to describe some of the consequences of the failure of this assumption.) Now we consider the contract ? F = I{HB?T} with B ? S0. For anyK < B we have (recall (1)) ? F ? 1 (B ? K)FK + G? where FK is the payoff of a vanilla option (ST?K)+, and ?t = ?I{HB<t?T}/(B? K) so that G? = (SHB ? ST )/(B ? K). There are two cases to be checked, namely when the left-hand-side is zero or one. If the barrier is not reached, then the left-hand-side is null and there is only one non-zero term on the right-hand-side, which is non-negative. If the barrier is reached, then the second term on the right-hand-side of (1) is present and moreover SHB ? B (with equality if S is continuous). Taking the value (ST ? K) rather than the positive part (ST ? K)+ again only makes the right-hand-side smaller, and leads to equality in (1) on (HB ? T ). It follows immediately that P( ? F) ? C(K)/(B ? K), and since K is arbitrary we conclude P( ? F) ? infK<B C(K)/(B ?K) = C(K?)/(B ?K?) =: D, where K? = arginfK<B(C(K)/(B ? K)). Now we want to argue that this bound is best possible in the given framework. To do this we exhibit a model under which the fair prices (i.e. expected values) of the vanilla securities are equal to the bound D. Since we are interested in pricing issues, it makes sense to work directly in a martingale measure, so that there is no distinction between P and Q. Write ? for the law of ST. Let b(K) = E[ST |ST ? K] = y?k y?(dy)/y?k ?(dy); b is called the barycentre function. By definition it is left-continuous, increasing and b(K) ? K ? E[ST ], at least for K smaller than the upper bound on the support of ?, where it is defined. Furthermore, if ? has a density then b(K) is continuous.
278 D. Hobson Given B there exists ?K= ?K(B) such that b(?K+) ? B ? b(?K) and then we can find a set A with (ST > ?K) ? A ? (ST ? ?K) for which B = A y?(dy)/A ?(dy), or in otherwords 0 = A(y ? B)?(dy) = A (y ? ?K)?(dy) + (?K? B)?(A). It follows that ? (A) = C(?K)/(B ? ?K) so that P(ST > ?K) ? C(?K) B ? ?K? P(ST ? ?K). Let a = Ac y?(dy)/Ac ?(dy), and let ST/2 take the values B or a with probabilities (x ? a)/(B ? a) and (B ? x)/(B ? a) respectively. On the set ST/2 = B, let ST have the law ? restricted to A. Similarly, on ST/2 = a, let ST have the law ? restricted to Ac. Suppose St is constant except for a pair of jumps at T/2 and T. See Fig. 2. Then, by construction, E[ST ;A] = BP(A) and E[ST ;Ac] = aP(Ac) so that St is a martingale.Moreover, if prices P are given by expectation with respect to P then P(F?) = P(HB ? T) = P(ST/2 = B) = ?(A) = C(?K) B ? ?K. It remains to show that ?Kis a minimiser of C(K)/(B?K). This can be deduced from the fact that the bound P( ? F) ? C(K)/(B ? K) holds for any martingale model with the correct marginals.We have P(HB ? T)=?(A)= C(?K) (B ? ?K) ? inf K<B C(K) (B ? K) ? sup?P(HB ? T)?P(HB ? T) where the supremum is taken over martingale models, denoted by?P, with the correct marginal laws at time T . Hence there is equality throughout and ?Kis a minimiser (Fig. 3). The above analysis exhibits a pure-jump model for which ST ? ? (and the price of the barrier option is equal to the robust upper bound C(K?)/(B ? K?)). Although potentially the simplest model, it is not unique. Indeed, we can construct a continuous price process model with the same properties. Let (W0 t )t?0 be Brownian motion, started at zero, and for? < 0 < ?, letH0?,? = inf{u : W0 u /? (?, ?)}. ThenW0H0?,? ? {?, ?} and P(W0H0?,? = ?)=?/(???) =: p, and we have embedded a two-point distribution in Brownian motion. Now set Xu = W0 u/(1?u)?H0?,? ; then X is a martingale with X1 ? p?? + (1 ? p)??.
The Skorokhod Embedding Problem and Model-Independent Bounds for Option Prices 279 B S0 a T/2 ?K(B) T Fig. 2 A jump model which matches options prices, and for which the maximum value of the digital option is attained. The price process is constant except for jumps at T/2 and T. Those paths which are at B (respectively a) at T/2 end up above (below) ?K(B) after the jump at time T * S0 S0 k C(k) K K B Fig. 3 The minimiser K? = K?(B) is chosen such that the tangent to C at K? crosses the x-axis at BWith this in mind, define Hsa,B = inf{u : Ws u /? (a,B)} whereWs t = S0 +W0 t , and S0 = s. By construction S0 +W0Hsa,B ? {a,B}. If we set St = S0 +W0 2t/(T?2t)?H0a?s,B?s = Ws 2t/(T?2t)?Hsa,B
280 D. Hobson then (St)0?t?T/2 is a continuous martingale which takes values in {a,B} at time T/2. To complete the construction (i.e. to construct the process St over (T/2, T ]) we need to discuss how to embed any centred distribution in Brownian motion (and not just a two point distribution). This is the Skorokhod embedding problem. 3 The Skorokhod Embedding Problem 3.1 The Classical Skorokhod Embedding Problem Suppose we are given a stochastic process X = (Xt)t?0 on a filtered probability space (?,F, F = (F)t?0, P, (Xt)t?0). Suppose X has state space I. The Skorokhod embedding problem (SEP) for (X, ?) is, given ? on I, to find (where possible) a stopping time ? such that the law of the stopped process is ?. We write ? ? ? T (X, ?). The classical version of the problem takes X ? W, aBrownian motion on R, started at 0, and ? a centred probability measure, in which case we suppress W from the notation and write ? ? ? T (?). Obloj [43] provides a comprehensive survey of the literature of solutions to the Skorokhod embedding problem. He lists more than twenty solutions, some of which we will discuss below. In the sequel the key properties of Brownian motion that we will use are the fact that Brownian motion leaves any interval in finite time almost surely, (so Ha := inf{u : Wu = a} < ? a.s.); the martingale property; the consequent fact that for a < x < b,Px(Ha < Hb) = (x ? a)/(b ? a); and the fact that Brownian motion has no intervals of constancy. Only occasionally will we use the speed of Brownian motion, but then we have that Ex[Ha ? Hb] = (b ? x)(x ? a). We shall often decompose Brownian motion into its constituent excursions away from zero, which are parameterised by the local time Lt. See Rogers [49] for an introduction to Brownian excursion theory. If we write Jt for the maximum process Jt = sup0?s?t{Ws} (we reserve the notation Mt for martingales, and St for forward prices) then by Levy's Theorem (Lt, |Wt|) ? (Jt, Jt?Wt), and there is an equivalent decomposition of a Brownian path into the excursions below the maximum. The local time is parameterised in such a way that the rate of excursions with maximum (in modulus) greater than a is a?1, for any positive a. 3.2 Doob's Solution Our first solution is attributed by Rogers and Williams [50] to Doob, and is not intended as a genuine solution to the SEP, but rather to show that without some refinements on the class of solutions to the SEP, the problem is trivial.
The Skorokhod Embedding Problem and Model-Independent Bounds for Option Prices 281 Wt W1 t ? F?1 ? (?(W1)) Fig. 4 The Doob construction. Run the Brownian motion until time 1. Conditional on the value at time 1, construct a new target level and run the Brownian motion until it first reaches this level. For a carefully chosen rule for selecting the target level, this construction embeds ? Given ?, define F? to the distribution function F?(x) = ?((??, x]) = P(X ? x|X ? ?). Let ? be the distribution function of a standard normal distribution, and let Z = F?1 ? (?(W1)). Then Z has law ?: P(Z ? x) = P(F?1 ? (?(W1)) ? x) = P(W1 ? ??1(F?(x))) = F?(x). Now let ? = inf{u ? 1 : Wu = F?1 ? (?(W1))}. Then W? ? F?1 ? (?(W1)) ? ?. See Fig. 4. Note that in general F?1 ? (?(x)) = x and thus, conditional on W1 = x, the expected value of ? is infinite. Then, unless ? has a standard normal distribution, E[?] = ?. In particular, (Wt?? )t?0 is not uniformly integrable. 3.3 Hall's Solution Let c= ?0 x?(dx). By the centring propertywe must also have c= 0 ?? |x|?(dx). Choose a pair of random variables U ?(??, 0), V ?[0,?) with joint law ? where ?(du, dv) = (|u| + v) c ?(du)?(dv)
282 D. Hobson Wt t ? UV Fig. 5 The Hall construction. Given random variablesU < 0 < V, we stop the Brownian motion the first time it leaves the interval [U, V ]. For the appropriate joint distribution of (U, V ), this leads to an embedding of ? (For example, if ? is a uniform distribution on (?1, 1) then c = 1/4 and ?(du, dv) = (|u| + v).) Then, conditional on (U = u, V = v), let ?u,v = inf{t ? 0 : Wt /? (u, v)}. We claim that ? = ?U,V embeds ?. See Fig. 5. We have, for u < 0, P(W? ? du) = v?[0,?) P(U ? du, V ? dv)P(W?u,v = u|U ? du, V ? dv) = ? v=0 ?(du, dv) v |u| + v = ?(du)? v=0 ?(dv)vc= ?(du). A similar calculation applies for v > 0, and the Hall embedding is a solution of the SEP for (W, ?). For this construction we can also calculate E[?]. Again conditioning on the exogenous random variables U and V , E[?] = E[E[?U,V |U, V ]] = 0 ?? ? 0 dv|u|v?(du, dv) = 0 ?? ?(du) ? 0 ?(dv) |u|2v + |u|v2 c
The Skorokhod Embedding Problem and Model-Independent Bounds for Option Prices 283 = 0 ?? u2?(du) ? 0 ?(dv)vc + 0 ?? |u| c ?(du) ? 0 ?(dv)v2 = ? ?? u2?(du), so that at least in the case where ? has finite variance, E[?] is equal to that variance. As we shall see below this is best possible. In this sense, the Hall solution is optimal; however, it has the undesirable feature of requiring independent randomisation. 3.4 Properties of Good Solutions Briefly we return to the general setting of a stochastic process X on I, and let ? and ? be stopping times. Definition 4. The stopping time ? is minimal if ? ? ? andX? ? X? implies ? = ? almost surely. Minimality is a natural concept for good solutions of the SEP in a general context, but now we return to the Brownian setting. Theorem 3 (Monroe [42]). 1. Minimal stopping times exist; given ? there exists a minimal stopping time ? with W? ? W? . 2. Hitting times are minimal; all stopping times with finite expectation are minimal. 3. Suppose ? is such that E[W?] = 0. Then ? is minimal if and only if Wt?? is uniformly integrable. The equivalence between uniformly integrable stopping times and minimal stopping times in the centred case allows us to translate an analytic condition which is useful for concluding that E[W???] = 0 into a path-wise condition describing good stopping times, where the adjective 'good' might better be expressed as 'not obviously inefficient'. We prove some of Theorem 3. Proof (that stopping times with finite expectation are minimal.). If E[?] < ? then E[W?] = 0 and E[W2 ? ] = E[?]. If ? ? ? and W? ? W? , then E[?] = E[W2 ?] = E[W2 ? ] = E[?] and ? = ? almost surely. Corollary 1. If ? has a secondmoment and ? ? ? T (?) then either E[?]= x2?(dx) or E[?] = ?.
284 D. Hobson Proof (that if Wt?? is uniformly integrable, then ? is minimal.). Suppose that ? ? ? and W? ? W? . Then for all a, E[W? ? a;W? ? a] = E[W? ? a;W? ? a] = E[W? ? a;W? ? a] where we use the identity in law, and the martingale and uniformly integrability properties. Now E[W? ? a;A] is maximised over sets A ? ? by choices A for which, modulo null sets (W? > a) ? A ? (W? ? a). But E[W? ? a;W? ? a] attains this maximum and hence modulo null sets, (W? > a) ? (W? ? a) ? (W? ? a). Hence W? = W? almost surely. Now let ? be any other stopping time with ? ? ? ? ?. Then W? = E[W? |F?] = E[W?|F?] = W? = W? , almost surely. HenceW is constant on (?, ? ), and since W has no intervals on constancy we must have ? = ? as required. In the centred Brownian case we write ? ? T (?) if ? ? ? T (?) and ? is minimal. Corollary 2. If ? is centred and has support contained in an interval I and if ? ? T (?) then ? is less than or equal to the first exit time from I. 3.5 The Azema-Yor Solution The Azema-Yor [2] solution is based on a stopping rule which is the first entrance of the joint process (Wt, Jt) into a domain DJ?. Let ? be an increasing (but not necessarily continuous, nor strictly increasing) process such that ?(j) ? j. (If j0 is such that ?(j0) = j0 then we insist that ?(j) = j for all j ? j0.) Let b be the leftcontinuous inverse to ? so that b = ??1, and let ?? = inf{t > 0 : Wt ? ?(Jt)}. See Fig. 6. Our approach is based on Rogers [49]. By the representation of the Brownian path in terms of excursions down from the maximum we have that the probability that J? is greater than j is equal to the probability that no excursion down from the maximum gets below ?(J-) before J reaches j. Let n denote Ito excursion measure and let Az be the set where the excursion down from the maximum when the maximum equals z gets below ?(z): Az = {max0<u<?z (ez(u)) > z??(z)}. Here ?z is the lifetime of the excursion down from the maximum which occurs when the maximum is at z, and (ez(u))0<u<?z is an excursion away from 0 of Brownian motion. Then P(J? ? j) = P(n (?z?jAz) = 0) = exp?j 0 dz z ? ?(z)
The Skorokhod Embedding Problem and Model-Independent Bounds for Option Prices 285 b(w) w Wt Jt W? J? Fig. 6 The Azema-Yor embedding. The figure shows a plot of the excursions of Wt down from the maximum, represented by the horizontal lines in (Wt, Jt) space. The Azema-Yor stopping time is the first time that the Brownian path crosses the line given by the barycentre b where we use the fact that the rate of excursions whose maximum modulus exceeds a is a?1, and the fact that for a Poisson random variable Z of mean ?, P(Z = 0) = e??. Having described the construction it remains to describe how to choose ? so that ? is a solution of the Skorokhod embedding problem for (W, ?). Note that the law of J? has a continuous density, except perhaps for an atom at j0. Moreover, for j such that ?(j) < j, (W? > ?(j)) ? (J? ? j) ? (W? ? ?(j)), (5) and, at least where b is continuous, we have P(W? ? w) = exp?b(w) 0 dz z ? ?(z), (6) and, if b is differentiable,?P(W? ? dw) P(W? ? w) = ? b(w) b(w) ? w. If W? ? ? then P(W? ? w) = ?([w,?)) =: ??(w), and if w is a continuity point then (b(w) ? w)?(dw) = b(w)??(w). It follows that d dw ? w z?(dz)= ?w?(dw) = b(w)??(w) ? b(w)?(dw) = d dw b(w) ? w ?(dz).
286 D. Hobson Integrating, and using the fact that at w equal to the lower limit on the support of ? we have ?w z?(dz) = 0 we find that b is equal to the barycentre function: b(w) = ?w z?(dz) ?w ?(dz) = EX??[X|X ? w]. (7) Example 1. If ? ? U[?1, 1] then b(w) = (w + 1)/2 (for ?1?w ?1) and ?(j) = 2j ? 1 for 0 ? j ? j0 = 1. If E1 is an exponential random variable rate 1 and ? is the centred distribution given by ? ? (E1 ? 1) then b(w) = w + 1 (for w > ?1) and ?(j) = j ? 1 for j < j0 = ?. If ? = (p?1 + p??1 + (1 ? 2p)?0) with p < 1/2 then for w ? ?1, b(w) = 0; for ?1 < w ? 0, b(w) = p/(1 ? p) and for 0 < w < 1, b(w) = 1. Then ? is also piecewise constant (for j ? 1): for 0 ? j < p/(1 ? p) we have ?(j) = ?1; for p/(1 ? p) ? j < 1 we have ?(j) = 0, and ?(j) = j for j ? 1. We have that the Azema-Yor construction gives a solution of the SEP for (W, ?). The question arises, is it minimal? By Monroe's result (Theorem 3), it is equivalent to ask if Wt?? is uniformly integrable, and for the Azema-Yor stopping rule it is possible to verify by calculation that this is the case. By a Theorem of Azema, Gundy and Yor [4] a (necessary and) sufficient condition for uniform integrability is that limx^? P(supt?? |Wt| ? x) > 0. For the Azema-Yor stopping time, P(sup t?? |Wt| ? x) = P(H?x < Hb(?x)) +P(Hb(?x) < H?x)Psup t?? Wt ? xHb(?x) < H?x= b(?x) x + b(?x) + x x + b(?x) P(W? ? ?(x)) P(W? ? ?x) . Now b(?x) > 0 and ??(?x) > 1 so that lim x^? xP(sup t?? |Wt| ? x) = lim x^? x??(?(x)) = lim y^? b(y)??(y) = lim y^?E[Y |Y ? y]P(Y ? y) = lim y^?E[Y ; Y ? y] = 0. Thus, if we are given ? and we define the barycentre function and its inverse, and the Azema-Yor stopping time relative to this inverse, thenWt?? is uniformly integrable. However, if we consider a general increasing function ? (for example, ?(j) = 1 ? 1/j), then there is no reason for the corresponding stopping rule to be associated with a uniformly integrable stopped process Wt?? . Note that from (7) we have (b(w) ? w)P(W? ? w) = ? w (z ? w)?(dz) = E[(W? ? w)+].
The Skorokhod Embedding Problem and Model-Independent Bounds for Option Prices 287 Furthermore, by Doob's submartingale inequality, for any uniformly integrable stopping time, and any j, 0 = E[W? ? j; J? ? j] = E[W? ? w; J? ? j] + (w ? j)P(J? ? j) ? E[W? ? w,W? ? w] + (w ? j)P(J? ? j). (8) Then P(J? ? j) ? inf w<j E[(W? ? w)+] j ? w = inf w<j C?(w) j ? w . (9) This is suggestive of the model independent bound infK<B C(K)/(B ? K) from (2). There is equality in (8) if and only if (W? > w) ? (J? ? j) ? (W? ? w). (10) Comparing (10) with (5) we see that there is equality in (8) for the Azema-Yor construction provided w = ?(j). We have the following result: Proposition 1. Amongst all minimal solutions of the SEP for (W, ?) the Azema-Yor stopping rule maximises P(J? ? j) simultaneously for all j. It is crucial in the proposition that we restrict attention to uniformly integrable stopping times. If we consider all embeddings then the problem is degenerate, and for each j > 0 there is an embedding for which P(J? ? j) = 1. To see this run the Brownian motion until the first return to zero after the first hit on j, and then use a favourite embedding thereafter. A corollary of the proposition is that there exists a model for which the forward price is continuous and the price of a one-touch digital option is equal to the upper bound C(K?)/(B?K?).Moreover, the bound is attained by a process in which the sets where the maximum is large correspond exactly to the sets where the terminal value is large. 3.6 Solutions of the SEP and Candidate Price Processes Let (Mt)t?0 be a continuous martingale, null at 0, such that MT ? ?. Then by the Dambis-Dubins-Schwarz Theorem (see e.g. Revuz and Yor [48, Theorem V.1.6]), Mt = WMt so that MT is a solution of the SEP for (W, ?). Conversely, if ? ? T (?) thenMt = Wt/(T?t)?? is a martingale with MT ? ?.
288 D. Hobson Further, if ? is an integrable but non-centred measure (with mean m?), then we can construct a centred measure ?0 by a parallel shift ?0((??, x]) = ?((??, x + m?]). If M0T andW0 ? embed ?0, then m? +M0T and m? +W0 ? embed ?. Putting these two ideas together, there is a one-to-one correspondence between minimal solutions of the Skorokhod Embedding Problem, and candidate martingale price processes whose marginal distribution at T is consistent with call prices. If ? is supported on R+, then by Corollary 2, (Mt)0?t?T is non-negative. 3.7 Azema Martingales, the Azema-Yor Embedding and Super-Replication Suppose we are given an increasing (differentiable) function F(j), and consider the problem of maximising E[F(J? )] over minimal embeddings of ?. For ease of exposition suppose that ? is such that the barycentre b and its inverse ? are continuous. Given a positive function h defineH(j,w) = j 0 h(r)(r?w)dr. The Azemamartingale is H(Jt,Wt) = Jt 0 h(r)(r?Wt)dr. It is easy to see from Ito's formula that dH(Jt,Wt) = ?Jt 0 h(r)drdWt + h(Jt)(Jt ?Wt)dJt. The final term in this expression is zero since Jt = Wt whenever the finite variation process Jt is not constant, and hence H(Jt,Wt) is a martingale. We aim to design H such that argmaxj{F(j) ? H(j,w)} = b(w). This requires the choice h(j) = F(j)/(j ? ?(j)) and then H(j,w) = j 0 F(r) (r ? w) r ? ?(r) dr = F(j) ? F(0) + j 0 F(r) (?(r) ? w) r ? ?(r) dr, so that F(j) ? H(j,w) = F(0) + j 0 F(r) (w ? ?(r)) r ? ?(r) dr. We want to maximise this expression. Note that the integrand is positive for ?(r) < w (i.e. r < b(w)) and negative for ?(r) > w (i.e. r > b(w)). Hence the expression is maximised at j = b(w) and F(j) ? H(j,w) ? F(0) + b(w) 0 F(r) (w ? ?(r)) r ? ?(r) dr ? G(w)
The Skorokhod Embedding Problem and Model-Independent Bounds for Option Prices 289 where the above is taken as the definition of G. In particular, F(j) ? G(w) + H(j,w) (uniformly in j > 0, w ? R) and applying this result at (J?,W? ) we obtain F(J? ) ? G(W?) + H(J?,W? ), on a path-by-path basis, with equality for the Azema-Yor embedding. Taking expectations, then provided ? is such that H(Jt??,Wt?? ) is uniformly integrable, it follows that E[F(J? )] ? E[G(W? )]. If we further restrict attention to minimal stopping times which are solutions of the SEP for (W, ?) then sup ??T (?) E[F(J? )] ? R G(x)?(dx). Althoughwe have derived this result for differentiable F and regular ? it is clear that it can be extended to arbitrary (increasing) functions. For example, for the increasing function F(j) = I{j?B} we have sup ??T (?) P[J? ? B] ? EW? ? ?(B) B ? ?(B) I{W>?(B)}. This yields another proof of Proposition 1. 3.8 The Perkins Solution The Azema-Yor stopping time is based on a stopping rule which compares the value of the Brownian motion to a function of the running maximum. The stopping time has the property that it maximises the law of the maximum amongst the class of uniformly integrable embeddings. The Perkins [47] embedding has the property that it minimises the law of the maximum of the stopped Brownian motion, amongst all embeddings (There is no need to impose a minimality criterion here; if ? is not minimal then there exists ? ? ? withW? = W? and then J? ? J? ). In fact the Perkins embedding has the property that it simultaneously minimises the law of the maximum J? and maximises the law of the minimum I? = inf{Ws : 0 ? s ? ?}. Our interpretation of the Perkins construction is based on the following path-wise inequality, which plays an analogous role to (1): I{HB??} ? I{W??B}+(W? ? B)+ (B ? K) ?(K ?W? )+ (B ? K) +WHB ?W? (B ? K) I{HB??} (11) There is equality in (11) if on HB > ? we have K ? W? < B and on HB ? ? we have eitherW? ? B or W? ? K.
290 D. Hobson Under the assumption that ? is minimal, taking expectations in (11) we find P(J? ? B) ? P(W? ? B) + 1 B ? K (C?(B) ? P?(K)) (12) where P?(K) = EX??[(K?XT )+]. Since (12) holds for anyK we can find a best bound of this type by taking the supremum overK <B,and then we find that K is chosen to maximise C?(B) ? P?(K) B ? K . (13) The final bound is P(J? ? B) ? |C?(B?)| + sup K<B 1 B ? K (C?(B) ? P?(K)). (14) If we can find a model such that the bound is attained, then it will follow that (14) is a best bound. Fix B and suppose X ? ?. Then there exists ?Kand A with (X < ?K) ? (X ? B) ? A ? (X ? ?K) ? (X ? B) such that 0 = A(k ? B)?(dk) = k?B(k ? B)?(dk) + A\(X?B)(k ? B)?(dk). (15) Suppose ?1 is such that W?1 ? {K? ,B}. On W?1 = B we embed the mass ? restricted to A; on W?1 = ?Kwe embed the mass ? restricted to Ac. Let ?P be this second embedding, then ?P embeds ?. By construction, (J?P ? B) ? (W?1 = B), and from (15), C?(B) = (B ? ?K)(?(A) ? ?([B,?))) + P?(?K). Then, P(J?P ? B) = ?(A) = ?([B,?)) + C?(B) ? P?(?K) (B ? ?K) ? ?([B,?)) + sup K<B C?(B) ? P?(K) (B ? K) ? inf ??T (?) P(J? ? B) ? P(J?P ? B) Hence, there is equality throughout, and ?Kmaximises (13). The above construction gives a solution of the Skorokhod embeddingwhich minimises P(J? ? B) for a fixed B. The Perkins embedding has the property that it minimises P(J? ? B) over all embeddings simultaneously for all B > 0. (It also minimises P(I? ? C) for allC <0, where It = inf{Wu; u ? t}.) Define ?(j) = argmax?<0 C?(j) ? P?(?) j ? ? ?(i) = argmin?>0P?(i) ? C?(?) ? ? i
The Skorokhod Embedding Problem and Model-Independent Bounds for Option Prices 291 Jt It ?(i) ?(j) W? (Jt, It) Fig. 7 The Perkins embedding. Given monotonic ?(j) and ?(i), the stopping rule ? = inf{u:Wu ? {?(Ju), ?(Iu)} is such that when W is stopped it is either at a new maximum, or at a new minimum Let ? = inf{U : Wu /? (?(Ju), ?(Iu))} Then W? ? ? and P(J? ? B) attains the lower bound from (14) uniformly in B. See Fig. 7. 3.9 Financial Interpretation of the Perkins Construction Suppose that St is a forward price, and that calls are traded with maturity T on S. Suppose that such calls are traded with a continuum of strikes K with prices C(K) which are consistent with no-arbitrage. This is equivalent to assuming we know the marginal distribution of ST . One candidate model for which option prices are given by C is when the price process (St)0?t<T is constant and then there is a jump at T , taken such that E[(ST ? K)+] = C(K). For this price process, forB > S0, P(JST ? B) = P(ST ? B), where JSt = sup0?u?t Su. This is the lowest possible value for P(JST ? B) given the law of ST . Now suppose that the price process St is assumed to be continuous. The effect of this assumption is to ensure that if we buy S the first time that the price gets to level B or above, then the price paid is B. Consider the one-touch digital option with barrier B > S0and maturity T . In particular, consider the payoff ? F = I{sup0?t?T St?B}, and consider the problem of finding a highest, model-independent, lower bound on the price of this option.
292 D. Hobson In the setting of the general theory we have FK = (ST ?K)+, with fK = C(K), and ? ? {cI(HB,T ]}. Then, modulo translation to non-centred random variables, the analysis of the previous section applies and P( ? F) ? |C(B?)| + sup K<B C(B) ? P(K) (B ? K) , with equality for any model for which (ST < ?K(B)) ? (HB ? T ) \ (ST ? B) ? (ST ? ?K(B)) where ?K(B) = argmaxK<B(C(B) ? P(K))/(B ? K). 3.10 Barrier Options As another example of a model-independent bound for an exotic option consider a knock-in barrier call option on the forward price St with maturity T , strike K and barrierB > max{S0,K}. The option has payoff (ST ? K)+I{HB?T}, paid at T . If we place ourselves in the setting of Sect. 2.7 then we have the fundamental inequality, for k ? [K,B); (ST ? K)+I{HB?T} ? B ? K B ? k (ST ? k)+ + k ? K B ? k (SHB ? ST )I{HB?T}. The first term is a semi-static hedging strategy in calls, and the second is the result of a forward investment in the underlying. This yields the price bound on the barrier option P((ST ? K)+I{HB?T}) ? (B ? K) inf k?[K,B) C(k) B ? k (16) Recall the definition of the barycentre function b in (7) and its inverse ?. To emphasize the dependence of these quantities on the law ? representing the marginal distribution of ST we use a subscript and write b? and ??. Then, for K ? ??(B) we find that the infimum in (16) is attained at k = K and the upper bound on the knock-in barrier option is equal to the price of the call without the knock-in feature. However, forK <??(B) the upper bound is strictly less than the call, and is equal to (B?K)C(??(B))/(B???(B)). It is possible to construct a model based on the Azema-Yor embedding and a time-change to show that this price can be attained. For the lower bound, if there are no assumptions on the underlying then we have the trivial inequality (ST ? K)+I{HB?T} ? (ST ? K)+I{ST?B} with associated price bound P((ST ? K)+I{HB?T}) ? C(B) + (B ? K)|C(B?)|. This price bound is attained for a jump model with a single jump at time T .
The Skorokhod Embedding Problem and Model-Independent Bounds for Option Prices 293 If we are prepared to assume that the underlying price process is continuous then we can refine the lower bound (This assumption has the effect that SHB ? B, so that if we go short the forward the first time that the underlying equals or exceeds the barrier, then the gains from trade are (B ? ST )). For k ? [K,B) we have the inequality (ST ? K)+I{HB?T} ? (ST ? K)+ ? B ? K B ? k (ST ? k)+ ? (ST ? B)++(B ? K)I{ST?B} + k ? K B ? k (ST?HB ? B) (To see this, split into two cases, (HB ? T ) and (HB > T), and observe that the right-hand-side is piecewise linear, so that it is sufficient to check that the inequality holds where there are changes in value or kinks, i.e. at K, k and B.) Then P((ST ? K)+I{HB?T}) ? C(K) + (B ? K)|C(B?)| ? inf k?[K,B)B ? K B ? k (C(k) ? C(B))+ (k ? K)(B ? S0) (B ? k) This bound can be attained by a time-change of the Perkins solution to the Skorokhod embedding problem. See Brown et al. [10] for a further discussion of barrier options, including knockout barriers, and knock-in and knock-out puts, and Cox and Obloj [18, 19] for a discussion of two-sided barriers. 3.11 Potential Theory and the Chacon-Walsh Embedding To date we have supposed that the initial law of W is trivial (and then by a parallel shift we may as well assume that W0 ? ?0). Now we suppose thatW0 ? ?0. Given centred probability measures ?0 and ?1, we ask when does there exist a stopping time ? such that W0 ? ?0,W? ? ?1 and Wt?? is uniformly integrable? (17) Clearly, if we can decide when it is possible to solve (17), and if we can find constructions where they exist, then we can solve the iterated problem: given (?i)0?i?n find an increasing sequence of stopping times 0 = ?0 ? ?1 ? . . . ? ?n (where possible) such that W?i ? ?i, Wt??n is uniformly integrable. (18)
294 D. Hobson C?2 (k) C?1 (k) S0 S0 k Fig. 8 Given a pair of call price functions satisfying the no-arbitrage conditions, there exists a model for the forward price which is consistent with those prices provided the call prices are increasing in maturity Theorem 4 (Rost [52]). A necessary and sufficient condition for the existence of a solution to (17) is C?0 (K) ? C?1 (K) for all K (Fig. 8). Proof. Necessity follows from an application of the conditional Jensen's inequality. Since (w ? K)+ is convex as a function of w, C?1 (K) = E[(W? ?K)+] = E[E[(W? ?K)+|F0]] ? E[(W0 ?K)+] = C?0 (K). Sufficiency follows from one of the constructions given below. Put-call parity is a consequence of the identity (y ? k)+ ? (y ? k)? = y ? k. Given also (y ?k)+ +(y ?k)? = |y ?k| we have 2(y ?k)+ = |y ?k|+(y ?k). Hence C?0 (K) ? C?1 (K) is equivalent to U?0 (K) ? U?1 (K) where U?(K) = ?EX??|X ? K| is the potential (or minus the price of a straddle). Then the fact that C is a convex function, with C?(k) ? k? implies that U? is concave and U?(x) ? ?|x|. Kinks in the derivative U? correspond to atoms of ?; conversely straight segments of U? correspond to intervals where ? places no mass. The Chacon-Walsh solution of the SEP is based on potentials. We return to the case whereW0 = 0and ? is a centred probability measure, but it is immediate from the inductive nature of the construction that provided the potentials are decreasing, then the same construction will work as an embedding for any initial law. Let U0(x) = U?0(x) = ?|x|, and ?0 = 0. Fix a1 < 0 < b1. Set ?1 = inf{t > ?0 : Wt /? (a1, b1)}, ?1 ? L(W?1 ) and U1 ? U?1. Then U1(x) = ?|x| for x ? a and x ? b, and U1(x) = a1 ? (b1 + a1)(x ? a1)/(b1 ? a1) for x ? (a1, b1). See Fig. 9. We now proceed inductively. Fix an < bn. Set ?n = inf{t > ?n?1 : Wt /? (an, bn)}, ?n ? L(W?n ), Un ? U?n. Then Un is a continuous concave function with Un(x) = Un?1(x) outside (an, bn) and Un linear on (an, bn).
The Skorokhod Embedding Problem and Model-Independent Bounds for Option Prices 295 U?(x) a1 a2 b1 b2 Fig. 9 Potentials in the Chacon-Walsh picture U?(x) U? a(x1) (x) a(x2) b(x1) b(x2) x1 x2 Fig. 10 The Dubins construction in the Chacon-Walsh picture. Shown are the potentials at the first and second stages of the iteration, together with the starting and terminal potentials The idea is to choose the points (an, bn) appropriately in such a way that Un v U?. Then the increasing sequence of stopping times ?n converges (to ? say) and W? ? ?. There is a large amount of freedom in the choice of the sequence (an, bn). A natural choice is given by the Dubins [22] solution to the SEP. In the Dubins construction the sequence (an, bn) is defined as follows. LetA0 = {0}. Given U? let (a(0), b(0)) be the x-coordinates of the points where the tangent to U? at x crosses U?0(x) = ?|x|. (If there is an atom of ? at zero, then U? has a kink there, and there are many candidate tangents to U?. We are free to choose any of these; for definiteness we can choose the tangent with slope equal to the right derivative of U? at x0.) Set A1 = {a(0), b(0)} and let ?1 be the law with corresponding potential U1(x) = min{U0(x), U?(0) + xU?(0+)}. See Fig. 10. Given U?, An and potential Un, for each x ? An let (a(x), b(x)) be the xcoordinates of the points where the tangent to U? (with slope U?(x+)) intersects Un. Note that if xi < xj ? An then a(xi) ? b(xi) ? a(xj) ? b(xj). Then let An+1 = {a(xi), b(xi); xi ? An}, and ?n+1 the law with corresponding potential Un+1 = minxi?An{Un(x), Un(xi) + (x ? xi)Un(xi+)}.
296 D. Hobson The Azema-Yor embedding [2] can also be phrased in terms of a Chacon-Walsh potential picture. Rather than considering a sequence of intervals, consider a continuum of intervals, parameterised by j, such that b(j) = j and a(j) is the x-coordinate of the pointwhere the tangent to U? passes through the point (j,?j). (Note that a(j) is not necessarily unique, but it is increasing, so we can make it unique by making the function a right continuous.)We have ?j = inf{t ? ?j?;Wt /? (a(j), j)} A few lines of calculus show that a(j) is the inverse barycentre function. 3.12 The Skorokhod Solution in the Potential Picture Skorokhod's solution [54] of the Skorokhod embedding problem can also be represented in the Chacon-Walsh picture. The construction is similar to the Hall solution, and the idea is to choose a single exogenous random variable L, to use that random variable to define an interval, and to set ? to be the first time that Brownian motion leaves that interval. Let c = (0,?) x?(dx), so that U?(0) = ?2c. For l ? (0, 2c), let V+(l) be the x-coordinate of the point in R+ such that the tangent to U? at V+(l) crosses the y-axis at y = ?l. (If U? has linear sections then there may be an interval of such V+(l), in which case we take the largest.With this definition the increasing function V+(l) is right-continuous.) Similarly, define the decreasing function V?(l) to be the x-coordinate of the point in R? such that the tangent to U? at V+(l) crosses the y-axis at y = ?l. See Fig. 11. If ? has a continuous distribution function then we take L to have distribution given by P(L ? l) = ?((V?(l), V+(l)), for 0 ? l ? 2c. More generally, to allow for atoms we take P(L ? l) to equal one half the difference in slopes ?L V?(L) V+(L) Fig. 11 The Skorokhod embedding in the potential picture. The points V(l) are determined by the (unique) tangents to U? which pass through (0,?l)
The Skorokhod Embedding Problem and Model-Independent Bounds for Option Prices 297 between the tangents joining (V?(l), U?(V?(l))) with (0,?l) and (0,?l) with (V+(l), U?(V+(l))). Finally we set ?l = inf{u : Wu /? (V?(l), V+(l))}, and then W?L ? ?. Rather than prove this result, we give an example. Suppose ? is the law of a uniform random variable on (?1, 1). Then U?(x) = ?(x2 + 1)/2, c = 1/4, and V(l) = v1 ? 2l. Then, by symmetry, for w ? (0, 1), P(W?L ? w) ? P(W?L ? 0) = 12P(V+(L) ? w) = 12P(L ? (1 ? w2)/2) = w2 as required. Remark 2. The original Skorokhod construction assumes the existence of a nonnegative exogenous random variable Z, and then sets ? to be the first time the Brownian motion leaves the interval (?(Z), Z) for a non-positive decreasing function ?. From our representation of the Skorokhod solution in the potential picture we see Z ? V+(L) and ?(z) = V?(V ?1 + (z)). 3.13 The Bass Solution Whereas our philosophy has been to construct solutions of the Skorokhod embedding problem for Brownian motion with the aim of generating models for the martingale price process via a time-change, Bass [5] constructs a (time-inhomogeneous) martingale diffusion such that X1 ? ?, and then uses this to construct a solution of the SEP for (W, ?). As such the Bass construction is interesting in the finance context because it gives directly (a family) of diffusion processes with marginal law ? at time 1. Suppose that on (?,F, F = (Ft)0?t?1, P), the diffusion process Z solves the stochastic differential equation dZt = ?(Zt, t)dBt + ?(Zt, t)dt with Z0 = z, and is such that the law of Z1 is known and given by the atom-free centred distribution function FZ. Suppose further that we can calculate the time-1 law of Zt from any starting point (Zt, t)0?t<1. (The simplest case is when Z is itself a Brownian motion, but other constructions could be based on a Brownian bridge, a Bessel process or an Ornstein-Uhlenbeck process.) Given ?, (and associated distribution function F?), fix g(z) = F?1 ? (FZ(z)). Then g is increasing and g(Z1) ? ?. Now set Xt = E[g(Z1)|Ft]. Then Xt = h(Zt, t), for a function h which is increasing in its first argument, and has inverse Zt = H(Xt, t) say. Then X1 ? ? and dXt = h(Zt, t)?(Zt, t)dBt = a(Xt, t)dBt where a(x, t) = h(H(x, t), t)?(H(x, t), t). Note that X0 = E[g(Z1)] = 0. Given a Brownian motion W and the function a, define the increasing additive functional ? and its inverse A via ?0 = 0, d?u du = 1 a(Wu, ?u)2, At = inf{u : ?u > t}.
298 D. Hobson Set Xt = WAt . Then, with u = At, dAt dt = 1 d?u/du = a(Wu, ?u)2 = a(Xt, t)2, and for some Brownian motion ?Wt, dXt = dAt/dt d?Wt = a(Xt, t)d?Wt. Finally, since X1 ? ?, we have WA1 ? ? and hence ? = A1 is a solution of the Skorokhod embedding problem for (W, ?). 3.14 A General Schematic for Solutions Solutions of the Skorokhod embedding problem can be classified, very approximately, into three main types. The first type (such as Dubins [22] and also Azema-Yor [2]) fall under the general heading of potential theoretic constructions, and have a pictorial representation in the Chacon-Walsh [13] picture. It is also possible to place the original embedding due to Skorokhod in this category. For the second type of embedding the aim is to solve the SEP subject to an additional optimality criterion. In particular, given some functional H(Wt; 0 ? t ? ?), the aim is to solve the SEP for (W, ?) such that H is maximised, in the sense of first order stochastic dominance, or sometimes in the weaker sense of maximised in expectation. As we have seen, the Azema-Yor [2] and Perkins [47] embeddings fall into this category, but so do the Root/Rost [51, 53] constructions (based on the additive functional t), the Vallois [55, 56] embedding (based on the local time) and the Obloj-Yor [44] solutions (based on the age of the excursion), amongst others. We will discuss the Root and Rost solutions in detail below, because of the direct financial interpretations. Finally, there are miscellaneous embeddings which fall into neither of the above categories. These include the Hall [29] and Bass [5] solutions described above, and also the Bertoin-Le Jan [7] solution. 4 Other Applications of the Skorokhod Embedding Problem 4.1 The Central Limit Theorem These notes are primarily concerned with the connection between Skorokhod embeddings and derivative pricing and hedging. However, there is one other important application which deserves comment, namely the use of Skorokhod embeddings to prove the Central Limit Theorem.
The Skorokhod Embedding Problem and Model-Independent Bounds for Option Prices 299 Let X1,X2, . . . be a sequence of independent identically distributed random variables, with law ? such that ? hasmean zero and variance 1. Let Sn = k?n Xk. Let B(i) be Brownian motions, and let ?(i) be any of the minimal embeddings of ? in B(i) described to date. The times ?(i) are independent identically distributed random variables with mean 1, and B(i) ?(i) are independent. The sequence (Xi)i?1 = (B(i) ?(i) )i?1 has the properties listed in the previous paragraph. Let T0 = 0 and Tj = i?j ?(i). Now define a Brownian motion (Wt)t?0 by Wt =i?j B(i) ?(i) + B(j+1) t Tj ? t < Tj+1 (19) Then WTn = Sn, and by Brownian scaling, Sn/vn = WTn/vn ? WTn/n. The idea is that, since Tn/n > 1 and since at fixed times Brownian motion has Gaussian marginals, then in the limit Sn/vn will inherit a standard normal distribution. Theorem 5. With the notation and hypotheses of this section Sn/vn converges in law to a standard normal distribution. Proof. LetW be the Brownian motion defined in (19). Let Z(n) t = Wnt/vn. Then, for each n, Z(n) is a Brownian motion. By the above construction we have vSnn = WvTn n = Z(n) Tn/n ? ZTn/n, for a Brownian motion Z. Fix > 0 and choose? > 0 so that Psup t:|1?t|<? |Zt ? Z1| > < 2 By the strong law of large numbers Tn/n > 1 almost surely, so that we can choose N large, such that for all n ? N, P(|Tn/n ? 1| > ?) < 2 Combining these last two displayed equations we conclude that P(|WTn/vn ?Wn/vn| > ) = P(|ZTn/n ? Z1| > ) < Then P(Wn/vn < x? ) ? ? P(Sn/vn < x) ? P(Wn/vn < x + ) + and the result follows.
300 D. Hobson 4.2 Non-Centred Target Laws There is a very easy way to embed integrable, but non-centred, target laws in Brownian motion started at zero - simply run Brownian motion until it hits the mean, and thereafter use a favourite embedding for a centred distribution. Such an embedding is minimal, see Cox and Hobson [17]. Note however that whereas in the centred case if ? has support in an interval I = [a, b] then for a minimal embedding ? ? Ha?Hb, in the non-centred case this is no longer true. If the mean of the target distribution is positive then it is no longer possible to have an embedding for which ? ? Hz almost surely, for any z < 0. (If it were, then (Wt?? )t?0 would be bounded below and Fatou's lemma would imply that the law of W? had negative mean.) 4.3 Embeddings in Time-Homogeneous Diffusions Suppose that X is a time-homogeneous diffusion with state space I ? R with absorbing or inaccessible endpoints, and consider the SEP for (X, ?). The two fundamental questions are: when is it possible to embed ?, and if it is possible, how can it be done? In fact the problem can easily be reduced to the case of Brownian motion. The relevant insight is due to Azema and Yor [3], see also Pedersen and Peskir [46] and Cox and Hobson [15]. Suppose that X solves dX = a(X)dB + b(X)dt. If s solves a(x)2s(x)/2 + b(x)s(x) = 0, then s is a scale function for X and Y = s(X) is a local martingale with state space s(I). We have dY = s(s?1(Y ))a(s?1(Y ))dB. We can choose s such that s(x0) = 0 and then by the Dambis-Dubins-Schwarz Theorem Yt = W?t for some Brownian motionW, where ?t = Y t. Let ? be the image of ? under s. If we can solve the problem for (W, ?) then we can construct a solution ? for (Y, ?) via time-change, and then ? is a solution of the SEP for (X, ?). Thus, if W? ? ? and if A is the inverse to ?, then YA? = W? ? ?, and XA? ? s(YA? ) ? ?. Note that there is no reason to expect that ? is centred as a measure on R. By the remarks in the previous section we can construct embeddings for non-centred target distributions provided we do not impose any restrictions that ? is less than the first exit time from some interval. However, for the purposes of embedding in non-martingale diffusionswe must have that ? is smaller than the first exit time from s(I). If we set m? = R x?(dx), then we find that the answer to the question about whether ? can be embedded in Y depends on the joint properties of s(I) and m? : If s(I) = R, then there is a solution for the SEP for any ?, If s(I) = (?a,?) then there is a solution for the SEP for ? if and only if m? ? 0, If s(I) = (??, b) then there is a solution for the SEP for ? if and only if m? ? 0, If s(I) = (?a, b) then there is a solution for the SEP for ? if and only if m? = 0.
The Skorokhod Embedding Problem and Model-Independent Bounds for Option Prices 301 5 The Root and Rost Solutions and Options on Volatility 5.1 The Root and Rost Embeddings Return to the classical setting of minimal solutions of the SEP for (W, ?) where ? is a centred probability measure. Suppose ? has finite variance. Then there are embeddings ? such that E[?] = R x2?(dx), (and as described in Corollary 1 above, for any embedding either E[?] = R x2?(dx), or ? has infinite expectation). In particular, it does not make sense to attempt to find the solution of the SEP for which E[?] is minimised; any minimal stopping time will satisfy this criterion. The task of maximising E[?] over minimal stopping times is equally trivial. However, the problem of searching for the embedding which minimises (over all stopping times) the variance of ?, or alternatively the embedding which maximises (over uniformly integrable stopping times) the variance of ? leads to a unique solution. Since we are looking for an embedding which optimises a functional of t evaluated at the stopping time, it is plausible that the stopping rule should depend on the joint distribution of Wt and the additive functional t. Given b : R > R+, define R ? Rb= {(t, x); t ? b(x)}. Let ?b = inf{u : (u,Wu) ? Rb}. We will describe the function b (and sometimes the region Rb) as a barrier (Fig. 12). Theorem 6 (Root [51], Rost [53]). 1. Given a centred probability measure ? there exists b such that ?b is a solution of the SEP for (W, ?); moreover ?b is minimal. b(x) Rb Fig. 12 The Root barrier solution. Given b : R > R+, or equivalently R ? Rb = {(t, x); t ? b(x)}, let ?b = inf{u : (u,Wu) ? Rb} be the time of first entry by (u,Wu) into the shaded region. The idea is to choose b such that W? ? ?
302 D. Hobson 2. ?b minimises the variance of ? amongst all embeddings of the law of W?b. More generally ?b minimises E? t?? h(Ws)dsfor all non-negative functions h and times t. The embedding property of the solution is due to Root [51], and henceforth we will label this solution as the Root solution. The optimality properties were conjectured by Kiefer [38] and proved by Rost [53]. Taking h = 1 we find that the Root solution minimises the residual expectation E[(? ? t)+] ? E[(? ? ? ? t)] for all t. Since any convex function can be decomposed into a positive combination of such functions (and since E[?] is invariant across minimal embeddings) it follows that the Root barrier solution minimises E[f(?)] for any convex f. Example 2. 1. Suppose ? ? N(0, 1). Then the barrier is given by b(x) = 1, Rb = {(t, x); t ? 1} and ?b = 1. 2. Suppose ? ? (??1 + ?+1)/2. Then Rb = {(x, t) : x ? ?1, x ? 1}, and ?b = H1. 3. Suppose ? ? p??1 + p?+1 + (1 ? 2p)?0 for 0 ? p ? 1/2. Then Rb = {(x, t) : x ? ?1, x ? 1}? {(0, t); t ? t0(p)}. The quantity t0(p) does not have a simple expression, but it is clear that t0(0) = 0, t0(1/2) = ? and that t0(p) is strictly increasing in p. Hence the existence of a barrier which embeds ? is guaranteed. There is also a converse to the Root embedding, which is based on a reverse barrier (Fig. 13). The embedding is attributed to Rost by Meilijson [41], see also Obloj [43]. Wt ? t Fig. 13 The Rost reversed barrier. The embedding ? is the first time Brownian motion W enters the shaded region
The Skorokhod Embedding Problem and Model-Independent Bounds for Option Prices 303 We assume that ? has no atom at zero. The construction can be extended to include an atom at 0 by independent randomisation. Theorem 7 (Rost). Given b : R > R+, define ? R ? ?R b = {(t, x); t ? b(x)}. Let ??b = inf{u : (u,Wu) ? ?R b}. Then, 1. Given a probability measure ? with no atom at 0, there exists b such that ??b is a solution of the SEP for (W, ?); moreover ??b is minimal; 2. ??b maximises the variance of ? amongst all uniformly integrable embeddings of the law of W??b . More generally ??b maximises E[? t?? h(Ws)ds] for all nonnegative functions h and times t. Remark 3. In fact both the Root and Rost embeddings can be extended to any continuous Markov process (Xt)t?0, and the optimality properties still hold. This will be clear from the fact that the proofs we sketch below do not use any properties of Brownian motion beyond the Markov property and continuity of paths. Sketch of proof of Theorem 6. Suppose ? consists of a finite collection of atoms at locations X = {x0 < x1 < . . . < xN < xN+1}, with associated probabilities {p0, p1, . . . , pN, pN+1}. Suppose also that ? is centred, so thatN+1 i=0 xipi = 0. We search for an embedding for (W, ?) of barrier form. Since the embedding is minimal, by Corollary 2 we must have that the process is stopped before it leaves the interval [x0, xN+1]. Furthermore, the process should only stop at the points xi ? X, hence the barrier R must be of the form R = {(x, b); xi ? X, b ? bi}. Moreover, we must have b0 = 0 = bN+1. Let ? = {?1, . . . , ?N} be a vector in RN+, and augment it with the values ?0 = 0 = ?N+1. Let ?? = inf{u : Bu = xi, u ? ?i; 0 ? i ? N + 1}. Set ?? = {? : P(B?? = xi) ? pi; 1 ? i ? N}. Note that if ? ? ?? we must have P(B?? = x0) + P(B?? = xN+1) ? p0 + pN+1 to compensate. Then ? ? ?? if the associated stopping rule never embeds more than allowed under ? at any point in the interior of the support of ?. The excess mass is embedded at the endpoints. We claim that if ?? and ?? are elements of ?? then so is ? where ?i = ??i ? ??i. To verify the claim, fix i ? {1, . . .,N}. Without loss of generality we may assume that ??i ? ??i. Then ?? = ??? on B?? = xi, and ?? ? ??? otherwise. See Fig. 14. Thus (? : B?? = xi) ? (? : B??? = xi) and P(B?? = xi) ? pi. Since i was arbitrary, the claim is proved. It follows from the claim that ?? has a minimal element.Moreover, this minimal element must embed ?; if not then for some i we must have P(B?? = xi) < pi, and for this i we can reduce the value of ? slightly without violating the condition P(B?? = xi) ? pi and only making the values of (P(B?? = xj ))j=i smaller. It remains to extend fromatomic distributions ?n to general ?. Root [51] achieves this by mapping [0,?] ? [??,?] to [0, 1] ? [?1, 1] and putting a distance metric on barriers expressed as sets in the new space. Given the images of the barriers
304 D. Hobson Wt xi x0 xN+1 t ? Fig. 14 The embedding property of the Root barrier for atomic measures ? on a finite number of points. The stopping time ?? is the first time the Brownian path is at one of the xi at a time later than ?i. If ? is such the probability of stopping at xi is less than pi, then making ?i smaller, will increase the probability that B?? = xi, but can only decrease the probability of stopping at any other point associated with ?n, there must be a convergent subsequence in the compact space [0, 1]?[?1, 1]. This must take the form of a barrier, and mapping back to the original space we obtain the solution of the SEP for ?. Sketch of proof of optimality of the Root construction. Fix x and t and suppose that ? ? T(?). We show that the Root barrier stopping time maximises E[Lxt?? ] (simultaneously for all x and t) amongst all minimal solutions of the Skorokhod embedding problem for ?. If so, then the Root stopping time maximises E[t?? 0 h(Ws)ds] for all positive h, and since E[? 0 h(Ws)ds] is constant across minimal embeddings of ?, it also minimises E[? t?? h(Ws)ds]. Let ? be any embedding of ? and suppose that there are paths with (W? ?dx, ? < t) and (W? ? dx, t ? ? < ?). Then we can take the terminal mass of W? from those paths which pass through (?, x) and embed that mass by extending the paths from (?, x) which are currently stopped at (W? ? dx, ? < t). See Fig. 15. This modification of the stopping rule must increase the value of the local time Lxt?? .
The Skorokhod Embedding Problem and Model-Independent Bounds for Option Prices 305 Wt ? t ? dx Fig. 15 Optimality of the Root construction. If for some (x, t) there are paths which stop at (x, ?) with? < t,and there are other paths which continue from (x, ?) with t < ? < ?, then by shifting the continuations of paths from (x, ?) so that they are continuations from (x, t) with t < ?, we can only increase the time spent at x before time t. We stop some paths which pass through (x, ?) early, and extend other paths at (x, ?) to compensate Hence, if ? is optimal, in the sense that it maximises E[Lxt?? ] amongst minimal solutions of the Skorokhod embedding problem for ?, then for any pair (x, t) we have that either the stopping rule never involves stopping paths at x before t, or, no paths cross x after t. Let Rt = {x : no paths cross x after t}. Then Rt is increasing in t and R = ?t?0Rt defines a barrier. The justification for the embedding property and optimality of the Rost reverse barrier is similar. Suppose ? is such that there are paths with (W? ? dx, ? < ? < t) and (W? ? dx, ? > t). Then we can take (some of) the terminal mass of W? from those paths which aren't stopped at ? (but do stop by time t) and embed thatmass by continuing paths from (x, ?) which are currently stopped at (W? ? dx, ? < t). This modification of the stopping rule must decrease the value of the local time Lxt?? . Remark 4. Note that the proofs of the embedding property and of the optimality of the Root and Rost constructions do not rely on any properties of Brownian motion, beyond the Markov property and the continuity of paths. We will exploit this fact when we discuss applications to the pricing of volatility derivatives below. Example 3. Suppose, that for ?, ? > 0 ?(dx) = ?v?e??x2/(2(x+?)) v2?(x + ?)3/2 dx; x > ??
306 D. Hobson ?t ? ? t ? Wt Fig. 16 The law ? is such that Brownian motion stopped the first time it hits the straight line x = ?t ? ? has law ? The associated barrier function is b(x) = (x + ?)/?, which corresponds to the straight line x = ?t ? ?. See Fig. 16. Suppose h is the convex function h(t) = e?t (with ? < ?2/2) and consider the problem of minimising E[h(?)] over stopping times ? which are solutions of the SEP for (W, ?). Define the constants ? = ? ??2 ? 2? (note that? > 0) and ? = 2?e??/?2, and set M(t, x) = ? ? ?e?x??2t/2, so that M(0, 0) = 0 and M = (M(t,Wt))t?0 is a martingale. Define ?(x) = inft>0[e?t ?M(t, x)]. The infimum is attained at t solving ?e?t = ??2 2 e?x??2t/2 (at least for x > ??) which reduces to t = 2?(x + ?) (?2 + 2?) = x + ? ? = b(x), where we use (? ? ?)2 = ?2 ? 2? so that ?2 + 2? = 2??. It also follows that ?(x) = 1 + 2? ?2e?(x+?)/? ? 2? ?2 e??. Then, by construction,h(t) ? M(t, x) + ?(x), ?t, x,
The Skorokhod Embedding Problem and Model-Independent Bounds for Option Prices 307 with equality at t = (x+?)/?. In particular, at t = ? we have h(?) ? M(?,W?)+ ?(W? ) so that for any ? with M(t ? ?,Wt?? ) uniformly integrable, E[h(?)] ? E[?(W? )]. Further, for all ? which are solutions to the Skorokhod embedding problem for ? we have E[e?? ] ? R ?(x)?(dx) = e?? with equality for the Root embedding ? = inf{u : Wu = ?u ? ?}. 5.2 Pricing Options on Volatility Let (Pt)t?0 be the price process of an asset, (not necessarily a forward price) and suppose Pt is continuous. Denote the quadratic variation by ln Pt. The problem is to derive robust, model independent bounds on the prices of call options on volatility, and, following Dupire [24] and Carr and Lee [12] the idea is to use to Root and Rost stopping times, and their optimality properties. Suppose interest rates are deterministic. (For ease of exposition we will assume that they are constant, and equal to r.) Then (St)t?0 given by St = e?rtPt is a forward price process, which we may assume to be a martingale under a pricing measure. Note that ln St = lnPt ? rt so that ln Pt = ln St. Write Xt as shorthand for ln St. Then XT = T 0 dSu Su 2 = T 0 dPu Pu 2 . On the other hand, XT ? X0 = T 0 dSu Su ? 12 T 0 dSu Su 2 , so that XT = ?2 lnST + 2lnS0 + T 0 2 Su dSu. Suppose that call options are traded for all strikes so that ln ST is effectively a traded asset. Suppose further that the strategy ?t = 2/St is an admissible dynamic hedging strategy. Then the integrated squared volatility XT has a model free price equal to 2(ln S0 ? ln ST ). Now consider call options on XT = ln PT . In particular, consider the security with payoff (XT ? Q)+.
308 D. Hobson Without loss of generality we may assume that P0 = S0 = 1, so that X0 = 0. The goal is to derive model-independent bounds on the price of (XT ? Q)+, assuming that the law of ST is given (by ? say). DefineMt = t 0 dSt/St. Then Xt = Mt ?MT /2 = Mt ?XT /2.We know that the continuous local martingaleM can be written as a time-change of Brownian motion:Mt = WXt for some Brownian motionW. We also have St = eXt = eWXt?Xt/2 = ZXt where (Zu)u?0 is the exponential Brownian motion Zu = eWu?u/2. Since ST ? ? we have Zln ST ? ?, so that ln ST is a solution of the Skorokhod embedding problem for (Z, ?). Conversely, if ? is a solution of the SEP for (Z, ?), and if St = Z??(t/(T?t)) then ST = Z? ? ? and ln ST = XT = ?. If ? is the Root solution of the SEP for (Z, ?) then we say that (St)0?t?T given by St = Z??t/(T?t) is the Root model. This model is consistent with observed call prices as represented by ?. Then, combining the time-change with Theorem 6 and Remark 3 we have the following theorem. Theorem 8 (Dupire [24], Carr-Lee [12]). Suppose call prices satisfy C(K) = C?(K) for some distribution ? with mean S0. Let ?R be the Root barrier solution of the Skorokhod embedding problem for (Z, ?). Let ((St)0?t?T , PR) be a model for the forward price for which St = Z?R?(t/(T?t)). Let ((St)0?t?T ,?P ) be any alternative model for which St is a martingale and ST ? ?. Then, for any Q ? 0, ER[(ln ST ? Q)+] ? ?E [(ln ST ? Q)+] and the price of a call option on quadratic variation for a given set of vanilla call prices is minimised under the Root model. The Rost (reverse barrier) construction gives an upper bound. 5.3 A Path-Wise Hedging Strategy for Volatility Options Theorem 8 gives bounds on the prices of call options on volatility, but it does not give an associated super-replicating or sub-replicating strategy. In particular, it does not give a path-wise inequality which could be used to enforce the bounds, in the way that the inequality (1) enforces no-arbitrage bounds on the prices of one-touch digitals. We show below that, subject to solving a variant on the heat equation with a rather strange 'boundary condition', a sub-replicating strategy exists. Let call prices (for all strikes and maturity T ) be such that ST ? ?. (By scaling we may assume that S0 = 1 and ? has support R+ and mean 1.) Suppose that the
The Skorokhod Embedding Problem and Model-Independent Bounds for Option Prices 309 Root solution to the Skorokhod embedding problem for (Z, ?) is associated with the barrier b?. Consider the problem of pricing an option with payoff h(ln ST ) with h(t) convex. Theorem 9. Suppose there exists m(t, z) such that m(0, 1) = 0, z2 2 m+ ? m = 0 and such that arg inft?0[h(t) ? m(t, z)] = b?(z). Suppose further that ? given by?t = m(ln St, St) is admissible, in the sense that G? = T 0 ?tdSt ? G?. If we define ?(z) = inft>0{h(t) ? m(t, z)} = h(b?(z)) ? m(t, b?(z)) then h(ln ST ) ? ?(ST) + G?, path-wise, and thus P(hln ST ) ? R+ ?(s)?(ds), with equality for the Root model. Proof. Since h(t) ? m(t, z) ? ?(z) uniformly in t and z we have h(ln ST ) ? ?(ST) + m(ln ST , ST ). But, by Ito's formula, and using dln St = (dSt)2/S2t , m(ln ST , ST) = m(0, 1) + T 0 m? dln St + mdSt + S2t 2 m(dSt)2 S2t = T 0 m(ln St, St)dSt = G?. Example 4. Suppose h(t) = t and m(t, z) = 2lnz + t. Then m(0, 1) = 0 and m? + z2m/2 = 0. Furthermore, h(t) ? m(t, z) is independent of t so that, for any ? with Root barrier b?(z), ?(z) = inf t {h(t) ? m(t, z)} = h(b?(z)) ? m(b?(z), z) = ?2 lnz. Then, provided ? given by ?t = (2/St) is admissible we have P(ln ST) = P(?2 lnST) = R+(?2 lns)?(ds) and the fair price of a security paying ln ST is model independent.
310 D. Hobson Example 5. In this second example the payoff is non-linear and Theorem 9 gives a model-independent bound, rather than the unique no-arbitrage price. We show how to construct a sub-replicating strategy which enforces the lower bound. The example is based on Example 3. Suppose that h(t) = e?t. Suppose further that ST ? ? where ?(dz) = ?v v ? 2?(? + lnz)3/2 exp(? ? (2? ? 1) ln z)2 8?(? + lnz) dz, z > e??. Then b?(z) = (? + lnz)/?. Fix v = e?? and let ? be the smallest root of ?2 ? (1 + 2?)? + 2? = 0. (We assume that ? is small enough so that this equation has a solution.) Define ? = ?(? ? 1)/2 and ? = ???1v??. Now set m(t, z) = ? ? ?z?e??t. If b(z) = arginft>0[h(t) ?m(t, z)] then b(z) solves ?e?b(z) = ??z?e??b(z). The choices of constants are such that b(z) = b?(z). Provided ? given by ?t = ???S??1 t e??Xt is an admissible strategy then, in the notation of Theorem 9, ?(ST) + G? is a sub-replicating strategy for the volatility option with payoff h(XT ). The model-independent lower bound on the price of the option is R+ ?(s)?(ds), where ?(s) = h(b(s)) ? m(b(s), s). 6 Multiple Stopping Times; Option Price Data for Several Maturities To date we have assumed that there are a continuum of option prices available, for vanilla European options of a single maturity. But what if options trade with two (or more) maturities? Are the option prices consistent with no arbitrage? Can the call prices from an earlier maturity be used to refine the price bounds? Is it possible to derive bounds for forward starting options? In terms of the Skorokhod embedding problem, the equivalent problems relate to the existence and properties of solutions when the initial law of the Brownian motion is non-trivial. Recall from Theorem 4 that there exist solutions of the Skorokhod embedding problem for centred initial and terminal laws if and only if C?(x) ? C? (x). This has an immediate Corollary in the finance setting; a necessary and sufficient condition for the absence of arbitrage between a pair of (decreasing, convex) call price functions is that for each fixed strike (in the bond numeraire), call prices are increasing in maturity. (There are extensions of this result to the case where only a finite number of strikes are traded, in which case the answer depends on the ability to extrapolate between the traded strikes to generate convex (in strike) call price functions whose prices are increasing in maturity. See Buhler [11], Davis and Hobson [20] or Cousot [14].)
The Skorokhod Embedding Problem and Model-Independent Bounds for Option Prices 311 So, suppose ? and ? are such C?(x) ? C? (x), or equivalently U?(x) ? U?(x). The aim is to find stopping rules ? which maximise a functional F(Wt, 0 ? ? ? t ? ?) (or in the forward-starting version of the problem F(Wt, ? ? t ? ?)) where W? ? ? and W? ? ?. the question arises: what are the appropriate generalisations of the Azema-Yor (or Perkins, Root, Rost . . . ) embeddings to non-zero initial law? In the financial context, new derivatives become relevant, such as the forward-starting straddle option with payoff |ST2 ? ST1 |. An analysis of this can be considered as a first step towards pricing the discrete time Asian option with payoff (i?n STi ? K)+, and thence its continuous time analogue. 6.1 Maximising the Law of the Maximum, with Intermediate Constraints Consider the problem: find sup ? P(J? ? j) where the supremum is taking over uniformly integrable stopping times ? such that there exists ? ? ? for which W0 ? ?0, W? ? ?, W? ? ?. (20) This is directly linked to finding candidate models for which ST1 ? ? and ST2 ? ?. It turns out that there are two cases, an easy case, and a hard case. In the easy case, the barycentres b? and b? are ordered so that b?(x) ? b?(x) for all x. See Fig. 17. Then the inverse barycentres ?? and ?? satisfy ??(j) ? ??(j). w1 j1 Wt Jt W? J? Fig. 17 A pair of barycentres. In this case the barycentres are ordered and it is possible to find ? and ? with ? ? ? where both separately represent the Azema-Yor construction of the associated measure
312 D. Hobson In particular, if we define ? = ?b? = inf{u : Wu ? ??(Ju)} and ? = ?b? = inf{u : Wu ? ?? (Ju)} then ? ? ? embed ? and ? respectively. Moreover, since ? is the Azema-Yor embedding for ?, ? maximises P(J? ? j) over all minimal solutions of the Skorokhod embedding problem for (W, ?), and hence must maximise P(J? ? j) over the smaller set of embeddings which are subject to the intermediate constraint. Unfortunately, although U?(x) ? U?(x) is a necessary condition for b?(x) ? b?(x), ?x, it is not sufficient. Suppose for example ? ? (??1 + ?1)/2 and ? ? p??2+(1?2p)?0+p?2. For 1/4 ? p ? 1/2 we have?1 = U?(0) ? U?(0) = ?4p and then U?(x) ? U?(x) for all x. However, for ?1 < x < 0 we have b?(x) = 1 and b?(x) = 2p/(1 ? p) so that in order to have b?(x) ? b?(x) we must have p ? 1/3. For p < 1/3 the barycentres are not ordered. It follows that the intermediate constraintW? ? ? has an impact on the possible values of P(J? ? j). For more on this situation, and the implications for modelindependent bounds, see Brown et al. [10]. A similar situation arises if we try to extend the Perkins [47], Root [51], Rost [41] or Vallois [55, 56] constructions to multiple time points. All these constructions utilise a stopping rule based on the first hitting time of the joint process (Wu,Au) of a domain, where At is an additive functional of the Brownian path. If these domains posses a natural ordering, then the construction of optimal stopping times ?, ? satisfying (20) is straightforward. Otherwise the construction of the optimal stopping rule (i.e. the one which maximises A? ) is much more challenging. See Fig. 18 for an illustration in the Root barrier case. 6.2 Maximising the Law of the Maximum, with Non-Trivial Initial Law Now consider the problem: sup ? P(J? ? j) where the supremum is taking over stopping times ? such that W0 ? ?, W? ? ? (21) where ? and ? are centred probability measures with U?(x) ? U?(x). An alternative but equivalent problem is to search for pairs of stopping times ? ? ? for which (20) holds, but to only calculate the maximum over the interval (?, ? ). This corresponds to searching for model-independent derivative prices for forward-starting options, e.g. for barrier optionswhere the option is knocked-in only if it is crossed in the period (T1, T2). Several generalisations of solutions of embeddings to the situation with nonzero initial laws are known. Hobson [32] shows how to adapt the potential picture to extend the Azema-Yor embedding to this case (see Fig. 19) and Hobson
The Skorokhod Embedding Problem and Model-Independent Bounds for Option Prices 313 tau Wt t xi xN+ x0 Fig. 18 A pair of Root barriers. Suppose we try to solve the problem (20) of constructing an embedding ? of ? subject to the existence of ? ? ? for which W? ? ?. Let b1 with associated stopping region Rb1 embed ?; for (different) ?? and ?? let?b2 and?b2 be the associated Root barriers. If the barriers are ordered, e.g. ?b2 ? b1, then we can define ? = inf{u:(u,Wu) ? Rb1} and ?? = inf{u : (u,Wu) ? R?b2 and the problem is solved. But, if the barriers are not ordered (e.g. b1 and?b2), then a more complicated construction is needed U?1 U?2 W? W0 Fig. 19 Potential theory picture of Azema-Yor story with non-trivial starting law. The idea is to run excursions down from the current maximum along tangents to the potential U?2 which intersect U?1 at the current value of the maximum. See Hobson [32]
314 D. Hobson and Pedersen [35] consider the extension of the Perkins embedding, and give an application to bounds on the prices of barrier options. Indeed, in the case of a Root [51] barrier solution, the same form of construction still holds, and ? = inf{u:(u,Wu) ? Rb} is an embedding for a suitably chosen barrier b depending on both ? and ?. 6.3 Maximising the Law of the Maximum, with a Continuum of Marginals Suppose we are given the marginal distributions of a martingale X for every t. For there to exist a process with those marginals we must have that the potentials are decreasing in t, (or equivalently the call option prices are increasing in maturity). By the results of Krylov [39], Gyongy [28] and Dupire [23], if the marginals arose from a continuous process then we can identify a unique diffusion with the same marginals. Now we ask, what other processes might have lead to the same marginals? The Dupire construction gives a canonical process with a given set of marginals, but it is not unique. In particular, supposeXt ? N(0, t), and thatXt is a martingale. Clearly one process with these marginals is Brownian motion, and Brownian motion is the unique continuous Markovian martingale with N(0, t) marginals. Following Oleszkiewicz [45] we can define a fake Brownian motion to be a martingale with marginals Xt ? N(0, t), which is not Brownian motion. Given Dupire's result, in order to find such a process we need to relax either the assumption of continuity of paths, or the Markov assumption. It is apparent from the discussion in Sect. 6.2 that several of the construction methods for solutions of the Skorokhod embedding problem formultiple time points extend to the setting of a family of marginals with parameter t, at least under some restrictions on that family. A first example is the Azema-Yor construction. Let ?t ? N(0, t), and let bt := b?t. By scaling we have that bt(x) = b1(xvt), so that the family bt is increasing in t for each fixed x. In particular, if ?t = inf{u : Wu ? ?t(Ju)} then ?t is an increasing family of stopping times such that ?t embeds ?t. This is the Madan and Yor [40] fake Brownian motion. The resulting process is a Markovian martingale, for which paths have strictly decreasing continuous parts interleaved with positive jumps. By extending the methods of Sect. 6.1 from two to a continuum of time-pointswe can also use the Perkins [47] or Vallois [55, 56] construction to generate other fake Brownian motions. (Note however that the generalisation of the Root [51] construction does not give a fake Brownian motion, since the barriers are simply vertical lines and the resulting stopping times are ?t ? t.) Interest in the problem of finding fake Brownian motions began with a paper by Hamza and Klebaner [30]. They use a remarkably clever decomposition and recombination of the normal distribution to produce a pure-jump martingale with Gaussian marginals. They also asked the question if there existed continuous
The Skorokhod Embedding Problem and Model-Independent Bounds for Option Prices 315 (non-Brownian) martingales with Gaussian marginals. This was answered in the affirmative by Albin [1]. Finally, Oleszkiewicz [45] gave an elegant and simple construction of a continuous fake Brownian motion. In essence this construction makes use of the fact that Rt sin?At is a Brownian motion where (Rt)t?0 is a twodimensional Bessel process, (?u)u?0 is a Brownian motion on the unit circle, and (At)t?0 is the increasing additive functional such that At = t 0 R?2 s ds. The idea is to write Xt = vtR sin(U + Wln t) where R has the same distribution as R1, U is uniform distribution on [0, 2?) and W is Brownian motion. The existence of fake Brownian motions implies that although the Dupire [23] construction gives a model which is consistent with the continuum of traded option prices (assuming such a family exists) - and perhaps gives the canonical model consistent with these prices - it is not the unique model with this property. Hence, although the Dupire diffusion might be used to give a guide price for exotic derivatives, these prices are not the unique prices consistent with no-arbitrage. 6.4 Model Independent Bounds on Basket Options Underlying the discussion in these notes is a philosophy whereby the prices of exotic options are related to the prices of vanilla (traded) options by the construction of super-hedges involving those vanilla options. The (primal) pricing problem is related to a (dual) hedging problem. The same philosophy can be applied in other contexts, one such being the pricing of basket (exotic) options, given the prices of (vanilla) call options on the individual constituents of the basket. It turns out that the model independent upper bound on the price of a basket option is associated with a model when the assets are comonotonic, see Dhaene et al. [21] or Hobson et al. [36]. 7 ClosingRemarks In a mature market, the prices of liquidly traded vanilla options are not the expectations of the payoff under a stochastic model, but rather they are fixed by supply and demand, or market sentiment. From a derivative pricing perspective the objects of interest become the less liquid exotic derivatives which must be priced relative to the vanilla options. In the standard case where the vanilla options are precisely the puts and calls, knowledge of vanilla prices is equivalent to knowledge of the marginal distribution of the underlying asset. Then, finding candidate models which fit option prices is equivalent to finding solutions of the Skorokhod embedding problem, and finding the range of no-arbitrage prices for an exotic option is equivalent to finding extremal embeddings which maximise functionals on the Brownian paths.
316 D. Hobson The associated no-arbitrage bounds may be quite wide. (Conversely, see Brown et al. [9], and Example 5 above, in some special cases the upper and lower bounds coincide, and there is a unique model-independent no-arbitrage price for the exotic option.) However, each bound is associated with a model which achieves the bound, and by investigating features of this model it is possible to determine the characteristics of models which lead to high option payouts. (For example, for the model which attains the upper bound on the price of a lookback option, the overall maximum is an increasing function of the time-T price.Whilst in exponential Brownian motion model the correlation between the final value and the maximum is not perfect, the correlation is quite strong, and therefore for realistic parameter values the model price can be expected to be quite close to the theoretical upper bound.) The second major advantage of the Skorokhod-embedding-model-independentbound approach is that since no assumptions are made on the model the resulting strategies must be very simple. Even if an agent believes in a particular stochastic model there may be advantages (especially in the form of lower transaction costs) in following a semi-static hedging strategy involving calls, when compared with a delta-hedging strategy with infinite trading. Cox and Obloj [18] compare the performance of a model independent hedge with the Black Scholes hedge for no-touch options, and conclude that the robust hedge frequently outperforms the classical delta-hedge, even when transaction costs are small. The optimal strategy involves purchasing an initial portfolio of traded options, but this portfolio is held constant over time, and there is no assumption that elements of the portfolio can be sold at intermediate times. Hence the success of any super-replicating strategy is not contingent upon any model for movements of option prices over time. Acknowledgements I would like to thank the editors for the invitation to write these lecture notes, and to the audience at the Bachelier seminar in Paris for useful feedback and stimulating questions. Most especially I would like to thank Alex Cox, for his detailed reading of an early draft of these notes, and for his many suggestions for improvements. Responsibility for errors and omissions rests, as always, with the author. References 1. Albin, J.M.P.: A continuous non-Brownian motion martingale with Brownian motion martingale distributions. Stat. Probab. Lett. 78(6), 682-686 (2008) 2. Azema, J., Yor, M.: Une solution simple au probleme de Skorokhod, Seminaire de Probabilites, vol. XIII. Lecture Notes in Math., vol. 721, pp. 90-115. Springer, Berlin (1979) 3. Azema, J., Yor, M.: Une solution simple au probleme de Skorokhod, Seminaire de Probabilites, vol. XIII. Lecture Notes in Math., vol. 721, pp. 625-633. Springer, Berlin (1979) 4. Azema, J., Gundy, R.F., Yor, M.: Sur l'integrabilite uniforme des martingales continues, Seminaire de Probabilites, vol. XIV. Lecture Notes in Math., vol. 784, pp. 53-61. Springer, Berlin (1980) 5. Bass, R.F.: Skorokhod imbedding via stochastic integrals, Seminaire de Probabilites, vol. XVII. Lecture Notes in Math., vol. 986, pp. 221-224. Springer, Berlin (1983)
The Skorokhod Embedding Problem and Model-Independent Bounds for Option Prices 317 6. Bergman, Y.Z., Grundy, B.D., Wiener, Z.: General properties of option prices. J. Finance 51, 1573-1610 (1996) 7. Bertoin, J., Le Jan, Y.: Representation of measures by balayage from a regular recurrent point. Ann. Probab. 20(1), 538-548 (1992) 8. Breeden, D.T., Litzenberger, R.H.: Prices of state-contingent claims implicit in options prices. J. Business 51, 621-651 (1978) 9. Brown, H., Hobson, D., Rogers, L.C.G.: Robust hedging of barrier options. Math. Finance 11(3), 285-314 (2001) 10. Brown, H., Hobson, D., Rogers, L.C.G.: The maximum maximum of a martingale constrained by an intermediate law. Probab. Theor. Relat. Field. 119, 558-578 (2001) 11. Buhler, H.: Expensive martingales. Quant. Finance 6, 207-218 (2006) 12. Carr, P., Lee, R.: Hedging variance options on semi-martingales. Finance Stochast. 14(2), 179- 208 (2010) 13. Chacon, R.V., Walsh, J.B.: One-dimensional potential embedding, Seminaire de Probabilites, vol. X. Lecture Notes in Math., vol. 511, pp. 19-23. Springer, Berlin (1976) 14. Cousot, L.: Conditions on options prices for the absence of arbitrage and exact calibration. J. Bank. Finance 31(11), 3377-3397 (2007) 15. Cox, A.M.G., Hobson, D.G.: An optimal embedding for diffusions. Stochast. Process. Appl. 111(1) 17-39 (2004) 16. Cox, A.M.G., Hobson, D.G.: Local martingales, bubbles and options prices. Finance Stochast. 9, 477-492 (2005) 17. Cox, A.M.G., Hobson, D.G.: Skorokhod embeddings, minimality and non-centred target distributions. Prob. Theor. Relat. Field. 135, 395-414 (2006) 18. Cox, A.M.G., Obloj, J.: Robust hedging of double touch barrier options (2008, Preprint). arXiv:0808.4012 19. Cox, A.M.G., Obloj, J.: Robust pricing and hedging of double no-touch options. To appear in Finance Stochast. (2010). arXiv:0901.0674 20. Davis, M.H.A., Hobson, D.G.: The range of traded options prices. Math. Finance 17, 1-14 (2007) 21. Dhaene, J., Denuit,M., Goovaerts, M.J., Kaas, R., Vyncke, D.: The concept of co-monotonicity in actuarial science and finance: Applications. Insur. Math. Econ. 31, 133-161 (2002) 22. Dubins, L.E.: On a theorem of Skorohod. Ann. Math. Statist. 39, 2094-2097 (1968) 23. Dupire, B.: Pricing with a smile. Risk Mag. 7(1), 18-20 (1994) 24. Dupire, B.: Arbitrage bounds for volatility derivatives. Presentation at PDE and Mathematical Finance KTH, Stockholm (2005) 25. El Karoui, N., Jeanblanc, M., Shreve, S.E.: Robustness of the Black-Scholes formula. Math. Finance 8, 93-126 (1998) 26. Figlewski, S.: Assessing the incremental value of option pricing theory relative to an informationally passive benchmark. J. Derivatives 10, 80-96 (2002) 27. Follmer, H., Schied, A.: Stochastic Finance: An Introduction in Discrete Time, 2nd edn. de Gruyter, Berlin (2002) 28. Gyongy, I.: Mimicking the one-dimensional marginal distributions of processes having an Ito differential. Prob. Theor. Relat. Field. 71, 501-516 (1986) 29. Hall, W.: On the Skorokhod embedding theorem, Technical Report 33. Department of Statistics, Stanford University (1968) 30. Hamza, K., Klebaner, F.C.: A family of non-Gaussian martingales with Gaussian marginals. J. Appl. Math. Stochast. Anal. 2007, 19 (2007); Article Id 92723 31. Hobson, D.G.: Robust hedging of the lookback option. Finance Stochast. 2(4), 329-347 (1998) 32. Hobson, D.G.: The maximum maximum of a martingale, Seminaire de Probabilites, vol. XXXII. Lecture Notes in Math., vol. 1686, pp. 250-263. Springer, Berlin (1998) 33. Hobson, D.G.: Volatility misspecification, option pricing and super-replication via coupling. Ann. Appl. Probab. 8, 193-205 (1998) 34. Hobson, D.G., Neuberger, A.: Robust bounds for Forward Start options. To appear in Math. Finance (2010)
318 D. Hobson 35. Hobson, D.G., Pedersen, J.L.: The minimum maximum of a continuous martingale with given initial and terminal laws. Ann. Probab. 30(2), 978-999 (2002) 36. Hobson, D.G., Lawrance, P.,Wang, T.-H.: Static-arbitrage upper bounds for the prices of basket options. Quant. Finance 5, 329-342 (2005) 37. Janson, S., Tysk, J.: Volatility time and properties of options prices. Ann. Appl. Probab. 13, 890-913 (2003) 38. Kiefer, J.: Skorokhod imbedding of multivariate RV's and the sample DF. Z. Wahrscheinlichkeitstheorie 24, 1-35 (1972) 39. Krylov, N.V.: On the relation between differential operators of second order and the solutions of differential equations. In: Krylov, N.V., et al. (eds.) Steklov Seminar 1984, pp. 214-229. Inc. Publications Division, New York (1985) 40. Madan, D.B., Yor, M.: Making Markov martingales meet marginals: With explicit constructions. Bernoulli 8(4), 509-536 (2002) 41. Meilijson, I.: Skorokhod's problem - embeddings in Brownian motion. Notes from the 3rd Winter School of Probability, Chile (1983) 42. Monroe, I.: On embedding right continuous martingales in Brownian motion. Ann. Math. Statist. 43, 1293-1311 (1972) 43. Obloj, J.: The Skorokhod embedding problem and its offspring. Probab. Surv. 1, 321-390 (2004) 44. Obloj, J., Yor, M.: An explicit Skorokhod embedding for the age of Brownian excursions and Azema martingale. Stochast. Process. Appl. 110(1), 83-110 (2004) 45. Oleszkiewicz, K.: On fake Brownian motions. Statist. Probab. Lett. 78, 1251-1254 (2008) 46. Pedersen, J.L., Peskir, G.: The Azema-Yor embedding in non-singular diffusions. Stochast. Process. Appl. 96(2), 305-312 (2001) 47. Perkins, E.: The Cereteli-Davis solution to the H1-embedding problem and an optimal embedding in Brownian motion. In: Seminar on Stochastic Processes, 1985 (Gainesville, Fla., 1985), pp. 172-223. Birkhauser Boston, MA (1986) 48. Revuz, D., Yor, M.: Continuous Martingales and Brownian Motion, 3rd edn. Springer, Berlin (1999) 49. Rogers, L.C.G.: A guided tour through excursions. Bull. Lond. Math. Soc. 21(4), 305-341 (1989) 50. Rogers, L.C.G., Williams, D.: Diffusions, Markov Processes and Martingales, vol. 2, Ito Calculus. CUP, Cambridge (2000) 51. Root, D.H.: The existence of certain stopping times on Brownian motion. Ann. Math. Statist. 40, 715-718 (1969) 52. Rost, H.: The stopping distributions of a Markov Process. Invent. Math. 14, 1-16 (1971) 53. Rost, H.: Skorokhod stopping times of minimal variance, Seminaire de Probabilites, vol. X, pp. 194-208. Lecture Notes in Math., vol. 511. Springer, Berlin (1976) 54. Skorokhod, A.V.: Studies in the Theory of Random Processes. Addison-Wesley, MA (1965) 55. Vallois, P.: Le probleme de Skorokhod sur R: une approche avec le temps local, Seminar on probability, vol. XVII. Lecture Notes in Math. vol. 986, pp. 227-239. Springer, Berlin (1983) 56. Vallois, P.: Quelques inegalites avec le temps local en zero du mouvement Brownien. Stochast. Process. Appl. 41(1), 117-155 (1992)
Pricing and Hedging in Exponential Levy Models: Review of Recent Results Peter Tankov Abstract These lecture notes cover a major part of the crash course on financial modeling with jump processes given by the author in Bologna on May 21-22, 2009. After a brief introduction, we discuss three aspects of exponential Levy models: absence of arbitrage, including more recent results on the absence of arbitrage in multidimensional models, properties of implied volatility, and modern approaches to hedging in these models. Keywords Levy processes - exponential Levy models - absence of arbitrage - Esscher transform - implied volatility - smile modeling - quadratic hedging 1 Introduction Exponential Levy models generalize the classical Black and Scholes setup by allowing the stock prices to jump while preserving the independence and stationarity of returns. There are ample reasons for introducing jumps in financial modeling. First of all, asset prices do jump, and some risks simply cannot be handled within continuous-path models. Second, the well-documented phenomenon of implied volatility smile in option markets shows that the risk-neutral returns are non-gaussian and leptokurtic. While the smile itself can be explained within a model with continuous paths, the fact that it becomes much more pronounced for short maturities is a clear indication of the presence of jumps. In continuous-path models, the law of returns for shorter maturities becomes closer to the Gaussian law, whereas in reality and in models with jumps returns actually become less Gaussian as the horizon becomes shorter. Finally, jump processes correspond to genuinely incomplete markets, whereas all continuous-path models are either complete or "completable" with a small number of additional assets. This fundamental P. Tankov () Centre de Mathematiques Appliquees, Ecole Polytechnique, Palaiseau Cedex 91128, France e-mail: peter.tankov@polytechnique.org A.R. Carmona et al. (eds.), Paris-Princeton Lectures on Mathematical Finance 2010, Lecture Notes in Mathematics 2003, DOI 10.1007/978-3-642-14660-2_5, c Springer-Verlag Berlin Heidelberg 2011 319
320 P. Tankov incompleteness makes it possible to carry out a rigorous analysis of the hedging error and find ways to improve the hedging performance using additional instruments such as liquid European options. A great advantage of exponential Levy models is their mathematical tractability, which makes it possible to perform many computations explicitly and to present deep results of modern mathematical finance in a simple manner. This has led to an explosion of the literature on option pricing and hedging in exponential Levymodels in the late 1990s and early 2000s, the literature which now contains hundreds of research papers and several monographs. However, some fundamental aspects such as asymptotic behavior of implied volatility or the computation of hedge ratios have only recently been given a rigorous treatment. In this survey, after recalling the essential properties of Levy processes and exponential Levy models, and introducing the notation used throughout the paper, we discuss, reformulate and extend some recent results on absence of arbitrage, properties of the implied volatility and approaches to option hedging in these models. For background on exponential Levy models, the reader may refer to textbooks such as [16, 49] for a more financial perspective or [3, 34] for a more mathematical perspective. Levy processes Levy processes [3, 7, 48] are stochastic processes with stationary and independent increments. The only Levy process with continuous trajectories is the Brownian motion with drift; all other representatives of this class admit discontinuities in finite or (countably) infinite number. A general Levy process can be represented as Xt = ?t + Bt + Nt + lim ?v0 M? t , (1) where B is a d-dimensional Brownian motion with covariance matrix A, ? ? Rd, N is a compound Poisson process which includes the jumps of X with |?Xt| > 1 andM? t is a compensated compound Poisson process (compound Poisson minus its expectation) which includes the jumps of X with ? < |?Xt| ? 1. The law of a Levy process is completely identified by its characteristic triplet: the positive definite matrix A, the vector ? and the measure ? on Rd, called the Levy measure, which determines the intensity of jumps of different sizes: ?(A) is the expected number of jumps on the time interval [0, 1], whose sizes fall in A. The Levy measure satisfies the integrability condition Rd 1 ? |x|2?(dx) < ?, and ?(Rd) < ? if and only if the process has finite jump intensity. The law of Xt at all times t is determined by the triplet, and in particular, the Levy-Khintchine formula gives the characteristic function:
Pricing and Hedging in Exponential Levy Models: Review of Recent Results 321 E[eiu.Xt] := ?t(u) = et?(u), u? Rd, where ?(u) = i?.u + 12Au.u + Rd (eiu.x ? 1 ? iu.x1|x|?1)?(dx). In the above formula and everywhere in this paper, a.b denotes the dot product of vectors a and b. The jump measure of X, defined by JX([t1, t2] ? A) := #{t ? [t1, t2] : ?Xt ? A}, is a Poisson random measure with intensity dt? ?(dx), and using this notation, the representation (1) can be rewritten as Xt = ?t + Bt + t 0 |x|>1 xJX(ds ? dx) + lim ?v0 t 0 ?<|x|?1 xJ?X(ds ? dx), where ? JX(ds ? dx) := JX(ds ? dx) ? ds ? ?(dx) is the compensated version of JX. Exponential Levy models The Black-Scholes model dSt St = ?dt + ?dWt can be equivalently rewritten in the exponential form St = S0e(???2/2)t+?Wt. This gives us two possibilities to construct an exponential Levy model starting from a (one-dimensional) Levy process X: using the stochastic differential equation: dSsde t Ssde t? = rdt + dXt, (2) or using the ordinary exponential Sexp t = Sexp 0 ert+Xt , (3) where we explicitly included the interest rate r (assumed constant) in the formulas, to simplify notation later on. The subscripts sde for stochastic differential equation and exp for exponential, used here to emphasize the fact that Ssde and Sexp are different processes, will be omitted throughout the paper when there is no ambiguity. Sometimes it will be convenient to discount the price processes with the numeraire B(t, T) = e?r(T?t) for some fixed maturity T . In this case ? St := St B(t,T) = er(T?t)St and the equations become d ? St ? St? = dXt (4)
322 P. Tankov or ? St = ? S0eXt , (5) The solution to (4) with initial condition ? S0 = 1 is called the stochastic exponential of X, written explicitly as E(X)t = eXt?12[X]ct s?t:?Xs=0(1 + ?Xs)e??Xs . It can become negative if the process X has a big negative jump: ?Xs < ?1 for s ? t. However, if X does not have jumps of size less or equal to ?1, then its stochastic exponential is positive, and can be represented as the ordinary exponential of another Levy process [26], which shows that the formulations (4) and (5) are equivalent, and the choice of one or the other is simply a matter of convenience for a particular problem. Examples of exponential Levy models Parametric exponential Levy models fall into two categories. In the first category, called jump-diffusion models, the "normal" evolution of prices is given by a diffusion process, punctuated by jumps at random intervals. Here the jumps represent rare events - crashes and large drawdowns. Such an evolution can be represented by a Levy process with a nonzero Gaussian component and a jump part with finitely many jumps: Xt = ?t + ?Wt +Nt i=1 Yi, (6) where (Yi) are i.i.d. and N is a Poisson process. In the Merton model [39], which is the first model of this type, suggested in the literature, jumps in the log-price X are assumed to have a Gaussian distribution: Yi ? N(?, ?2). In the Kou model [32], jump sizes are distributed according to an asymmetric Laplace law with a density of the form ?0(dx) = [p?+e??+x1x>0 + (1 ? p)??e???|x|1x<0]dx (7) with ?+ > 0, ?? > 0 governing the decay of the tails for the distribution of positive and negative jump sizes and p ? [0, 1] representing the probability of an upward jump. The probability distribution of returns in this model has semi-heavy (exponential) tails. The second category consists of modelswith an infinite number of jumps in every interval, called infinite activity or infinite intensity models. In these models, one does not need to introduce a Brownian component since the dynamics of jumps is already rich enough to generate nontrivial small time behavior [13]. The variance gamma process [10, 38] is obtained by time-changing a Brownian motion with a gamma subordinator and has the characteristic exponent of the form:
Pricing and Hedging in Exponential Levy Models: Review of Recent Results 323 ?(u) = ?1? log(1 + u2?2? 2 ? i??u). (8) The density of the Levy measure of the variance gamma process is given by ?(x) = c |x| e???|x|1x<0 + cxe??+x1x>0, (9) where c = 1/?, ?+ = v?2+2?2/? ?2 ? ? ?2 and ?? = v?2+2?2/? ?2 + ? ?2 . To define the tempered stable process, introduced by Koponen [31] and also known under the name of CGMY model [13], one specifies directly the Levy density: ?(x) = c? |x|1+?? e???|x|1x<0 + c+ x1+?+ e??+x1x>0 (10) with ?+ < 2 and ?? < 2. 2 The Esscher Transform and Absence of Arbitrage in Exponential Levy Models To find out whether a given exponential Levy model is suitable for financial modeling, one needs to ensure that it does not contain arbitrage opportunities, a property which, by the fundamental theorem of asset pricing, is guaranteed by the existence of an equivalent martingale measure. The no arbitrage equivalences for exponential Levy models were studied in [15,28,55] in the one-dimensional unconstrained case and more recently in [30] in the multidimensional case with convex constraints on trading strategies. In this section, we start by reviewing the one-dimensional result, and then provide a multidimensional result (Theorem 2) which is valid in the unconstrained case only but is more explicit than the one in [30] and clarifies the link between the geometric properties of the Levy measure and the arbitrage opportunities in the model. In the Black-Scholes model, the unique equivalent martingale measure could be obtained by changing the drift of the Brownian motion. In models with jumps, if the Gaussian component is absent, this is no longer possible, but a much greater variety of equivalent measures can be obtained by altering the distribution of jumps. The following proposition describes the possible measure changes under which a Levy process remains a Levy process. Proposition 1 (see Sato [48], Theorems 33.1 and 33.2). Let (X,P) be a Levy process on Rd with characteristic triplet (A, ?, ?); choose ? ? Rd and ? : Rd > R with Rd (e?(x)/2 ? 1)2?(dx) < ?. (11)
324 P. Tankov and define Ut := ?.Xc + t 0 Rd (e?(x) ? 1) ? JX(ds dx), where Xc denotes the continuous martingale (Brownian motion) part of X, and ? JX is the compensated jump measure of X. Then E(U)t is a positive martingale such that the probability measure Pdefined by dP|Ft dP|Ft = E(U)t, (12) is equivalent to P and under P, X is a Levy process with characteristic triplet (A, ?, ?) where ?= e?? and ?= ? + |x|?1 x(?? ?)(dx) + A?. (13) A useful example, which will be the basis of our construction of an equivalent martingale measure is provided by the Esscher transform. Let X be a Levy process on Rd with characteristic triplet (A, ?, ?), and let ? ? Rd be such that |x|>1 e?.x?(dx) < ?. Applying a measure transformation of Proposition 1 with ? = ? and ?(x) = ?.x, we obtain an equivalent probability under which X is a Levy process with Levy measure ??(dx) = e?.x?(dx) and third component of the characteristic triplet ?? = ? + A? + |x|?1 x(e?.x ? 1)?(dx). Using Proposition 1, the Radon-Nikodym derivative corresponding to this measure change is found to be dP|Ft dP|Ft = e?.Xt E[e?.Xt ] = exp(?.Xt ? ?(?)t), (14) where ?(?) := lnE[exp(?.X1)] = ?(?i?). Although the two definitions of an exponential Levy model, via the ordinary exponential (5) or via the stochastic exponential (4), are equivalent, the set of Levy processes that lead to arbitrage-free models of the form (5) does not necessarily coincide with the set that yields arbitrage-free models of the form (4). In particular, we shall see that the no-arbitrage conditions for multidimensional stochastic and ordinary exponentials are considerably different. It will be more convenient to find these conditions for models of type (4) first and then deduce the conditions for ordinary exponentials using the transformationXt := ln E(Y )t. In themultidimensional case, this transformation must be applied to each component. In an exponential Levy model of type (4), the absence of arbitrage is tantamount to the existence of a probabilityQ equivalent to P such that E(X) is a Q-martingale. We will see that when this is the case, it is always possible to find a martingale probability Q ? P under which X remains a Levy process, which means that X itself must be a Q-martingale (cf. Proposition 8.23 in [16]).
Pricing and Hedging in Exponential Levy Models: Review of Recent Results 325 We start with the one-dimensional case. In the sequel, cc(A) denotes the smallest convex cone containing A and ri(A) denotes the relative interior of the set A, that is, the interior of A in the smallest linear subspace containing A. In particular, ri({0}) = {0}. Theorem 1 (Absence of arbitrage in models based on stochastic exponentials, one-dimensional case). Let (X, P) be a real-valued Levy process on [0, T ] with characteristic triplet (?2, ?, ?). The following statements are equivalent: 1. There exists a probability Q equivalent to P such that (X,Q) is a Levy process and a martingale. 2. Either X ? 0 or (X, P) is not a.s. monotone. 3. One of the following conditions is satisfied: (i) ? > 0. (ii) ? = 0 and |x|?1 |x|?(dx) = ?. (iii) ? = 0, |x|?1 |x|?(dx) < ? and ?b ? ri(cc(supp ?)), where b = ? ? |x|?1 x?(dx) is the drift of X. Condition (2) implies that if an exponential Levy model admits an arbitrage, it can be realized by a buy-and-hold strategy (if X is increasing) or a corresponding short sale (if X is decreasing). It is easy to see that condition (iii) above is satisfied if and only if ? = 0, |x|?1 |x|?(dx) < ? and one of the following is true: : ?((??, 0)) > 0 and ?((0,?)) > 0. : ?((??, 0)) > 0 and b > 0. : ?((0,?)) > 0 and b < 0. : The trivial case of a constant process: ? = 0 and b = 0. In other words, when a finite-variation Levy process has one-sided jumps, it is arbitrage-free if the jumps and the drift point in opposite directions. Before proceeding with the proof of Theorem 1, we will show that for onedimensional exponential Levy models of the form (5), the no-arbitrage conditions are actually the same as for stochastic exponentials. Corollary 1 (Absence of arbitrage in models based on ordinary exponential, one-dimensional case). Let (X, P) be a real-valued Levy process on [0, T ] with characteristic triplet (?2, ?, ?). The following statements are equivalent: 1. There exists a probability Q equivalent to P such that (X,Q) is a Levy process and eX is a martingale. 2. Either X ? 0 or (X, P) is not a.s. monotone. 3. One of the following conditions is satisfied: (i) ? > 0. (ii) ? = 0 and |x|?1 |x|?(dx) = ?. (iii) ? = 0, |x|?1 |x|?(dx) < ? and ?b ? ri(cc(supp ?)).
326 P. Tankov Proof. It suffices to show that ln E(X) is monotone if and only if X is monotone. From [16, Proposition 8.22] it is easy to see that ln E(X) is a finite variation process if and only ifX is a finite variation process. In the finite-variation case, the stochastic exponential has a simple form: E(X)t = ebts?t(1 + ?Xs), and it is readily seen that the monotonicity properties of X and log E(X) are the same. Proof (Proof of Theorem 1). We exclude the trivial case X ? 0 a.s. which clearly does not constitute an arbitrage opportunity (every probability is a martingale measure). The equivalence 2 ?? 3 follows from [16, Proposition 3.10]. 3 ? 1. Define a probability?P equivalent to P by d?P|FT dP|FT = E - 0 R(e?x2 ? 1) ? JX(ds dx)T Under ?P , X has characteristic triplet (?2, ??, ??) with ?? = e?x2 ? and ?? = ? + |x|?1 x(e?x2 ? 1)?(dx). It is easy to see that E?P [e?Xt ] < ? for all ? ? R and all t > 0. Suppose that the convex function ? > E?P [e?X1 ] has a finite minimizer ??. Then, using the dominated convergence theorem, E?P [X1e??X1] = 0 which implies thatX is a Q-martingale withdQ|Ft d?P|Ft = e??Xt E[e??Xt ] (Essher transform) To show the existence of a finite minimizer ??, it is sufficient to prove that E?P [e?X1 ]>?as ?>?, or, equivalently, that the function f(?) = logE?P [e?X1] = ?2 2 ?2 + ??? + R(e?x ? 1 ? ?x1|x|?1)e?x2?(dx). goes to infinity as ?>?. In case (i), f(?) ? ?2 which means that f(?)>?as ?>?. In case (ii), f(?) = ?? + |x|>1 xe?x2?(dx) + R x(e?x ? 1)e?x2?(dx), and it is not difficult to check that lim?>+? f(?) = +? and lim?>?? f(?) = ?? which means that f(?)>?as ?>?. In case (iii), f(?) = b + R xe?xe?x2?(dx),
Pricing and Hedging in Exponential Levy Models: Review of Recent Results 327 and it is easy to see, by examining one by one the different mutually exclusive cases listed after the statement of the theorem, that in each of these cases fis bounded from below on R and therefore once again, f(?)>?as ?>?. 1 ? 2. It is clear that a process cannot be a martingale under one probability and a.s. monotone under an equivalent probability, unless it is constant. In the multidimensional case, the no arbitrage conditions for ordinary and stochastic exponentials are different. We start with the simpler case of stochastic exponentials. Let (X, P) be an Rd-valued Levy process on [0, T ] with characteristic triplet (A, ?, ?). To describe the no-arbitrage conditions, we need to separate the finite and infinite variation components of X. We therefore introduce the linear subspace L ? Rd containing all vectors w ? Rd such that w.X is a finite variation process. From Proposition 3.8 and Theorem 4.1 in [16], it follows that L = N(A) ? {w ? Rd : |x|?1 |w.x|?(dx) < ?}, where N(A) := {w ? Rd : Aw = 0}. Further, denote by XL the projection of X on L. XL is a finite variation Levy process with triplet (0, ?L, ?L), and we denote its drift by bL := ?L ? L?{x:|x|?1} x?L(dx). Theorem 2 (Absence of arbitrage in models based on stochastic exponential, multidimensional case). Let (X, P) be an Rd-valued Levy process on [0, T ] with characteristic triplet (A, ?, ?). The following statements are equivalent: 1. There exists a probability Q equivalent to P such that (X,Q) is a Levy process and (Xi) is a Q-martingale for all i. 2. For every w ? Rd, the process w.X satisfies one of the equivalent conditions (2) or (3) of Theorem 1. 3. ?bL ? ri(cc(supp ?L)). Let us comment on the equivalent conditions of the above theorem. To understand condition (2), assume that for some w ? Rd, the process w.X does not satisfy the equivalent conditions of Theorem 1, meaning that it is either strictly increasing or strictly decreasing. Consider a portfolio where the relative proportions of different assets are kept constant and equal to wi. The proportions may, of course, change when the underlying assets jump, but it is assumed that they are readjusted to their constant values immediately after the jump. Such a strategy is called a fixedmix strategy. The discounted value ? Vt of such a portfolio satisfies the SDE d ? Vt = ? Vt?w.dXt, and therefore either this portfolio constitutes an arbitrage strategy or
328 P. Tankov an arbitrage strategy can be obtained by shorting this portfolio. Condition (2) thus implies that a multidimensional exponential Levy model is arbitrage-free if and only if there are no fixed-mix arbitrage strategies. The third condition is a concise characterization of arbitrage-free exponential Levy models in terms of their characteristic triplets. This condition is always satisfied if the process X has no finite-variation components: in this case L = {0} and condition (3) reduces to 0 ? {0}. If the process is of finite variation, this condition reduces to ?b ? ri(cc(supp ?)), that is, the drift and the finite variation jumps must point in opposite directions. Proof (Proof of Theorem 2). 1 ? 2 is readily obtained by an application of Theorem 1 to the process w.X. 2 ? 1. By an argument similar to the one in the proof of Theorem 1, we can suppose without loss of generality that for all ? ? Rd, E[e?.X1 ] < ?. The function f : ? > E[e?.X1 ] < ? is then a proper convex differentiable function on Rd and if ?? is a minimizer of this function, E[Xi1e??.X1] = 0 for all i = 1, . . . , d and we can define an equivalent martingale measure Q using the Esscher transform dQ|Ft dP|Ft := e??.X1 E[e??.X1 ] . Suppose that w.X is a Levy process satisfying conditions (2) or (3) of Theorem 1. Then it follows from the proof of this theorem that w.X is either constant or lim?>? E[e?w.X1] = ?. Hence, the function f is constant along every recession direction, which implies that f attains its minimum (Theorem 27.1 in [43]). 2 ? 3. Suppose ?bL /?ri(cc(supp ?L)). Then ?bL can be weakly separated from cc(supp ?L) by a hyperplane contained in L, passing through the origin, and which does not contain ?bL or cc(supp ?L) completely (Theorems 11.3 and 11.7 in [43]). This means that there exists w ? L such that bL.w?0 and x.w ?0, ?x? supp ?L with either bL.w > 0 or x.w > 0 for some x ? supp ?L. In this case, ri(cc (supp ?w)) is either {0} or (0,?), where the measure ?w is defined by ?w(A): = ?L({x?L:w.x?A}). If bL.w>0, this implies that ?bL.w /?ri(cc(supp ?w)). If bL.w = 0 then necessarily x.w >0 for some x ? supp ?L which means that in this case ri(cc(supp ?w)) = (0,?) and once again ?bL.w /?ri(cc(supp ?w)). In both cases, we have obtained a contradiction with 2. 3 ? 2. Assume that ?bL ? ri(cc(supp ?L)) and let w ? Rd. If w /? L than w.X has infinite variation and the claim is shown. Assume that w ? L and let Rw := ri(cc(supp ?w)). Rw can be equal to R, half-axis or a single point {0}. If Rw = R, there is nothing to prove. In the two other cases, ?b.w /? Rw means that w weakly separates ?bL from cc(supp ?L) in such a way that either bL.w > 0 or x.w > 0 for some x ? supp ?L, which is a contradiction with (3).
Pricing and Hedging in Exponential Levy Models: Review of Recent Results 329 Case of models based on ordinary exponentials In multidimensional models of type (5), contrary to the one-dimensional case, the no-arbitrage conditions are not the same as in models of type (4), as the following example illustrates. Let N be a standard Poisson process with intensity ? and define X1t = Nt ? ?(e ? 1)t; S1t = S10eX1t . X2t = ?Nt ? ?(e?1 ? 1)t; S2t = S20eX2t . The linear combination X1 +X2 is nonconstant and monotone, however the model is arbitrage-free since S1 and S2 are easily seen to be martingales. To check whether a model of type (5) based on an Rd-valued Levy process X is arbitrage-free, one should construct the equivalent model of type (4) by computing Y i t = lnE(Xi)t for i = 1, . . . , d, and then check the conditions of Theorem 2 for the process Y . The following remarks can facilitate this task in some commonly encountered cases: : The space L of finite variation components is invariant under the mapping ln E; therefore, if the process X does not have finite variation components, the model is arbitrage-free. : If the Levy measure ?X of X has full support then the Levy measure ?Y of Y satisfies cc(supp ?Y ) = Rd, which implies that the model is arbitrage-free. : If an orthant is contained in the support of ?X, this orthant will also be contained in cc(supp ?Y ). 3 European Options in exp-Levy Models Given the results of Sect. 2, in any "reasonable" exponential Levy model we can assume that there exists a probability measure Q equivalent to P such that the discounted prices of all assets are Q-martingales. In practice, this measure is usually found by calibrating the exponential Levy model to market quoted prices of European options [5, 17], and the first step in using the model is therefore to obtain fast pricing algorithms for European calls and puts. Prices of European options in exponential Levy models can be computed directly from the characteristic function of X which is explicitly known from the Levy- Khintchine formula. This idea was first introduced to finance by Carr and Madan [10] (for European calls and puts) and later extended and generalized by many authors including [19, 36, 37, 42]. The result given below is a slight generalization of the one in [19], allowing both discontinuous pay-off functions and Levy processes without a bounded density, such as variance gamma.
330 P. Tankov We start with a one-dimensional risk-neutral exponential Levy model in the form (5). Under the risk-neutral probability, the process eX must therefore be a martingale, a condition which can be expressed in terms of the characteristic triplet of X: ? + A2 + R(ey ? 1 ? y1|y|?1)?(dy) = 0. We consider a European option with pay-off G(ST) = G( ? ST ) at time T and denote by g its log-payoff function: G(ex) ? g(x). As above, we denote by ?t the characteristic function of Xt. Proposition 2. Suppose that there exists R = 0 such that g(x)e?Rx has finite variation on R, (15) g(x)e?Rx ? L1(R), (16) E[eRXT?t ] < ? and R |?T?t(u?iR)| 1+|u| du < ?. (17) Then the price at time t of the European option with pay-off function G satisfies P(t, St) := e?r(T?t)E[G(ST )|Ft] = e?r(T?t) 2? R ?g(u + iR)?T?t(?u ? iR) ? SR?iu t du, (18) where ?g(u) := R eiuxg(x)dx. Proof. By integration by parts for Stieltjes integrals, ?g(u + iR) = R g(x)eix(u+iR)dx = i u + iR R eix(u+iR)dg(x). (19) This implies in particular that |?g(u + iR)| ? C |u + iR|, u? R. (20) Suppose that R > 0 (the case R < 0 can be treated in a similar manner) and consider the function f(x) = eRx ? x p(dz),
Pricing and Hedging in Exponential Levy Models: Review of Recent Results 331 where p denotes the distribution of XT?t. From the assumption (17) it follows R eRxp(dx) < ? and therefore limx>? f(x) = 0. Clearly also limx>?? f(x) = 0. By integration by parts, N ?N f(x)dx = 1R N ?N eRxp(dx) + 1R(f(N) ? f(?N). This shows that f ? L1(R) and it follows that R e?iuxf(x)dx = ?T?t(?u ? iR) R ? iu . From condition (17) it follows that f can be recovered by Fourier inversion (cf. [46, Theorem 9.11]): f(x) = 1 2? R eiux ?T?t(?u ? iR) R ? iu du. (21) Let us now turn to the proof of (18). From (19), (21) and Fubini's theorem, 1 2? R ?g(u + iR)?T?t(?u ? iR) ? SR?iu t du (22) = 1 2? R dg(x)eRx R dueiux?T?t(?u ? iR)e(R?iu) log ? St R ? iu (23) = R dg(x)e?R(x?log ? St)f(x ? log ? St) = R dg(x) ? x?log ? St p(dz) (24) = R g(x + log ? St)p(dx) = EQ[G( ? ST )|Ft] = EQ[G(ST )|Ft]. (25) Example 1. The digital option has pay-off G(ST) = 1ST?K. In this case for all R > 0 conditions (15) and (16) are satisfied and ?g(u + iR) = Kiu?R R ? iu . Example 2. The European call option has pay-offG(ST) = (ST ?K)+. Therefore, conditions (15) and (16) are satisfied for allR > 1, ?g(u + iR) = Kiu+1?R (R ? iu)(R ? 1 ? iu) .
332 P. Tankov and the price of a call option can be written as an inverse Fourier transform: C(t, St) = e?r(T?t) 2? R Kiu+1?R ? SR?iu t ?T?t(?u ? iR) (R ? iu)(R ? 1 ? iu) du = St 2? R ekf (iu+1?R)?T?t(?u ? iR) (R ? iu)(R ? 1 ? iu) du where kf is the log forward moneyness defined by kf = ln(K/St) ? r(T ? t). This property allows to compute call option prices for many values of kf in a single computation using the FFT algorithm (see [10] or [16] for details). 4 Implied Volatility Recall the well-known Black-Scholes formula for call option prices: CBS(t, St, T,K, ?) = StN(d1) ? Ke?r(T?t)N(d2) (26) with d1,2 = log( St Ke?r? )  ??2/2 ?v? and N(u) ? v12? u ?? e?z2 2 dz, where ? = T ? t. If all other parameters are fixed, (26) is an increasing continuous function of ?, mapping (0,?) into ((St ? Ke?r? )+, St). The latter interval is the greatest interval allowed by arbitrage bounds on call option prices. Therefore, given the market price C?t (T,K) of a call option, one can always invert (26) and find the value of volatility parameter which, when substituted into the Black-Scholes formula, gives the correct option price: ?! ?t(T,K) > 0: CBS(t, St, T,K,?t(T,K)) = C?t (K, T ). (27) This value is called the (Black-Scholes) implied volatility of the option. For fixed (T,K), the implied volatility ?t(T,K) is in general a stochastic process and, for fixed t, its value depends on the characteristics of the option such as the maturity T and the strike level K: the function ?t : (T,K) > ?t(T,K) is called the implied volatility surface at date t (see Fig. 1). Using the log moneyness k = log(K/St) of the option, one can also represent the implied volatility surface as a function of k and time to maturity: It(?, k) = ?t(t + ?, Stek). From the independence and stationarity of increments of X, it follows that the definition of implied volatility (27) is equivalent to E[(eX? ? ek?r? )+] = E[(eIW??I2? 2 ? ek?r? )+].
Pricing and Hedging in Exponential Levy Models: Review of Recent Results 333 Fig. 1 Left: Profile of the implied volatility surface as a function of time to maturity and moneyness for the Merton jump-diffusion model with ? = 15%, ? = 1 and ? = 0.1. Right: Implied volatility surface as a function of time to maturity and moneyness for the variance gamma model using parameters taken from [38]. Note the flattening of the skew with maturity Since each side depends only on (?, k) and not on t one concludes that in exponential Levy models, the implied volatility for a given log moneyness k and time to maturity ? does not evolve in time: It(?, k) = I0(?, k) := I(?, k). This property is known as the floating smile property. In exponential Levy models, the properties of the implied volatility surfaces can be characterized in terms of the asymptotic behavior of the surface for large and small values of strike and maturity.We start with the large and small strike behavior which was first analyzed by Roger Lee [35]; this analysis was subsequently extended and made more precise by Benaim and Friz [23, 24]. Their results, reviewed below, take a particularly simple form in the case of Levy processes, because the critical exponents do not depend on time. Next, we study the short maturity asymptotics, where it turns out that the behavior of the implied volatility is very different for out of the money (OTM) and at the money (ATM) options. Below, we present some original results for the two cases. Finally, the long-maturity asymptotics were recently studied by Tehranchi [56, 57] and Rogers and Tehranchi [44]. We review their results in the case of Levy processes, where once again, the formulation is particularly simple and interesting links to the large deviations theory and Cramer's theorem can be made. Large/small strikes The limiting slope of time-rescaled implied variance as a function of log-strike turns out to be related to the critical exponents of the moment generating function of the log-price process X, defined by q?t = ?inf{u : E[euXt ] < ?}, r?t = sup{u : E[euXt ] < ?}. It is clear that the interval [?q?t , r?t ] is nonempty, because E[euXt ] < ? at least for all u ? [0, 1] by the martingale condition.
334 P. Tankov Proposition 3 (Implied volatility asymptotics at extreme strikes [23]). Fix ?>0 and suppose that r?? ? (0,?) and q?? ? (0,?) and that the moment generating function blows up in a regularly varying way around its critical exponents (see [23] for a precise definition). Then the implied volatility I(?, k) satisfies I2(?,?k)? |k| ? ?(q?? ) and I2(?, k)? k ? ?(r?? ? 1), as k > +?, where the function ? is defined by ?(x) = 2 ? 4(vx2 + x ? x). This proposition extends in a natural way to the case of infinite critical exponents: I2(?,?k)? |k| k>+? ?????> 0 if q?? = ? and I2(?, k)? k k>+? ?????> 0 if p?? = ?. This was shown already in the original work of Roger Lee [35]. For Levy processes, the exponents q? and r? do not depend on t and are particularly easy to compute, since the moment generating function is known from the Levy-Khintchine formula. In particular, the models with exponential tail decay of the Levymeasure such as variance gamma, normal inverse Gaussian and Kou satisfy the necessary conditions for the Proposition 3 and their critical exponents coincide with the inverse decay lengths: q? = ?? and r? = ?+. Figure 2 shows that the asymptotic linear slope of the implied variance as a function of log strike can be observed for values of k which are not so far from zero, especially for short maturity options. In Merton model, the tails of the Levy measure are thinner than exponential and the critical exponents q? and r? are infinite. The remark after Proposition 3 then T=1month T=3months T=1year Fig. 2 Smile asymptotics: implied variance multiplied by square root of maturity as function of log-strike in the variance gamma model with parameters taken from [38]: ? = 0.1213, ? = ?0.1436, ? = 0.1686
Pricing and Hedging in Exponential Levy Models: Review of Recent Results 335 only tells us that the limiting slope of the implied variance is zero, but other results in [24] allow to compute the exact asymptotics: for the right tail we have I2(?, k)? ? k>?? ? k 2v2 logk , when ? > 0 and I2(?, k)? ? k>?? ? k 2 logk , when ? = 0, where ? is the standard deviation of the jump size and ? is the mean jump. Short maturity asymptotics The short maturity behavior of implied volatility in exponential Levy models is very different from that observed in stochastic/local volatility models with continuous paths. While in continuous models the implied volatility usually converges to a finite nonzero value as ? > 0, in models with jumps the implied volatility of out of the money or in the money options blows up. On the other hand, the implied volatility of at-the-money options converges to the volatility of the diffusion component as ? > 0; in particular it converges to zero for pure jump models. This leads to very pronounced smiles for short maturity options (in agreement with marketquoted smiles). The intuitive explanation of this effect is that in most continuous models, the stock returns at short time scales become close to Gaussian; in particular, the skewness and excess kurtosis converge to zero as ? > 0. By contrast, in models with jumps, the distribution of stock returns at short time scales shifts further away from the Gaussian law; the skewness and kurtosis explode as v1? and 1? respectively. The short maturity asymptotics of implied volatility smile in exponential Levy models can be computed by comparing the option price asymptotics in the Black- Scholes model to those in the exponential Levy model (some results in this direction can be found in Carr and Wu [12] and Roper [45]). To simplify the developments, we suppose that the interest rate is zero. Then the normalized Black-Scholes price satisfies cBS(?, k, ?) = N(d1) ? ekN(d2), d1,2 = ?k ?v?  12?v?. Using the asymptotic expansion of the function N [1], we get, for the ATM options (k = 0): cBS(?, k, ?) ? ?vv ? 2? (28) and for other options cBS(?, k, ?) ? ek/2 k2v2??3?3/2e? k2 2?2? , (29) where the notation f ? g signifies fg > 1 as ? > 0.
336 P. Tankov In every exponential Levy model satisfying the martingale condition, we have [47] E[(eX? ? ek)+] ? ? (ex ? ek)+?(dx), fork > 0 (30) E[(ek ? eX? )+] ? ? (ek ? ex)+?(dx), fork < 0 (31) From these estimates, the following universal result can be deduced: it confirms the numerical observation of smile explosion in exponential Levy models and gives the exact rate at which this explosion takes place. Proposition 4 (Short maturity asymptotics: OTM options). Let X be a Levy process with Levy measure ? satisfying supp ? = R. Then, for a fixed log moneyness k = 0, the implied volatility I(?, k) in the exponential Levy model St = S0eXt satisfies lim ?>0 2I2(?, k)? log 1? k2 = 1. (32) Proof. Suppose first that k > 0. It is clear that I(?, k)v? > 0 as ? > 0 because otherwise the option price would not converge to 0.We then have, from OTM Black-Scholes asymptotics (29): lim ?>0 cBS(?, k, I(?, k)) C1I(?, k)3?3/2e? k2 2I2(?,k)? = 1, where C1 >0 does not depend on ?. Denote the (normalized) call price in the exponential Levy model by c(?, k). Under the full support hypothesis, c(?, k) ? C2? with C2 >0 which once again does not depend on ?. By definition of the implied volatility we then have lim ?>0 C2? C1I(?, k)3?3/2e? k2 2I2(?,k)? = 1. Taking the logarithm gives lim ?>0{log(C2/C1) + 3logI(?, k) + 12 log ? ? k2 2I2(?, k)? } = 0. Now, knowing that I2(?, k)? > 0, we can multiply all terms by I2(?, k)?: lim ?>0{I2? log(C2/C1) + 32I2? log(I2?) ? I2? log ? ? k2 2 } = 0. Since the first two terms disappear in the limit, this completes the proof in the case k > 0. The case k < 0 can be treated in a similar manner using put options.
Pricing and Hedging in Exponential Levy Models: Review of Recent Results 337 For ATMoptions, the situation is completely different, from estimate (28)we will deduce that the implied volatility does not explode but converges to the volatility of the diffusion component. Proposition 5 (Short maturity asymptotics: ATM options). 1. Let X be a Levy process without diffusion component and with Levy measure ? satisfying |x|?1 |x|?(dx) < ?. Then, the ATM implied volatility I(?, 0) in the exponential Levy model St = S0eXt falls as v? for short maturities: lim ?>0 I(?, 0) v2?? max (ex ? 1)+?(dx), (1 ? ex)+?(dx)= 1. 2. Let X be a Levy process with characteristic exponent ?(u) = i?u ? |u|?f(u) for 1 < ? < 2 and some continuous bounded function f satisfying lim u>+?f(u) = c+, lim u>??f(u) = c?, 0 < c1, c2 < ?. This includes in particular stable and tempered stable processes with 1 < ? < 2. Then, the ATM implied volatility I(?, 0) in the exponential Levy model St = S0eXt falls as ?1/??1/2 for short maturities: lim ?>0 I(?, 0) C?1/??1/2v2? = 1. with C = ?1??(?1/?)(c1/? + + c1/? ? ). 3. Let X be a Levy process with a diffusion component with volatility ? and Levy measure satisfying x2?(dx) < ?. Then the ATM implied volatility I(?, 0) in the exponential Levy model St = S0eXt converges to ? as ? > 0. The short-maturity smile asymptotics are illustrated in Fig. 3: the ATM implied volatility converges to the value of ? and the out of the money and in the money volatilities eventually become very large as ? approaches zero. Proof. 1. Let b denote the drift of X. Since X is a finite-variation process, the Ito-Tanaka formula applied to the function (1 ?eX? )+ does not yield a local time term, and we obtain E[(1 ? eX? )+] = E b ? 0 eXt1Xt?0dt + ? 0 R ?(dx){(1 ? eXt+x)+ ? (1 ? eXt )+}dt.
338 P. Tankov Fig. 3 Smile asymptotics: term structure of implied volatility for different strikes in Merton's model with parameters ? = 0.1, ? = 2, ? = ?0.1 and ? = 0.5 0.0 0.5 1.0 1.5 0.10 0.15 0.20 0.25 0.30 0.35 0.40 0.45 0.50 0.55 K=1 K=1.1 K=0.9 By L'Hopital's rule, lim ?>0 1? E[(1 ? eX? )+] = b lim ?>0E[eX? 1X??0] + lim ?>0E R ?(dx){(1 ? eX?+x)+ ? (1 ? eX? )+}. From Theorem 43.20 in [48], Xt t > b almost surely as t > 0. From this we deduce that lim?>0 E[eX? 1X??0] = 1b?0. Using the dominated convergence for the second term above, we finally obtain lim ?>0 1? E[(1 ? eX? )+] = b1b?0 + R ?(dx)(1 ? ex)+. Since by the martingale condition, b + R(ex ? 1)?(dx) = 0, this limit can be rewritten as lim ?>0 1? E[(1 ? eX? )+] =max((ex ? 1)+?(dx), (1 ? ex)+?(dx)). Comparing this expression with the Black-Scholes ATM asymptotics, we obtain the desired result. 2. Let pt denote the density of Xt (which exists and is square integrable under the hypotheses of this part). The ATM call option price is given by c(?, 0) = (ex ? 1)+pt(x)dx.
Pricing and Hedging in Exponential Levy Models: Review of Recent Results 339 Let us fix a constant? < ?1 and define ?c(?, 0) = (ex ? 1)+e?xpt(x)dx. Then it follows from results in [47] that |c(?, 0) ? ?c(?, 0)| = (ex ? 1)+(1 ? e?x)pt(dx) = O(?) as ? > 0. This means that it is sufficient to study the decay properties of ?c. This function is a scalar product of the square integrable function pt by the square integrable function (ex ? 1)+e?x. By the Plancherel theorem we then have ??c(?, 0) = 1 2? e??(u) (u ? i?)(u ? i ? i?)du = 1 2? ei??u??|u|?f(u) (u ? i?)(u ? i ? i?)du. On the other hand, direct computation shows that ei?u?du (u ? i?)(u ? i ? i?) = O(?) as ? > 0. Then, changing the variable of integration, we obtain ??c(?, 0) = ?1/? 2? ei?z?1?1/?(e?|z|?f(??1/?z) ? 1) (z ? i? 1/??)(z ? i? 1/?(1 + ?)) dz + O(?). The dominated convergence theorem then yields ???1/??c(?, 0) > 1 2? 0 ?? e?c?|z|? ? 1 z2 dz + 1 2? ? 0 e?c+|z|? ? 1 z2 dz as ? > ?. This result generalizes the findings of Carr and Wu [12]. Computing the integrals and comparing the result to the Black-Scholes at the money asymptotics, we obtain the final result. 3. Under the conditions of this part, we can write the characteristic exponent of X as ?(u) = i?u ? f(u)u2 for a continuous bounded function f satisfying limu>? f(u) = ?2 2 . Then, exactly as in the previous part, the dominated convergence theorem yields ?c?(v?, 0) ? > 1 2? R e??2u2 2 ? 1 u2 du = v?2?, which is equal to the Black-Scholes ATM asymptotics.
340 P. Tankov Flattening of the skew/smile far from maturity As the time to maturity ? goes to infinity, the implied volatility I(?, k) in an exponential Levy model converges to a constant value I(?) which does not depend on k (see Figs. 1 and 3). As a result, the implied volatility smile flattens for long maturities, a phenomenon which is also observed in the options markets, although with a slower rate. This flattening has been often attributed (e.g., [11]) to the central limit theorem, according to which, for a Levy process with finite variance, the distribution of increments (X??E[X? )])/v? becomes approximatelyGaussian as ? goes to infinity. However, contrary to this intuition, the flattening of the smile is not a consequence of the central limit theorem, but, rather, of a "large deviation" principle which governs the tail behavior of the sample average of n i.i.d. random variables. In fact, as observed by Rogers and Tehranchi [44], the implied volatility flattens even in models where log-returns have infinite variance such as the finite moment log-stable process of [11]. To understand this, consider a Levy process X with E[X1]<?. Since in a riskneutral model E[eXt] = 1, the Jensen inequality implies that E[Xt] < 0 for all t. Therefore, by the law of large numbers, Xt > ??almost surely as t > ?, which means that eXt > 0 a.s. The exercise of a long-dated call option is thus an event with a very small probability. The probability of such rare events is given by Cramer's theorem, which is the cornerstone of the theory of large deviations, rather than by the CLT. The normalized price of a call option with log-moneyness k can be written as c(?, k) = E(eX? ? ek)+ = ?P[X? ? k] ? ekP[X? ? k], where we introduce the new probability?P via the Esscher transform: dP|?Ft dP|Ft := eXt . Denote ? = E[X1] and ?? = ?E[X1]. An easy computation using Proposition 1 shows that ? = ??2 2 ? R(ex ? x ? 1)?(dx) < 0 ?? = ?2 2 + R(xex ? ex + 1)?(dx) > 0. To make the probability of a rare event appear, we rewrite the option price as c(?, k) = 1 ??P ?X? ? ??? ? > ?? ? k? ? ekP X? ? ?? ? ? ?? + k? . These probabilities can be estimated with the help of the famous Cramer's theorem which gives the exact convergence rate in the law of large numbers.
Pricing and Hedging in Exponential Levy Models: Review of Recent Results 341 Theorem 3 (Cramer). Let {Xi}i?1 be an i.i.d. sequence of random variables with E[Xi] = 0 for all i. Then for all x ? 0 lim n>? 1n log P 1nn i=1 Xi ? x= ?I(x), where I(x) is the Fenchel transform of the log-Laplace transform of X1: I(x) = sup ? (?x ? l(?)), l(?) = logE[e?X1 ]. Suppose that the Levy measure ? is such that1 |x|>1 x?(dx? ) < ? and |x|>1 xex?(dx) < ? (33) and define the log-Laplace transforms by ?l(?) := log ?E[e??(X1???)] and l(?) := logE[e?(X1??)], and the respective Fenchel transforms by ?I and I. A direct computation then shows that ?I(??) = I(??) = sup ? ?2 2 (? ? ?2) ? R(e?x ? ?ex ? 1 + ?)?(dx), and that the functions ?I and I are finite and hence, continuous, in the neighborhood of, respectively, ?? and ??. Hence the sup above can be restricted to the interval ? ? [0, 1], since the function being maximized is concave and equal to 0 for ? = 0 and ? = 1. Using Cramer's theorem and the continuity of ?I and I, we then obtain lim ?>? 1? log(1 ? c(?, k)) = sup ??[0,1]?2 2 (? ? ?2) ? R(e?x ? ?ex ? 1 + ?)?(dx). (34) Note that this formula is valid for any k, we can even take k to be a function of ? as long as k = o(?) as ? >?. Specializing this formula to the Black-Scholes model, where ? ? 0 and the sup can be computed explicitly, we get lim ?>? 1? log(1 ? cBS(?, k, ?)) = ?2 8 . 1 The finite moment log stable process of Carr andWu [12] satisfies these hypotheses although the variance of the log-price is infinite in this model.
342 P. Tankov From(34), it follows in particular that the implied volatility satisfies ?I2(?, k)>? as ? > ? (otherwise the call option price would not converge to 1). Since in the Black-Scholes model the option price depends only on ??2 but not on ? or ? separately, we can write lim ?>? 1 ?I2(?, k) log(1 ? cBS(?I2(?, k), k, 1)) = 18, and combining this with (34), we obtain the final result: Proposition 6 ([57]). Let X be a Levy process with Levy measure satisfying (33). Then the implied volatility I(?, k) in the exponential Levy model St = S0eXt satisfies lim ?>?I2(?, k) = 8sup ? ?2 2 (? ? ?2) ? R(e?x ? ?ex ? 1 + ?)?(dx). (35) The exact formula (35) for the limiting long-term implied volatility in an exponential Levy model is difficult to use in practice: even if for some models such as variance gamma it yields a closed form expression, it is rather cumbersome. However, for small jump sizes, Taylor expansion shows that this expression is not very different from the total variance of the Levy process: I2(?, k) ? ?2 + x2?(dx). The smile flattening in exponential Levy models has thus little to do with the so called aggregational normality of stock returns. One may think that the implied volatility converges to its limiting value faster for Levy processes to which the central limit theoremapplies. However, the results of Rogers and Tehranchi [44] suggest otherwise: they give the following upper bound, valid in exponential Levy models as soon as E[|Xt| < ?], for the rate of convergence of the implied volatility skew to zero:lim sup ?>? sup k1,k2?[?M,M] ? I(?, k2)2 ? I(?, k1)2 k2 ? k1 ? 4, 0<M < ?. See also [56] for explicit asymptotics of the derivative ?I(?,k) ?k as ? >?. 5 Hedging in Exponential Levy Models Exponential Levy models generally correspond to incomplete markets, making exact replication impossible. Hedging must therefore be interpreted as approximation of the terminal pay-off with an admissible portfolio. The usual practice is to
Pricing and Hedging in Exponential Levy Models: Review of Recent Results 343 minimize the expected squared deviation of the hedging portfolio from the contingent claim, an approach known as quadratic hedging. The resulting strategies are often explicitly computable and, more importantly, they are linear, because the hedging portfolios can be interpreted as orthogonal projections of contingent claims onto the closed linear subspace of hedgeable portfolios. To hedge a book of options written on the same underlying, a trader can therefore compute the hedge ratio for every option in the book and then add them up, just like this is typically done with delta hedging. This greatly reduces the computational cost of hedging and is an important advantage of quadratic hedging compared to other, e.g., utility-based approaches. To define the criterion to be minimized in a mean square sense, two approaches are possible. In the first approach [9, 29, 40], the hedging strategy is supposed to be self-financing, and one minimizes the quadratic hedging error at maturity, that is, the expected squared difference between the terminal value of the hedging portfolio and the option's pay-off: inf V0,?E[ |VT (?) ? H|2] where VT (?) = V0 + T 0 ?0tdS0t + T 0 ?tdSt, (36) where S0 is the risk-free asset. If the interest rate is constant, we can choose the zero-coupon bond with maturity T as the risk-free asset: S0t = e?r(T?t) and after discounting this problem becomes: inf ? V0,?E[|VT (?) ? H|2], where VT = V?0 + T 0 ?td ? St. In the second approach [21, 22, 50, 53], strategies that are not self-financing are allowed, but they are required to replicate the option's pay-off exactly: VT (?) = H. In an incomplete market, this means that the option's seller will have to continuously inject/withdraw money from the hedging portfolio. The cumulative amount of funds injected or withdrawn is called the cost process. It is given by Ct(?) = Vt(?) ? Gt(?), where Vt(?) = ?0tS0t + ?tSt and G is the gain process given by Gt = t 0 ?0sdS0s + t 0 ?sdSs. The discounted cost process is then given by ? Ct = ?0t+ ?t ? St ? t 0 ?sd ? Ss.
344 P. Tankov The risk-minimizing strategy, as introduced by Follmer and Sondermann [22], is a strategy which replicates the option's pay-off, and has the cost process which varies as little as possible, that is, this strategy minimizes, at each date t, the residual cost given by E[( ? CT ? ? Ct)2|Ft]. (37) over all admissible continuations of the strategy from date t onwards. The riskminimizing strategy always exists in the martingale case (when the discounted stock price is a martingale), but in the general case, it may fail to exist even in the most simple examples [50]. Motivated by this difficulty, Follmer and Schweizer [21] introduced the notion of locally risk minimizing strategy, which corresponds to finding the extremumof (37) with respect to suitably defined small perturbations of the strategy, or, in other words, measuring the riskiness of the cost process locally in time. Local risk minimization is discussed in detail in Sect. 5.2. The expectations in (37) and (36) are taken with respect to some probability which we have to specify. To begin, let us assume that we have chosen a martingale measure Q and the expectations in (36) and (37) are taken with respect to Q. In particular, ? S is a martingale under Q. Assume now that H ? L2(?,F,Q) and ? S is also square-integrable. If we consider portfolios of the form: S = {? caglad predictable and E| T 0 ?td ? St|2 < ?} (38) then the set A of attainable pay-offs is a closed linear subspace of L2(?,F,Q), and the quadratic hedging problem becomes an orthogonal projection: inf ? V0,?E|VT (?) ? H|2 = inf A?A H ? A2L2(Q). (39) The solution is then given by the well-known Galtchouk-Kunita-Watanabe decomposition [25, 33], which states that any random variable H ? L2(?,F,Q) can be represented as H = E[H] + T 0 ?Htd ? St + NHT , (40) where (NHt ) is a square integrable martingale orthogonal to ? S. The optimal hedging strategy is then given by ?H and the initial cost of the hedging portfolio is V0 = e?r(T?t)E[H]. Introducing the martingale ?Ht := E[H|Ft] generated by H, we have ?Ht = E[H] + t 0 ?Hsd ? Ss + NHt ,
Pricing and Hedging in Exponential Levy Models: Review of Recent Results 345 and the orthogonality implies?H? - 0 ?Hsd ? Ss, ? S? 0, which means that the optimal hedge ratio may be expressed more explicitly using the predictable covariation of the option price and the stock price: ?Ht= dH? , ? St d? S, ? St . (41) In the martingale setting, optimizing the global hedging error (36) we obtain a strategy which is also risk minimizing in the sense of (37). For any strategy ?, we haveE[( ? CT ? ? Ct)2|Ft] = (?Ht ? ? Vt)2 + E ??H ? ?Ht ? T t ?sd ? Ss2Ft?? = (?Ht ? ? Vt)2 + E[(NT ? Nt)2|Ft] + E ??T t (?s ? ?Hs)d ? Ss2Ft?? . To minimize this expression, we clearly need to take ? = ?H and choose ?0 such that ? Vt = ?Ht for all t. In this case, the discounted cost process is given by ? Ct = ? Vt ? t 0 ?Hsd ? Ss = E[H] + NHt . We shall see in Sect. 5.2 that in the martingale setting, the strategy ?H which minimizes the terminal hedging error also coincides with the locally risk minimizing strategy of Follmer and Schweizer [21]. Moreover, it is often easy to compute in terms of option prices. This is no longer true if ? S is not a martingale. However using the risk-neutral second moment of the hedging error as a criterion for measuring risk is not very natural:Q represents a pricing rule and not a statistical description of market events, so the profit and loss (P&L) of a portfolio may have a large variance while its "risk neutral" variance can be small. Nevertheless, to estimate the expected return of a stock, and therefore, to distinguish it from a martingale, one needs historical stock return observations covering an extended period of time, often exceeding the lifetime of the option. Option hedging, on the other hand, is a "local" business, where one tries to cancel out the daily movements of option prices with the daily movements of the underlying and locally, every stock behaves like a martingale. Without contributing to this ongoing argument, we review both approaches in the next two sections.
346 P. Tankov 5.1 Quadratic Hedging in Exponential-Levy Models Under the Martingale Measure Although the quadratic hedging problem is "solved" by the Galtchouk-Kunita- Watanabe decomposition, from a practical point of view the problem is of course to compute the risk minimizing hedge ?Ht. Formulas for ?Htwith various degrees of explicitness and under various assumptions on the driving process X and on the pay-off G were given in [6,9,20,27] and several other papers. In particular [18] provide the expressions for hedge ratios in the case when the hedging portfolio itself contains options. In the case of European pay-offs and exponential Levy models, the problem was solved in [29] using Fourier analysis techniques. Their method, reviewed in Sect. 5.2 covers the general case as well as the martingale case. In this section, we provide another Fourier-based result, which is specialized to the martingale setting but works under different regularity assumptions on the pay-off than in [29], which include, for instance, digital options. Proposition 7 (Quadratic hedge in exponential-Levy models, martingale case). Let X be a Levy process with Levy measure ?, diffusion coefficient ?, and characteristic function ?, such that eX is a martingale and assume: i. The log-payoff function satisfies the conditions (15) and (16). ii. The integrability condition (17) holds for all t < T. iii.The Levy measure of X satisfies |x|>1 e2(x?Rx)?(dx) < ?. (42) Then the optimal quadratic hedging for a European option with pay-off G(ST ) at date T in an exponential Levy model St = S0ert+Xt amounts to holding a position in the underlying ?t = 1 2? R ?g(u + iR)?T?t(?u ? iR) ? SR?iu?1 t? ?(R ? iu)du (43) where ?(y) = ?(y + 1) ? ?(y) ? ?(1) ?(2) ? 2?(1) , and ?(z) := logE[ezX1 ], (44) or, equivalently, ?t = ?(t, St?) where: ?(t, S) = ?2 ?P ?S (t, S) + 1S ?(dz)(ez ? 1)[P(t, Sez) ? P(t, S)] ?2 + (ez ? 1)2?(dz) (45) with P(t, S) = e?r(T?t)EQ[G(ST )|St = S] the option price at date t when the underlying is at the level S.
Pricing and Hedging in Exponential Levy Models: Review of Recent Results 347 Remark 1. Condition (42), which is the only assumption imposed in addition to those of Proposition 2, guarantees that both the price process St and the option pay-off G(ST ) are square integrable. Proof. By Ito formula, the discounted stock price dynamics is given by ? ST = ? S0 + T 0 ? St?dWt + T 0 R ? St(ex ? 1) ? JX(dt ? dx). (46) To prove the proposition using the formula (41), we now need to obtain a similar integral representation for the option's discounted price function ? P(t, St) = er(T?t)P(t, St). Let t < T. Applying the Ito formula under the integral sign in (18), we find ? P(t, St) ? ? P(0, S0) = 1 2? R du?g(u + iR) t 0 ?T?s(?u ? iR) (R ? iu) ? SR?iu s ?dWs + 1 2? R du?g(u + iR) t 0 ?T?s(?u ? iR) ? SR?iu s? R(e(R?iu)z ? 1) ? JX(ds ? dz). (47) Let us first assume that? > 0 and study the first term in the right-hand side of (47), which can be written as R ?(du) t 0 Hus dWs where ?(du) = |?g(u + iR)?T?t(?u ? iR)|du (48) is a finite positive measure on R and Hus = ??g(u + iR)?T?s(?u ? iR) 2?|?g(u + iR)?T?t(?u ? iR)| (R ? iu) ? SR?iu s By the Fubini theorem for stochastic integrals (see [41, p. 208]), we can interchange the two integrals in (48) provided that E t 0 ?(du)|Hus |2ds < ? (49) Under the assumption (17) it is easy to check that ?T?s(?u ? iR) |?T?t(?u ? iR)| ? C
348 P. Tankov for all s ? t ? T for some constantC > 0 which does not depend on s and t. To prove (49) it is then sufficient to check E t 0 R |?g(u + iR)?T?t(?u ? iR)|| ? S2(R?iu) s |2(R ? iu)2dudt < ? which holds because |?T?t(?u ? iR)| ? Ce?(T?t) ?2u2 2 (50) Therefore, the first term on the right-hand side of (47) is equal to t 0 ??sdWs, ??s = ? 2? R du?g(u + iR)?T?s(?u ? iR)(R ? iu) ? SR?iu s . (51) This also shows that ??s = ?Ss ?P(s,Ss) ?S . Let us now turn to the second term in the right-hand side of (47). Here we need to apply the Fubini theorem for stochastic integralswith respect to a compensated Poisson random measure [4, Theorem 5] and the applicability condition boils down to E t 0 R |?g(u+iR)?T?t(?u?iR)|| ?S2(R?iu) s |2R |e(R?iu)z?1|2?(dz)dudt < ? If? > 0, this is once again guaranteed by (50), and when ? = 0, R |e(R?iu)z ? 1|2?(dz) = ?(?2iR) ? 2?(?u ? iR). Since, for someC <?, |?(?u ? iR)?T?t(?u ? iR)| = |?(?u ? iR)e(T?t)?(?u?iR)| ? CeT?t 2 ?(?u?iR), the integrability condition is satisfied and we conclude that ? P(t, St) ? ? P(0, S0) = t 0 ??sdWs + t 0 R ??s(z) ? JX(ds ? dz) (52) for all t < T with ?? as above and ??s(z) = 1 2? R du?g(u + iR)?T?s(?u ? iR) ? SR?iu s? (e(R?iu)z ? 1) (53) = ? P(s, Ss?ez) ? ? P(s, Ss?).
Pricing and Hedging in Exponential Levy Models: Review of Recent Results 349 The optimal (risk-minimizing) hedge is obtained from formula (41): ? ?t = ? ? St??t + ? St R ?(dz)(ez ? 1)??t(z) ? S2t (?2 + R(ez ? 1)2?(dz)) . Substituting the expressions for ?? and ?? in terms of option prices into the above expression, we obtain (45) directly. On the other hand, the Fourier representations (51) and (53) and an application of Fubini's theorem yield (43). As a by-product, the martingale representation (52) also yields the expression for the residual risk of a hedging strategy: E[(?)2] =E T 0 dt R ?(dz) ? P(t, St?ez) ? ? P(t, St?) ? ? St??t(ez ? 1)2+E T 0 ? S2t? ?t ? ?P ?S (t, St?)2 ?2dt. (54) This allows us to examine whether there are any cases where the hedging error can be reduced to zero, i.e., where one can achieve a perfect hedge for every option and the market is complete. Hedging error is zero if and only if, for almost all t, there exists k ? R with: (?St ?P ?S , (P(t, Stez) ? P(t, St))z?supp ?) = k(?St, (St(ez ? 1))z?supp ?) This is only true in two (trivial) cases: : The Levy process X is a Brownian motion with drift: ? = 0 and we retrieve the Black-Scholes delta hedge ?t = ?BS(t, St) = ?P ?S (t, St). : The Levy process X is a Poisson process with drift: ? = 0 and there is a single possible jump size: ? = ?x0(x). In this case the hedging error equals E T 0 dt ? P(t, St?ex0) ? ? P(t, St?) ? ? St??t(ex0 ? 1)2so by choosing ?t = P(t, St?ex0) ? P(t, St?) St?(ex0 ? 1) we obtain a replication strategy.
350 P. Tankov In other cases, the market is incomplete (an explicit counter-example may be constructed using power option with pay-off HT = (ST )?). Delta-hedging vs. optimal strategy We see that the optimal strategy (45) can be represented as a weighted average of the delta hedging ?P ?S and a certain integral involving the sensitivities of the option price to various possible jumps. But how far is the optimal strategy from the pure delta hedging? To answer this question, if option prices are regular (e.g., when ?>0) and jumps are small, we can perform a Taylor expansion with respect to the jump size in (45), obtaining?(t, S) = ?P ?S + S 2?2 ?2P ?S2 ?(dz)(ez ? 1)3. where ?2 = ?2 + (ez ? 1)2?(dz). Typically in equity markets the jumps are negative and small, therefore ?(t, S) < ?P ?S and the optimal strategy represents a small (of the order of third power of jump size) asymmetry correction. This situation is represented in Fig. 4, left graph. On the other hand, for pure-jump processes such as variance gamma, we cannot perform the Taylor expansion, because the second derivative ?2P ?S2 may not even exist, and the correction may therefore be quite large (see Fig. 4, right graph). How big is the hedging error? To answer this question, we simulated the terminal value of the hedging portfolio and that of the option's payoff over 10,000 trajectories for different strategies and different parameter sets. 0.80 0.85 0.90 0.95 1.00 1.05 1.10 1.15 1.20 0.0 0.1 0.2 0.3 0.4 0.5 0.6 0.7 0.8 0.9 1.0 Delta Optimal 0.80 0.85 0.90 0.95 1.00 1.05 1.10 1.15 1.20 0.0 0.1 0.2 0.3 0.4 0.5 0.6 0.7 0.8 0.9 1.0 Delta Optimal Fig. 4 Hedge ratios for the optimal strategy of Proposition 7 and the delta hedging strategy as function of stock price S. Left: hedging with stock in Kou model: the optimal strategy introduces a small asymmetry correction to delta hedging. Right: variance gamma model close to maturity (2 days): the optimal strategy is very far from delta hedging
Pricing and Hedging in Exponential Levy Models: Review of Recent Results 351 Table 1 Hedging errors for different strategies in Kou model expressed in percentage of the initial stock price. Model parameters were estimated from MSFT time series. The "Black-Scholes" strategy corresponds to delta-hedging in the Black-Scholes model with equivalent volatility Strategy Root of mean squared error Delta hedging 0.0133 Optimal quadratic 0.0133 Delta hedging in Black-Scholes model (error due to discrete hedging) 0.0059 No hedging 0.107 Fig. 5 Histograms of the residual hedging error in Kou model. Left: parameters estimated from MSFT time series. This graph shows the residual hedging error in Kou model with the optimal quadratic strategy (solid line), in Kou model with the delta-hedging strategy (dashed line) and in the Black-Scholes model with the delta-hedging strategy (dash-dot line). In the latter case, the error is only due to discrete-time hedging, and this curve was include to assess the magnitude of the discretization error for other tests. Right: strong negative jumps In the first case study, Kou model with parameters estimated from market data (MSFT) during a calm period was used, and the option to hedge was a European put with strike K = 90% of the spot price and time to maturity T = 1 year. The hedging errors are given in Table 1 and the left graph in Fig. 5 shows the P&L histograms. For this parameter set, the optimal strategy is very close to delta hedging, and consequently, the hedging error is the same for delta hedging as for the optimal strategy. On the other hand, this error is very low, it is only twice as big as what we would get in the Black and Scholes model with equivalent volatility (this error in the Black-Scholes model is due to the fact that in the simulations, the portfolio is only rebalanced once a day and not continuously). In the second case study, Kou model with unfrequent large negative jumps (10%) was used, and we wanted once again to hedge an OTM European put (K = 90%, T = 1). The hedging errors are given in Table 2 and the P&L histograms in Fig. 5, right graph. Here we see that first, the optimal strategy has a much better performance than delta-hedging, and second, even this performance may not be sufficient, since the residual error is still of order of 4% of the initial stock price. This means that in this context, the market is "strongly incomplete" and hedging with stock only
352 P. Tankov Table 2 Hedging errors for different strategies in Kou model expressed in percentage of the initial stock price. A parameter set ensuring the presence of large negative jumps was taken Strategy Root of mean squared error Delta-hedging 0.051 Optimal quadratic 0.041 No hedging 0.156 does not allow to make the risk at terminal date sufficiently small. In this case, to improve the hedging performance, one can include additional liquid assets, such as options on the same underlying, or variance swaps, into the hedging portfolio. 5.2 Quadratic Hedging in Exponential Levy Models Under the Historical Measure Throughout this section, to simplify notation, we suppose that the interest rate is equal to zero; the formulas for the general case can be obtained by working with discounted claims. Let S be the price process of the underlying, and suppose that it can be written in the formSt = S0 +Mt + t 0 ?sdMs (55) for some square integrable martingaleM and some predictable process ?. If S is an exponential of a Levy processX with Levy measure ? satisfying |x|>1 e2x?(dx) < ? and diffusion coefficient ?, which can be written as St = S0 + t 0 ?Sudu + t 0 Su?dWu + t 0 R Su?(ez ? 1) ? JX(du ? dz), (56) then the representation (55) holds with Mt = t 0 Su?dWu + t 0 R Su?(ez ? 1) ? JX(du ? dz) Mt = t 0 S2u ?2 + R(ez ? 1)2?(dz)du ?t = ? St ?2 + R(ez ? 1)2?(dz)We then introduce the so-called mean-variance tradeoff process Kt := t 0 ?2sdMs.
Pricing and Hedging in Exponential Levy Models: Review of Recent Results 353 In an exponential Levy model, the mean-variance tradeoff is deterministic: Kt = ?2t ?2 + R(ez ? 1)2?(dz) . Local risk minimization The locally risk minimizing strategy [21, 51] is a (not necessarily self-financing) trading strategy whose discounted cost process ? C is a martingale orthogonal to M. This strategy is optimal in the sense that we eliminate all the risk associated to the underlying with hedging, and the only part of risk that remains in the cost process is the risk which is orthogonal to the fluctuations of the underlying, and hence, cannot be hedged with it. If the market is complete, then all risk is explained by the underlying and the cost process of a locally minimizing strategy becomes constant, that is, the strategy becomes self-financing. As already mentioned, the locally risk minimizing strategy also has the interpretation of minimizing the residual risk (37) with respect to suitably defined small perturbations of the strategy [51]. Since the cost process is nonconstant, the locally risk minimizing strategy is not a self-financing strategy in general however since C is a martingale with mean zero this strategy is self-financing on average. The locally risk minimizing strategy is closely related to an extension of the Kunita-Watanabe decomposition to semimartingale setting, known as the Follmer- Schweizer decomposition [21, 50, 53, 54]. Definition 1. LetH ?L2(P) be a contingent claim. A sum H =H0+T 0 ?HudSu+ LHTis called the Follmer-Schweizer decomposition of H if H0 is F0-measurable, ?H is an admissible trading strategy and LH is a square integrable martingale with LH0= 0, orthogonal to M. Given a Follmer-Schweizer decomposition for the claim H, the locally risk minimizing strategy for H can be constructed by taking ?t = ?Htfor all t, and choosing ?0 such that the cost process is Ct =H0 +LHtfor all t, which amounts to ?0t= H0 + LHt? ?HtSt ? t 0 ?HudSu. Relationship with the minimal martingale measure Define a process Z via Z := E(?- 0 ?sdMs) and assume that Z is a strictly positive square integrable martingale. Then we can define a new measure QM by dQ|Ft dP|Ft := Zt. By Girsanov-Meyer theorem ([41], Theorem 36 in Chap. 3), we have that (1) QM is a martingale measure, that is, S becomes a martingale under Q and (2) any square integrable martingale which is orthogonal to M under P remains a martingale under Q (although it may no longer be orthogonal to M). This measure is known as the minimal martingale measure [2, 53].
354 P. Tankov The minimal martingale measure allows to express the Follmer-Schweizer decomposition in a more explicit form. First, compute the process LH: LHt= EQM[LHT|Ft] = EQM[H|Ft] ? H0 ? t 0 ?HudSu. Since LH0=0, the initial capital for the Follmer-Schweizer strategy is H0 = EQM[H]. LetHMt := EQM [H|Ft]. The orthogonality condition under P then yields an analogue of formula (41): ?Ht= dHM, SPt dS, SPt . In models with jumps, the minimal martingale measure does not always exist as a probability measure (but may turn out to be a signed measure). In an exponential-Levy model of the form (56), the density of the minimal martingale measure simplifies to Z = E(U) with Ut = ? ? ?2 + R(ez ? 1)2?(dz) ?Wt + t 0 R(ez ? 1) ? J(ds ? dz). By Proposition 1, this yields a probability change if ?(ex ? 1) ?2 + R(ez ? 1)2?(dz) < 1 ?x ? supp ?, which imposes a strong restriction on the drift parameter ?. If this condition is not satisfied, the Follmer-Schweizer decomposition may still exist, but the interpretation using the minimal martingale measure is no longer valid, and the initial capital may turn out to be negative. The existence of a Follmer-Schweizer decomposition has been studied by many authors (see for example [2,53]), and in particular it was shown that the decomposition always exists in the case of exponential Levy models. For these models, explicit formulas for the coefficients of this decomposition for European options are given in [29]: Proposition 8 (Follmer-Schweizer decomposition for European options in exponential Levy models [29]). : Case of exponential pay-offs. Let z ? C with SzT? L2(P). Then the contingent claim H(z) = SzTadmits a Follmer-Schweizer decomposition with ?(z)t = ?(z)e?(z)(T?t)Sz?1 t? L(z)t = e?(z)(T?t)Szt ? e?(z)T Sz0 ? t 0 ?(z)udSu,
Pricing and Hedging in Exponential Levy Models: Review of Recent Results 355 where the coefficients ? and ? are given by ?(z) = k(z + 1) ? k(z) ? k(1) k(2) ? 2k(1) , ?(z) = k(z) ? k(1)?(z), and k(z) = logE[ezX1 ] is the Laplace exponent of X. : Case of arbitrary payoffs. Let the option payoff beH = f(ST ) with f of the form f(s) = sz?(dz) for some finite complex measure ? on a strip {z ? C : R? z ? R}, where R,R ? R are chosen such that E[e2RX1 ] < ? and E[e2RX1 ] < ?. Then H admits a Follmer-Schweizer decomposition with coefficients ?Ht= ?(z)t?(dz) LHt= L(z)t?(dz). Example 3. Let N1 and N2 be two standard Poisson processes with intensity 1 under P and suppose that the stock price is given by St = ?t + 2N1 t + N2 t ? 3t, and that the contingent claim to be hedged is H = 5N1T . Define Lt = N1 t ? 2N2 t + t Then L is a P-martingale and [L, S]t = 2N1 t ? 2N2 t which means that L is orthogonal to the martingale part of S under P. It is now easy to check that the Follmer-Schweizer decomposition for H is given by H = (5 ? 2?)T + LT + 2ST . The locally risk-minimizing strategy therefore consists in : Buying 2 units of the risky asset at date t = 0 (at zero price) and holding them until maturity. : Placing (5 ? 2?)T at the bank account and dynamically adding/withdrawing money according to the value of L.
356 P. Tankov The initial cost of this strategy is thus equal to H0 = (5 ? 2?)T , which can be both positive and negative (if ? > 52 ), and therefore cannot be interpreted as the price of the claim H. An intuitive explanation is that when the stock returns are very high, one can obtain a terminal pay-offwhich is (on average) positive even with a negative initial capital. The minimal martingale measure in this setting is defined by dQM|Ft dP|Ft = Zt, dZt Zt? = ??5 (2dN1 t + dN2 t ? 3dt). From Proposition 1, we deduce that QM is a probability measure if and only if ? < 52 , in which case N1 and N2 are independent Poisson processes under QM, with intensities ?1 = 1? 2? 5 and ?2 = 1? ?5 . Easy calculations show that : The martingale property of L is preserved under QM, and in particular, we can compute HMt = EQM [H|Ft] = 5?1T + 5(N1 t ? ?1t) and ?Ht= dHM, SPt dS, SPt = 2. : On the other hand, the orthogonality of S and L is not preserved under QM: this would require [L, S]t = 2N1 t ? 2N2 t to be a QM-martingale, which holds if and only if ?1 = ?2. Variance-optimal hedging An alternative approach is to choose a self-financing strategy ? and the initial capital V0 such as to minimize EP(V0 + GT (?) ? H)2. under the statistical measure P. This approach, known as mean-variance hedging or variance optimal hedging, is described in many papers including [8,9,14,29,40,54]. The general results concerning existence of optimal strategies are given in [14]. Schweizer [52] studies the case where the mean-variance tradeoff process K is deterministic and shows that in this case, the variance-optimal hedging strategy is also linked to the Follmer-Schweizer decomposition. Hubalek et al. [29] exploit these results to derive explicit formulas for the hedging strategy in the case of Levy processes. The following proposition uses the notation of Proposition 8.
Pricing and Hedging in Exponential Levy Models: Review of Recent Results 357 Proposition 9 (Mean variance hedging in exponential Levy models [29]). Let the contingent claim H be as in the second part of Proposition 8. Then the variance optimal initial capital and the variance optimal hedging strategy are given by V0 = H0 ?t = ?Ht+ ? St? (Ht? ? V0 ? Gt?(?)), (57) where ? = ?(1) ?(2)?2?(1) andHt = Szt e?(z)(T?t)?(dz). In the case of exponential Levy models, and in all models with deterministic mean-variance tradeoff, the variance optimal initial wealth is therefore equal to the initial value of the locally risk minimizing strategy. This allows to interpret the above result as a "stochastic target" approach to hedging,where the locally risk minimizing portfolio Ht plays the role of a "stochastic target" which we would like to follow because it allows to approach the option's pay-off with the least fluctuations. Since the locally risk-minimizing strategy is not self-financing, if we try to follow it with a self-financing strategy, our portfolio may deviate from the locally risk minimizing portfolio upwards or downwards. The strategy (57) measures this deviation at each date and tries to compensate it by investing more or less in the stock, depending on the sign of the expected return (? is the expected excess return divided by the square of the volatility). Acknowledgements I would like to thank all the participants of the crash course on financial modeling with jump processes in Bologna on May 21-22, 2009, and especially the organizer, Andrea Pascucci, for stimulating discussions and valuable feedback on my lectures. I am also grateful to the anonymous referee for the careful reading of the manuscript. This research is supported by the Chair Financial Risks of the Risk Foundation sponsored by Societe Generale, the Chair Derivatives of the Future sponsored by the Federation Bancaire Francaise, and the Chair Finance and Sustainable Development sponsored by EDF and Calyon. References 1. Abramowitz, M., Stegun, I. (eds.): Handbook of Mathematical Functions. Dover, New York (1968) 2. Ansel, J.P., Stricker, C.: Lois de martingale, densites et decomposition de Follmer-Schweizer. Annales de l'Institut Henri Poincare 28, 375-392 (1992) 3. Appelbaum, D.: Levy Processes and Stochastic Calculus. Cambridge Unviersity Press, Cambridge (2004) 4. Appelbaum, D.: Martingale-valued measures, Ornstein-Uhlenbeck processes with jumps and operator self-decomposability in Hilbert space. In: InMemoriam Paul-Andre Meyer, Seminaire de Probabilites, vol. XXXIX, pp. 171-196. Springer, Berlin (2006)
358 P. Tankov 5. Belomestny, D., Reiss, M.: Spectral calibration of exponential Levy models. Finance Stochast. 10, 449-474 (2006) 6. Benth, F.E., Di Nunno, G., Lokka, A., Oksendal, B., Proske, F.: Explicit representation of the minimal variance portfolio in markets driven by Levy processes. Math. finance 13, 55-72 (2003) 7. Bertoin, J.: Levy Processes. Cambridge University Press, Cambridge (1996) 8. Biagini, F., Guasoni, P.: Mean-variance hedging with random volatility jumps. Stochast. Anal. Appl. 20, 471-494 (2002) 9. Bouleau, N., Lamberton, D.: Residual risks and hedging strategies in Markovian markets. Stochast. Process. Appl. 33, 131-150 (1989) 10. Carr, P., Madan, D.: Option valuation using the fast Fourier transform. J. Comput. Finance 2, 61-73 (1998) 11. Carr, P., Wu, L.: The finite moment logstable process and option pricing. J. Finance 58, 753-778 (2003) 12. Carr, P., Wu, L.: What type of process underlies options? A simple robust test. J. Finance 58, 2581-2610 (2003) 13. Carr, P., Geman, H., Madan, D., Yor, M.: The fine structure of asset returns: An empirical investigation. J. Business 75, 305-332 (2002) 14. C? erny, A., Kallsen, J.: On the structure of general mean-variance hedging strategies. Ann. Probab. 35, 1479-1531 (2007) 15. Cherny, A.S., Shiryaev, A.N.: Change of time and measure for Levy processes. MaPhySto lecture notes series 2002-13 (2002) 16. Cont, R., Tankov, P.: Financial Modelling with Jump Processes. Chapman & Hall, London (2004) 17. Cont, R., Tankov, P.: Non-parametric calibration of jump-diffusion option pricing models. J. Comput. Finance 7, 1-49 (2004) 18. Cont, R., Tankov, P., Voltchkova, E.: Hedging with options in models with jumps. In: Stochastic Analysis and Applications - The Abel Symposium 2005. Springer, Berlin (2007) 19. Eberlein, E., Glau, K., Papapantoleon, A.: Analysis of Fourier transform valuation formulas and applications. Appl. Math. Finance 13, 211-240 (2010) 20. Follmer, H., Elliott, R.: Orthogonal martingale representation. In: Mayer-Wolf, E., Merzbach, E., Schwartz, A. (eds.) Stochastic Analysis, pp. 139-152. Academic Press, Boston (1991) 21. Follmer, H., Schweizer, M.: Hedging of contintgent claims under incomplete information. In: Davis, M.H.A., Elliott, R.J. (eds.) Applied Stochastic Analysis, pp. 389-414. Gordon and Breach, NY (1991) 22. Follmer, H., Sondermann, D.: Hedging of non-redundant contingent claims. In: Hildenbrand, W., Mas-Colell, A. (eds.) Contributions to Mathematical Economics, pp. 205-223. North Holland, Amsterdam (1986) 23. Friz, P., Benaim, S.: Smile asymptotics II: Models with known MGF. J. Appl. Probab. 45, 16-32 (2008) 24. Friz, P., Benaim, S.: Regular variation and smile asymptotics. Math. Finance 19, 1-12 (2009) 25. Galtchouk, L.: Representation des martingales engendrees par un processus a accroissements independants (cas des martingales de carre integrable). Ann. Inst. H. Poincare Sect. B (N.S.) 12, 199-211 (1976) 26. Goll, T., Kallsen, J.: Optimal portfolios for logarithmic utility. Stochast. Process. Appl. 89, 31-48 (2000) 27. Jacod, J., Meleard, S., Protter, P.: Explicit form and robustness of martingale representations. Ann. Probab. 28, 1747-1780 (2000) 28. Jakubenas, P.: On option pricing in certain incomplete markets. Proceedings of the Steklov Mathematical Institute, 237 (2002) 29. Kallsen, J., Hubalek, F., Krawczyk, L.: Variance-optimal hedging for processes with stationary independent increments. Ann. Appl. Probab. 16, 853-885 (2006) 30. Kardaras, C.: No-free-lunch equivalences for exponential Levy models under convex constraints on investment. Math. Finance 19, 161-187 (2009)
Pricing and Hedging in Exponential Levy Models: Review of Recent Results 359 31. Koponen, I.: Analytic approach to the problem of convergence of truncated Levy flights towards the Gaussian stochastic process. Phys. Rev. E 52, 1197-1199 (1995) 32. Kou, S.: A jump-diffusion model for option pricing. Manag. Sci. 48, 1086-1101 (2002) 33. Kunita, H., Watanabe, S.: On square integrable martingales. Nagoya Math. J. 30, 209-245 (1967) 34. Kyprianou, A.: Introductory Lectures on Fluctuations of Levy Processes with Applications. Springer, Berlin (2006) 35. Lee, R.: The moment formula for implied volatility at extreme strikes. Math. Finance 14, 469-480 (2004) 36. Lee, R.W.: Option pricing by transform methods: Extensions, unification and error control. J. Comput. Finance 7, 51-86 (2004) 37. Lewis, A.: A simple option formula for general jump-diffusion and other exponential Levy processes. http://www.optioncity.net (2001) 38. Madan, D., Carr, P., Chang, E.: The variance gamma process and option pricing. Eur. Finance Rev. 2, 79-105 (1998) 39. Merton, R.: Option pricing when underlying stock returns are discontinuous. J. Financ. Econ. 3, 125-144 (1976) 40. Pham, H.: Hedging and optimization problems in continuous financial models. In: Cont, R., Yong, J. (eds.) Mathematical Finance: Theory and Practice, vol. 1 of Series in Contemporary Applied Mathematics, pp. 353-381. Higher Education Press, Beijing (2000) 41. Protter, P.: Stochastic Integration and Differential Equations, 2nd edn. Springer, Berlin (2004) 42. Raible, S.: Levy Processes in Finance: Theory, Numerics and Empirical Facts, PhD thesis, Freiburg University (2000) 43. Rockafellar, R.T.: Convex Analysis. Princeton University Press, NJ (1970) 44. Rogers, L.C.G., Tehranchi, M.: Can the implied volatility surface move by parallel shifts? Finance Stochast. 14, 235-248 (2010) 45. Roper, M.: Implied volatility explosions: European calls and implied volatilities close to expiry in exponential Levy models (2008), arXiv:0809.3305 46. Rudin, W.: Real and Complex Analysis, 3rd edn. McGraw-Hill, NY (1987) 47. Ruschendorf, L., Woerner, J.H.: Expansion of transition distributions of Levy processes in small time. Bernoulli 8, 81-96 (2002) 48. Sato, K.: Levy Processes and Infinitely Divisible Distributions. Cambridge University Press, Cambridge (1999) 49. Schoutens, W.: Levy Processes in Finance: Pricing Financial Derivatives. Wiley, NY (2003) 50. Schweizer, M.: Risk-minimality and orthogonality of martingales. Stochast. Stochast. Rep. 30, 123-131 (1990) 51. Schweizer, M.: Option hedging for semimartingales. Stochast. Process. Appl. 37, 339-363 (1991) 52. Schweizer, M.: Approximating random variables by stochastic integrals. Ann. Probab. 22, 1536-1575 (1994) 53. Schweizer, M.: On the minimal martingale measure and the Follmer-Schweizer decomposition. Stochast. Anal. Appl. 13, 573-599 (1995) 54. Schweizer, M.: A guided tour through quadratic hedging approaches, pp. 538-574. Cambridge University Press, Cambridge (2001) 55. Selivanov, A.V.: On the martingale measures in exponential Levy models. Theor. Probab. Appl. 49, 261-274 (2005) 56. Tehranchi, M.R.: Asymptotics of implied volatility far from maturity. J. Appl. Probab. 46, 629-650 (2009) 57. Tehranchi, M.R.: Implied volatility: Long maturity behavior. In: Encyclopedia of Quantitative Finance. Wiley, NY (2010)
Lecture Notes in Mathematics For information about earlier volumes please contact your bookseller or Springer LNM Online archive: springerlink.com Vol. 1816: S. Albeverio, W. Schachermayer, M. Talagrand, Lectures on Probability Theory and Statistics. Ecole d'Ete de Probabilites de Saint-Flour XXX-2000. Editor: P. Bernard (2003) Vol. 1817: E. Koelink, W. Van Assche (Eds.), Orthogonal Polynomials and Special Functions. Leuven 2002 (2003) Vol. 1818: M. Bildhauer, Convex Variational Problems with Linear, nearly Linear and/or Anisotropic Growth Conditions (2003) Vol. 1819: D. Masser, Yu. V. Nesterenko, H. P. Schlickewei, W. M. Schmidt, M. Waldschmidt, Diophantine Approximation. Cetraro, Italy 2000. Editors: F. Amoroso, U. Zannier (2003) Vol. 1820: F. Hiai, H. Kosaki, Means of Hilbert Space Operators (2003) Vol. 1821: S. Teufel, Adiabatic Perturbation Theory in Quantum Dynamics (2003) Vol. 1822: S.-N. Chow, R. Conti, R. Johnson, J. Mallet-Paret, R. Nussbaum, Dynamical Systems. Cetraro, Italy 2000. Editors: J.W. Macki, P. Zecca (2003) Vol. 1823: A. M. Anile, W. Allegretto, C. Ringhofer, Mathematical Problems in Semiconductor Physics. Cetraro, Italy 1998. Editor: A. M. Anile (2003) Vol. 1824: J. A. Navarro Gonzalez, J. B. Sancho de Salas, C? - Differentiable Spaces (2003) Vol. 1825: J. H. Bramble, A. Cohen, W. Dahmen, Multiscale Problems and Methods in Numerical Simulations, Martina Franca, Italy 2001. Editor: C. Canuto (2003) Vol. 1826: K. Dohmen, Improved Bonferroni Inequalities via Abstract Tubes. Inequalities and Identities of Inclusion-Exclusion Type. VIII, 113 p, 2003. Vol. 1827: K. M. Pilgrim, Combinations of Complex Dynamical Systems. IX, 118 p, 2003. Vol. 1828: D. J. Green, Grobner Bases and the Computation of Group Cohomology. XII, 138 p, 2003. Vol. 1829: E. Altman, B. Gaujal, A. Hordijk, Discrete-Event Control of Stochastic Networks: Multimodularity and Regularity. XIV, 313 p, 2003. Vol. 1830:M. I. Gil', Operator Functions and Localization of Spectra. XIV, 256 p, 2003. Vol. 1831: A. Connes, J. Cuntz, E. Guentner, N. Higson, J. E. Kaminker, Noncommutative Geometry, Martina Franca, Italy 2002. Editors: S. Doplicher, L. Longo (2004) Vol. 1832: J. Azema, M. Emery, M. Ledoux, M. Yor (Eds.), Seminaire de Probabilites XXXVII (2003) Vol. 1833: D.-Q. Jiang, M. Qian, M.-P. Qian, Mathematical Theory of Nonequilibrium Steady States. On the Frontier of Probability and Dynamical Systems. IX, 280 p, 2004. Vol. 1834: Yo. Yomdin, G. Comte, Tame Geometry with Application in Smooth Analysis. VIII, 186 p, 2004. Vol. 1835: O.T. Izhboldin, B. Kahn, N.A. Karpenko, A. Vishik, Geometric Methods in the Algebraic Theory of Quadratic Forms. Summer School, Lens, 2000. Editor: J.-P. Tignol (2004) Vol. 1836: C. N?ast?asescu, F. Van Oystaeyen, Methods of Graded Rings. XIII, 304 p, 2004. Vol. 1837: S. Tavare, O. Zeitouni, Lectures on Probability Theory and Statistics. Ecole d'Ete de Probabilites de Saint-Flour XXXI-2001. Editor: J. Picard (2004) Vol. 1838: A.J. Ganesh, N.W. O'Connell, D.J. Wischik, Big Queues. XII, 254 p, 2004. Vol. 1839: R. Gohm, Noncommutative Stationary Processes. VIII, 170 p, 2004. Vol. 1840: B. Tsirelson,W.Werner, Lectures on Probability Theory and Statistics. Ecole d'Ete de Probabilites de Saint-Flour XXXII-2002. Editor: J. Picard (2004) Vol. 1841: W. Reichel, Uniqueness Theorems for Variational Problems by the Method of Transformation Groups (2004) Vol. 1842: T. Johnsen, A. L. Knutsen, K3 Projective Models in Scrolls (2004) Vol. 1843: B. Jefferies, Spectral Properties of Noncommuting Operators (2004) Vol. 1844: K.F. Siburg, The Principle of Least Action in Geometry and Dynamics (2004) Vol. 1845: Min Ho Lee, Mixed Automorphic Forms, Torus Bundles, and Jacobi Forms (2004) Vol. 1846: H. Ammari, H. Kang, Reconstruction of Small Inhomogeneities from Boundary Measurements (2004) Vol. 1847: T.R. Bielecki, T. Bjork, M. Jeanblanc, M. Rutkowski, J.A. Scheinkman, W. Xiong, Paris-Princeton Lectures on Mathematical Finance 2003 (2004) Vol. 1848:M. Abate, J. E. Fornaess, X. Huang, J. P. Rosay, A. Tumanov, Real Methods in Complex and CR Geometry, Martina Franca, Italy 2002. Editors: D. Zaitsev, G. Zampieri (2004) Vol. 1849: Martin L. Brown, Heegner Modules and Elliptic Curves (2004) Vol. 1850: V. D. Milman, G. Schechtman (Eds.), Geometric Aspects of Functional Analysis. Israel Seminar 2002-2003 (2004) Vol. 1851: O. Catoni, Statistical Learning Theory and Stochastic Optimization (2004) Vol. 1852: A.S. Kechris, B.D. Miller, Topics in Orbit Equivalence (2004) Vol. 1853: Ch. Favre, M. Jonsson, The Valuative Tree (2004) Vol. 1854: O. Saeki, Topology of Singular Fibers of Differential Maps (2004) Vol. 1855: G. Da Prato, P.C. Kunstmann, I. Lasiecka, A. Lunardi, R. Schnaubelt, L. Weis, Functional Analytic Methods for Evolution Equations. Editors: M. Iannelli, R. Nagel, S. Piazzera (2004) Vol. 1856: K. Back, T.R. Bielecki, C. Hipp, S. Peng, W. Schachermayer, Stochastic Methods in Finance, Bressanone/Brixen, Italy, 2003. Editors: M. Fritelli, W. Runggaldier (2004) Vol. 1857: M. Emery, M. Ledoux, M. Yor (Eds.), Seminaire de Probabilites XXXVIII (2005) Vol. 1858: A.S. Cherny, H.-J. Engelbert, Singular Stochastic Differential Equations (2005) Vol. 1859: E. Letellier, Fourier Transforms of Invariant Functions on Finite Reductive Lie Algebras (2005)
Vol. 1860: A. Borisyuk, G.B. Ermentrout, A. Friedman, D. Terman, Tutorials in Mathematical Biosciences I. Mathematical Neurosciences (2005) Vol. 1861: G. Benettin, J. Henrard, S. Kuksin, Hamiltonian Dynamics - Theory and Applications, Cetraro, Italy, 1999. Editor: A. Giorgilli (2005) Vol. 1862: B. Helffer, F. Nier, Hypoelliptic Estimates and Spectral Theory for Fokker-Planck Operators and Witten Laplacians (2005) Vol. 1863: H. Fuhr, Abstract Harmonic Analysis of Continuous Wavelet Transforms (2005) Vol. 1864: K. Efstathiou, Metamorphoses of Hamiltonian Systems with Symmetries (2005) Vol. 1865: D. Applebaum, B.V. R. Bhat, J. Kustermans, J.M. Lindsay, Quantum Independent Increment Processes I. From Classical Probability to Quantum Stochastic Calculus. Editors: M. Schurmann, U. Franz (2005) Vol. 1866: O.E. Barndorff-Nielsen, U. Franz, R. Gohm, B. Kummerer, S. Thorbjonsen, Quantum Independent Increment Processes II. Structure of Quantum Levy Processes, Classical Probability, and Physics. Editors: M. Schurmann, U. Franz, (2005) Vol. 1867: J. Sneyd (Ed.), Tutorials in Mathematical Biosciences II. Mathematical Modeling of Calcium Dynamics and Signal Transduction. (2005) Vol. 1868: J. Jorgenson, S. Lang, Posn(R) and Eisenstein Series. (2005) Vol. 1869: A. Dembo, T. Funaki, Lectures on Probability Theory and Statistics. Ecole d'Ete de Probabilites de Saint-Flour XXXIII-2003. Editor: J. Picard (2005) Vol. 1870: V.I. Gurariy, W. Lusky, Geometry of Muntz Spaces and Related Questions. (2005) Vol. 1871: P. Constantin, G. Gallavotti, A.V. Kazhikhov, Y. Meyer, S. Ukai, Mathematical Foundation of Turbulent Viscous Flows, Martina Franca, Italy, 2003. Editors: M. Cannone, T. Miyakawa (2006) Vol. 1872: A. Friedman (Ed.), Tutorials in Mathematical Biosciences III. Cell Cycle, Proliferation, and Cancer (2006) Vol. 1873: R. Mansuy, M. Yor, Random Times and Enlargements of Filtrations in a Brownian Setting (2006) Vol. 1874: M. Yor, M. Emery (Eds.), In Memoriam Paul-Andre Meyer -Seminaire de Probabilites XXXIX (2006) Vol. 1875: J. Pitman, Combinatorial Stochastic Processes. Ecole d'Ete de Probabilites de Saint-Flour XXXII-2002. Editor: J. Picard (2006) Vol. 1876: H. Herrlich, Axiom of Choice (2006) Vol. 1877: J. Steuding, Value Distributions of L-Functions (2007) Vol. 1878: R. Cerf, TheWulff Crystal in Ising and Percolation Models, Ecole d'Ete de Probabilites de Saint-Flour XXXIV-2004. Editor: Jean Picard (2006) Vol. 1879: G. Slade, The Lace Expansion and its Applications, Ecole d'Ete de Probabilites de Saint-Flour XXXIV-2004. Editor: Jean Picard (2006) Vol. 1880: S. Attal, A. Joye, C.-A. Pillet, Open Quantum Systems I, The Hamiltonian Approach (2006) Vol. 1881: S. Attal, A. Joye, C.-A. Pillet, Open Quantum Systems II, The Markovian Approach (2006) Vol. 1882: S. Attal, A. Joye, C.-A. Pillet, Open Quantum Systems III, Recent Developments (2006) Vol. 1883: W. Van Assche, F. Marcellan (Eds.), Orthogonal Polynomials and Special Functions, Computation and Application (2006) Vol. 1884: N. Hayashi, E.I. Kaikina, P.I. Naumkin, I.A. Shishmarev, Asymptotics for Dissipative Nonlinear Equations (2006) Vol. 1885: A. Telcs, The Art of Random Walks (2006) Vol. 1886: S. Takamura, Splitting Deformations of Degenerations of Complex Curves (2006) Vol. 1887: K. Habermann, L. Habermann, Introduction to Symplectic Dirac Operators (2006) Vol. 1888: J. van der Hoeven, Transseries and Real Differential Algebra (2006) Vol. 1889: G. Osipenko, Dynamical Systems, Graphs, and Algorithms (2006) Vol. 1890: M. Bunge, J. Funk, Singular Coverings of Toposes (2006) Vol. 1891: J.B. Friedlander, D.R. Heath-Brown, H. Iwaniec, J. Kaczorowski, Analytic Number Theory, Cetraro, Italy, 2002. Editors: A. Perelli, C. Viola (2006) Vol. 1892: A. Baddeley, I. Barany, R. Schneider, W.Weil, Stochastic Geometry, Martina Franca, Italy, 2004. Editor: W. Weil (2007) Vol. 1893: H. Han?mann, Local and Semi-Local Bifurcations in Hamiltonian Dynamical Systems, Results and Examples (2007) Vol. 1894: C.W. Groetsch, Stable Approximate Evaluation of Unbounded Operators (2007) Vol. 1895: L. Molnar, Selected Preserver Problems on Algebraic Structures of Linear Operators and on Function Spaces (2007) Vol. 1896: P. Massart, Concentration Inequalities and Model Selection, Ecole d'Ete de Probabilites de Saint-Flour XXXIII-2003. Editor: J. Picard (2007) Vol. 1897: R. Doney, Fluctuation Theory for Levy Processes, Ecole d'Ete de Probabilites de Saint-Flour XXXV-2005. Editor: J. Picard (2007) Vol. 1898: H.R. Beyer, Beyond Partial Differential Equations, On linear and Quasi-Linear Abstract Hyperbolic Evolution Equations (2007) Vol. 1899: Seminaire de Probabilites XL. Editors: C. Donati-Martin, M. Emery, A. Rouault, C. Stricker (2007) Vol. 1900: E. Bolthausen, A. Bovier (Eds.), Spin Glasses (2007) Vol. 1901: O. Wittenberg, Intersections de deux quadriques et pinceaux de courbes de genre 1, Intersections of Two Quadrics and Pencils of Curves of Genus 1 (2007) Vol. 1902: A. Isaev, Lectures on the Automorphism Groups of Kobayashi-Hyperbolic Manifolds (2007) Vol. 1903: G. Kresin, V. Maz'ya, Sharp Real-Part Theorems (2007) Vol. 1904: P. Giesl, Construction of Global Lyapunov Functions Using Radial Basis Functions (2007) Vol. 1905: C. Prev?ot, M. Rockner, A Concise Course on Stochastic Partial Differential Equations (2007) Vol. 1906: T. Schuster, The Method of Approximate Inverse: Theory and Applications (2007) Vol. 1907:M. Rasmussen, Attractivity and Bifurcation for Nonautonomous Dynamical Systems (2007) Vol. 1908: T.J. Lyons, M. Caruana, T. Levy, Differential Equations Driven by Rough Paths, Ecole d'Ete de Probabilites de Saint-Flour XXXIV-2004 (2007) Vol. 1909: H. Akiyoshi, M. Sakuma, M. Wada, Y. Yamashita, Punctured Torus Groups and 2-Bridge Knot Groups (I) (2007) Vol. 1910: V.D. Milman, G. Schechtman (Eds.), Geometric Aspects of Functional Analysis. Israel Seminar 2004-2005 (2007)
Vol. 1911: A. Bressan, D. Serre, M. Williams, K. Zumbrun, Hyperbolic Systems of Balance Laws. Cetraro, Italy 2003. Editor: P. Marcati (2007) Vol. 1912: V. Berinde, Iterative Approximation of Fixed Points (2007) Vol. 1913: J.E. Marsden, G. Misiolek, J.-P. Ortega, M. Perlmutter, T.S. Ratiu, Hamiltonian Reduction by Stages (2007) Vol. 1914: G. Kutyniok, Affine Density in Wavelet Analysis (2007) Vol. 1915: T. B?y?ko?glu, J. Leydold, P.F. Stadler, Laplacian Eigenvectors of Graphs. Perron-Frobenius and Faber-Krahn Type Theorems (2007) Vol. 1916: C. Villani, F. Rezakhanlou, Entropy Methods for the Boltzmann Equation. Editors: F. Golse, S. Olla (2008) Vol. 1917: I. Veseli?c, Existence and Regularity Properties of the Integrated Density of States of Random Schrodinger (2008) Vol. 1918: B. Roberts, R. Schmidt, Local Newforms for GSp(4) (2007) Vol. 1919: R.A. Carmona, I. Ekeland, A. Kohatsu-Higa, J.-M. Lasry, P.-L. Lions, H. Pham, E. Taflin, Paris-Princeton Lectures on Mathematical Finance 2004. Editors: R.A. Carmona, E. Cinlar, I. Ekeland, E. Jouini, J.A. Scheinkman, N. Touzi (2007) Vol. 1920: S.N. Evans, Probability and Real Trees. Ecole d'Ete de Probabilites de Saint-Flour XXXV-2005 (2008) Vol. 1921: J.P. Tian, Evolution Algebras and their Applications (2008) Vol. 1922: A. Friedman (Ed.), Tutorials in Mathematical BioSciences IV. Evolution and Ecology (2008) Vol. 1923: J.P.N. Bishwal, Parameter Estimation in Stochastic Differential Equations (2008) Vol. 1924: M. Wilson, Littlewood-Paley Theory and Exponential-Square Integrability (2008) Vol. 1925: M. du Sautoy, L.Woodward, Zeta Functions of Groups and Rings (2008) Vol. 1926: L. Barreira, V. Claudia, Stability of Nonautonomous Differential Equations (2008) Vol. 1927: L. Ambrosio, L. Caffarelli, M.G. Crandall, L.C. Evans, N. Fusco, Calculus of Variations and Non-Linear Partial Differential Equations. Cetraro, Italy 2005. Editors: B. Dacorogna, P. Marcellini (2008) Vol. 1928: J. Jonsson, Simplicial Complexes of Graphs (2008) Vol. 1929: Y. Mishura, Stochastic Calculus for Fractional Brownian Motion and Related Processes (2008) Vol. 1930: J.M. Urbano, The Method of Intrinsic Scaling. A Systematic Approach to Regularity for Degenerate and Singular PDEs (2008) Vol. 1931: M. Cowling, E. Frenkel, M. Kashiwara, A. Valette, D.A. Vogan, Jr., N.R.Wallach, Representation Theory and Complex Analysis. Venice, Italy 2004. Editors: E.C. Tarabusi, A. D'Agnolo, M. Picardello (2008) Vol. 1932: A.A. Agrachev, A.S. Morse, E.D. Sontag, H.J. Sussmann, V.I. Utkin, Nonlinear and Optimal Control Theory. Cetraro, Italy 2004. Editors: P. Nistri, G. Stefani (2008) Vol. 1933: M. Petkovic, Point Estimation of Root Finding Methods (2008) Vol. 1934: C. Donati-Martin, M. Emery, A. Rouault, C. Stricker (Eds.), Seminaire de Probabilites XLI (2008) Vol. 1935: A. Unterberger, Alternative Pseudodifferential Analysis (2008) Vol. 1936: P. Magal, S. Ruan (Eds.), Structured Population Models in Biology and Epidemiology (2008) Vol. 1937: G. Capriz, P. Giovine, P.M. Mariano (Eds.), Mathematical Models of Granular Matter (2008) Vol. 1938: D. Auroux, F. Catanese, M. Manetti, P. Seidel, B. Siebert, I. Smith, G. Tian, Symplectic 4-Manifolds and Algebraic Surfaces. Cetraro, Italy 2003. Editors: F. Catanese, G. Tian (2008) Vol. 1939: D. Boffi, F. Brezzi, L. Demkowicz, R.G. Duran, R.S. Falk, M. Fortin, Mixed Finite Elements, Compatibility Conditions, and Applications. Cetraro, Italy 2006. Editors: D. Boffi, L. Gastaldi (2008) Vol. 1940: J. Banasiak, V. Capasso, M.A.J. Chaplain, M. Lachowicz, J. Mie?kisz,Multiscale Problems in the Life Sciences. From Microscopic to Macroscopic. Be?dlewo, Poland 2006. Editors: V. Capasso,M. Lachowicz (2008) Vol. 1941: S.M.J. Haran, Arithmetical Investigations. Representation Theory, Orthogonal Polynomials, and Quantum Interpolations (2008) Vol. 1942: S. Albeverio, F. Flandoli, Y.G. Sinai, SPDE in Hydrodynamic. Recent Progress and Prospects. Cetraro, Italy 2005. Editors: G. Da Prato, M. Rockner (2008) Vol. 1943: L.L. Bonilla (Ed.), Inverse Problems and Imaging. Martina Franca, Italy 2002 (2008) Vol. 1944: A. Di Bartolo, G. Falcone, P. Plaumann, K. Strambach, Algebraic Groups and Lie Groups with Few Factors (2008) Vol. 1945: F. Brauer, P. van den Driessche, J. Wu (Eds.), Mathematical Epidemiology (2008) Vol. 1946: G. Allaire, A. Arnold, P. Degond, T.Y. Hou, Quantum Transport. Modelling, Analysis and Asymptotics. Cetraro, Italy 2006. Editors: N.B. Abdallah, G. Frosali (2008) Vol. 1947: D. Abramovich, M. Mari?no, M. Thaddeus, R. Vakil, Enumerative Invariants in Algebraic Geometry and String Theory. Cetraro, Italy 2005. Editors: K. Behrend, M. Manetti (2008) Vol. 1948: F. Cao, J-L. Lisani, J-M.Morel, P.Muse, F. Sur, A Theory of Shape Identification (2008) Vol. 1949: H.G. Feichtinger, B. Helffer, M.P. Lamoureux, N. Lerner, J. Toft, Pseudo-Differential Operators. Quantization and Signals. Cetraro, Italy 2006. Editors: L. Rodino, M.W.Wong (2008) Vol. 1950: M. Bramson, Stability of Queueing Networks, Ecole d'Ete de Probabilites de Saint-Flour XXXVI-2006 (2008) Vol. 1951: A. Molto, J. Orihuela, S. Troyanski, M. Valdivia, A Non Linear Transfer Technique for Renorming (2009) Vol. 1952: R. Mikhailov, I.B.S. Passi, Lower Central and Dimension Series of Groups (2009) Vol. 1953: K. Arwini, C.T.J. Dodson, Information Geometry (2008) Vol. 1954: P. Biane, L. Bouten, F. Cipriani, N. Konno, N. Privault, Q. Xu, Quantum Potential Theory. Editors: U. Franz, M. Schuermann (2008) Vol. 1955: M. Bernot, V. Caselles, J.-M. Morel, Optimal Transportation Networks (2008) Vol. 1956: C.H. Chu, Matrix Convolution Operators on Groups (2008) Vol. 1957: A. Guionnet, On Random Matrices: Macroscopic Asymptotics, Ecole d'Ete de Probabilites de Saint-Flour XXXVI-2006 (2009) Vol. 1958: M.C. Olsson, Compactifying Moduli Spaces for Abelian Varieties (2008)
Vol. 1959: Y. Nakkajima, A. Shiho, Weight Filtrations on Log Crystalline Cohomologies of Families of Open Smooth Varieties (2008) Vol. 1960: J. Lipman, M. Hashimoto, Foundations of Grothendieck Duality for Diagrams of Schemes (2009) Vol. 1961: G. Buttazzo, A. Pratelli, S. Solimini, E. Stepanov, Optimal Urban Networks via Mass Transportation (2009) Vol. 1962: R. Dalang, D. Khoshnevisan, C. Mueller, D. Nualart, Y. Xiao, A Minicourse on Stochastic Partial Differential Equations (2009) Vol. 1963: W. Siegert, Local Lyapunov Exponents (2009) Vol. 1964: W. Roth, Operator-valued Measures and Integrals for Cone-valued Functions and Integrals for Conevalued Functions (2009) Vol. 1965: C. Chidume, Geometric Properties of Banach Spaces and Nonlinear Iterations (2009) Vol. 1966: D. Deng, Y. Han, Harmonic Analysis on Spaces of Homogeneous Type (2009) Vol. 1967: B. Fresse, Modules over Operads and Functors (2009) Vol. 1968: R. Weissauer, Endoscopy for GSP(4) and the Cohomology of Siegel Modular Threefolds (2009) Vol. 1969: B. Roynette, M. Yor, Penalising Brownian Paths (2009) Vol. 1970: M. Biskup, A. Bovier, F. den Hollander, D. Ioffe, F. Martinelli, K. Neto?cny, F. Toninelli, Methods of Contemporary Mathematical Statistical Physics. Editor: R. Kotecky (2009) Vol. 1971: L. Saint-Raymond, Hydrodynamic Limits of the Boltzmann Equation (2009) Vol. 1972: T. Mochizuki, Donaldson Type Invariants for Algebraic Surfaces (2009) Vol. 1973:M.A. Berger, L.H.Kauffmann, B. Khesin,H.K. Moffatt, R.L. Ricca, De W. Sumners, Lectures on Topological Fluid Mechanics. Cetraro, Italy 2001. Editor: R.L. Ricca (2009) Vol. 1974: F. den Hollander, Random Polymers: Ecole d'Ete de Probabilites de Saint-Flour XXXVII - 2007 (2009) Vol. 1975: J.C. Rohde, Cyclic Coverings, Calabi-Yau Manifolds and Complex Multiplication (2009) Vol. 1976: N. Ginoux, The Dirac Spectrum (2009) Vol. 1977: M.J. Gursky, E. Lanconelli, A. Malchiodi, G. Tarantello, X.-J.Wang, P.C. Yang, Geometric Analysis and PDEs. Cetraro, Italy 2001. Editors: A. Ambrosetti, S.-Y.A. Chang, A. Malchiodi (2009) Vol. 1978: M. Qian, J.-S. Xie, S. Zhu, Smooth Ergodic Theory for Endomorphisms (2009) Vol. 1979: C. Donati-Martin, M. Emery, A. Rouault, C. Stricker (Eds.), ?Seminaire de Probablities XLII (2009) Vol. 1980: P. Graczyk, A. Stos (Eds.), Potential Analysis of Stable Processes and its Extensions (2009) Vol. 1981: M. Chlouveraki, Blocks and Families for Cyclotomic Hecke Algebras (2009) Vol. 1982: N. Privault, Stochastic Analysis in Discrete and Continuous Settings. With Normal Martingales (2009) Vol. 1983: H. Ammari (Ed.), Mathematical Modeling in Biomedical Imaging I. Electrical and Ultrasound Tomographies, Anomaly Detection, and Brain Imaging (2009) Vol. 1984: V. Caselles, P. Monasse, Geometric Description of Images as Topographic Maps (2010) Vol. 1985: T. Lin?, Layer-Adapted Meshes for Reaction-Convection-Diffusion Problems (2010) Vol. 1986: J.-P. Antoine, C. Trapani, Partial Inner Product Spaces. Theory and Applications (2009) Vol. 1987: J.-P. Brasselet, J. Seade, T. Suwa, Vector Fields on Singular Varieties (2010) Vol. 1988: M. Broue, Introduction to Complex Reflection Groups and Their Braid Groups (2010) Vol. 1989: I.M. Bomze, V. Demyanov, Nonlinear Optimization. Cetraro, Italy 2007. Editors: G. di Pillo, F. Schoen (2010) Vol. 1990: S. Bouc, Biset Functors for Finite Groups (2010) Vol. 1991: F. Gazzola, H.-C. Grunau, G. Sweers, Polyharmonic Boundary Value Problems (2010) Vol. 1992: A. Parmeggiani, Spectral Theory of Non-Commutative Harmonic Oscillators: An Introduction (2010) Vol. 1993: P. Dodos, Banach Spaces and Descriptive Set Theory: Selected Topics (2010) Vol. 1994: A. Baricz, Generalized Bessel Functions of the First Kind (2010) Vol. 1995: A.Y. Khapalov, Controllability of Partial Differential Equations Governed by Multiplicative Controls (2010) Vol. 1996: T. Lorenz,Mutational Analysis.A Joint Framework for Cauchy Problems In and Beyond Vector Spaces (2010) Vol. 1997: M. Banagl, Intersection Spaces, Spatial Homology Truncation, and String Theory (2010) Vol. 1998:M. Abate, E. Bedford,M. Brunella, T.-C. Dinh, D. Schleicher, N. Sibony, Holomorphic Dynamical Systems. Cetraro, Italy 2008. Editors: G. Gentili, J. Guenot, G. Patrizio (2010) Vol. 1999: H. Schoutens, The Use of Ultraproducts in Commutative Algebra (2010) Vol. 2000: H. Yserentant, Regularity and Approximability of Electronic Wave Functions (2010) Vol. 2001: T. Duquesne, O.E. Barndorff-Nielson, O. Reichmann, J. Bertoin, K.-I. Sato, J. Jacod, C. Schwab, C. Kluppelberg, Levy Matters I (2010) Vol. 2002: C. Potzsche, Geometric Theory of Discrete Nonautonomous Dynamical Systems (2010) Vol. 2003: A. Cousin, S. Crepey, O. Gueant, D. Hobson, M. Jeanblanc, J.-M. Lasry, J.-P. Laurent, P.-L. Lions, P. Tankov, Paris-Princeton Lectures on Mathematical Finance 2010. Editors: R.A. Carmona, E. Cinlar, I. Ekeland, E. Jouini, J.A. Scheinkman, N. Touzi (2011) Recent Reprints and New Editions Vol. 1702: J. Ma, J. Yong, Forward-Backward Stochastic Differential Equations and their Applications. 1999 - Corr. 3rd printing (2007) Vol. 830: J.A. Green, Polynomial Representations of GLn, with an Appendix on Schensted Correspondence and Littelmann Paths by K. Erdmann, J.A. Green and M. Schoker 1980 - 2nd corr. and augmented edition (2007) Vol. 1693: S. Simons, From Hahn-Banach to Monotonicity (Minimax and Monotonicity 1998) - 2nd exp. edition (2008) Vol. 470: R.E. Bowen, Equilibrium States and the Ergodic Theory of Anosov Diffeomorphisms. With a preface by D. Ruelle. Edited by J.-R. Chazottes. 1975 - 2nd rev. edition (2008) Vol. 523: S.A. Albeverio, R.J. Hoegh-Krohn, S. Mazzucchi, Mathematical Theory of Feynman Path Integral. 1976 - 2nd corr. and enlarged edition (2008) Vol. 1764: A. Cannas da Silva, Lectures on Symplectic Geometry 2001 - Corr. 2nd printing (2008)
LECTURE NOTES IN MATHEMATICS 123 Edited by J.-M. Morel, F. Takens, B. Teissier, P.K. Maini Editorial Policy (forMulti-Author Publications: Summer Schools/IntensiveCourses) 1. Lecture Notes aim to report new developments in all areas of mathematics and their applications -quickly, informally and at a high level. Mathematical texts analysing new developments in modelling and numerical simulation are welcome. Manuscripts should be reasonably self-contained and rounded off. Thus they may, and often will, present not only results of the author but also related work by other people. They should provide sufficient motivation, examples and applications. There should also be an introduction making the text comprehensible to a wider audience. This clearly distinguishes Lecture Notes from journal articles or technical reports which normally are very concise. Articles intended for a journal but too long to be accepted by most journals, usually do not have this "lecture notes" character. 2. In general SUMMER SCHOOLS and other similar INTENSIVE COURSES are held to present mathematical topics that are close to the frontiers of recent research to an audience at the beginning or intermediate graduate level, who may want to continue with this area of work, for a thesis or later. This makes demands on the didactic aspects of the presentation. Because the subjects of such schools are advanced, there often exists no textbook, and so ideally, the publication resulting from such a school could be a first approximation to such a textbook. Usually several authors are involved in the writing, so it is not always simple to obtain a unified approach to the presentation. For prospective publication in LNM, the resulting manuscript should not be just a collection of course notes, each of which has been developed by an individual author with little or no co-ordination with the others, and with little or no common concept. The subject matter should dictate the structure of the book, and the authorship of each part or chapter should take secondary importance. Of course the choice of authors is crucial to the quality of the material at the school and in the book, and the intention here is not to belittle their impact, but simply to say that the book should be planned to be written by these authors jointly, and not just assembled as a result of what these authors happen to submit. This represents considerable preparatory work (as it is imperative to ensure that the authors know these criteria before they invest work on a manuscript), and also considerable editing work afterwards, to get the book into final shape. Still it is the form that holds the most promise of a successful book that will be used by its intended audience, rather than yet another volume of proceedings for the library shelf. 3. Manuscripts should be submitted either to Springer's mathematics editorial in Heidelberg, or to one of the series editors. Volume editors are expected to arrange for the refereeing, to the usual scientific standards, of the individual contributions. If the resulting reports can be forwarded to us (series editors or Springer) this is very helpful. If no reports are forwarded or if other questions remain unclear in respect of homogeneity etc, the series editors may wish to consult external referees for an overall evaluation of the volume. A final decision to publish can be made only on the basis of the complete manuscript; however a preliminary decision can be based on a pre-final or incomplete manuscript. The strict minimum amount of material that will be considered should include a detailed outline describing the planned contents of each chapter. Volume editors and authors should be aware that incomplete or insufficiently close to final manuscripts almost always result in longer evaluation times. They should also be aware that parallel submission of their manuscript to another publisher while under consideration for LNM will in general lead to immediate rejection.
4. Manuscripts should in general be submitted in English. Final manuscripts should contain at least 100 pages of mathematical text and should always include - a general table of contents; - an informative introduction, with adequate motivation and perhaps some historical remarks: it should be accessible to a reader not intimately familiar with the topic treated; - a global subject index: as a rule this is genuinely helpful for the reader. Lecture Notes volumes are, as a rule, printed digitally from the authors' files.We strongly recommend that all contributions in a volume be written in LaTeX2e. To ensure best results, authors are asked to use the LaTeX2e style files available from Springer's webserver at ftp://ftp.springer.de/pub/tex/latex/svmultt1/(for summer schools/tutorials). Additional technical instructions are available on request from: lnm@springer.com. 5. Careful preparation of the manuscripts will help keep production time short besides ensuring satisfactory appearance of the finished book in print and online. After acceptance of the manuscript authors will be asked to prepare the final LaTeX source files (and also the corresponding dvi-, pdf-or zipped ps-file) together with the final printout made from these files. The LaTeX source files are essential for producing the full-text online version of the book. For the existing online volumes of LNM see: www.springerlink.com/content/110312 The actual production of a Lecture Notes volume takes approximately 12 weeks. 6. Volume editors receive a total of 50 free copies of their volume to be shared with the authors, but no royalties. They and the authors are entitled to a discount of 33.3% on the price of Springer books purchased for their personal use, if ordering directly from Springer. 7. Commitment to publish is made by letter of intent rather than by signing a formal contract. Springer-Verlag secures the copyright for each volume. Authors are free to reuse material contained in their LNM volumes in later publications: a brief written (or e-mail) request for formal permission is sufficient. Addresses: Professor J.-M. Morel, CMLA, Ecole Normale Superieure de Cachan, 61 Avenue du President Wilson, 94235 Cachan Cedex, France E-mail: Jean-Michel.Morel@cmla.ens-cachan.fr Professor F. Takens, Mathematisch Instituut, Rijksuniversiteit Groningen, Postbus 800, 9700 AV Groningen, The Netherlands E-mail: F.Takens@math.rug.nl Professor B. Teissier, Institut Mathematique de Jussieu, UMR 7586 du CNRS, Equipe "Geometrie et Dynamique", 175 rue du Chevaleret 75013 Paris, France E-mail: teissier@math.jussieu.fr For the "Mathematical Biosciences Subseries" of LNM: Professor P.K. Maini, Center for Mathematical Biology Mathematical Institute, 24-29 St Giles, Oxford OX1 3LP, UK E-mail: maini@maths.ox.ac.uk Springer, Mathematics Editorial I, Tiergartenstr. 17, 69121 Heidelberg, Germany, Tel.: +49 (6221) 487-8259 Fax: +49 (6221) 4876-8259 E-mail: lnm@springer.com